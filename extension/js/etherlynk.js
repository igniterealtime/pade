/**
 * etherlynk.js
 */

var etherlynk = (function(lynk)
{

    //-------------------------------------------------------
    //
    //  lib-jitsi-meet.js
    //
    //-------------------------------------------------------

    /*! For license information please see lib-jitsi-meet.min.js.LICENSE */
    !function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.JitsiMeetJS=t():e.JitsiMeetJS=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=56)}([function(e,t,n){var r=n(35),i=n(62),o={},a=[],s=r.levels.TRACE;e.exports={addGlobalTransport:function(e){r.addGlobalTransport(e)},removeGlobalTransport:function(e){r.removeGlobalTransport(e)},getLogger:function(e,t,n){var i=new r(s,e,t,n);return e?(o[e]=o[e]||[],o[e].push(i)):a.push(i),i},setLogLevelById:function(e,t){for(var n=t?o[t]||[]:a,r=0;r<n.length;r++)n[r].setLevel(e)},setLogLevel:function(e){s=e;for(var t=0;t<a.length;t++)a[t].setLevel(e);for(var n in o){var r=o[n]||[];for(t=0;t<r.length;t++)r[t].setLevel(e)}},levels:r.levels,LogCollector:i}},function(e,t,n){"use strict";(function(e){function r(){if(navigator.webkitGetUserMedia){h=m.RTC_BROWSER_CHROME;var e=navigator.userAgent.match(/chrome\/(\d+)\./i),t=e?parseInt(e[1],10):"undefined";return v.log("This appears to be Chrome, ver: "+t),t}return null}function i(){var e=navigator.userAgent;if(e.match(/Opera|OPR/)){h=m.RTC_BROWSER_OPERA;var t=e.match(/(Opera|OPR) ?\/?(\d+)\.?/)[2];return v.info("This appears to be Opera, ver: "+t),t}return null}function o(){if(navigator.mozGetUserMedia){h=m.RTC_BROWSER_FIREFOX;var e=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);return v.log("This appears to be Firefox, ver: "+e),e}return null}function a(){return/^((?!chrome).)*safari/i.test(navigator.userAgent)?(h=m.RTC_BROWSER_SAFARI,v.info("This appears to be Safari"),1):null}function s(){var e=void 0,t=window.navigator.userAgent,n=t.indexOf("MSIE ");n>0&&(e=parseInt(t.substring(n+5,t.indexOf(".",n)),10));var r=t.indexOf("Trident/");if(!e&&r>0){var i=t.indexOf("rv:");e=parseInt(t.substring(i+3,t.indexOf(".",i)),10)}return e&&(h=m.RTC_BROWSER_IEXPLORER,v.info("This appears to be IExplorer, ver: "+e)),e}function c(){var e=void 0,t=window.navigator.userAgent,n=t.indexOf("Edge/");return!e&&n>0&&(e=parseInt(t.substring(n+5,t.indexOf(".",n)),10)),e&&(h=m.RTC_BROWSER_EDGE,v.info("This appears to be Edge, ver: "+e)),e}function u(){var e=navigator.userAgent;if(e.match(/Electron/)){h=m.RTC_BROWSER_ELECTRON;var t=e.match(/Electron\/([\d.]+)/)[1];return v.info("This appears to be Electron, ver: "+t),t}return null}function l(){var e=navigator.userAgent;if(e.match(/JitsiMeetNW/)){h=m.RTC_BROWSER_NWJS;var t=e.match(/JitsiMeetNW\/([\d.]+)/)[1];return v.info("This appears to be JitsiMeetNW, ver: "+t),t}return null}function d(){var e=navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i),t=void 0;if(e||"ReactNative"===navigator.product){h=m.RTC_BROWSER_REACT_NATIVE;var n=void 0;e&&e.length>2&&(n=e[1],t=e[2]),n||(n="react-native"),t||(t="unknown"),console.info("This appears to be "+n+", ver: "+t)}else t=null;return t}var p=n(0),f=void n.n(p),h=void 0,v=Object(p.getLogger)(e),m={RTC_BROWSER_CHROME:"rtc_browser.chrome",RTC_BROWSER_OPERA:"rtc_browser.opera",RTC_BROWSER_FIREFOX:"rtc_browser.firefox",RTC_BROWSER_IEXPLORER:"rtc_browser.iexplorer",RTC_BROWSER_EDGE:"rtc_browser.edge",RTC_BROWSER_SAFARI:"rtc_browser.safari",RTC_BROWSER_NWJS:"rtc_browser.nwjs",RTC_BROWSER_ELECTRON:"rtc_browser.electron",RTC_BROWSER_REACT_NATIVE:"rtc_browser.react-native",doesVideoMuteByStreamRemove:function(){return!(m.isFirefox()||m.isEdge())},getBrowserType:function(){return h},getBrowserName:function(){return-1!==navigator.userAgent.indexOf("Android")?"android":h.split("rtc_browser.")[1]},isChrome:function(){return h===m.RTC_BROWSER_CHROME},isOpera:function(){return h===m.RTC_BROWSER_OPERA},isFirefox:function(){return h===m.RTC_BROWSER_FIREFOX},isIExplorer:function(){return h===m.RTC_BROWSER_IEXPLORER},isEdge:function(){return h===m.RTC_BROWSER_EDGE},isSafari:function(){return h===m.RTC_BROWSER_SAFARI},isNWJS:function(){return h===m.RTC_BROWSER_NWJS},isElectron:function(){return h===m.RTC_BROWSER_ELECTRON},isP2PSupported:function(){return!m.isEdge()},isReactNative:function(){return h===m.RTC_BROWSER_REACT_NATIVE},isTemasysPluginUsed:function(){return m.isSafari()||m.isIExplorer()&&m.getIExplorerVersion()<12},isVideoMuteOnConnInterruptedSupported:function(){return m.isChrome()},getFirefoxVersion:function(){return m.isFirefox()?f:null},getChromeVersion:function(){return m.isChrome()?f:null},getIExplorerVersion:function(){return m.isIExplorer()?f:null},getEdgeVersion:function(){return m.isEdge()?f:null},usesPlanB:function(){return!m.usesUnifiedPlan()},usesUnifiedPlan:function(){return m.isFirefox()},supportsBandwidthStatistics:function(){return!m.isFirefox()&&!m.isEdge()},supportsDataChannels:function(){return!m.isEdge()},supportsRTTStatistics:function(){return!m.isFirefox()&&!m.isEdge()},supportsSimulcast:function(){return m.isChrome()||m.isFirefox()||m.isElectron()||m.isNWJS()},supportsRtx:function(){return!m.isFirefox()},supportsRtpSender:function(){return m.isFirefox()}};f=function(){for(var e=void 0,t=[d,u,l,i,r,o,c,s,a],n=0;n<t.length;n++)if(e=t[n]())return e;return v.warn("Browser type defaults to Safari ver 1"),h=m.RTC_BROWSER_SAFARI,1}(),t.a=m}).call(t,"modules/RTC/RTCBrowserType.js")},function(e,t){function n(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];i.forEach(function(e){return e.apply(void 0,t)}),o&&o.apply(void 0,t)}function r(e){i.forEach(function(t){return t(null,null,null,null,e.reason)}),a&&a(e)}var i=[],o=window.onerror,a=window.onunhandledrejection;window.onerror=n,window.onunhandledrejection=r;var s={addHandler:function(e){i.push(e)},callErrorHandler:function(e){var t=window.onerror;t&&t(null,null,null,null,e)},callUnhandledRejectionHandler:function(e){var t=window.onunhandledrejection;t&&t(e)}};e.exports=s},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r="audio",i="video"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"AUTH_STATUS_CHANGED",function(){return r}),n.d(t,"AVAILABLE_DEVICES_CHANGED",function(){return i}),n.d(t,"AVATAR_CHANGED",function(){return o}),n.d(t,"BEFORE_STATISTICS_DISPOSED",function(){return a}),n.d(t,"CONFERENCE_ERROR",function(){return s}),n.d(t,"CONFERENCE_FAILED",function(){return c}),n.d(t,"CONFERENCE_JOINED",function(){return u}),n.d(t,"CONFERENCE_LEFT",function(){return l}),n.d(t,"CONNECTION_INTERRUPTED",function(){return d}),n.d(t,"CONNECTION_RESTORED",function(){return p}),n.d(t,"DATA_CHANNEL_OPENED",function(){return f}),n.d(t,"DISPLAY_NAME_CHANGED",function(){return h}),n.d(t,"DOMINANT_SPEAKER_CHANGED",function(){return v}),n.d(t,"DTMF_SUPPORT_CHANGED",function(){return m}),n.d(t,"ENDPOINT_MESSAGE_RECEIVED",function(){return g}),n.d(t,"JVB121_STATUS",function(){return y}),n.d(t,"KICKED",function(){return b}),n.d(t,"LAST_N_ENDPOINTS_CHANGED",function(){return S}),n.d(t,"LOCK_STATE_CHANGED",function(){return _}),n.d(t,"MESSAGE_RECEIVED",function(){return T}),n.d(t,"PARTICIPANT_CONN_STATUS_CHANGED",function(){return E}),n.d(t,"PARTCIPANT_FEATURES_CHANGED",function(){return C}),n.d(t,"PARTICIPANT_PROPERTY_CHANGED",function(){return w}),n.d(t,"P2P_STATUS",function(){return R}),n.d(t,"PHONE_NUMBER_CHANGED",function(){return k}),n.d(t,"RECORDER_STATE_CHANGED",function(){return I}),n.d(t,"VIDEO_SIP_GW_AVAILABILITY_CHANGED",function(){return P}),n.d(t,"START_MUTED_POLICY_CHANGED",function(){return A}),n.d(t,"STARTED_MUTED",function(){return D}),n.d(t,"SUBJECT_CHANGED",function(){return O}),n.d(t,"SUSPEND_DETECTED",function(){return L}),n.d(t,"TALK_WHILE_MUTED",function(){return N}),n.d(t,"TRACK_ADDED",function(){return M}),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",function(){return x}),n.d(t,"TRACK_MUTE_CHANGED",function(){return F}),n.d(t,"TRACK_REMOVED",function(){return j}),n.d(t,"TRANSCRIPTION_STATUS_CHANGED",function(){return U}),n.d(t,"USER_JOINED",function(){return B}),n.d(t,"USER_LEFT",function(){return G}),n.d(t,"USER_ROLE_CHANGED",function(){return J}),n.d(t,"USER_STATUS_CHANGED",function(){return H});var r="conference.auth_status_changed",i="conference.availableDevicesChanged",o="conference.avatarChanged",a="conference.beforeStatisticsDisposed",s="conference.error",c="conference.failed",u="conference.joined",l="conference.left",d="conference.connectionInterrupted",p="conference.connectionRestored",f="conference.dataChannelOpened",h="conference.displayNameChanged",v="conference.dominantSpeaker",m="conference.dtmfSupportChanged",g="conference.endpoint_message_received",y="conference.jvb121Status",b="conferenece.kicked",S="conference.lastNEndpointsChanged",_="conference.lock_state_changed",T="conference.messageReceived",E="conference.participant_conn_status_changed",C="conference.partcipant_features_changed",w="conference.participant_property_changed",R="conference.p2pStatus",k="conference.phoneNumberChanged",I="conference.recorderStateChanged",P="conference.videoSIPGWAvailabilityChanged",A="conference.start_muted_policy_changed",D="conference.started_muted",O="conference.subjectChanged",L="conference.suspendDetected",N="conference.talk_while_muted",M="conference.trackAdded",x="conference.audioLevelsChanged",F="conference.trackMuteChanged",j="conference.trackRemoved",U="conference.transcriptionStatusChanged",B="conference.userJoined",G="conference.userLeft",J="conference.roleChanged",H="conference.statusChanged"},function(e,t,n){"use strict";(function(e){function r(e){S||(v.a.loadScript(e||"https://api.callstats.io/static/callstats-ws.min.js",!0,!0),S=!0)}function i(e){var t=new Error;return t.stack=e.stack,t.name=(e.name||"Unknown error")+(e.gum&&e.gum.error&&e.gum.error.name?" - "+e.gum.error.name:""),t.constraintName=e.gum&&e.gum.constraints?JSON.stringify(e.gum.constraints):"",t.message=e.message,t}function o(e,t){this.rtpStatsMap=new Map,this.eventEmitter=new s.a,this.xmpp=e,this.options=t||{},this.callStatsIntegrationEnabled=this.options.callStatsID&&this.options.callStatsSecret&&!0!==o.disableThirdPartyRequests,this.callStatsIntegrationEnabled&&(p.a.isReactNative()||r(this.options.callStatsCustomScriptUrl),this.options.callStatsConfIDNamespace||y.warn('"callStatsConfIDNamespace" is not defined')),this.callsStatsInstances=new Map,o.instances.add(this)}t.a=o;var a=n(12),s=n.n(a),c=n(63),u=n(65),l=n(39),d=n(86),p=n(1),f=n(19),h=n(41),v=n.n(h),m=n(9),g=n(40),y=n(0).getLogger(e),b=void 0,S=!1;o.init=function(e){o.audioLevelsEnabled=!e.disableAudioLevels,"number"==typeof e.audioLevelsInterval&&(o.audioLevelsInterval=e.audioLevelsInterval),o.disableThirdPartyRequests=e.disableThirdPartyRequests},o.audioLevelsEnabled=!1,o.audioLevelsInterval=200,o.disableThirdPartyRequests=!1,o.analytics=c.a,Object.defineProperty(o,"instances",{get:function(){return b||(b=new Set),b}}),o.prototype.startRemoteStats=function(e){this.stopRemoteStats(e);try{var t=new d.a(e,o.audioLevelsInterval,2e3,this.eventEmitter);t.start(o.audioLevelsEnabled),this.rtpStatsMap.set(e.id,t)}catch(e){y.error("Failed to start collecting remote statistics: "+e)}},o.localStats=[],o.startLocalStats=function(e,t){if(o.audioLevelsEnabled){var n=new l.a(e,o.audioLevelsInterval,t);this.localStats.push(n),n.start()}},o.prototype.addAudioLevelListener=function(e){o.audioLevelsEnabled&&this.eventEmitter.on(g.a,e)},o.prototype.removeAudioLevelListener=function(e){o.audioLevelsEnabled&&this.eventEmitter.removeListener(g.a,e)},o.prototype.addBeforeDisposedListener=function(e){this.eventEmitter.on(g.b,e)},o.prototype.removeBeforeDisposedListener=function(e){this.eventEmitter.removeListener(g.b,e)},o.prototype.addConnectionStatsListener=function(e){this.eventEmitter.on(g.d,e)},o.prototype.removeConnectionStatsListener=function(e){this.eventEmitter.removeListener(g.d,e)},o.prototype.addByteSentStatsListener=function(e){this.eventEmitter.on(g.c,e)},o.prototype.removeByteSentStatsListener=function(e){this.eventEmitter.removeListener(g.c,e)},o.prototype.dispose=function(){try{this.callsStatsInstances.size||this.eventEmitter.emit(g.b);var e=!0,t=!1,n=void 0;try{for(var r,i=this.callsStatsInstances.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;this.stopCallStats(a.tpc)}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}var s=!0,c=!1,u=void 0;try{for(var l,d=this.rtpStatsMap.keys()[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var p=l.value;this._stopRemoteStats(p)}}catch(e){c=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw u}}this.eventEmitter&&this.eventEmitter.removeAllListeners()}finally{o.instances.delete(this)}},o.stopLocalStats=function(e){if(o.audioLevelsEnabled)for(var t=0;t<o.localStats.length;t++)if(o.localStats[t].stream===e){var n=o.localStats.splice(t,1);n[0].stop();break}},o.prototype._stopRemoteStats=function(e){var t=this.rtpStatsMap.get(e);t&&(t.stop(),this.rtpStatsMap.delete(e))},o.prototype.stopRemoteStats=function(e){this._stopRemoteStats(e.id)},o.prototype.startCallStats=function(e,t){if(this.callStatsIntegrationEnabled){if(this.callsStatsInstances.has(e.id))return void y.error("CallStats instance for ${tpc} exists already");if(!u.a.isBackendInitialized()){var n=f.a.callStatsUserName;if(!u.a.initBackend({callStatsID:this.options.callStatsID,callStatsSecret:this.options.callStatsSecret,userName:n,aliasName:this.options.callStatsAliasName}))return}y.info("Starting CallStats for "+e+"...");var r=new u.a(e,{confID:this._getCallStatsConfID(),remoteUserID:t});this.callsStatsInstances.set(e.id,r)}},o._getAllCallStatsInstances=function(){var e=new Set,t=!0,n=!1,r=void 0;try{for(var i,a=o.instances[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,c=!0,u=!1,l=void 0;try{for(var d,p=s.callsStatsInstances.values()[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value;e.add(f)}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return e},o.prototype._getCallStatsConfID=function(){return this.options.callStatsConfIDNamespace?this.options.callStatsConfIDNamespace+"/"+this.options.roomName:this.options.roomName},o.prototype.stopCallStats=function(e){var t=this.callsStatsInstances.get(e.id);t&&(1===this.callsStatsInstances.size&&this.eventEmitter.emit(g.b),this.callsStatsInstances.delete(e.id),t.sendTerminateEvent())},o.prototype.isCallstatsEnabled=function(){return this.callStatsIntegrationEnabled},o.prototype.sendConnectionResumeOrHoldEvent=function(e,t){var n=this.callsStatsInstances.get(e.id);n&&n.sendResumeOrHoldEvent(t)},o.prototype.sendIceConnectionFailedEvent=function(e){var t=this.callsStatsInstances.get(e.id);t&&t.sendIceConnectionFailedEvent(),o.analytics.sendEvent("connection.ice_failed")},o.prototype.sendMuteEvent=function(e,t,n){var r=e&&this.callsStatsInstances.get(e.id);u.a.sendMuteEvent(t,n,r)},o.prototype.sendScreenSharingEvent=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=this.callsStatsInstances.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0)i.value.sendScreenSharingEvent(e)}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}},o.prototype.sendDominantSpeakerEvent=function(){var e=!0,t=!1,n=void 0;try{for(var r,i=this.callsStatsInstances.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0)r.value.sendDominantSpeakerEvent()}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}},o.sendActiveDeviceListEvent=function(e){var t=o._getAllCallStatsInstances();if(t.size){var n=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;u.a.sendActiveDeviceListEvent(e,c)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}else u.a.sendActiveDeviceListEvent(e,null)},o.prototype.associateStreamWithVideoTag=function(e,t,n,r,i,o){var a=this.callsStatsInstances.get(e.id);a&&a.associateStreamWithVideoTag(t,n,r,i,o)},o.sendGetUserMediaFailed=function(e){var t=e instanceof m.a?i(e):e,n=o._getAllCallStatsInstances();if(n.size){var r=!0,a=!1,s=void 0;try{for(var c,l=n[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var d=c.value;u.a.sendGetUserMediaFailed(t,d)}}catch(e){a=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw s}}}else u.a.sendGetUserMediaFailed(t,null)},o.prototype.sendCreateOfferFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateOfferFailed(e)},o.prototype.sendCreateAnswerFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateAnswerFailed(e)},o.prototype.sendSetLocalDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetLocalDescFailed(e)},o.prototype.sendSetRemoteDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetRemoteDescFailed(e)},o.prototype.sendAddIceCandidateFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendAddIceCandidateFailed(e)},o.sendLog=function(e){var t=new Set,n=!0,r=!1,i=void 0;try{for(var a,s=o.instances[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;c.callsStatsInstances.size&&t.add(c.callsStatsInstances.values().next().value)}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}if(t.size){var l=!0,d=!1,p=void 0;try{for(var f,h=t[Symbol.iterator]();!(l=(f=h.next()).done);l=!0){var v=f.value;u.a.sendApplicationLog(e,v)}}catch(e){d=!0,p=e}finally{try{!l&&h.return&&h.return()}finally{if(d)throw p}}}else u.a.sendApplicationLog(e,null)},o.prototype.sendFeedback=function(e,t){u.a.sendFeedback(this._getCallStatsConfID(),e,t),o.analytics.sendEvent("feedback.rating",{value:e,detailed:t})},o.LOCAL_JID=n(88).LOCAL_JID,o.reportGlobalError=function(e){e instanceof m.a&&e.gum?o.sendGetUserMediaFailed(e):o.sendLog(e)},o.sendEventToAll=function(e,t){this.analytics.sendEvent(e,t),o.sendLog(JSON.stringify({name:e,data:t}))}}).call(t,"modules/statistics/statistics.js")},function(e,t){var n={ADD_ICE_CANDIDATE_FAILED:"xmpp.add_ice_candidate_failed",AUDIO_MUTED_BY_FOCUS:"xmpp.audio_muted_by_focus",AUTHENTICATION_REQUIRED:"xmpp.authentication_required",BRIDGE_DOWN:"xmpp.bridge_down",CALL_ACCEPTED:"xmpp.callaccepted.jingle",CALL_INCOMING:"xmpp.callincoming.jingle",CALL_ENDED:"xmpp.callended.jingle",CHAT_ERROR_RECEIVED:"xmpp.chat_error_received",CONFERENCE_SETUP_FAILED:"xmpp.conference_setup_failed",CONNECTION_ESTABLISHED:"xmpp.connection.connected",CONNECTION_FAILED:"xmpp.connection.failed",CONNECTION_INTERRUPTED:"xmpp.connection.interrupted",CONNECTION_RESTORED:"xmpp.connection.restored",CONNECTION_ICE_FAILED:"xmpp.connection.ice.failed",DISPLAY_NAME_CHANGED:"xmpp.display_name_changed",EMUC_ROOM_ADDED:"xmpp.emuc_room_added",EMUC_ROOM_REMOVED:"xmpp.emuc_room_removed",ETHERPAD:"xmpp.etherpad",FOCUS_DISCONNECTED:"xmpp.focus_disconnected",FOCUS_LEFT:"xmpp.focus_left",GRACEFUL_SHUTDOWN:"xmpp.graceful_shutdown",ICE_RESTARTING:"rtc.ice_restarting",JINGLE_ERROR:"xmpp.jingle_error",JINGLE_FATAL_ERROR:"xmpp.jingle_fatal_error",KICKED:"xmpp.kicked",LOCAL_ROLE_CHANGED:"xmpp.localrole_changed",MESSAGE_RECEIVED:"xmpp.message_received",MUC_DESTROYED:"xmpp.muc_destroyed",MUC_JOINED:"xmpp.muc_joined",MUC_MEMBER_JOINED:"xmpp.muc_member_joined",MUC_MEMBER_LEFT:"xmpp.muc_member_left",MUC_LEFT:"xmpp.muc_left",MUC_ROLE_CHANGED:"xmpp.muc_role_changed",MUC_LOCK_CHANGED:"xmpp.muc_lock_changed",PARTICIPANT_AUDIO_MUTED:"xmpp.audio_muted",PARTICIPANT_VIDEO_MUTED:"xmpp.video_muted",PARTICIPANT_VIDEO_TYPE_CHANGED:"xmpp.video_type",PARTCIPANT_FEATURES_CHANGED:"xmpp.partcipant_features_changed",PASSWORD_REQUIRED:"xmpp.password_required",PEERCONNECTION_READY:"xmpp.peerconnection_ready",PHONE_NUMBER_CHANGED:"conference.phoneNumberChanged",PRESENCE_STATUS:"xmpp.presence_status",PROMPT_FOR_LOGIN:"xmpp.prompt_for_login",READY_TO_JOIN:"xmpp.ready_to_join",RECORDER_STATE_CHANGED:"xmpp.recorderStateChanged",REMOTE_STATS:"xmpp.remote_stats",RESERVATION_ERROR:"xmpp.room_reservation_error",ROOM_CONNECT_ERROR:"xmpp.room_connect_error",ROOM_CONNECT_NOT_ALLOWED_ERROR:"xmpp.room_connect_error.not_allowed",ROOM_JOIN_ERROR:"xmpp.room_join_error",ROOM_MAX_USERS_ERROR:"xmpp.room_max_users_error",SENDING_CHAT_MESSAGE:"xmpp.sending_chat_message",SESSION_ACCEPT_TIMEOUT:"xmpp.session_accept_timeout",START_MUTED_FROM_FOCUS:"xmpp.start_muted_from_focus",SUBJECT_CHANGED:"xmpp.subject_changed",SUSPEND_DETECTED:"xmpp.suspend_detected",TRANSCRIPTION_STATUS_CHANGED:"xmpp.transcription_status_changed",TRANSPORT_INFO:"xmpp.transportinfo.jingle",VIDEO_SIP_GW_AVAILABILITY_CHANGED:"xmpp.videoSIPGWAvailabilityChanged",ICE_CONNECTION_STATE_CHANGED:"xmpp.ice_connection_state_changed",JSON_MESSAGE_RECEIVED:"xmmp.json_message_received"};e.exports=n},function(e,t){var n={CREATE_ANSWER_FAILED:"rtc.create_answer_failed",CREATE_OFFER_FAILED:"rtc.create_offer_failed",RTC_READY:"rtc.ready",DATA_CHANNEL_OPEN:"rtc.data_channel_open",ENDPOINT_CONN_STATUS_CHANGED:"rtc.endpoint_conn_status_changed",DOMINANT_SPEAKER_CHANGED:"rtc.dominant_speaker_changed",LASTN_ENDPOINT_CHANGED:"rtc.lastn_endpoint_changed",LASTN_VALUE_CHANGED:"rtc.lastn_value_changed",AVAILABLE_DEVICES_CHANGED:"rtc.available_devices_changed",TRACK_ATTACHED:"rtc.track_attached",REMOTE_TRACK_ADDED:"rtc.remote_track_added",REMOTE_TRACK_MUTE:"rtc.remote_track_mute",REMOTE_TRACK_REMOVED:"rtc.remote_track_removed",REMOTE_TRACK_UNMUTE:"rtc.remote_track_unmute",SET_LOCAL_DESCRIPTION_FAILED:"rtc.set_local_description_failed",SET_REMOTE_DESCRIPTION_FAILED:"rtc.set_remote_description_failed",AUDIO_OUTPUT_DEVICE_CHANGED:"rtc.audio_output_device_changed",DEVICE_LIST_CHANGED:"rtc.device_list_changed",DEVICE_LIST_AVAILABLE:"rtc.device_list_available",ENDPOINT_MESSAGE_RECEIVED:"rtc.endpoint_message_received",LOCAL_UFRAG_CHANGED:"rtc.local_ufrag_changed",REMOTE_UFRAG_CHANGED:"rtc.remote_ufrag_changed"};e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(12),o=n.n(i),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o.a;r(this,e),this.eventEmitter=t,this.addEventListener=this.on=this.addListener,this.removeEventListener=this.off=this.removeListener}return a(e,[{key:"addListener",value:function(e,t){this.eventEmitter.addListener(e,t)}},{key:"removeListener",value:function(e,t){this.eventEmitter.removeListener(e,t)}}]),e}();t.a=s},function(e,t,n){"use strict";function r(e,t,n){if("object"===(void 0===e?"undefined":a(e))&&void 0!==e.name)switch(this.gum={error:e,constraints:t,devices:n&&Array.isArray(n)?n.slice(0):void 0},e.name){case"PermissionDeniedError":case"SecurityError":this.name=o.PERMISSION_DENIED,this.message=s[this.name]+(this.gum.devices||[]).join(", ");break;case"DevicesNotFoundError":case"NotFoundError":this.name=o.NOT_FOUND,this.message=s[this.name]+(this.gum.devices||[]).join(", ");break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":var r=e.constraintName||e.constraint;t&&t.video&&(!n||n.indexOf("video")>-1)&&("minWidth"===r||"maxWidth"===r||"minHeight"===r||"maxHeight"===r||"width"===r||"height"===r)?(this.name=o.UNSUPPORTED_RESOLUTION,this.message=s[this.name]+i(r,t)):(this.name=o.CONSTRAINT_FAILED,this.message=s[this.name]+e.constraintName);break;default:this.name=o.GENERAL,this.message=e.message||s[this.name]}else{if("string"!=typeof e)throw new Error("Invalid arguments");s[e]?(this.name=e,this.message=t||s[e]):this.message=e}this.stack=e.stack||(new Error).stack}function i(e,t){if(t&&t.video&&t.video.mandatory)switch(e){case"width":return t.video.mandatory.minWidth;case"height":return t.video.mandatory.minHeight;default:return t.video.mandatory[e]||""}return""}var o=n(13),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s={};s[o.UNSUPPORTED_RESOLUTION]="Video resolution is not supported: ",s[o.FIREFOX_EXTENSION_NEEDED]="Firefox extension is not installed",s[o.CHROME_EXTENSION_INSTALLATION_ERROR]="Failed to install Chrome extension",s[o.CHROME_EXTENSION_USER_GESTURE_REQUIRED]="Failed to install Chrome extension - installations can only be initiated by a user gesture.",s[o.CHROME_EXTENSION_USER_CANCELED]="User canceled Chrome's screen sharing prompt",s[o.CHROME_EXTENSION_GENERIC_ERROR]="Unknown error from Chrome extension",s[o.ELECTRON_DESKTOP_PICKER_ERROR]="Unkown error from desktop picker",s[o.ELECTRON_DESKTOP_PICKER_NOT_FOUND]="Failed to detect desktop picker",s[o.GENERAL]="Generic getUserMedia error",s[o.PERMISSION_DENIED]="User denied permission to use device(s): ",s[o.NOT_FOUND]="Requested device(s) was/were not found: ",s[o.CONSTRAINT_FAILED]="Constraint could not be satisfied: ",s[o.TRACK_IS_DISPOSED]="Track has been already disposed",s[o.TRACK_NO_STREAM_FOUND]="Track does not have an associated Media Stream",s[o.NO_DATA_FROM_SOURCE]="The track has stopped receiving data from it's source",r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,t.a=r},function(e,t,n){"use strict";(function(e){var r=n(0),i=(n.n(r),n(16)),o=n.n(i),a=n(1),s=Object(r.getLogger)(e),c={filterSpecialChars:function(e){return e?e.replace(/[\\\/\{,\}\+]/g,""):e},iceparams:function(e,t){var n=null,r=void 0,i=void 0;return(i=c.findLine(e,"a=ice-ufrag:",t))&&(r=c.findLine(e,"a=ice-pwd:",t))&&(n={ufrag:c.parseICEUfrag(i),pwd:c.parseICEPwd(r)}),n},parseICEUfrag:function(e){return e.substring(12)},buildICEUfrag:function(e){return"a=ice-ufrag:"+e},parseICEPwd:function(e){return e.substring(10)},buildICEPwd:function(e){return"a=ice-pwd:"+e},parseMID:function(e){return e.substring(6)},parseMLine:function(e){var t={},n=e.substring(2).split(" ");return t.media=n.shift(),t.port=n.shift(),t.proto=n.shift(),""===n[n.length-1]&&n.pop(),t.fmt=n,t},buildMLine:function(e){return"m="+e.media+" "+e.port+" "+e.proto+" "+e.fmt.join(" ")},parseRTPMap:function(e){var t={},n=e.substring(9).split(" ");return t.id=n.shift(),n=n[0].split("/"),t.name=n.shift(),t.clockrate=n.shift(),t.channels=n.length?n.shift():"1",t},parseSCTPMap:function(e){var t=e.substring(10).split(" ");return[t[0],t[1],t.length>2?t[2]:null]},buildRTPMap:function(e){var t="a=rtpmap:"+e.getAttribute("id")+" "+e.getAttribute("name")+"/"+e.getAttribute("clockrate");return e.getAttribute("channels")&&"1"!==e.getAttribute("channels")&&(t+="/"+e.getAttribute("channels")),t},parseCrypto:function(e){var t={},n=e.substring(9).split(" ");return t.tag=n.shift(),t["crypto-suite"]=n.shift(),t["key-params"]=n.shift(),n.length&&(t["session-params"]=n.join(" ")),t},parseFingerprint:function(e){var t={},n=e.substring(14).split(" ");return t.hash=n.shift(),t.fingerprint=n.shift(),t},parseFmtp:function(e){var t=[],n=e.split(" ");n.shift(),n=n.join(" ").split(";");for(var r=0;r<n.length;r++){for(var i=n[r].split("=")[0];i.length&&" "===i[0];)i=i.substring(1);var o=n[r].split("=")[1];i&&o?t.push({name:i,value:o}):i&&t.push({name:"",value:i})}return t},parseICECandidate:function(e){var t={},n=e.split(" ");t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation=0;for(var r=8;r<n.length;r+=2)switch(n[r]){case"raddr":t["rel-addr"]=n[r+1];break;case"rport":t["rel-port"]=n[r+1];break;case"generation":t.generation=n[r+1];break;case"tcptype":t.tcptype=n[r+1];break;default:s.log('parseICECandidate not translating "'+n[r]+'" = "'+n[r+1]+'"')}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},buildICECandidate:function(e){var t=["a=candidate:"+e.foundation,e.component,e.protocol,e.priority,e.ip,e.port,"typ",e.type].join(" ");switch(t+=" ",e.type){case"srflx":case"prflx":case"relay":e.hasOwnAttribute("rel-addr")&&e.hasOwnAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e["rel-addr"],t+=" ",t+="rport",t+=" ",t+=e["rel-port"],t+=" ")}return e.hasOwnAttribute("tcptype")&&(t+="tcptype",t+=" ",t+=e.tcptype,t+=" "),t+="generation",t+=" ",t+=e.hasOwnAttribute("generation")?e.generation:"0"},parseSSRC:function(e){for(var t={},n=e.split("\r\n"),r=0;r<n.length;r++)if("a=ssrc:"===n[r].substring(0,7)){var i=n[r].indexOf(" ");t[n[r].substr(i+1).split(":",2)[0]]=n[r].substr(i+1).split(":",2)[1]}return t},parseRTCPFB:function(e){var t=e.substr(10).split(" "),n={};return n.pt=t.shift(),n.type=t.shift(),n.params=t,n},parseExtmap:function(e){var t=e.substr(9).split(" "),n={};return n.value=t.shift(),-1===n.value.indexOf("/")?n.direction="both":(n.direction=n.value.substr(n.value.indexOf("/")+1),n.value=n.value.substr(0,n.value.indexOf("/"))),n.uri=t.shift(),n.params=t,n},findLine:function(e,t,n){for(var r=e.split("\r\n"),i=0;i<r.length;i++)if(r[i].substring(0,t.length)===t)return r[i];if(!n)return!1;r=n.split("\r\n");for(var o=0;o<r.length;o++)if(r[o].substring(0,t.length)===t)return r[o];return!1},findLines:function(e,t,n){for(var r=e.split("\r\n"),i=[],o=0;o<r.length;o++)r[o].substring(0,t.length)===t&&i.push(r[o]);if(i.length||!n)return i;r=n.split("\r\n");for(var a=0;a<r.length;a++)r[a].substring(0,t.length)===t&&i.push(r[a]);return i},candidateToJingle:function(e){if(0===e.indexOf("candidate:"))e="a="+e;else if("a=candidate:"!==e.substring(0,12))return s.log("parseCandidate called with a line that is not a candidate line"),s.log(e),null;"\r\n"===e.substring(e.length-2)&&(e=e.substring(0,e.length-2));var t={},n=e.split(" ");if("typ"!==n[6])return s.log("did not find typ in the right place"),s.log(e),null;t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation="0";for(var r=8;r<n.length;r+=2)switch(n[r]){case"raddr":t["rel-addr"]=n[r+1];break;case"rport":t["rel-port"]=n[r+1];break;case"generation":t.generation=n[r+1];break;case"tcptype":t.tcptype=n[r+1];break;default:s.log('not translating "'+n[r]+'" = "'+n[r+1]+'"')}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},candidateFromJingle:function(e){var t="a=candidate:";t+=e.getAttribute("foundation"),t+=" ",t+=e.getAttribute("component"),t+=" ";var n=e.getAttribute("protocol");switch(a.a.isFirefox()&&"ssltcp"===n.toLowerCase()&&(n="tcp"),t+=n,t+=" ",t+=e.getAttribute("priority"),t+=" ",t+=e.getAttribute("ip"),t+=" ",t+=e.getAttribute("port"),t+=" ",t+="typ",t+=" "+e.getAttribute("type"),t+=" ",e.getAttribute("type")){case"srflx":case"prflx":case"relay":e.getAttribute("rel-addr")&&e.getAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e.getAttribute("rel-addr"),t+=" ",t+="rport",t+=" ",t+=e.getAttribute("rel-port"),t+=" ")}return"tcp"===n.toLowerCase()&&(t+="tcptype",t+=" ",t+=e.getAttribute("tcptype"),t+=" "),t+="generation",t+=" ",(t+=e.getAttribute("generation")||"0")+"\r\n"},parsePrimaryVideoSsrc:function(e){var t=e.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t}).length,n=e.ssrcGroups&&e.ssrcGroups.length||0;if(!(t>1&&0===n)){var r=null;if(1===t)r=e.ssrcs[0].id;else if(2===t){var i=e.ssrcGroups.find(function(e){return"FID"===e.semantics});i&&(r=i.ssrcs.split(" ")[0])}else if(t>=3){var o=e.ssrcGroups.find(function(e){return"SIM"===e.semantics});o&&(r=o.ssrcs.split(" ")[0])}return r}},generateSsrc:function(){return o.a.randomInt(1,4294967295)},getSsrcAttribute:function(e,t,n){for(var r=0;r<e.ssrcs.length;++r){var i=e.ssrcs[r];if(i.id===t&&i.attribute===n)return i.value}},parseGroupSsrcs:function(e){return e.ssrcs.split(" ").map(function(e){return parseInt(e,10)})},getMedia:function(e,t){return e.media.find(function(e){return e.type===t})},getUfrag:function(e){var t=e.split("\n").filter(function(e){return e.startsWith("a=ice-ufrag:")});if(t.length>0)return t[0].substr("a=ice-ufrag:".length)},preferVideoCodec:function(e,t){var n=null;if(t){for(var r=0;r<e.rtp.length;++r){var i=e.rtp[r];if(i.codec&&i.codec.toLowerCase()===t.toLowerCase()){n=i.payload;break}}if(n){var o=e.payloads.split(" ").map(function(e){return parseInt(e,10)}),a=o.indexOf(n);o.splice(a,1),o.unshift(n),e.payloads=o.join(" ")}}}};t.a=c}).call(t,"modules/xmpp/SDPUtil.js")},function(e,t,n){var r=n(120),i=n(121);t.write=i,t.parse=r.parse,t.parseFmtpConfig=r.parseFmtpConfig,t.parseParams=r.parseParams,t.parsePayloads=r.parsePayloads,t.parseRemoteCandidates=r.parseRemoteCandidates,t.parseImageAttributes=r.parseImageAttributes,t.parseSimulcastStreamList=r.parseSimulcastStreamList},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function o(e){return"object"===(void 0===e?"undefined":s(e))&&null!==e}function a(e){return void 0===e}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,s,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(n=this._events[e],a(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(o(n))for(s=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,c=0;c<i;c++)u[c].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(i=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,a,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(s=a;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CHROME_EXTENSION_GENERIC_ERROR",function(){return r}),n.d(t,"CHROME_EXTENSION_INSTALLATION_ERROR",function(){return i}),n.d(t,"CHROME_EXTENSION_USER_GESTURE_REQUIRED",function(){return o}),n.d(t,"CHROME_EXTENSION_USER_CANCELED",function(){return a}),n.d(t,"CONSTRAINT_FAILED",function(){return s}),n.d(t,"ELECTRON_DESKTOP_PICKER_ERROR",function(){return c}),n.d(t,"ELECTRON_DESKTOP_PICKER_NOT_FOUND",function(){return u}),n.d(t,"FIREFOX_EXTENSION_NEEDED",function(){return l}),n.d(t,"GENERAL",function(){return d}),n.d(t,"NOT_FOUND",function(){return p}),n.d(t,"PERMISSION_DENIED",function(){return f}),n.d(t,"TRACK_IS_DISPOSED",function(){return h}),n.d(t,"TRACK_NO_STREAM_FOUND",function(){return v}),n.d(t,"UNSUPPORTED_RESOLUTION",function(){return m}),n.d(t,"NO_DATA_FROM_SOURCE",function(){return g});var r="gum.chrome_extension_generic_error",i="gum.chrome_extension_installation_error",o="gum.chrome_extension_user_gesture_required",a="gum.chrome_extension_user_canceled",s="gum.constraint_failed",c="gum.electron_desktop_picker_error",u="gum.electron_desktop_picker_not_found",l="gum.firefox_extension_needed",d="gum.general",p="gum.not_found",f="gum.permission_denied",h="track.track_is_disposed",v="track.no_stream_found",m="gum.unsupported_resolution",g="track.no_data_from_source"},function(e,t){var n={CAMERA:"camera",DESKTOP:"desktop"};e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"LOCAL_TRACK_STOPPED",function(){return r}),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",function(){return i}),n.d(t,"TRACK_AUDIO_OUTPUT_CHANGED",function(){return o}),n.d(t,"TRACK_MUTE_CHANGED",function(){return a}),n.d(t,"TRACK_VIDEOTYPE_CHANGED",function(){return s}),n.d(t,"NO_DATA_FROM_SOURCE",function(){return c});var r="track.stopped",i="track.audioLevelsChanged",o="track.audioOutputChanged",a="track.trackMuteChanged",s="track.videoTypeChanged",c="track.no_data_from_source"},function(e,t){function n(e,t){return Math.floor(Math.random()*(t-e+1))+e}function r(e){return e[n(0,e.length-1)]}function i(e){for(var t="",n=0;n<e;n+=1)t+=r(o);return t}var o="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",a={randomHexDigit:function(){return r("0123456789abcdef")},randomHexString:function(e){for(var t="";e--;)t+=this.randomHexDigit();return t},randomElement:r,randomAlphanumStr:i,randomInt:n};e.exports=a},function(e,t,n){"use strict";function r(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrent=r},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){function e(){o(this,e)}return e}();return function(e){function t(){var e;o(this,t);for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];var s=r(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i)));return s.connection=null,s}return i(t,e),c(t,[{key:"init",value:function(e){this.connection=e}}]),t}(e)}n.d(t,"a",function(){return u});var s=n(8),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.b=a();var u=a(s.a)},function(e,t,n){"use strict";(function(e){function r(){var e=l.a.generateUsername();return d.log("generated callstats uid",e),e}function i(){var e=a();return d.log("generated id",e),e}function o(){var e=void 0;try{e=(window||this).localStorage}catch(e){d.error(e)}return e}function a(){return s()+s()+s()+s()}function s(){return(Math.random().toString(16)+"000000000").substr(2,8)}var c=n(0),u=(n.n(c),n(64)),l=n.n(u),d=Object(c.getLogger)(e),p=void 0,f=void 0;t.a={get callStatsUserName(){if(!p){var e=o();e&&(p=e.getItem("callStatsUserName")),p||(p=r(),e&&e.setItem("callStatsUserName",p))}return p},get machineId(){if(!f){var e=o();e&&(f=e.getItem("jitsiMeetId")),f||(f=i(),e&&e.setItem("jitsiMeetId",f))}return f},get sessionId(){var e=o();return e?e.getItem("sessionId"):void 0},set sessionId(e){var t=o();t&&(e?t.setItem("sessionId",e):t.removeItem("sessionId"))}}}).call(t,"modules/settings/Settings.js")},function(e,t){var n,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"==typeof window?"undefined":r(window))&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(){var e=i.browserName.chrome,t=null,n=null,r=null,o=i.codeBaseType.chrome;if(window&&(!window.navigator||!window.navigator.userAgent||window.csioReactNative))return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{browserName:e,codeBase:o,os:t,osVersion:n,userAgent:r};var a=(r=navigator.userAgent).toLowerCase(),s=navigator.appVersion,c=""+parseFloat(navigator.appVersion),u=void 0;-1!==(u=a.indexOf("opera"))?(e=i.browserName.opera,c=a.substring(u+6),-1!==(u=a.indexOf("Version"))&&(c=a.substring(u+8)),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("opr"))?(e=i.browserName.opera,c=a.substring(u+4),-1!==(u=a.indexOf("Version"))&&(c=a.substring(u+8)),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("msie"))?(e=i.browserName.msie,c=a.substring(u+5),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("edge"))?(e=i.browserName.edge,c=a.substring(u+5),o=i.codeBaseType.edge):-1!==(u=a.indexOf("chrome"))?(e=i.browserName.chrome,c=a.substring(u+7),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("safari"))?(e=i.browserName.safari,c=a.substring(u+7),-1!==(u=a.indexOf("Version"))&&(c=a.substring(u+8)),o=i.codeBaseType.chrome):-1!==(u=a.indexOf("firefox"))?(e=i.browserName.firefox,c=a.substring(u+8),o=i.codeBaseType.firefox):-1!==(u=a.indexOf("trident"))&&(e=i.browserName.msie,u=a.indexOf("rv"),c=a.substring(u+3,u+7),o=i.codeBaseType.chrome);var l=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],d=void 0,p=void 0;for(d in l)if(l.hasOwnProperty(d)&&(p=l[d]).r.test(a)){t=p.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=i.osName.windows),t){case i.osName.mac:n=/mac os x (10[\.\_\d]+)/.exec(a)[1];break;case i.osName.android:n=/android ([\.\_\d]+)/.exec(a)[1];break;case i.osName.ios:n=(n=/os (\d+)_(\d+)_?(\d+)?/.exec(s))[1]+"."+n[2]+"."+(0|n[3])}return{browserName:e,browserVersion:c.toString(),os:t,osVersion:n,codeBase:o,userAgent:r}}Object.defineProperty(t,"__esModule",{value:!0}),t.detect=r;var i=t.Constants={codeBaseType:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},browserName:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari"},osName:{windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"}}},function(e,t,n){(function(n,r,i){var o,a,s,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n){"object"==c(t)&&void 0!==e?e.exports=n():(a=[],o=n,void 0!==(s="function"==typeof o?o.apply(t,a):o)&&(e.exports=s))}(function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof _dereq_&&_dereq_;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return i(t[a][1][e]||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof _dereq_&&_dereq_,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";t.exports=function(e){function t(e){var t=new n(e),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,r){"use strict";function i(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new l(16),this._normalQueue=new l(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=u}function o(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function a(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function s(e){this._normalQueue._pushOne(e),this._queueTick()}var c;try{throw new Error}catch(e){c=e}var u=e("./schedule"),l=e("./queue"),d=e("./util");i.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},i.prototype.hasCustomScheduler=function(){return this._customScheduler},i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},i.prototype.disableTrampolineIfNecessary=function(){d.hasDevTools&&(this._trampolineEnabled=!1)},i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},i.prototype.fatalError=function(e,t){t?(n.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),n.exit(2)):this.throwLater(e)},i.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},d.hasDevTools?(i.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},i.prototype.invoke=function(e,t,n){this._trampolineEnabled?a.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},i.prototype.settlePromises=function(e){this._trampolineEnabled?s.call(this,e):this._schedule(function(){e._settlePromises()})}):(i.prototype.invokeLater=o,i.prototype.invoke=a,i.prototype.settlePromises=s),i.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},i.prototype._reset=function(){this._isTickUsed=!1},t.exports=i,t.exports.firstLineError=c},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},a=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},c=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var u=n(o),l=new e(t);l._propagateFrom(this,1);var d=this._target();if(l._setBoundTo(u),u instanceof e){var p={promiseRejectionQueued:!1,promise:l,target:d,bindingPromise:u};d._then(t,a,void 0,l,p),u._then(s,c,void 0,l,p),l._setOnCancel(u)}else l._resolveCallback(d);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}}},{}],4:[function(e,t,n){"use strict";function r(){try{Promise===o&&(Promise=i)}catch(e){}return o}var i;"undefined"!=typeof Promise&&(i=Promise);var o=e("./promise")();o.noConflict=r,t.exports=o},{"./promise":22}],5:[function(e,t,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(t){function n(e,n){var r;if(null!=e&&(r=e[n]),"function"!=typeof r){var i="Object "+s.classString(e)+" has no method '"+s.toString(n)+"'";throw new t.TypeError(i)}return r}function r(e){return n(e,this.pop()).apply(e,this)}function i(e){return e[this]}function o(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var a,s=e("./util"),c=s.canEvaluate;s.isIdentifier,t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(r,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if("number"==typeof e)t=o;else if(c){var n=a(e);t=null!==n?n:i}else t=i;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){var o=e("./util"),a=o.tryCatch,s=o.errorObj,c=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),c.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=a(e).call(this._boundValue());r===s&&(this._attachExtraTrace(r.e),c.throwLater(r.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),c.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){"use strict";t.exports=function(t){function n(e,n,s){return function(c){var u=s._boundValue();e:for(var l=0;l<e.length;++l){var d=e[l];if(d===Error||null!=d&&d.prototype instanceof Error){if(c instanceof d)return o(n).call(u,c)}else if("function"==typeof d){var p=o(d).call(u,c);if(p===a)return p;if(p)return o(n).call(u,c)}else if(r.isObject(c)){for(var f=i(d),h=0;h<f.length;++h){var v=f[h];if(d[v]!=c[v])continue e}return o(n).call(u,c)}}return t}}var r=e("./util"),i=e("./es5").keys,o=r.tryCatch,a=r.errorObj;return n}},{"./es5":13,"./util":36}],8:[function(e,t,n){"use strict";t.exports=function(e){function t(){this._trace=new t.CapturedTrace(r())}function n(){if(i)return new t}function r(){var e=o.length-1;if(e>=0)return o[e]}var i=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=n,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,a=e._peekContext,s=e.prototype._peekContext,c=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=a,e.prototype._peekContext=s,e.prototype._promiseCreated=c,i=!1},i=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=r,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},{}],9:[function(e,t,r){"use strict";t.exports=function(t,r){function i(e,t){return{promise:t}}function o(){return!1}function a(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+B.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function s(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?B.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function u(){return this._onCancelField}function l(e){this._onCancelField=e}function d(){this._cancellationParent=void 0,this._onCancelField=void 0}function p(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function f(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(){var e=this._boundTo;return void 0!==e&&e instanceof t?e.isFulfilled()?e.value():void 0:e}function v(){this._trace=new L(this._peekContext())}function m(e,t){if(G(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=w(e);B.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),B.notEnumerableProp(e,"__stackCleaned__",!0)}}}function g(e,t,n,r,i){if(void 0===e&&null!==t&&X){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),c=E(s),u=c.length-1;u>=0;--u){var l=c[u];if(!H.test(l)){var d=l.match(V);d&&(o="at "+d[1]+":"+d[2]+":"+d[3]+" ");break}}if(c.length>0)for(var p=c[0],u=0;u<s.length;++u)if(s[u]===p){u>0&&(a="\n"+s[u-1]);break}}var f="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a;r._warn(f,!0,t)}}function y(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),b(n)}function b(e,n,r){if(se.warnings){var i,o=new U(e);if(n)r._attachExtraTrace(o);else if(se.longStackTraces&&(i=t._peekContext()))i.attachExtraTrace(o);else{var a=w(o);o.stack=a.message+"\n"+a.stack.join("\n")}ne("warning",o)||R(o,"",!0)}}function S(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function _(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function T(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],a=-1,s=r.length-1;s>=0;--s)if(r[s]===o){a=s;break}for(var s=a;s>=0;--s){var c=r[s];if(t[i]!==c)break;t.pop(),i--}t=r}}function E(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||W.test(r),o=i&&ie(r);i&&!o&&(q&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function C(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||W.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}function w(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?C(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:E(t)}}function R(e,t,n){if("undefined"!=typeof console){var r;if(B.isObject(e)){var i=e.stack;r=t+K(i,e)}else r=t+String(e);"function"==typeof x?x(r,n):"function"!=typeof console.log&&"object"!==c(console.log)||console.log(r)}}function k(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){j.throwLater(e)}"unhandledRejection"===e?ne(e,n,r)||i||R(n,"Unhandled rejection "):ne(e,r)}function I(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():B.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+P(t)+">, no stack trace)"}function P(e){return e.length<41?e:e.substr(0,38)+"..."}function A(){return"function"==typeof ae}function D(e){var t=e.match(oe);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function O(e,t){if(A()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),a=-1,s=-1,c=0;c<i.length;++c){var u=D(i[c]);if(u){n=u.fileName,a=u.line;break}}for(var c=0;c<o.length;++c){var u=D(o[c]);if(u){r=u.fileName,s=u.line;break}}a<0||s<0||!n||!r||n!==r||a>=s||(ie=function(e){if(J.test(e))return!0;var t=D(e);return!!(t&&t.fileName===n&&a<=t.line&&t.line<=s)})}}function L(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);ae(this,L),t>32&&this.uncycle()}var N,M,x,F=t._getDomain,j=t._async,U=e("./errors").Warning,B=e("./util"),G=B.canAttachTrace,J=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,H=/\((?:timers\.js):\d+:\d+\)/,V=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,W=null,K=null,q=!1,z=!(0==B.env("BLUEBIRD_DEBUG")),Q=!(0==B.env("BLUEBIRD_WARNINGS")||!z&&!B.env("BLUEBIRD_WARNINGS")),$=!(0==B.env("BLUEBIRD_LONG_STACK_TRACES")||!z&&!B.env("BLUEBIRD_LONG_STACK_TRACES")),X=0!=B.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(Q||!!B.env("BLUEBIRD_W_FORGOTTEN_RETURN"));t.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),j.invokeLater(this._notifyUnhandledRejection,this,void 0))},t.prototype._notifyUnhandledRejectionIsHandled=function(){k("rejectionHandled",N,void 0,this)},t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),k("unhandledRejection",M,e,this)}},t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},t.prototype._warn=function(e,t,n){return b(e,t,n||this)},t.onPossiblyUnhandledRejection=function(e){var t=F();M="function"==typeof e?null===t?e:B.domainBind(t,e):void 0},t.onUnhandledRejectionHandled=function(e){var t=F();N="function"==typeof e?null===t?e:B.domainBind(t,e):void 0};var Y=function(){};t.longStackTraces=function(){if(j.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!se.longStackTraces&&A()){var e=t.prototype._captureStackTrace,n=t.prototype._attachExtraTrace;se.longStackTraces=!0,Y=function(){if(j.haveItemsQueued()&&!se.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=e,t.prototype._attachExtraTrace=n,r.deactivateLongStackTraces(),j.enableTrampoline(),se.longStackTraces=!1},t.prototype._captureStackTrace=v,t.prototype._attachExtraTrace=m,r.activateLongStackTraces(),j.disableTrampolineIfNecessary()}},t.hasLongStackTraces=function(){return se.longStackTraces&&A()};var Z=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return B.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!B.global.dispatchEvent(n)}}if("function"==typeof Event){var e=new Event("CustomEvent");return B.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!B.global.dispatchEvent(n)}}var e=document.createEvent("CustomEvent");return e.initCustomEvent("testingtheevent",!1,!0,{}),B.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!B.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),ee=function(){return B.isNode?function(){return n.emit.apply(n,arguments)}:B.global?function(e){var t="on"+e.toLowerCase(),n=B.global[t];return!!n&&(n.apply(B.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),te={promiseCreated:i,promiseFulfilled:i,promiseRejected:i,promiseResolved:i,promiseCancelled:i,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:i},ne=function(e){var t=!1;try{t=ee.apply(null,arguments)}catch(e){j.throwLater(e),t=!0}var n=!1;try{n=Z(e,te[e].apply(null,arguments))}catch(e){j.throwLater(e),n=!0}return n||t};t.config=function(e){if(e=Object(e),"longStackTraces"in e&&(e.longStackTraces?t.longStackTraces():!e.longStackTraces&&t.hasLongStackTraces()&&Y()),"warnings"in e){var n=e.warnings;se.warnings=!!n,X=se.warnings,B.isObject(n)&&"wForgottenReturn"in n&&(X=!!n.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!se.cancellation){if(j.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=d,t.prototype._propagateFrom=p,t.prototype._onCancel=u,t.prototype._setOnCancel=l,t.prototype._attachCancellationCallback=s,t.prototype._execute=a,re=p,se.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!se.monitoring?(se.monitoring=!0,t.prototype._fireEvent=ne):!e.monitoring&&se.monitoring&&(se.monitoring=!1,t.prototype._fireEvent=o)),t},t.prototype._fireEvent=o,t.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},t.prototype._onCancel=function(){},t.prototype._setOnCancel=function(e){},t.prototype._attachCancellationCallback=function(e){},t.prototype._captureStackTrace=function(){},t.prototype._attachExtraTrace=function(){},t.prototype._clearCancellationData=function(){},t.prototype._propagateFrom=function(e,t){};var re=f,ie=function(){return!1},oe=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;B.inherits(L,Error),r.CapturedTrace=L,L.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;e=this._length=r;for(var r=e-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(var r=0;r<e;++r){var a=t[r].stack,s=n[a];if(void 0!==s&&s!==r){s>0&&(t[s-1]._parent=void 0,t[s-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var c=r>0?t[r-1]:this;s<e-1?(c._parent=t[s+1],c._parent.uncycle(),c._length=c._parent._length+1):(c._parent=void 0,c._length=1);for(var u=c._length+1,l=r-2;l>=0;--l)t[l]._length=u,u++;return}}}},L.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=w(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(E(i.stack.split("\n"))),i=i._parent;T(r),_(r),B.notEnumerableProp(e,"stack",S(n,r)),B.notEnumerableProp(e,"__stackCleaned__",!0)}};var ae=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():I(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,W=e,K=t;var n=Error.captureStackTrace;return ie=function(e){return J.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r=new Error;if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return W=/@/,K=t,q=!0,function(e){e.stack=(new Error).stack};var i;try{throw new Error}catch(e){i="stack"in e}return"stack"in r||!i||"number"!=typeof Error.stackTraceLimit?(K=function(e,t){return"string"==typeof e?e:"object"!==(void 0===t?"undefined":c(t))&&"function"!=typeof t||void 0===t.name||void 0===t.message?I(t):t.toString()},null):(W=e,K=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(x=function(e){console.warn(e)},B.isNode&&n.stderr.isTTY?x=function(e,t){var n=t?"[33m":"[31m";console.warn(n+e+"[0m\n")}:B.isNode||"string"!=typeof(new Error).stack||(x=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var se={warnings:Q,longStackTraces:!1,cancellation:!1,monitoring:!1};return $&&t.longStackTraces(),{longStackTraces:function(){return se.longStackTraces},warnings:function(){return se.warnings},cancellation:function(){return se.cancellation},monitoring:function(){return se.monitoring},propagateFromFunction:function(){return re},boundValueFunction:function(){return h},checkForgottenReturns:g,setBounds:O,warn:b,deprecated:y,CapturedTrace:L,fireDomEvent:Z,fireGlobalEvent:ee}}},{"./errors":12,"./util":36}],10:[function(e,t,n){"use strict";t.exports=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],r=function(){throw t};return this.caught(e,r)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},{}],11:[function(e,t,n){"use strict";t.exports=function(e,t){function n(){return o(this)}function r(e,n){return i(e,n,t,t)}var i=e.reduce,o=e.all;e.prototype.each=function(e){return i(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,t,t)},e.each=function(e,r){return i(e,r,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=r}},{}],12:[function(e,t,n){"use strict";function r(e,t){function n(r){if(!(this instanceof n))return new n(r);d(this,"message","string"==typeof r?r:t),d(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(n,Error),n}function i(e){if(!(this instanceof i))return new i(e);d(this,"name","OperationalError"),d(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(d(this,"message",e.message),d(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o,a,s=e("./es5"),c=s.freeze,u=e("./util"),l=u.inherits,d=u.notEnumerableProp,p=r("Warning","warning"),f=r("CancellationError","cancellation error"),h=r("TimeoutError","timeout error"),v=r("AggregateError","aggregate error");try{o=TypeError,a=RangeError}catch(e){o=r("TypeError","type error"),a=r("RangeError","range error")}for(var m="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),g=0;g<m.length;++g)"function"==typeof Array.prototype[m[g]]&&(v.prototype[m[g]]=Array.prototype[m[g]]);s.defineProperty(v.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),v.prototype.isOperational=!0;var y=0;v.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];r=i.join("\n"),t+=r+"\n"}return y--,t},l(i,Error);var b=Error.__BluebirdErrorTypes__;b||(b=c({CancellationError:f,TimeoutError:h,OperationalError:i,RejectionError:i,AggregateError:v}),s.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:a,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:p}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,a={}.constructor.prototype,s=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t},c=function(e,t){return{value:e[t]}},u=function(e,t,n){return e[t]=n.value,e},l=function(e){return e},d=function(e){try{return Object(e).constructor.prototype}catch(e){return a}},p=function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}};t.exports={isArray:p,keys:s,names:s,defineProperty:u,getDescriptor:c,freeze:l,getPrototypeOf:d,isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}}},{}],15:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function o(e){this.finallyHandler=e}function a(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return u.call(this,this.promise._target()._settledValue())}function c(e){if(!a(this,e))return p.e=e,p}function u(e){var i=this.promise,u=this.handler;if(!this.called){this.called=!0;var l=this.isFinallyHandler()?u.call(i._boundValue()):u.call(i._boundValue(),e);if(l===r)return l;if(void 0!==l){i._setReturnedNonUndefined();var f=n(l,i);if(f instanceof t){if(null!=this.cancelPromise){if(f._isCancelled()){var h=new d("late cancellation observer");return i._attachExtraTrace(h),p.e=h,p}f.isPending()&&f._attachCancellationCallback(new o(this))}return f._then(s,c,void 0,this,void 0)}}}return i.isRejected()?(a(this),p.e=e,p):(a(this),e)}var l=e("./util"),d=t.CancellationError,p=l.errorObj,f=e("./catch_filter")(r);return i.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){a(this.finallyHandler)},t.prototype._passThrough=function(e,t,n,r){return"function"!=typeof e?this.then():this._then(n,r,void 0,new i(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,u,u)},t.prototype.tap=function(e){return this._passThrough(e,1,u)},t.prototype.tapCatch=function(e){var n=arguments.length;if(1===n)return this._passThrough(e,1,void 0,u);var r,i=new Array(n-1),o=0;for(r=0;r<n-1;++r){var a=arguments[r];if(!l.isObject(a))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+l.classString(a)));i[o++]=a}i.length=o;var s=arguments[r];return this._passThrough(f(i,s,this),1,void 0,u)},i}},{"./catch_filter":7,"./util":36}],16:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e,n,r){for(var o=0;o<n.length;++o){r._pushContext();var a=f(n[o])(e);if(r._popContext(),a===p){r._pushContext();var s=t.reject(p.e);return r._popContext(),s}var c=i(a,r);if(c instanceof t)return c}return null}function c(e,n,i,o){if(a.cancellation()){var s=new t(r),c=this._finallyPromise=new t(r);this._promise=s.lastly(function(){return c}),s._captureStackTrace(),s._setOnCancel(this)}else(this._promise=new t(r))._captureStackTrace();this._stack=o,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(h):h,this._yieldedPromise=null,this._cancellationPhase=!1}var u=e("./errors"),l=u.TypeError,d=e("./util"),p=d.errorObj,f=d.tryCatch,h=[];d.inherits(c,o),c.prototype._isResolved=function(){return null===this._promise},c.prototype._cleanup=function(){this._promise=this._generator=null,a.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},c.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=f(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=f(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},c.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=f(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},c.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=f(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},c.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},c.prototype.promise=function(){return this._promise},c.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},c.prototype._continue=function(e){var n=this._promise;if(e===p)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(!(o instanceof t)&&null===(o=s(o,this._yieldHandlers,this._promise)))return void this._promiseRejected(new l("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var a=o._bitField;0==(50397184&a)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&a)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&a)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()},t.coroutine=function(e,t){if("function"!=typeof e)throw new l("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=c,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r(void 0,void 0,n,i),a=o.promise();return o._generator=t,o._promiseFulfilled(void 0),a}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new l("expecting a function but got "+d.classString(e));h.push(e)},t.spawn=function(e){if(a.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new c(e,this),i=r.promise();return r._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){var s=e("./util");s.canEvaluate,s.tryCatch,s.errorObj,t.join=function(){var e,t=arguments.length-1;if(t>0&&"function"==typeof arguments[t]){e=arguments[t];var r}var i=[].slice.call(arguments);e&&i.pop();var r=new n(i).promise();return void 0!==e?r.spread(e):r}}},{"./util":36}],18:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=l();this._callback=null===i?t:d.domainBind(i,t),this._preservedValues=r===o?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0)}function u(e,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+d.classString(n));var a=0;if(void 0!==i){if("object"!==(void 0===i?"undefined":c(i))||null===i)return t.reject(new TypeError("options argument must be an object but it is "+d.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+d.classString(i.concurrency)));a=i.concurrency}return a="number"==typeof a&&isFinite(a)&&a>=1?a:0,new s(e,n,a,o).promise()}var l=t._getDomain,d=e("./util"),p=d.tryCatch,f=d.errorObj,h=t._async;d.inherits(s,n),s.prototype._asyncInit=function(){this._init$(void 0,-2)},s.prototype._init=function(){},s.prototype._promiseFulfilled=function(e,n){var r=this._values,o=this.length(),s=this._preservedValues,c=this._limit;if(n<0){if(n=-1*n-1,r[n]=e,c>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(c>=1&&this._inFlight>=c)return r[n]=e,this._queue.push(n),!1;null!==s&&(s[n]=e);var u=this._promise,l=this._callback,d=u._boundValue();u._pushContext();var h=p(l).call(d,e,n,o),v=u._popContext();if(a.checkForgottenReturns(h,v,null!==s?"Promise.filter":"Promise.map",u),h===f)return this._reject(h.e),!0;var m=i(h,this._promise);if(m instanceof t){m=m._target();var g=m._bitField;if(0==(50397184&g))return c>=1&&this._inFlight++,r[n]=m,m._proxy(this,-1*(n+1)),!1;if(0==(33554432&g))return 0!=(16777216&g)?(this._reject(m._reason()),!0):(this._cancel(),!0);h=m._value()}r[n]=h}return++this._totalResolved>=o&&(null!==s?this._filter(r,s):this._resolve(r),!0)},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},s.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},s.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return u(this,e,t,null)},t.map=function(e,t,n,r){return u(e,t,n,r)}}},{"./util":36}],19:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){var a=e("./util"),s=a.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+a.classString(e));return function(){var r=new t(n);r._captureStackTrace(),r._pushContext();var i=s(e).apply(this,arguments),a=r._popContext();return o.checkForgottenReturns(i,a,"Promise.method",r),r._resolveFromSyncValue(i),r}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+a.classString(e));var r=new t(n);r._captureStackTrace(),r._pushContext();var c;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],l=arguments[2];c=a.isArray(u)?s(e).apply(l,u):s(e).call(l,u)}else c=s(e)();var d=r._popContext();return o.checkForgottenReturns(c,d,"Promise.try",r),r._resolveFromSyncValue(c),r},t.prototype._resolveFromSyncValue=function(e){e===a.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){"use strict";function r(e){return e instanceof Error&&l.getPrototypeOf(e)===Error.prototype}function i(e){var t;if(r(e)){t=new u(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var n=l.keys(e),i=0;i<n.length;++i){var o=n[i];d.test(o)||(t[o]=e[o])}return t}return a.markAsOriginatingFromRejection(e),e}function o(e,t){return function(n,r){if(null!==e){if(n){var o=i(s(n));e._attachExtraTrace(o),e._reject(o)}else if(t){var a=[].slice.call(arguments,1);e._fulfill(a)}else e._fulfill(r);e=null}}}var a=e("./util"),s=a.maybeWrapAsError,c=e("./errors"),u=c.OperationalError,l=e("./es5"),d=/^(?:name|message|stack|cause)$/;t.exports=o},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,n){"use strict";t.exports=function(t){function n(e,t){var n=this;if(!o.isArray(e))return r.call(n,e,t);var i=s(t).apply(n._boundValue(),[null].concat(e));i===c&&a.throwLater(i.e)}function r(e,t){var n=this,r=n._boundValue(),i=void 0===e?s(t).call(r,null):s(t).call(r,null,e);i===c&&a.throwLater(i.e)}function i(e,t){var n=this;if(!e){var r=new Error(e+"");r.cause=e,e=r}var i=s(t).call(n._boundValue(),e);i===c&&a.throwLater(i.e)}var o=e("./util"),a=t._async,s=o.tryCatch,c=o.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var o=r;void 0!==t&&Object(t).spread&&(o=n),this._then(o,i,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,t,r){"use strict";t.exports=function(){function r(){}function i(e,t){if(null==e||e.constructor!==o)throw new b("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new b("expecting a function but got "+h.classString(t))}function o(e){e!==_&&i(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function a(e){this.promise._resolveCallback(e)}function s(e){this.promise._rejectCallback(e,!1)}function c(e){var t=new o(_);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var u,l=function(){return new b("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},d=function(){return new o.PromiseInspection(this._target())},p=function(e){return o.reject(new b(e))},f={},h=e("./util");u=h.isNode?function(){var e=n.domain;return void 0===e&&(e=null),e}:function(){return null},h.notEnumerableProp(o,"_getDomain",u);var v=e("./es5"),m=e("./async"),g=new m;v.defineProperty(o,"_async",{value:g});var y=e("./errors"),b=o.TypeError=y.TypeError;o.RangeError=y.RangeError;var S=o.CancellationError=y.CancellationError;o.TimeoutError=y.TimeoutError,o.OperationalError=y.OperationalError,o.RejectionError=y.OperationalError,o.AggregateError=y.AggregateError;var _=function(){},T={},E={},C=e("./thenables")(o,_),w=e("./promise_array")(o,_,C,p,r),R=e("./context")(o),k=R.create,I=e("./debuggability")(o,R),P=(I.CapturedTrace,e("./finally")(o,C,E)),A=e("./catch_filter")(E),D=e("./nodeback"),O=h.errorObj,L=h.tryCatch;return o.prototype.toString=function(){return"[object Promise]"},o.prototype.caught=o.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!h.isObject(o))return p("Catch statement predicate: expecting an object but got "+h.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,A(r,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(d,d,void 0,this,void 0)},o.prototype.then=function(e,t){if(I.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+h.classString(e);arguments.length>1&&(n+=", "+h.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},o.prototype.spread=function(e){return"function"!=typeof e?p("expecting a function but got "+h.classString(e)):this.all()._then(e,void 0,void 0,T,void 0)},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new w(this).promise()},o.prototype.error=function(e){return this.caught(h.originatesFromRejection,e)},o.getNewLibraryCopy=t.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(_);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=L(e)(D(t,n));return r===O&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new w(e).promise()},o.cast=function(e){var t=C(e);return t instanceof o||(t=new o(_),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(_);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if("function"!=typeof e)throw new b("expecting a function but got "+h.classString(e));return g.setScheduler(e)},o.prototype._then=function(e,t,n,r,i){var a=void 0!==i,s=a?i:new o(_),c=this._target(),l=c._bitField;a||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():c===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var d=u();if(0!=(50397184&l)){var p,f,v=c._settlePromiseCtx;0!=(33554432&l)?(f=c._rejectionHandler0,p=e):0!=(16777216&l)?(f=c._fulfillmentHandler0,p=t,c._unsetRejectionIsUnhandled()):(v=c._settlePromiseLateCancellationObserver,f=new S("late cancellation observer"),c._attachExtraTrace(f),p=t),g.invoke(v,c,{handler:null===d?p:"function"==typeof p&&h.domainBind(d,p),promise:s,receiver:r,value:f})}else c._addCallbacks(e,t,s,r,d);return s},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},o.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},o.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},o.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},o.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},o.prototype._isFinal=function(){return(4194304&this._bitField)>0},o.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},o.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},o.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},o.prototype._setAsyncGuaranteed=function(){g.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==f)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=f),this._addCallbacks(t,n,r,i,null)},o.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=f),this._addCallbacks(n,r,i,o,null)},o.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:h.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:h.domainBind(i,t));else{var a=4*o-4;this[a+2]=n,this[a+3]=r,"function"==typeof e&&(this[a+0]=null===i?e:h.domainBind(i,e)),"function"==typeof t&&(this[a+1]=null===i?t:h.domainBind(i,t))}return this._setLength(o+1),o},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(l(),!1);var n=C(e,this);if(!(n instanceof o))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r===this)return void this._reject(l());var i=r._bitField;if(0==(50397184&i)){var a=this._length();a>0&&r._migrateCallback0(this);for(var s=1;s<a;++s)r._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&i))this._fulfill(r._value());else if(0!=(16777216&i))this._reject(r._reason());else{var c=new S("late cancellation observer");r._attachExtraTrace(c),this._reject(c)}}},o.prototype._rejectCallback=function(e,t,n){var r=h.ensureErrorObject(e),i=r===e;if(!i&&!n&&I.warnings()){var o="a promise was rejected with a non-error: "+h.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},o.prototype._resolveFromExecutor=function(e){if(e!==_){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},o.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){r._pushContext();var o;t===T?n&&"number"==typeof n.length?o=L(e).apply(this._boundValue(),n):(o=O,o.e=new b("cannot .spread() a non-array: "+h.classString(n))):o=L(e).call(t,n);var a=r._popContext();0==(65536&(i=r._bitField))&&(o===E?r._reject(n):o===O?r._rejectCallback(o.e,!1):(I.checkForgottenReturns(o,a,"",r,this),r._resolveCallback(o)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,n,i){var a=e instanceof o,s=this._bitField,c=0!=(134217728&s);0!=(65536&s)?(a&&e._invokeInternalOnCancel(),n instanceof P&&n.isFinallyHandler()?(n.cancelPromise=e,L(t).call(n,i)===O&&e._reject(O.e)):t===d?e._fulfill(d.call(n)):n instanceof r?n._promiseCancelled(e):a||e instanceof w?e._cancel():n.cancel()):"function"==typeof t?a?(c&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,i,e)):t.call(n,i,e):n instanceof r?n._isResolved()||(0!=(33554432&s)?n._promiseFulfilled(i,e):n._promiseRejected(i,e)):a&&(c&&e._setAsyncGuaranteed(),0!=(33554432&s)?e._fulfill(i):e._reject(i))},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,i=e.value;"function"==typeof t?n instanceof o?this._settlePromiseFromHandler(t,r,i,n):t.call(r,i,n):n instanceof o&&n._reject(i)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=l();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():g.settlePromises(this))}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return g.fatalError(e,h.isNode);(65535&t)>0?g.settlePromises(this):this._ensurePossibleRejectionHandled()}},o.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},o.defer=o.pending=function(){return I.deprecated("Promise.defer","new Promise"),{promise:new o(_),resolve:a,reject:s}},h.notEnumerableProp(o,"_makeSelfResolutionError",l),e("./method")(o,_,C,p,I),e("./bind")(o,_,C,I),e("./cancel")(o,w,p,I),e("./direct_resolve")(o),e("./synchronous_inspection")(o),e("./join")(o,w,C,_,g,u),o.Promise=o,o.version="3.5.0",e("./map.js")(o,w,p,C,_,I),e("./call_get.js")(o),e("./using.js")(o,p,C,k,_,I),e("./timers.js")(o,_,I),e("./generators.js")(o,p,_,C,r,I),e("./nodeify.js")(o),e("./promisify.js")(o,_),e("./props.js")(o,w,C,p),e("./race.js")(o,_,C,p),e("./reduce.js")(o,w,p,C,_,I),e("./settle.js")(o,w,I),e("./some.js")(o,w,p),e("./filter.js")(o,_),e("./each.js")(o,_),e("./any.js")(o),h.toFastProperties(o),h.toFastProperties(o.prototype),c({a:1}),c({b:2}),c({c:3}),c(1),c(function(){}),c(void 0),c(!1),c(new o(_)),I.setBounds(m.firstLineError,h.lastLineError),o}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){function a(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function s(e){var r=this._promise=new t(n);e instanceof t&&r._propagateFrom(e,3),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var c=e("./util");return c.isArray,c.inherits(s,o),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function e(n,o){var s=r(this._values,this._promise);if(s instanceof t){s=s._target();var u=s._bitField;if(this._values=s,0==(50397184&u))return this._promise._setAsyncGuaranteed(),s._then(e,this._reject,void 0,this,o);if(0==(33554432&u))return 0!=(16777216&u)?this._reject(s._reason()):this._cancel();s=s._value()}if(null===(s=c.asArray(s))){var l=i("expecting an array or an iterable object but got "+c.classString(s)).reason();return void this._promise._rejectCallback(l,!1)}if(0===s.length)return void(-5===o?this._resolveEmptyArray():this._resolve(a(o)));this._iterate(s)},s.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,a=null,s=0;s<n;++s){var c=r(e[s],i);c instanceof t?(c=c._target(),a=c._bitField):a=null,o?null!==a&&c.suppressUnhandledRejections():null!==a?0==(50397184&a)?(c._proxy(this,s),this._values[s]=c):o=0!=(33554432&a)?this._promiseFulfilled(c._value(),s):0!=(16777216&a)?this._promiseRejected(c._reason(),s):this._promiseCancelled(s):o=this._promiseFulfilled(c,s)}o||i._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},s.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s}},{"./util":36}],24:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e){return!_.test(e)}function i(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function o(e,t,n){var r=f.getDataPropertyOrDefault(e,t+n,b);return!!r&&i(r)}function a(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),a=0;a<e.length;a+=2)if(e[a]===o)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function s(e,t,n,r){for(var s=f.inheritedDataKeys(e),c=[],u=0;u<s.length;++u){var l=s[u],d=e[l],p=r===T||T(l,d,e);"function"!=typeof d||i(d)||o(e,l,t)||!r(l,d,e,p)||c.push(l,d)}return a(c,t,n),c}function u(e,r,i,o,a,s){function c(){var i=r;r===p&&(i=this);var o=new t(n);o._captureStackTrace();var a="string"==typeof l&&this!==u?this[l]:e,c=h(o,s);try{a.apply(i,v(arguments,c))}catch(e){o._rejectCallback(m(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var u=function(){return this}(),l=e;return"string"==typeof l&&(e=o),f.notEnumerableProp(c,"__isPromisified__",!0),c}function l(e,t,n,r,i){for(var o=new RegExp(E(t)+"$"),a=s(e,t,o,n),c=0,u=a.length;c<u;c+=2){var l=a[c],d=a[c+1],h=l+t;if(r===C)e[h]=C(l,p,l,d,t,i);else{var v=r(d,function(){return C(l,p,l,d,t,i)});f.notEnumerableProp(v,"__isPromisified__",!0),e[h]=v}}return f.toFastProperties(e),e}function d(e,t,n){return C(e,t,void 0,e,null,n)}var p={},f=e("./util"),h=e("./nodeback"),v=f.withAppended,m=f.maybeWrapAsError,g=f.canEvaluate,y=e("./errors").TypeError,b={__isPromisified__:!0},S=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],_=new RegExp("^(?:"+S.join("|")+")$"),T=function(e){return f.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},E=function(e){return e.replace(/([$])/,"\\$")},C=g?void 0:u;t.promisify=function(e,t){if("function"!=typeof e)throw new y("expecting a function but got "+f.classString(e));if(i(e))return e;t=Object(t);var n=void 0===t.context?p:t.context,o=!!t.multiArgs,a=d(e,n,o);return f.copyDescriptors(e,a,r),a},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!==(void 0===e?"undefined":c(e)))throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");t=Object(t);var n=!!t.multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=T);var o=t.promisifier;if("function"!=typeof o&&(o=C),!f.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=f.inheritedDataKeys(e),s=0;s<a.length;++s){var u=e[a[s]];"constructor"!==a[s]&&f.isClass(u)&&(l(u.prototype,r,i,o,n),l(u,r,i,o,n))}return l(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e){var t,n=!1;if(void 0!==s&&e instanceof s)t=d(e),n=!0;else{var r=l.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var a=r[o];t[o]=e[a],t[o+i]=a}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function a(e){var n,a=r(e);return u(a)?(n=a instanceof t?a._then(t.props,void 0,void 0,void 0,void 0):new o(a).promise(),a instanceof t&&n._propagateFrom(a,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var s,c=e("./util"),u=c.isObject,l=e("./es5");"function"==typeof Map&&(s=Map);var d=function(){function e(e,r){this[t]=e,this[t+n]=r,t++}var t=0,n=0;return function(r){n=r.size,t=0;var i=new Array(2*r.size);return r.forEach(e,i),i}}(),p=function(e){for(var t=new s,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t};c.inherits(o,n),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=p(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return a(this)},t.props=function(e){return a(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){"use strict";function r(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}function i(e){this._capacity=e,this._length=0,this._front=0}i.prototype._willBeOverCapacity=function(e){return this._capacity<e},i.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},i.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},i.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},i.prototype.length=function(){return this._length},i.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},i.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,r(this,0,this,t,this._front+this._length&t-1)},t.exports=i},{}],27:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){function o(e,o){var c=r(e);if(c instanceof t)return s(c);if(null===(e=a.asArray(e)))return i("expecting an array or an iterable object but got "+a.classString(e));var u=new t(n);void 0!==o&&u._propagateFrom(o,3);for(var l=u._fulfill,d=u._reject,p=0,f=e.length;p<f;++p){var h=e[p];(void 0!==h||p in e)&&t.cast(h)._then(l,d,void 0,u,null)}return u}var a=e("./util"),s=function(e){return e.then(function(t){return o(t,e)})};t.race=function(e){return o(e,void 0)},t.prototype.race=function(){return o(this,void 0)}}},{"./util":36}],28:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e,n,r,i){this.constructor$(e);var a=p();this._fn=null===a?n:f.domainBind(a,n),void 0!==r&&(r=t.resolve(r),r._attachCancellationCallback(this)),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function c(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function u(e,t,n,i){return"function"!=typeof t?r("expecting a function but got "+f.classString(t)):new s(e,t,n,i).promise()}function l(e){this.accum=e,this.array._gotAccum(e);var n=i(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(e){var n=this.array,r=n._promise,i=h(n._fn);r._pushContext();var o;(o=void 0!==n._eachValues?i.call(r._boundValue(),e,this.index,this.length):i.call(r._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(n._currentCancellable=o);var s=r._popContext();return a.checkForgottenReturns(o,s,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),o}var p=t._getDomain,f=e("./util"),h=f.tryCatch;f.inherits(s,n),s.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},s.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},s.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},s.prototype._iterate=function(e){this._values=e;var n,r,i=e.length;if(void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n,!n.isRejected())for(;r<i;++r){var o={accum:null,value:e[r],index:r,length:i,array:this};n=n._then(l,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(c,c,void 0,n,this)},t.prototype.reduce=function(e,t){return u(this,e,t,null)},t.reduce=function(e,t,n,r){return u(e,t,n,r)}}},{"./util":36}],29:[function(e,t,o){"use strict";var a,s=e("./util"),c=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},u=s.getNativePromise();if(s.isNode&&"undefined"==typeof MutationObserver){var l=r.setImmediate,d=n.nextTick;a=s.isRecentNode?function(e){l.call(r,e)}:function(e){d.call(n,e)}}else if("function"==typeof u&&"function"==typeof u.resolve){var p=u.resolve();a=function(e){p.then(e)}}else a="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==i?function(e){i(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:c:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,r=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(r,t);var i=function(){n||(n=!0,r.classList.toggle("foo"))};return function(n){var r=new MutationObserver(function(){r.disconnect(),n()});r.observe(e,t),i()}}();t.exports=a},{"./util":36}],30:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e)}var o=t.PromiseInspection;e("./util").inherits(i,n),i.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},i.prototype._promiseFulfilled=function(e,t){var n=new o;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},i.prototype._promiseRejected=function(e,t){var n=new o;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},t.settle=function(e){return r.deprecated(".settle()",".reflect()"),new i(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new i(e),o=n.promise();return n.setHowMany(t),n.init(),o}var a=e("./util"),s=e("./errors").RangeError,c=e("./errors").AggregateError,u=a.isArray,l={};a.inherits(i,n),i.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=u(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},i.prototype.init=function(){this._initialized=!0,this._init()},i.prototype.setUnwrap=function(){this._unwrap=!0},i.prototype.howMany=function(){return this._howMany},i.prototype.setHowMany=function(e){this._howMany=e},i.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},i.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},i.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(l),this._checkOutcome())},i.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new c,t=this.length();t<this._values.length;++t)this._values[t]!==l&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},i.prototype._fulfilled=function(){return this._totalResolved},i.prototype._rejected=function(){return this._values.length-this.length()},i.prototype._addRejected=function(e){this._values.push(e)},i.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},i.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},i.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new s(t)},i.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return o(e,t)},t.prototype.some=function(e){return o(this,e)},t._SomePromiseArray=i}},{"./errors":12,"./util":36}],32:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){"use strict";t.exports=function(t,n){function r(e,r){if(l(e)){if(e instanceof t)return e;var i=o(e);if(i===u){r&&r._pushContext();var c=t.reject(i.e);return r&&r._popContext(),c}if("function"==typeof i){if(a(e)){var c=new t(n);return e._then(c._fulfill,c._reject,void 0,c,null),c}return s(e,i,r)}}return e}function i(e){return e.then}function o(e){try{return i(e)}catch(e){return u.e=e,u}}function a(e){try{return d.call(e,"_promise0")}catch(e){return!1}}function s(e,r,i){function o(e){s&&(s._resolveCallback(e),s=null)}function a(e){s&&(s._rejectCallback(e,d,!0),s=null)}var s=new t(n),l=s;i&&i._pushContext(),s._captureStackTrace(),i&&i._popContext();var d=!0,p=c.tryCatch(r).call(e,o,a);return d=!1,s&&p===u&&(s._rejectCallback(p.e,!0,!0),s=null),l}var c=e("./util"),u=c.errorObj,l=c.isObject,d={}.hasOwnProperty;return r}},{"./util":36}],34:[function(e,t,n){"use strict";t.exports=function(t,n,r){function i(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function a(e){throw clearTimeout(this.handle),e}var s=e("./util"),c=t.TimeoutError;i.prototype._resultCancelled=function(){clearTimeout(this.handle)};var u=function(e){return l(+this).thenReturn(e)},l=t.delay=function(e,o){var a,s;return void 0!==o?(a=t.resolve(o)._then(u,null,null,e,void 0),r.cancellation()&&o instanceof t&&a._setOnCancel(o)):(a=new t(n),s=setTimeout(function(){a._fulfill()},+e),r.cancellation()&&a._setOnCancel(new i(s)),a._captureStackTrace()),a._setAsyncGuaranteed(),a};t.prototype.delay=function(e){return l(e,this)};var d=function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new c("operation timed out"):new c(t),s.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()};t.prototype.timeout=function(e,t){e=+e;var n,s,c=new i(setTimeout(function(){n.isPending()&&d(n,t,s)},e));return r.cancellation()?(s=this.then(),n=s._then(o,a,void 0,c,void 0),n._setOnCancel(c)):n=this._then(o,a,void 0,c,void 0),n}}},{"./util":36}],35:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,a){function s(e){setTimeout(function(){throw e},0)}function c(e){var t=r(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function u(e,n){function i(){if(a>=u)return l._fulfill();var o=c(e[a++]);if(o instanceof t&&o._isDisposable()){try{o=r(o._getDisposer().tryDispose(n),e.promise)}catch(e){return s(e)}if(o instanceof t)return o._then(i,s,null,null,null)}i()}var a=0,u=e.length,l=new t(o);return i(),l}function l(e,t,n){this._data=e,this._promise=t,this._context=n}function d(e,t,n){this.constructor$(e,t,n)}function p(e){return l.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function f(e){this.length=e,this.promise=null,this[e-1]=null}var h=e("./util"),v=e("./errors").TypeError,m=e("./util").inherits,g=h.errorObj,y=h.tryCatch,b={};l.prototype.data=function(){return this._data},l.prototype.promise=function(){return this._promise},l.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():b},l.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==b?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},l.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},m(d,l),d.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},f.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return n("you must pass at least 2 arguments to Promise.using");var i=arguments[e-1];if("function"!=typeof i)return n("expecting a function but got "+h.classString(i));var o,s=!0;2===e&&Array.isArray(arguments[0])?(o=arguments[0],e=o.length,s=!1):(o=arguments,e--);for(var c=new f(e),d=0;d<e;++d){var v=o[d];if(l.isDisposer(v)){var m=v;v=v.promise(),v._setDisposable(m)}else{var b=r(v);b instanceof t&&(v=b._then(p,null,null,{resources:c,index:d},void 0))}c[d]=v}for(var S=new Array(c.length),d=0;d<S.length;++d)S[d]=t.resolve(c[d]).reflect();var _=t.all(S).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return g.e=n.error(),g;if(!n.isFulfilled())return void _.cancel();e[t]=n.value()}T._pushContext(),i=y(i);var r=s?i.apply(void 0,e):i(e),o=T._popContext();return a.checkForgottenReturns(r,o,"Promise.using",T),r}),T=_.lastly(function(){var e=new t.PromiseInspection(_);return u(c,e)});return c.promise=T,T._setOnCancel(c),T},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new d(e,this,i());throw new v}}},{"./errors":12,"./util":36}],36:[function(e,t,i){"use strict";function o(){try{var e=P;return P=null,e.apply(this,arguments)}catch(e){return O.e=e,O}}function a(e){return P=e,o}function s(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function u(e){return"function"==typeof e||"object"===(void 0===e?"undefined":c(e))&&null!==e}function l(e){return s(e)?new Error(b(e)):e}function d(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i}function p(e,t,n){if(!A.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function f(e,t,n){if(s(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return A.defineProperty(e,t,r),e}function h(e){throw e}function v(e){try{if("function"==typeof e){var t=A.names(e.prototype),n=A.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=x.test(e+"")&&A.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}}function m(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function g(e){return F.test(e)}function y(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function b(e){try{return e+""}catch(e){return"[no string representation]"}}function S(e){return null!==e&&"object"===(void 0===e?"undefined":c(e))&&"string"==typeof e.message&&"string"==typeof e.name}function _(e){try{f(e,"isOperational",!0)}catch(e){}}function T(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function E(e){return S(e)&&A.propertyIsWritable(e,"stack")}function C(e){return{}.toString.call(e)}function w(e,t,n){for(var r=A.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{A.defineProperty(t,o,A.getDescriptor(e,o))}catch(e){}}}function R(e){return J?n.env[e]:void 0}function k(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function I(e,t){return e.bind(t)}var P,A=e("./es5"),D="undefined"==typeof navigator,O={e:{}},L="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r?r:void 0!==this?this:null,N=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)r.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var r={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},M=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(A.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return r}for(var a=0;a<o.length;++a){var s=o[a];if(!i[s]){i[s]=!0;var c=Object.getOwnPropertyDescriptor(e,s);null!=c&&null==c.get&&null==c.set&&r.push(s)}}e=A.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var a=0;a<e.length;++a)if(r.call(e[a],o))continue e;i.push(o)}return i}}(),x=/this\s*\.\s*\S+\s*=/,F=/^[a-z$_][a-z$_0-9]*$/i,j=function(){return"stack"in new Error?function(e){return E(e)?e:new Error(b(e))}:function(e){if(E(e))return e;try{throw new Error(b(e))}catch(e){return e}}}(),U=function(e){return A.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var B="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};U=function(e){return A.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?B(e):null}}var G=void 0!==n&&"[object process]"===C(n).toLowerCase(),J=void 0!==n&&void 0!==n.env,H={isClass:v,isIdentifier:g,inheritedDataKeys:M,getDataPropertyOrDefault:p,thrower:h,isArray:A.isArray,asArray:U,notEnumerableProp:f,isPrimitive:s,isObject:u,isError:S,canEvaluate:D,errorObj:O,tryCatch:a,inherits:N,withAppended:d,maybeWrapAsError:l,toFastProperties:m,filledRange:y,toString:b,canAttachTrace:E,ensureErrorObject:j,originatesFromRejection:T,markAsOriginatingFromRejection:_,classString:C,copyDescriptors:w,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:G,hasEnvVariables:J,env:R,global:L,getNativePromise:k,domainBind:I};H.isRecentNode=H.isNode&&function(){var e=n.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),H.isNode&&H.toFastProperties(n);try{throw new Error}catch(e){H.lastLineError=e}t.exports=H},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(t,n(30),n(20),n(36).setImmediate)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CONNECTION_DISCONNECTED",function(){return r}),n.d(t,"CONNECTION_ESTABLISHED",function(){return i}),n.d(t,"CONNECTION_FAILED",function(){return o}),n.d(t,"WRONG_STATE",function(){return a});var r="connection.connectionDisconnected",i="connection.connectionEstablished",o="connection.connectionFailed",a="connection.wrongState"},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){var n=[],r=null;return e.forEach(function(e){e.mediaType===m.a?r=t.micDeviceId:e.videoType===T.a.CAMERA&&(r=t.cameraDeviceId),R+=1;var i=new p.a(C({},e,{deviceId:r,facingMode:t.facingMode,rtcId:R}));n.push(i)}),n}var s=n(0),c=(n.n(s),n(113)),u=n(2),l=n.n(u),d=n(4),p=n(114),f=n(9),h=n(13),v=n(8),m=n(3),g=n(7),y=n.n(g),b=n(25),S=n(125),_=n(14),T=n.n(_),E=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},w=Object(s.getLogger)(e),R=0,k=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.conference=e,o.peerConnections=new Map,o.peerConnectionIdCounter=1,o.localTracks=[],o.options=n,o._channel=null,o._channelOpen=!1,o._lastN=-1,o._lastNEndpoints=null,o._pinnedEndpoint=null,o._selectedEndpoint=null,o._lastNChangeListener=o._onLastNChanged.bind(o),b.a.isDeviceChangeAvailable("output")&&b.a.addListener(y.a.AUDIO_OUTPUT_DEVICE_CHANGED,function(e){var t=o.getRemoteTracks(m.a),n=!0,r=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done);n=!0)a.value.setAudioOutput(e)}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}),o}return o(t,e),E(t,[{key:"initializeBridgeChannel",value:function(e,t){var n=this;this._channel=new c.a(e,t,this.eventEmitter),this._channelOpenListener=function(){n._channelOpen=!0;try{n._channel.sendPinnedEndpointMessage(n._pinnedEndpoint),n._channel.sendSelectedEndpointMessage(n._selectedEndpoint)}catch(e){l.a.callErrorHandler(e),w.error("Cannot send selected("+n._selectedEndpoint+")pinned("+n._pinnedEndpoint+") endpoint message.",e)}n.removeListener(y.a.DATA_CHANNEL_OPEN,n._channelOpenListener),n._channelOpenListener=null,-1!==n._lastN&&n._channel.sendSetLastNMessage(n._lastN)},this.addListener(y.a.DATA_CHANNEL_OPEN,this._channelOpenListener),this.addListener(y.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener)}},{key:"_onLastNChanged",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this._lastNEndpoints||[],r=[],i=[];this._lastNEndpoints=t,r=n.filter(function(t){return!e.isInLastN(t)}),i=t.filter(function(e){return-1===n.indexOf(e)}),this.conference.eventEmitter.emit(d.LAST_N_ENDPOINTS_CHANGED,r,i)}},{key:"onCallEnded",value:function(){this._channel&&(this._channel&&"websocket"===this._channel.mode&&this._channel.close(),this._channel=null,this._channelOpen=!1)}},{key:"setReceiverVideoConstraint",value:function(e){this._channel&&this._channel.sendReceiverVideoConstraintMessage(e)}},{key:"selectEndpoint",value:function(e){this._selectedEndpoint=e,this._channel&&this._channelOpen&&this._channel.sendSelectedEndpointMessage(e)}},{key:"pinEndpoint",value:function(e){this._pinnedEndpoint=e,this._channel&&this._channelOpen&&this._channel.sendPinnedEndpointMessage(e)}},{key:"createPeerConnection",value:function(e,n,r,i){var o=new S.a(this,this.peerConnectionIdCounter,e,n,t.getPCConstraints(r),r,i);return this.peerConnections.set(o.id,o),this.peerConnectionIdCounter+=1,o}},{key:"_removePeerConnection",value:function(e){var t=e.id;return!!this.peerConnections.has(t)&&(this.peerConnections.delete(t),!0)}},{key:"addLocalTrack",value:function(e){if(!e)throw new Error("track must not be null nor undefined");this.localTracks.push(e),e.conference=this.conference}},{key:"getLastN",value:function(){return this._lastN}},{key:"getLocalVideoTrack",value:function(){var e=this.getLocalTracks(m.b);return e.length?e[0]:void 0}},{key:"getLocalAudioTrack",value:function(){var e=this.getLocalTracks(m.a);return e.length?e[0]:void 0}},{key:"getLocalTracks",value:function(e){var t=this.localTracks.slice();return void 0!==e&&(t=t.filter(function(t){return t.getType()===e})),t}},{key:"getRemoteTracks",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var o,a=this.peerConnections.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=s.getRemoteTracks(void 0,e);c&&(t=t.concat(c))}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t}},{key:"setAudioMute",value:function(e){var t=[];return this.getLocalTracks(m.a).forEach(function(n){t.push(e?n.mute():n.unmute())}),Promise.all(t)}},{key:"removeLocalTrack",value:function(e){var t=this.localTracks.indexOf(e);-1!==t&&this.localTracks.splice(t,1)}},{key:"removeRemoteTracks",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var o,a=this.peerConnections.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=s.removeRemoteTracks(e);t=t.concat(c)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return w.debug("Removed remote tracks for "+e+" count: "+t.length),t}},{key:"closeBridgeChannel",value:function(){this._channel&&(this._channel.close(),this._channelOpen=!1,this.removeListener(y.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener))}},{key:"setAudioLevel",value:function(e,t,n,r){var i=e.getTrackBySSRC(t);if(i){if(!i.isAudioTrack())return void w.warn("Received audio level for non-audio track: "+t);i.isLocal()!==r&&w.error(i+" was expected to "+(r?"be":"not be")+" local"),i.setAudioLevel(n,e)}}},{key:"sendChannelMessage",value:function(e,t){if(!this._channel)throw new Error("Channel support is disabled!");this._channel.sendMessage(e,t)}},{key:"setLastN",value:function(e){this._lastN!==e&&(this._lastN=e,this._channel&&this._channelOpen&&this._channel.sendSetLastNMessage(e),this.eventEmitter.emit(y.a.LASTN_VALUE_CHANGED,e))}},{key:"isInLastN",value:function(e){return!this._lastNEndpoints||this._lastNEndpoints.indexOf(e)>-1}}],[{key:"obtainAudioAndVideoPermissions",value:function(e){return b.a.obtainAudioAndVideoPermissions(e).then(function(t){var n=a(t,e);return n.some(function(e){return!e._isReceivingData()})?Promise.reject(new f.a(h.NO_DATA_FROM_SOURCE)):n})}},{key:"addListener",value:function(e,t){b.a.addListener(e,t)}},{key:"removeListener",value:function(e,t){b.a.removeListener(e,t)}},{key:"isRTCReady",value:function(){return b.a.isRTCReady()}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=e,b.a.init(this.options)}},{key:"getDeviceAvailability",value:function(){return b.a.getDeviceAvailability()}},{key:"getPCConstraints",value:function(e){return e?b.a.p2pPcConstraints:b.a.pcConstraints}},{key:"attachMediaStream",value:function(e,t){return b.a.attachMediaStream(e,t)}},{key:"getStreamID",value:function(e){return b.a.getStreamID(e)}},{key:"getTrackID",value:function(e){return b.a.getTrackID(e)}},{key:"isDeviceListAvailable",value:function(){return b.a.isDeviceListAvailable()}},{key:"isDeviceChangeAvailable",value:function(e){return b.a.isDeviceChangeAvailable(e)}},{key:"getAudioOutputDevice",value:function(){return b.a.getAudioOutputDevice()}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return b.a.getCurrentlyAvailableMediaDevices()}},{key:"getEventDataForActiveDevice",value:function(e){return b.a.getEventDataForActiveDevice(e)}},{key:"setAudioOutputDevice",value:function(e){return b.a.setAudioOutputDevice(e)}},{key:"isUserStream",value:function(e){return t.isUserStreamById(b.a.getStreamID(e))}},{key:"isUserStreamById",value:function(e){return e&&"mixedmslabel"!==e&&"default"!==e}},{key:"enumerateDevices",value:function(e){b.a.enumerateDevices(e)}},{key:"stopMediaStream",value:function(e){b.a.stopMediaStream(e)}},{key:"isDesktopSharingEnabled",value:function(){return b.a.isDesktopSharingEnabled()}}]),t}(v.a);t.a=k}).call(t,"modules/RTC/RTC.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function s(){ce=navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?function(e){navigator.mediaDevices.enumerateDevices().then(e,function(){return e([])})}:MediaStreamTrack&&MediaStreamTrack.getSources?function(e){MediaStreamTrack.getSources(function(t){return e(t.map(g))})}:void 0}function c(e,t,n){M.a[n]&&(t&&(e.video.width={ideal:M.a[n].width},e.video.height={ideal:M.a[n].height}),e.video.mandatory.minWidth=M.a[n].width,e.video.mandatory.minHeight=M.a[n].height),e.video.mandatory.minWidth&&(e.video.mandatory.maxWidth=e.video.mandatory.minWidth),e.video.mandatory.minHeight&&(e.video.mandatory.maxHeight=e.video.mandatory.minHeight)}function u(e,t){var n={audio:!1,video:!1},r=x.a.isFirefox()||x.a.isEdge()||x.a.isReactNative()||x.a.isTemasysPluginUsed();if(e.indexOf("video")>=0){if(n.video={mandatory:{},optional:[]},t.cameraDeviceId)r&&(n.video.deviceId=t.cameraDeviceId),n.video.optional.push({sourceId:t.cameraDeviceId});else{var i=t.facingMode||w.a.USER;r&&(n.video.facingMode=i),n.video.optional.push({facingMode:i})}(t.minFps||t.maxFps||t.fps)&&((t.minFps||t.fps)&&(t.minFps=t.minFps||t.fps,n.video.mandatory.minFrameRate=t.minFps),t.maxFps&&(n.video.mandatory.maxFrameRate=t.maxFps)),c(n,r,t.resolution)}if(e.indexOf("audio")>=0&&(x.a.isReactNative()?n.audio=!0:x.a.isFirefox()?t.micDeviceId?n.audio={mandatory:{},deviceId:t.micDeviceId,optional:[{sourceId:t.micDeviceId}]}:n.audio=!0:(n.audio={mandatory:{},optional:[]},t.micDeviceId&&(r&&(n.audio.deviceId=t.micDeviceId),n.audio.optional.push({sourceId:t.micDeviceId})),n.audio.optional.push({echoCancellation:!te&&!ee},{googEchoCancellation:!te&&!ee},{googAutoGainControl:!re&&!ee},{googNoiseSupression:!ne&&!ee},{googHighpassFilter:!ie&&!ee},{googNoiseSuppression2:!ne&&!ee},{googEchoCancellation2:!te&&!ee},{googAutoGainControl2:!re&&!ee}))),e.indexOf("screen")>=0)if(x.a.isChrome())n.video={mandatory:{chromeMediaSource:"screen",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[]};else if(x.a.isTemasysPluginUsed())n.video={optional:[{sourceId:q.WebRTCPlugin.plugin.screensharingKey}]};else if(x.a.isFirefox())n.video={mozMediaSource:"window",mediaSource:"window"};else{var o="'screen' WebRTC media source is supported only in Chrome and with Temasys plugin";A.a.callErrorHandler(new Error(o)),K.error(o)}return e.indexOf("desktop")>=0&&(n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t.desktopStream,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[]}),t.bandwidth&&(n.video||(n.video={mandatory:{},optional:[]}),n.video.optional.push({bandwidth:t.bandwidth})),x.a.isFirefox()&&t.firefox_fake_device&&(n.fake=!0),n}function l(e,t){var n=t&&t.getAudioTracks().length>0,r=t&&t.getVideoTracks().length>0;-1!==e.indexOf("video")&&(X.video=r),-1!==e.indexOf("audio")&&(X.audio=n),z.emit(j.a.AVAILABLE_DEVICES_CHANGED,X)}function d(e){function t(e){return JSON.stringify({kind:e.kind,deviceId:e.deviceId,groupId:e.groupId,label:e.label,facing:e.facing})}return e.length!==se.length||e.map(t).sort().join("")!==se.map(t).sort().join("")}function p(){ce&&ce(function(e){void 0===se?se=e.slice(0):d(e)&&f(e),window.setTimeout(p,Q)})}function f(e){se=e.slice(0),K.info("list of media devices has changed:",se);var t=se.filter(function(e){return"videoinput"===e.kind}),n=se.filter(function(e){return"audioinput"===e.kind}),r=t.filter(function(e){return""===e.label}),i=n.filter(function(e){return""===e.label});t.length&&t.length===r.length&&(X.video=!1),n.length&&n.length===i.length&&(X.audio=!1),z.emit(j.a.DEVICE_LIST_CHANGED,e)}function h(e,t){e&&e.apply(void 0,a(t))}function v(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?function(t,n,r){return e(t).then(function(e){return h(n,[e]),e}).catch(function(e){throw h(r,[e]),e})}:function(t,n,r){e(t,function(e){h(n,[e])},function(e){h(r,[e])})}}function m(e){MediaStreamTrack.getSources(function(t){return e(t.map(g))})}function g(e){var t=(e.kind||"").toLowerCase();return{facing:e.facing||null,label:e.label,kind:t?"audiooutput"===t?t:t+"input":null,deviceId:e.id,groupId:e.groupId||null}}function y(e,t){var n=void 0,r=void 0,i=void 0,o=[];if(e){var a=e.audioVideo;if(a){var s=window.webkitMediaStream||window.MediaStream,c=a.getAudioTracks();if(c.length){n=new s;for(var u=0;u<c.length;u++)n.addTrack(c[u])}var l=a.getVideoTracks();if(l.length){i=new s;for(var d=0;d<l.length;d++)i.addTrack(l[d])}}else n=e.audio,i=e.video;r=e.desktop}if(r){var p=r,f=p.stream,h=p.sourceId,v=p.sourceType;o.push({stream:f,sourceId:h,sourceType:v,track:f.getVideoTracks()[0],mediaType:L.b,videoType:H.a.DESKTOP})}return n&&o.push({stream:n,track:n.getAudioTracks()[0],mediaType:L.a,videoType:null}),i&&o.push({stream:i,track:i.getVideoTracks()[0],mediaType:L.b,videoType:H.a.CAMERA,resolution:t}),o}function b(e,t){var n="srcObject";if(n in e||(n="mozSrcObject")in e||(n=null),n)return void(e[n]=t);var r=void 0;t&&((r=t.jitsiObjectURL)||(t.jitsiObjectURL=r=(URL||webkitURL).createObjectURL(t))),e.src=r||""}function S(e,t){var n=new Error(e);n.name="WEBRTC_NOT_SUPPORTED",K.error(e),t(n)}function _(e){if(!e.devices||0===e.devices.length)return e.successCallback(e.streams||{});var t=e.devices.splice(0,1);e.deviceGUM[t](function(n){e.streams=e.streams||{},e.streams[t]=n,_(e)},function(n){Object.keys(e.streams).forEach(function(t){return pe.stopMediaStream(e.streams[t])}),K.error("failed to obtain "+t+" stream - stop",n),e.errorCallback(n)})}function T(e,t){le=!0,z.emit(j.a.RTC_READY,!0),B.a.init(e,t),pe.isDeviceListAvailable()&&ce&&ce(function(e){se=e.splice(0),z.emit(j.a.DEVICE_LIST_AVAILABLE,se),ue?navigator.mediaDevices.addEventListener("devicechange",function(){return pe.enumerateDevices(f)}):p()})}function E(e){return function(t,n){var r=e.apply(pe,arguments);return n&&pe.isDeviceChangeAvailable("output")&&n.getAudioTracks&&n.getAudioTracks().length&&Z&&t.setSinkId(pe.getAudioOutputDevice()).catch(function(e){var n=new D.a(e,null,["audiooutput"]);A.a.callUnhandledRejectionHandler({promise:this,reason:n}),K.warn("Failed to set audio output device for the element. Default audio output device will be used instead",t,n)}),r}}var C=n(51),w=n.n(C),R=n(12),k=n.n(R),I=n(0),P=(n.n(I),n(2)),A=n.n(P),D=n(9),O=n(8),L=n(3),N=n(31),M=n.n(N),x=n(1),F=n(7),j=n.n(F),U=n(115),B=n(124),G=n(10),J=n(14),H=n.n(J),V=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),K=Object(I.getLogger)(e),q=x.a.isTemasysPluginUsed()?n(33):void 0,z=new k.a,Q=3e3,X={audio:!1,video:!1},Y="default",Z=!1,ee=!1,te=!1,ne=!1,re=!1,ie=!1,oe=document.createElement("audio"),ae=void 0!==oe.setSinkId,se=void 0,ce=void 0,ue=!1,le=!1,de=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,z))}return o(t,e),W(t,[{key:"init",value:function(e){var t=this;return"boolean"==typeof e.disableAEC&&(te=e.disableAEC,K.info("Disable AEC: "+te)),"boolean"==typeof e.disableNS&&(ne=e.disableNS,K.info("Disable NS: "+ne)),"boolean"==typeof e.disableAP&&(ee=e.disableAP,K.info("Disable AP: "+ee)),"boolean"==typeof e.disableAGC&&(re=e.disableAGC,K.info("Disable AGC: "+re)),"boolean"==typeof e.disableHPF&&(ie=e.disableHPF,K.info("Disable HPF: "+ie)),s(),new Promise(function(n,r){if(x.a.isFirefox()){var i=x.a.getFirefoxVersion();if(i<40)return void S("Firefox version too old: "+i+". Required >= 40.",r);t.RTCPeerConnectionType=mozRTCPeerConnection,t.getUserMedia=v(navigator.mozGetUserMedia.bind(navigator)),t.enumerateDevices=ce,t.pcConstraints={},t.attachMediaStream=E(function(e,t){return e&&(b(e,t),t&&e.play()),e}),t.getStreamID=function(e){var t=e.id;if(!t){var n=e.getVideoTracks();n&&0!==n.length||(n=e.getAudioTracks()),t=n[0].id}return G.a.filterSpecialChars(t)},t.getTrackID=function(e){return e.id},RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate}else if(x.a.isChrome()||x.a.isOpera()||x.a.isNWJS()||x.a.isElectron()||x.a.isReactNative()){t.RTCPeerConnectionType=webkitRTCPeerConnection;var o=navigator.webkitGetUserMedia.bind(navigator);t.getUserMedia=v(o),t.enumerateDevices=ce,t.attachMediaStream=E(function(e,t){return b(e,t),e}),t.getStreamID=function(e){var t=e.id;return"number"==typeof t?t:G.a.filterSpecialChars(t)},t.getTrackID=function(e){return e.id},t.pcConstraints={optional:[]},e.useIPv6&&t.pcConstraints.optional.push({googIPv6:!0}),webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks}),webkitMediaStream.prototype.getAudioTracks||(webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),t.p2pPcConstraints=JSON.parse(JSON.stringify(t.pcConstraints)),e.disableSuspendVideo||t.pcConstraints.optional.push({googSuspendBelowMinBitrate:!0}),t.p2pPcConstraints.optional.push({googSuspendBelowMinBitrate:!0})}else if(x.a.isEdge())t.RTCPeerConnectionType=U.a,t.getUserMedia=v(navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices),!0),t.enumerateDevices=ce,t.attachMediaStream=E(function(e,t){return b(e,t),e}),t.getStreamID=function(e){var t=e.jitsiRemoteId||e.id;return G.a.filterSpecialChars(t)},t.getTrackID=function(e){return e.jitsiRemoteId||e.id};else{if(!x.a.isTemasysPluginUsed())return void S("Browser does not appear to be WebRTC-capable",r);var a=function(){t.RTCPeerConnectionType=RTCPeerConnection,t.getUserMedia=window.getUserMedia,t.enumerateDevices=m,t.attachMediaStream=E(function(e,t){if(t){if("dummyAudio"===t.id||"dummyVideo"===t.id)return;var n=$(e);if(x.a.isTemasysPluginUsed()&&!n.is(":visible")&&n.show(),t.getVideoTracks().length>0&&!$(e).is(":visible"))throw new Error("video element must be visible to attach video stream")}return attachMediaStream(e,t)}),t.getStreamID=function(e){return G.a.filterSpecialChars(e.label)},t.getTrackID=function(e){return e.id},T(e,t.getUserMediaWithConstraints.bind(t))},s=new Promise(function(e){return q.webRTCReady(e)});q.WebRTCPlugin.isPluginInstalled(q.WebRTCPlugin.pluginInfo.prefix,q.WebRTCPlugin.pluginInfo.plugName,q.WebRTCPlugin.pluginInfo.type,function(){s.then(function(){a(),n()})},function(){var e=new Error("Temasys plugin is not installed");e.name="WEBRTC_NOT_READY",e.webRTCReadyPromise=s,r(e)})}t.p2pPcConstraints=t.p2pPcConstraints||t.pcConstraints,x.a.isTemasysPluginUsed()||(T(e,t.getUserMediaWithConstraints.bind(t)),n())})}},{key:"getUserMediaWithConstraints",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=u(e,r);K.info("Get media constraints",i);try{this.getUserMedia(i,function(n){K.log("onUserMediaSuccess"),l(e,n),t(n)},function(t){l(e,void 0),K.warn("Failed to get access to local media. Error ",t,i),n&&n(new D.a(t,i,e))})}catch(t){K.error("GUM failed: ",t),n&&n(new D.a(t,i,e))}}},{key:"obtainAudioAndVideoPermissions",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this,r=V({},t.desktopSharingExtensionExternalInstallation,{desktopSharingSources:t.desktopSharingSources});return new Promise(function(i,o){var a=function(e){i(y(e,t.resolution))};if(t.devices=t.devices||["audio","video"],B.a.isSupported()||-1===t.devices.indexOf("desktop")||o(new Error("Desktop sharing is not supported!")),x.a.isFirefox()||x.a.isReactNative()||x.a.isTemasysPluginUsed()){var s=function(e,n,r){this.getUserMediaWithConstraints(e,n,r,t)},c={audio:s.bind(n,["audio"]),video:s.bind(n,["video"])};B.a.isSupported()&&(c.desktop=B.a.obtainStream.bind(B.a,r)),_({devices:t.devices,streams:[],successCallback:a,errorCallback:o,deviceGUM:c})}else{var l=t.devices.indexOf("desktop")>-1;l&&t.devices.splice(t.devices.indexOf("desktop"),1),t.resolution=t.resolution||"360",t.devices.length?e.getUserMediaWithConstraints(t.devices,function(e){var i=-1!==t.devices.indexOf("audio"),s=-1!==t.devices.indexOf("video"),c=e.getAudioTracks().length>0,d=e.getVideoTracks().length>0;if(i&&!c||s&&!d){n.stopMediaStream(e);var p=[];return i&&!c&&p.push("audio"),s&&!d&&p.push("video"),void n.getUserMediaWithConstraints(p,function(){o(new D.a({name:"UnknownError"},u(t.devices,t),p))},function(e){o(e)},t)}l?B.a.obtainStream(r,function(t){a({audioVideo:e,desktop:t})},function(t){n.stopMediaStream(e),o(t)}):a({audioVideo:e})},function(e){return o(e)},t):l&&B.a.obtainStream(r,function(e){return a({desktop:e})},function(e){return o(e)})}})}},{key:"getDeviceAvailability",value:function(){return X}},{key:"isRTCReady",value:function(){return le}},{key:"_isDeviceListAvailable",value:function(){if(!le)throw new Error("WebRTC not ready yet");return Boolean(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||"undefined"!=typeof MediaStreamTrack&&MediaStreamTrack.getSources)}},{key:"onRTCReady",value:function(){return le?Promise.resolve():new Promise(function(e){var t=function t(){z.removeListener(j.a.RTC_READY,t),e()};z.addListener(j.a.RTC_READY,t)})}},{key:"isDeviceListAvailable",value:function(){return this.onRTCReady().then(this._isDeviceListAvailable.bind(this))}},{key:"isDeviceChangeAvailable",value:function(e){return"output"===e||"audiooutput"===e?ae:x.a.isChrome()||x.a.isFirefox()||x.a.isOpera()||x.a.isTemasysPluginUsed()||x.a.isNWJS()||x.a.isElectron()||x.a.isEdge()}},{key:"stopMediaStream",value:function(e){e.getTracks().forEach(function(e){!x.a.isTemasysPluginUsed()&&e.stop&&e.stop()}),e.stop&&e.stop(),e.release&&e.release();var t=e.jitsiObjectURL;t&&(delete e.jitsiObjectURL,(URL||webkitURL).revokeObjectURL(t))}},{key:"isDesktopSharingEnabled",value:function(){return B.a.isSupported()}},{key:"setAudioOutputDevice",value:function(e){return this.isDeviceChangeAvailable("output")||Promise.reject(new Error("Audio output device change is not supported")),oe.setSinkId(e).then(function(){Y=e,Z=!0,K.log("Audio output device set to "+e),z.emit(j.a.AUDIO_OUTPUT_DEVICE_CHANGED,e)})}},{key:"getAudioOutputDevice",value:function(){return Y}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return se}},{key:"getEventDataForActiveDevice",value:function(e){var t=[],n={deviceId:e.deviceId,kind:e.kind,label:e.label,groupId:e.groupId};return t.push(n),{deviceList:t}}}]),t}(O.a),pe=new de;t.a=pe}).call(t,"modules/RTC/RTCUtils.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return parseInt(e.ssrcs.split(" ")[0],10)}function o(e){return parseInt(e.ssrcs.split(" ")[1],10)}function a(e){return e.ssrcs?e.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t}).length:0}t.b=i,t.c=o,n.d(t,"a",function(){return l});var s=n(11),c=(n.n(s),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),u=function(){function e(t){if(r(this,e),!t)throw new Error("mLine is undefined");this.mLine=t}return c(e,[{key:"getSSRCAttrValue",value:function(e,t){var n=this.ssrcs.find(function(n){return n.id===e&&n.attribute===t});return n&&n.value}},{key:"removeSSRC",value:function(e){this.mLine.ssrcs&&this.mLine.ssrcs.length&&(this.mLine.ssrcs=this.mLine.ssrcs.filter(function(t){return t.id!==e}))}},{key:"addSSRCAttribute",value:function(e){this.ssrcs.push(e)}},{key:"findGroup",value:function(e,t){return this.ssrcGroups.find(function(n){return n.semantics===e&&(!t||t===n.ssrcs)})}},{key:"findGroups",value:function(e){return this.ssrcGroups.filter(function(t){return t.semantics===e})}},{key:"findGroupByPrimarySSRC",value:function(e,t){return this.ssrcGroups.find(function(n){return n.semantics===e&&i(n)===t})}},{key:"findSSRCByMSID",value:function(e){return this.ssrcs.find(function(t){return"msid"===t.attribute&&(null===e||t.value===e)})}},{key:"getSSRCCount",value:function(){return a(this.mLine)}},{key:"containsAnySSRCGroups",value:function(){return void 0!==this.mLine.ssrcGroups}},{key:"getPrimaryVideoSsrc",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimarySsrc doesn't work with '"+e+"'");if(1===a(this.mLine))return this.mLine.ssrcs[0].id;if(this.mLine.ssrcGroups){var t=this.findGroup("SIM");if(t)return i(t);var n=this.findGroup("FID");if(n)return i(n)}}},{key:"getRtxSSRC",value:function(e){var t=this.findGroupByPrimarySSRC("FID",e);return t&&o(t)}},{key:"getSSRCs",value:function(){return this.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t})}},{key:"getPrimaryVideoSSRCs",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimaryVideoSSRCs doesn't work with "+e);var t=this.getSSRCs(),n=!0,r=!1,i=void 0;try{for(var a,s=this.ssrcGroups[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var c=a.value;if("FID"===c.semantics){var u=o(c);t.splice(t.indexOf(u),1)}}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return t}},{key:"dumpSSRCGroups",value:function(){return JSON.stringify(this.mLine.ssrcGroups)}},{key:"removeGroupsWithSSRC",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter(function(t){return-1===t.ssrcs.indexOf(""+e)}))}},{key:"removeGroupsBySemantics",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter(function(t){return t.semantics!==e}))}},{key:"replaceSSRC",value:function(e,t){this.mLine.ssrcs&&this.mLine.ssrcs.forEach(function(n){n.id===e&&(n.id=t)})}},{key:"addSSRCGroup",value:function(e){this.ssrcGroups.push(e)}},{key:"ssrcs",get:function(){return this.mLine.ssrcs||(this.mLine.ssrcs=[]),this.mLine.ssrcs},set:function(e){this.mLine.ssrcs=e}},{key:"direction",get:function(){return this.mLine.direction},set:function(e){this.mLine.direction=e}},{key:"ssrcGroups",get:function(){return this.mLine.ssrcGroups||(this.mLine.ssrcGroups=[]),this.mLine.ssrcGroups},set:function(e){this.mLine.ssrcGroups=e}}]),e}(),l=function(){function e(t){r(this,e),this.parsedSDP=s.parse(t)}return c(e,[{key:"selectMedia",value:function(e){var t=this.parsedSDP.media.find(function(t){return t.type===e});return t?new u(t):null}},{key:"toRawSDP",value:function(){return s.write(this.parsedSDP)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"LOCAL_STATS_UPDATED",function(){return r}),n.d(t,"REMOTE_STATS_UPDATED",function(){return i});var r="cq.local_stats_updated",i="cq.remote_stats_updated"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"AUTHENTICATION_REQUIRED",function(){return r}),n.d(t,"CHAT_ERROR",function(){return i}),n.d(t,"CONFERENCE_DESTROYED",function(){return o}),n.d(t,"CONFERENCE_MAX_USERS",function(){return a}),n.d(t,"CONNECTION_ERROR",function(){return s}),n.d(t,"NOT_ALLOWED_ERROR",function(){return c}),n.d(t,"FOCUS_DISCONNECTED",function(){return u}),n.d(t,"FOCUS_LEFT",function(){return l}),n.d(t,"GRACEFUL_SHUTDOWN",function(){return d}),n.d(t,"INCOMPATIBLE_SERVER_VERSIONS",function(){return p}),n.d(t,"JINGLE_FATAL_ERROR",function(){return f}),n.d(t,"PASSWORD_NOT_SUPPORTED",function(){return h}),n.d(t,"PASSWORD_REQUIRED",function(){return v}),n.d(t,"RESERVATION_ERROR",function(){return m}),n.d(t,"SETUP_FAILED",function(){return g}),n.d(t,"VIDEOBRIDGE_NOT_AVAILABLE",function(){return y});var r="conference.authenticationRequired",i="conference.chatError",o="conference.destroyed",a="conference.max_users",s="conference.connectionError",c="conference.connectionError.notAllowed",u="conference.focusDisconnected",l="conference.focusLeft",d="conference.gracefulShutdown",p="conference.incompatible_server_versions",f="conference.jingleFatalError",h="conference.passwordNotSupported",v="conference.passwordRequired",m="conference.reservationError",g="conference.setup_failed",y="conference.videobridgeNotAvailable"},function(e,t){function n(){this.attaches=[],this.signalListeners=[],this.mapFnc=null}n.prototype={constructor:n,add:function(e){console.log("Abstract method is called width value: "+e)},remove:function(e){console.log("Abstract method is called with value: "+e)},attach:function(e,t){this.attaches.push({cb:e,that:void 0===t?null:t})},notify:function(e){for(var t=0;t<this.attaches.length;++t){var n=this.attaches[t];n.cb?n.cb.call(n.that,e):n.cb(e)}},addMapFnc:function(e){this.mapFnc=e},map:function(){},mapping:function(e,t){null!==this.mapFnc&&this.mapFnc(e,t)},addSignalListener:function(e,t,n){this.signalListeners.push({signalName:e,cb:t,that:void 0===n?null:n})},signalize:function(e,t){for(var n=0;n<this.signalListeners.length;++n){var r=this.signalListeners[n];r.signalName===e&&null!==r.cb&&void 0!==r.cb&&(r.that?r.cb.call(r.that,t):r.cb(t))}}},e.exports=n},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function o(e){if(d===clearTimeout)return clearTimeout(e);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function a(){v&&f&&(v=!1,f.length?h=f.concat(h):m=-1,h.length&&s())}function s(){if(!v){var e=i(a);v=!0;for(var t=h.length;t;){for(f=h,h=[];++m<t;)f&&f[m].run();m=-1,t=h.length}f=null,v=!1,o(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var l,d,p=e.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(e){d=r}}();var f,h=[],v=!1,m=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new c(e,t)),1!==h.length||v||i(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=u,p.addListener=u,p.once=u,p.off=u,p.removeListener=u,p.removeAllListeners=u,p.emit=u,p.prependListener=u,p.prependOnceListener=u,p.listeners=function(e){return[]},p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){var n={1080:{width:1920,height:1080,order:7},fullhd:{width:1920,height:1080,order:7},720:{width:1280,height:720,order:6},hd:{width:1280,height:720,order:6},960:{width:960,height:720,order:5},360:{width:640,height:360,order:4},640:{width:640,height:480,order:3},vga:{width:640,height:480,order:3},180:{width:320,height:180,order:2},320:{width:320,height:240,order:1}};e.exports=n},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",function(){return m});var i=n(0),o=(n.n(i),n(4)),a=n(15),s=n(3),c=n(1),u=n(7),l=n.n(u),d=n(5),p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=Object(i.getLogger)(e),h=500,v=2e3,m={ACTIVE:"active",INACTIVE:"inactive",INTERRUPTED:"interrupted",RESTORING:"restoring"},g=function(){function e(t,n,i){r(this,e),this.rtc=t,this.conference=n,this.trackTimers={},this.connStatusFromJvb={},this.outOfLastNTimeout="number"==typeof i.outOfLastNTimeout?i.outOfLastNTimeout:h,this.rtcMuteTimeout="number"==typeof i.rtcMuteTimeout?i.rtcMuteTimeout:v,this.rtcMutedTimestamp={},f.info("RtcMuteTimeout set to: "+this.rtcMuteTimeout),this.enteredLastNTimestamp=new Map,this.restoringTimers=new Map}return p(e,null,[{key:"_getNewStateForJvbMode",value:function(e,t,n,r,i){return e?r?m.ACTIVE:c.a.isVideoMuteOnConnInterruptedSupported()?i?t?n?m.INTERRUPTED:m.RESTORING:m.INACTIVE:m.ACTIVE:t?m.ACTIVE:m.INACTIVE:m.INTERRUPTED}},{key:"_getNewStateForP2PMode",value:function(e,t){return c.a.isVideoMuteOnConnInterruptedSupported()?e||!t?m.ACTIVE:m.INTERRUPTED:m.ACTIVE}}]),p(e,[{key:"_getVideoFrozenTimeout",value:function(e){return this.rtc.isInLastN(e)?this.rtcMuteTimeout:this.outOfLastNTimeout}},{key:"init",value:function(){this._onEndpointConnStatusChanged=this.onEndpointConnStatusChanged.bind(this),this.rtc.addListener(l.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),this._onP2PStatus=this.refreshConnectionStatusForAll.bind(this),this.conference.on(o.P2P_STATUS,this._onP2PStatus),c.a.isVideoMuteOnConnInterruptedSupported()&&(this._onTrackRtcMuted=this.onTrackRtcMuted.bind(this),this.rtc.addListener(l.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this._onTrackRtcUnmuted=this.onTrackRtcUnmuted.bind(this),this.rtc.addListener(l.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this._onRemoteTrackAdded=this.onRemoteTrackAdded.bind(this),this.conference.on(o.TRACK_ADDED,this._onRemoteTrackAdded),this._onRemoteTrackRemoved=this.onRemoteTrackRemoved.bind(this),this.conference.on(o.TRACK_REMOVED,this._onRemoteTrackRemoved),this._onSignallingMuteChanged=this.onSignallingMuteChanged.bind(this)),this._onLastNChanged=this._onLastNChanged.bind(this),this.conference.on(o.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this._onLastNValueChanged=this.refreshConnectionStatusForAll.bind(this),this.rtc.on(l.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged)}},{key:"dispose",value:function(){this.rtc.removeListener(l.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),c.a.isVideoMuteOnConnInterruptedSupported()&&(this.rtc.removeListener(l.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this.rtc.removeListener(l.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this.conference.off(o.TRACK_ADDED,this._onRemoteTrackAdded),this.conference.off(o.TRACK_REMOVED,this._onRemoteTrackRemoved)),this.conference.off(o.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this.rtc.removeListener(l.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged),this.conference.off(o.P2P_STATUS,this._onP2PStatus);var e=Object.keys(this.trackTimers),t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;this.clearTimeout(s),this.clearRtcMutedTimestamp(s)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}this.connStatusFromJvb={}}},{key:"onEndpointConnStatusChanged",value:function(e,t){f.debug("Detector RTCEvents.ENDPOINT_CONN_STATUS_CHANGED("+Date.now()+"): "+e+": "+t),e!==this.conference.myUserId()&&(this.connStatusFromJvb[e]=t,this.figureOutConnectionStatus(e))}},{key:"_changeConnectionStatus",value:function(e,t){if(e.getConnectionStatus()!==t){var n=e.getId();e._setConnectionStatus(t),f.debug("Emit endpoint conn status("+Date.now()+") "+n+": "+t),d.a.sendLog(JSON.stringify({id:"peer.conn.status",participant:n,status:t})),this.conference.eventEmitter.emit(o.PARTICIPANT_CONN_STATUS_CHANGED,n,t)}}},{key:"clearTimeout",value:function(e){this.trackTimers[e]&&(window.clearTimeout(this.trackTimers[e]),this.trackTimers[e]=null)}},{key:"clearRtcMutedTimestamp",value:function(e){this.rtcMutedTimestamp[e]=null}},{key:"onRemoteTrackAdded",value:function(e){e.isLocal()||e.getType()!==s.b||(f.debug("Detector on remote track added for: "+e.getParticipantId()),e.on(a.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged))}},{key:"onRemoteTrackRemoved",value:function(e){if(!e.isLocal()&&e.getType()===s.b){var t=e.getParticipantId();f.debug("Detector on remote track removed: "+t),e.off(a.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}}},{key:"isVideoTrackFrozen",value:function(e){if(!c.a.isVideoMuteOnConnInterruptedSupported())return!1;var t=e.getId(),n=e.hasAnyVideoTrackWebRTCMuted(),r=this.rtcMutedTimestamp[t],i=this._getVideoFrozenTimeout(t);return n&&"number"==typeof r&&Date.now()-r>=i}},{key:"refreshConnectionStatusForAll",value:function(){var e=this.conference.getParticipants(),t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.figureOutConnectionStatus(a.getId())}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}},{key:"figureOutConnectionStatus",value:function(t){var n=this.conference.getParticipantById(t);if(!n)return void f.warn("figure out conn status - no participant for: "+t);var r=this.conference.isP2PActive(),i=this._isRestoringTimedout(t),o=0===this.rtc.getLastN(),a=n.isVideoMuted()||o,s=this.isVideoTrackFrozen(n),c=this.rtc.isInLastN(t),u=this.connStatusFromJvb[t];"boolean"!=typeof u&&(f.debug("Assuming connection active by JVB - no notification"),u=!0);var l=r?e._getNewStateForP2PMode(a,s):e._getNewStateForJvbMode(u,c,i,a,s);l!==m.RESTORING&&this._clearRestoringTimer(t),f.debug("Figure out conn status for "+t+", is video muted: "+a+" is active(jvb): "+u+" video track frozen: "+s+" p2p mode: "+r+" is in last N: "+c+" currentStatus => newStatus: \n                    "+n.getConnectionStatus()+" => "+l),this._changeConnectionStatus(n,l)}},{key:"_onLastNChanged",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Date.now();f.debug("leaving/entering lastN",e,t,n);var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;this.enteredLastNTimestamp.delete(c),this._clearRestoringTimer(c),this.figureOutConnectionStatus(c)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}var u=!0,l=!1,d=void 0;try{for(var p,h=t[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var v=p.value;this.enteredLastNTimestamp.set(v,n),this.figureOutConnectionStatus(v)}}catch(e){l=!0,d=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw d}}}},{key:"_clearRestoringTimer",value:function(e){var t=this.restoringTimers.get(e);t&&(clearTimeout(t),this.restoringTimers.delete(e))}},{key:"_isRestoringTimedout",value:function(e){var t=this,n=this.enteredLastNTimestamp.get(e);return!!(n&&Date.now()-n>=5e3)||(this.restoringTimers.get(e)||this.restoringTimers.set(e,setTimeout(function(){return t.figureOutConnectionStatus(e)},5e3)),!1)}},{key:"onTrackRtcMuted",value:function(e){var t=this,n=e.getParticipantId(),r=this.conference.getParticipantById(n);if(f.debug("Detector track RTC muted: "+n,Date.now()),!r)return void f.error("No participant for id: "+n);if(this.rtcMutedTimestamp[n]=Date.now(),!r.isVideoMuted()){this.clearTimeout(n);var i=this._getVideoFrozenTimeout(n);this.trackTimers[n]=window.setTimeout(function(){f.debug("Set RTC mute timeout for: "+n+"                     of "+i+" ms"),t.clearTimeout(n),t.figureOutConnectionStatus(n)},i)}}},{key:"onTrackRtcUnmuted",value:function(e){var t=e.getParticipantId();f.debug("Detector track RTC unmuted: "+t,Date.now()),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}},{key:"onSignallingMuteChanged",value:function(e){var t=e.getParticipantId();f.debug("Detector on track signalling mute changed: "+t,e.isMuted()),this.figureOutConnectionStatus(t)}}]),e}();t.b=g}).call(t,"modules/connectivity/ParticipantConnectionStatus.js")},function(e,t,n){(function(t){var r,r,o=n(0).getLogger(t),a=a||{};e.exports=a,a.options=a.options||{},a.VERSION="0.14.0",a.onwebrtcready=a.onwebrtcready||function(e){},a._onwebrtcreadies=[],a.webRTCReady=function(e){if("function"!=typeof e)throw new Error("Callback provided is not a function");!0===a.onwebrtcreadyDone?e(null!==a.WebRTCPlugin.plugin):a._onwebrtcreadies.push(e)},a.WebRTCPlugin=a.WebRTCPlugin||{},a.WebRTCPlugin.pluginInfo=a.WebRTCPlugin.pluginInfo||{prefix:"Tem",plugName:"TemWebRTCPlugin",pluginId:"plugin0",type:"application/x-temwebrtcplugin",onload:"__TemWebRTCReady0",portalLink:"http://skylink.io/plugin/",downloadLink:null,companyName:"Temasys",downloadLinks:{mac:"http://bit.ly/webrtcpluginpkg",win:"http://bit.ly/webrtcpluginmsi"}},void 0!==a.WebRTCPlugin.pluginInfo.downloadLinks&&null!==a.WebRTCPlugin.pluginInfo.downloadLinks&&(navigator.platform.match(/^Mac/i)?a.WebRTCPlugin.pluginInfo.downloadLink=a.WebRTCPlugin.pluginInfo.downloadLinks.mac:navigator.platform.match(/^Win/i)&&(a.WebRTCPlugin.pluginInfo.downloadLink=a.WebRTCPlugin.pluginInfo.downloadLinks.win)),a.WebRTCPlugin.TAGS={NONE:"none",AUDIO:"audio",VIDEO:"video"},a.WebRTCPlugin.pageId=Math.random().toString(36).slice(2),a.WebRTCPlugin.plugin=null,a.WebRTCPlugin.setLogLevel=null,a.WebRTCPlugin.defineWebRTCInterface=null,a.WebRTCPlugin.isPluginInstalled=null,a.WebRTCPlugin.pluginInjectionInterval=null,a.WebRTCPlugin.injectPlugin=null,a.WebRTCPlugin.PLUGIN_STATES={NONE:0,INITIALIZING:1,INJECTING:2,INJECTED:3,READY:4},a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.NONE,a.onwebrtcreadyDone=!1,a.WebRTCPlugin.PLUGIN_LOG_LEVELS={NONE:"NONE",ERROR:"ERROR",WARNING:"WARNING",INFO:"INFO",VERBOSE:"VERBOSE",SENSITIVE:"SENSITIVE"},a.WebRTCPlugin.WaitForPluginReady=null,a.WebRTCPlugin.callWhenPluginReady=null,__TemWebRTCReady0=function(){if("complete"===document.readyState)a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.READY,a.maybeThroughWebRTCReady();else var e=setInterval(function(){"complete"===document.readyState&&(clearInterval(e),a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.READY,a.maybeThroughWebRTCReady())},100)},a.maybeThroughWebRTCReady=function(){a.onwebrtcreadyDone||(a.onwebrtcreadyDone=!0,a._onwebrtcreadies.length?a._onwebrtcreadies.forEach(function(e){"function"==typeof e&&e(null!==a.WebRTCPlugin.plugin)}):"function"==typeof a.onwebrtcready&&a.onwebrtcready(null!==a.WebRTCPlugin.plugin))},a.TEXT={PLUGIN:{REQUIRE_INSTALLATION:"This website requires you to install a WebRTC-enabling plugin to work on this browser.",NOT_SUPPORTED:"Your browser does not support WebRTC.",BUTTON:"Install Now"},REFRESH:{REQUIRE_REFRESH:"Please refresh page",BUTTON:"Refresh Page"}},a._iceConnectionStates={starting:"starting",checking:"checking",connected:"connected",completed:"connected",done:"completed",disconnected:"disconnected",failed:"failed",closed:"closed"},a._iceConnectionFiredStates=[],a.isDefined=null,a.parseWebrtcDetectedBrowser=function(){var e=null;if(window.opr&&opr.addons||window.opera||navigator.userAgent.indexOf(" OPR/")>=0)e=navigator.userAgent.match(/OPR\/(\d+)/i)||[],webrtcDetectedBrowser="opera",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=26,webrtcDetectedType="webkit",webrtcDetectedDCSupport="SCTP";else if(navigator.userAgent.match(/Bowser\/[0-9.]*/g)){e=navigator.userAgent.match(/Bowser\/[0-9.]*/g)||[];var t=parseInt((navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[])[2]||"0",10);webrtcDetectedBrowser="bowser",webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),webrtcMinimumVersion=0,webrtcDetectedType="webkit",webrtcDetectedDCSupport=t>30?"SCTP":"RTP"}else if(navigator.userAgent.indexOf("OPiOS")>0)e=navigator.userAgent.match(/OPiOS\/([0-9]+)\./),webrtcDetectedBrowser="opera",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("CriOS")>0)e=navigator.userAgent.match(/CriOS\/([0-9]+)\./)||[],webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null;else if(navigator.userAgent.indexOf("FxiOS")>0)e=navigator.userAgent.match(/FxiOS\/([0-9]+)\./)||[],webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null;else if(document.documentMode)e=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],webrtcDetectedBrowser="IE",webrtcDetectedVersion=parseInt(e[1],10),webrtcMinimumVersion=9,webrtcDetectedType="plugin",webrtcDetectedDCSupport="SCTP",webrtcDetectedVersion||(e=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],webrtcDetectedVersion=parseInt(e[1]||"0",10));else if(window.StyleMedia||navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e=navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)||[],webrtcDetectedBrowser="edge",webrtcDetectedVersion=parseFloat((e[0]||"0/0").split("/")[1],10),webrtcMinimumVersion=13.10547,webrtcDetectedType="ms",webrtcDetectedDCSupport=null;else if("undefined"!=typeof InstallTrigger||navigator.userAgent.indexOf("irefox")>0)e=navigator.userAgent.match(/Firefox\/([0-9]+)\./)||[],webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=31,webrtcDetectedType="moz",webrtcDetectedDCSupport="SCTP";else if(window.chrome&&window.chrome.webstore||navigator.userAgent.indexOf("Chrom")>0)e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./i)||[],webrtcDetectedBrowser="chrome",webrtcDetectedVersion=parseInt(e[2]||"0",10),webrtcMinimumVersion=38,webrtcDetectedType="webkit",webrtcDetectedDCSupport=webrtcDetectedVersion>30?"SCTP":"RTP";else if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)){e=navigator.userAgent.match(/version\/(\d+)/i)||[];var n=navigator.userAgent.match(/(iPhone|iPad)/gi)||[];webrtcDetectedBrowser="safari",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=7,webrtcDetectedType=0===n.length?"plugin":null,webrtcDetectedDCSupport=0===n.length?"SCTP":null}else/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent)&&(e=navigator.userAgent.match(/AppleWebKit\/([0-9]+)\./)||[],webrtcDetectedBrowser="safari",webrtcDetectedVersion=parseInt(e[1]||"0",10),webrtcMinimumVersion=0,webrtcDetectedType=null,webrtcDetectedDCSupport=null);window.webrtcDetectedBrowser=webrtcDetectedBrowser,window.webrtcDetectedVersion=webrtcDetectedVersion,window.webrtcMinimumVersion=webrtcMinimumVersion,window.webrtcDetectedType=webrtcDetectedType,window.webrtcDetectedDCSupport=webrtcDetectedDCSupport},a.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e[t]=n},a.renderNotificationBar=function(e,t,n,r,i){if("complete"===document.readyState){var o=window,s=document.createElement("iframe");s.name="adapterjs-alert",s.style.position="fixed",s.style.top="-41px",s.style.left=0,s.style.right=0,s.style.width="100%",s.style.height="40px",s.style.backgroundColor="#ffffe1",s.style.border="none",s.style.borderBottom="1px solid #888888",s.style.zIndex="9999999","string"==typeof s.style.webkitTransition?s.style.webkitTransition="all .5s ease-out":"string"==typeof s.style.transition&&(s.style.transition="all .5s ease-out"),document.body.appendChild(s);var c=s.contentWindow?s.contentWindow:s.contentDocument.document?s.contentDocument.document:s.contentDocument;c.document.open(),c.document.write('<span style="display: inline-block; font-family: Helvetica, Arial,sans-serif; font-size: .9rem; padding: 4px; vertical-align: middle; cursor: default;">'+e+"</span>"),t&&n?(c.document.write('<button id="okay">'+t+'</button><button id="cancel">Cancel</button>'),c.document.close(),a.addEvent(c.document.getElementById("okay"),"click",function(e){i&&a.renderNotificationBar(a.TEXT.EXTENSION?a.TEXT.EXTENSION.REQUIRE_REFRESH:a.TEXT.REFRESH.REQUIRE_REFRESH,a.TEXT.REFRESH.BUTTON,"javascript:location.reload()"),window.open(n,r?"_blank":"_top"),e.preventDefault();try{e.cancelBubble=!0}catch(e){}var t=setInterval(function(){isIE||navigator.plugins.refresh(!1),a.WebRTCPlugin.isPluginInstalled(a.WebRTCPlugin.pluginInfo.prefix,a.WebRTCPlugin.pluginInfo.plugName,a.WebRTCPlugin.pluginInfo.type,function(){clearInterval(t),a.WebRTCPlugin.defineWebRTCInterface()},function(){})},500)}),a.addEvent(c.document.getElementById("cancel"),"click",function(e){o.document.body.removeChild(s)})):c.document.close(),setTimeout(function(){"string"==typeof s.style.webkitTransform?s.style.webkitTransform="translateY(40px)":"string"==typeof s.style.transform?s.style.transform="translateY(40px)":s.style.top="0px"},300)}},webrtcDetectedType=null,checkMediaDataChannelSettings=function(e,t,n,r){if("function"==typeof n){var i=!0,a="firefox"===webrtcDetectedBrowser,s="moz"===webrtcDetectedType&&webrtcDetectedVersion>30,c="firefox"===e;if(a&&c||s)try{delete r.mandatory.MozDontOfferDataChannel}catch(e){o.error("Failed deleting MozDontOfferDataChannel"),o.error(e)}else a&&!c&&(r.mandatory.MozDontOfferDataChannel=!0);if(!a)for(var u in r.mandatory)r.mandatory.hasOwnProperty(u)&&-1!==u.indexOf("Moz")&&delete r.mandatory[u];!a||c||s||(i=!1),n(i,r)}},checkIceConnectionState=function(e,t,n){if("function"!=typeof n)return void o.warn("No callback specified in checkIceConnectionState. Aborted.");e=e||"peer",a._iceConnectionFiredStates[e]&&t!==a._iceConnectionStates.disconnected&&t!==a._iceConnectionStates.failed&&t!==a._iceConnectionStates.closed||(a._iceConnectionFiredStates[e]=[]),t=a._iceConnectionStates[t],a._iceConnectionFiredStates[e].indexOf(t)<0&&(a._iceConnectionFiredStates[e].push(t),t===a._iceConnectionStates.connected&&setTimeout(function(){a._iceConnectionFiredStates[e].push(a._iceConnectionStates.done),n(a._iceConnectionStates.done)},1e3),n(t))},createIceServer=null,createIceServers=null,RTCPeerConnection=null,RTCSessionDescription="function"==typeof RTCSessionDescription?RTCSessionDescription:null,RTCIceCandidate="function"==typeof RTCIceCandidate?RTCIceCandidate:null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null,webrtcMinimumVersion=null,!(navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))||0===(navigator.userAgent.match(/android/gi)||[]).length&&0===(navigator.userAgent.match(/chrome/gi)||[]).length&&navigator.userAgent.indexOf("Safari/")>0?("object"==typeof o&&"function"==typeof o.log||(o={}||o,o.log=function(e){},o.info=function(e){},o.error=function(e){},o.dir=function(e){},o.exception=function(e){},o.trace=function(e){},o.warn=function(e){},o.count=function(e){},o.debug=function(e){},o.count=function(e){},o.time=function(e){},o.timeEnd=function(e){},o.group=function(e){},o.groupCollapsed=function(e){},o.groupEnd=function(e){}),a.parseWebrtcDetectedBrowser(),isIE="IE"===webrtcDetectedBrowser,a.WebRTCPlugin.WaitForPluginReady=function(){for(;a.WebRTCPlugin.pluginState!==a.WebRTCPlugin.PLUGIN_STATES.READY;);},a.WebRTCPlugin.callWhenPluginReady=function(e){if(a.WebRTCPlugin.pluginState===a.WebRTCPlugin.PLUGIN_STATES.READY)e();else var t=setInterval(function(){a.WebRTCPlugin.pluginState===a.WebRTCPlugin.PLUGIN_STATES.READY&&(clearInterval(t),e())},100)},a.WebRTCPlugin.setLogLevel=function(e){a.WebRTCPlugin.callWhenPluginReady(function(){a.WebRTCPlugin.plugin.setLogLevel(e)})},a.WebRTCPlugin.injectPlugin=function(){if("complete"===document.readyState&&a.WebRTCPlugin.pluginState===a.WebRTCPlugin.PLUGIN_STATES.INITIALIZING){if(a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.INJECTING,"IE"===webrtcDetectedBrowser&&webrtcDetectedVersion<=10){var e=document.createDocumentFragment();for(a.WebRTCPlugin.plugin=document.createElement("div"),a.WebRTCPlugin.plugin.innerHTML='<object id="'+a.WebRTCPlugin.pluginInfo.pluginId+'" type="'+a.WebRTCPlugin.pluginInfo.type+'" width="1" height="1"><param name="pluginId" value="'+a.WebRTCPlugin.pluginInfo.pluginId+'" /> <param name="windowless" value="false" /> <param name="pageId" value="'+a.WebRTCPlugin.pageId+'" /> <param name="onload" value="'+a.WebRTCPlugin.pluginInfo.onload+'" /><param name="tag" value="'+a.WebRTCPlugin.TAGS.NONE+'" />'+(a.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+"</object>";a.WebRTCPlugin.plugin.firstChild;)e.appendChild(a.WebRTCPlugin.plugin.firstChild);document.body.appendChild(e),a.WebRTCPlugin.plugin=document.getElementById(a.WebRTCPlugin.pluginInfo.pluginId)}else a.WebRTCPlugin.plugin=document.createElement("object"),a.WebRTCPlugin.plugin.id=a.WebRTCPlugin.pluginInfo.pluginId,isIE?(a.WebRTCPlugin.plugin.width="1px",a.WebRTCPlugin.plugin.height="1px"):(a.WebRTCPlugin.plugin.width="0px",a.WebRTCPlugin.plugin.height="0px"),a.WebRTCPlugin.plugin.type=a.WebRTCPlugin.pluginInfo.type,a.WebRTCPlugin.plugin.innerHTML='<param name="onload" value="'+a.WebRTCPlugin.pluginInfo.onload+'"><param name="pluginId" value="'+a.WebRTCPlugin.pluginInfo.pluginId+'"><param name="windowless" value="false" /> '+(a.options.getAllCams?'<param name="forceGetAllCams" value="True" />':"")+'<param name="pageId" value="'+a.WebRTCPlugin.pageId+'"><param name="tag" value="'+a.WebRTCPlugin.TAGS.NONE+'" />',document.body.appendChild(a.WebRTCPlugin.plugin);a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.INJECTED}},a.WebRTCPlugin.isPluginInstalled=function(e,t,n,r,i){if(isIE){try{new ActiveXObject(e+"."+t)}catch(e){return void i()}r()}else{for(var o=navigator.mimeTypes,a=0;a<o.length;a++)if(o[a].type.indexOf(n)>=0)return void r();i()}},a.WebRTCPlugin.defineWebRTCInterface=function(){if(a.WebRTCPlugin.pluginState===a.WebRTCPlugin.PLUGIN_STATES.READY)return void o.error("AdapterJS - WebRTC interface has already been defined");a.WebRTCPlugin.pluginState=a.WebRTCPlugin.PLUGIN_STATES.INITIALIZING,a.isDefined=function(e){return null!==e&&void 0!==e},createIceServer=function(e,t,n){var r=null,i=e.split(":");return 0===i[0].indexOf("stun")?r={url:e,hasCredentials:!1}:0===i[0].indexOf("turn")&&(r={url:e,hasCredentials:!0,credential:n,username:t}),r},createIceServers=function(e,t,n){for(var r=[],i=0;i<e.length;++i)r.push(createIceServer(e[i],t,n));return r},RTCSessionDescription=function(e){return a.WebRTCPlugin.WaitForPluginReady(),a.WebRTCPlugin.plugin.ConstructSessionDescription(e.type,e.sdp)},RTCPeerConnection=function(e,t){if(void 0!==e&&null!==e&&!Array.isArray(e.iceServers))throw new Error("Failed to construct 'RTCPeerConnection': Malformed RTCConfiguration");if(void 0!==t&&null!==t){var n=!1;if(n|="object"!=typeof t,n|=t.hasOwnProperty("mandatory")&&void 0!==t.mandatory&&null!==t.mandatory&&t.mandatory.constructor!==Object,n|=t.hasOwnProperty("optional")&&void 0!==t.optional&&null!==t.optional&&!Array.isArray(t.optional))throw new Error("Failed to construct 'RTCPeerConnection': Malformed constraints object")}a.WebRTCPlugin.WaitForPluginReady();var r=null;if(e&&Array.isArray(e.iceServers)){r=e.iceServers;for(var i=0;i<r.length;i++)r[i].urls&&!r[i].url&&(r[i].url=r[i].urls),r[i].hasCredentials=a.isDefined(r[i].username)&&a.isDefined(r[i].credential)}if(a.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION&&a.WebRTCPlugin.plugin.PEER_CONNECTION_VERSION>1)return r&&(e.iceServers=r),a.WebRTCPlugin.plugin.PeerConnection(e);var o=t&&t.mandatory?t.mandatory:null,s=t&&t.optional?t.optional:null;return a.WebRTCPlugin.plugin.PeerConnection(a.WebRTCPlugin.pageId,r,o,s)},MediaStreamTrack=function(){},MediaStreamTrack.getSources=function(e){a.WebRTCPlugin.callWhenPluginReady(function(){a.WebRTCPlugin.plugin.GetSources(e)})};var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};getUserMedia=function(t,n,r){var i={};i.audio=!!t.audio&&e(t.audio),i.video=!!t.video&&e(t.video),a.WebRTCPlugin.callWhenPluginReady(function(){a.WebRTCPlugin.plugin.getUserMedia(i,n,r)})},window.navigator.getUserMedia=getUserMedia,navigator.mediaDevices||"undefined"==typeof Promise||(requestUserMedia=function(e){return new Promise(function(t,n){getUserMedia(e,t,n)})},navigator.mediaDevices={getUserMedia:requestUserMedia,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],id:e.id,deviceId:e.id,groupId:""}}))})})}}),attachMediaStream=function(e,t){if(e&&e.parentNode){var n;null===t?n="":(void 0!==t.enableSoundTracks&&t.enableSoundTracks(!0),n=t.id);var r=0===e.id.length?Math.random().toString(36).slice(2):e.id,i=e.nodeName.toLowerCase();if("object"!==i){var o;switch(i){case"audio":o=a.WebRTCPlugin.TAGS.AUDIO;break;case"video":o=a.WebRTCPlugin.TAGS.VIDEO;break;default:o=a.WebRTCPlugin.TAGS.NONE}var s=document.createDocumentFragment(),c=document.createElement("div"),u="";for(e.className?u='class="'+e.className+'" ':e.attributes&&e.attributes.class&&(u='class="'+e.attributes.class.value+'" '),c.innerHTML='<object id="'+r+'" '+u+'type="'+a.WebRTCPlugin.pluginInfo.type+'"><param name="pluginId" value="'+r+'" /> <param name="pageId" value="'+a.WebRTCPlugin.pageId+'" /> <param name="windowless" value="true" /> <param name="streamId" value="'+n+'" /> <param name="tag" value="'+o+'" /> </object>';c.firstChild;)s.appendChild(c.firstChild);var l="",d="";e.clientWidth||e.clientHeight?(d=e.clientWidth,l=e.clientHeight):(e.width||e.height)&&(d=e.width,l=e.height),e.parentNode.insertBefore(s,e),s=document.getElementById(r),s.width=d,s.height=l,e.parentNode.removeChild(e)}else{for(var p=e.children,f=0;f!==p.length;++f)if("streamId"===p[f].name){p[f].value=n;break}e.setStreamId(n)}var h=document.getElementById(r);return a.forwardEventHandlers(h,e,Object.getPrototypeOf(e)),h}},reattachMediaStream=function(e,t){for(var n=null,r=t.children,i=0;i!==r.length;++i)if("streamId"===r[i].name){a.WebRTCPlugin.WaitForPluginReady(),n=a.WebRTCPlugin.plugin.getStreamWithId(a.WebRTCPlugin.pageId,r[i].value);break}if(null!==n)return attachMediaStream(e,n);o.log("Could not find the stream associated with this element")},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=getUserMedia,a.attachMediaStream=attachMediaStream,a.reattachMediaStream=reattachMediaStream,a.getUserMedia=getUserMedia,a.forwardEventHandlers=function(e,t,n){properties=Object.getOwnPropertyNames(n);for(var r in properties)r&&(propName=properties[r],"function"==typeof propName.slice&&"on"===propName.slice(0,2)&&"function"==typeof t[propName]&&a.addEvent(e,propName.slice(2),t[propName]));var i=Object.getPrototypeOf(n);i&&a.forwardEventHandlers(e,t,i)},RTCIceCandidate=function(e){return e.sdpMid||(e.sdpMid=""),a.WebRTCPlugin.WaitForPluginReady(),a.WebRTCPlugin.plugin.ConstructIceCandidate(e.sdpMid,e.sdpMLineIndex,e.candidate)},a.addEvent(document,"readystatechange",a.WebRTCPlugin.injectPlugin),a.WebRTCPlugin.injectPlugin()},a.WebRTCPlugin.pluginNeededButNotInstalledCb=a.WebRTCPlugin.pluginNeededButNotInstalledCb||function(){a.addEvent(document,"readystatechange",a.WebRTCPlugin.pluginNeededButNotInstalledCbPriv),a.WebRTCPlugin.pluginNeededButNotInstalledCbPriv()},a.WebRTCPlugin.pluginNeededButNotInstalledCbPriv=function(){if(!a.options.hidePluginInstallPrompt){var e=a.WebRTCPlugin.pluginInfo.downloadLink;if(e){var t;t=a.WebRTCPlugin.pluginInfo.portalLink?'This website requires you to install the  <a href="'+a.WebRTCPlugin.pluginInfo.portalLink+'" target="_blank">'+a.WebRTCPlugin.pluginInfo.companyName+" WebRTC Plugin</a> to work on this browser.":a.TEXT.PLUGIN.REQUIRE_INSTALLATION,a.renderNotificationBar(t,a.TEXT.PLUGIN.BUTTON,e)}else a.renderNotificationBar(a.TEXT.PLUGIN.NOT_SUPPORTED)}},a.WebRTCPlugin.isPluginInstalled(a.WebRTCPlugin.pluginInfo.prefix,a.WebRTCPlugin.pluginInfo.plugName,a.WebRTCPlugin.pluginInfo.type,a.WebRTCPlugin.defineWebRTCInterface,a.WebRTCPlugin.pluginNeededButNotInstalledCb)):(function(t){e.exports=function(){return function e(t,n,i){function o(s,c){if(!n[s]){if(!t[s]){var u="function"==typeof r&&r;if(!c&&u)return r(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){return o(t[s][1][e]||e)},d,d.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof r&&r,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},r.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){r.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getDtlsParameters=function(e,t){var n=r.splitLines(e);n=n.concat(r.splitLines(t));var i=n.filter(function(e){return 0===e.indexOf("a=fingerprint:")})[0].substr(14);return{role:"auto",fingerprints:[{algorithm:i.split(" ")[0],value:i.split(" ")[1]}]}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return n=n.concat(r.splitLines(t)),{usernameFragment:n.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),o=3;o<i.length;o++){var a=i[o],s=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=r.parseRtpMap(s),u=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=u.length?r.parseFmtp(u[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";return n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}),n+="a=rtcp-mux\r\n"},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{payloadType:e.payloadType,ssrc:t}};n.push(r),o&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var l=r.matchPrefix(e,"b=");return l.length&&(0===l[0].indexOf("b=TIAS:")?l=parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")&&(l=parseInt(l[0].substr(5),10)),n.forEach(function(e){e.maxBitrate=l})),n},r.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n"},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},t.exports=r},{}],2:[function(e,t,n){"use strict";!function(){var n=e("./utils").log,r=e("./utils").browserDetails;t.exports.browserDetails=r,t.exports.extractVersion=e("./utils").extractVersion,t.exports.disableLog=e("./utils").disableLog;var i=e("./chrome/chrome_shim")||null,o=e("./edge/edge_shim")||null,a=e("./firefox/firefox_shim")||null,s=e("./safari/safari_shim")||null;switch(r.browser){case"opera":case"chrome":if(!i||!i.shimPeerConnection)return void n("Chrome shim is not included in this adapter release.");n("adapter.js shimming chrome."),t.exports.browserShim=i,i.shimGetUserMedia(),i.shimMediaStream(),i.shimSourceObject(),i.shimPeerConnection(),i.shimOnTrack();break;case"firefox":if(!a||!a.shimPeerConnection)return void n("Firefox shim is not included in this adapter release.");n("adapter.js shimming firefox."),t.exports.browserShim=a,a.shimGetUserMedia(),a.shimSourceObject(),a.shimPeerConnection(),a.shimOnTrack();break;case"edge":if(!o||!o.shimPeerConnection)return void n("MS edge shim is not included in this adapter release.");n("adapter.js shimming edge."),t.exports.browserShim=o,o.shimGetUserMedia(),o.shimPeerConnection();break;case"safari":if(!s)return void n("Safari shim is not included in this adapter release.");n("adapter.js shimming safari."),t.exports.browserShim=s,s.shimGetUserMedia();break;default:n("Unsupported browser!")}}()},{"./chrome/chrome_shim":3,"./edge/edge_shim":5,"./firefox/firefox_shim":7,"./safari/safari_shim":9,"./utils":10}],3:[function(e,t,n){"use strict";var r=e("../utils.js").log,i=e("../utils.js").browserDetails,o={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var t=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.addEventListener("addtrack",function(n){var r=new Event("track");r.track=n.track,r.receiver={track:n.track},r.streams=[e.stream],t.dispatchEvent(r)}),e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;if(this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),!e)return void(this.src="");this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})}}))},shimPeerConnection:function(){window.RTCPeerConnection=function(e,t){r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new webkitRTCPeerConnection(e,t),i=n.getStats.bind(n);return n.getStats=function(e,t,n){var r=this,o=arguments;if(arguments.length>0&&"function"==typeof e)return i(e,t);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e,t){var n=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return t=t||e,Object.keys(t).forEach(function(e){n[e]=t[e]}),n};if(arguments.length>=2){var c=function(e){o[1](s(a(e)))};return i.apply(this,[c,arguments[0]])}return new Promise(function(t,n){1===o.length&&"object"==typeof e?i.apply(r,[function(e){t(s(a(e)))},n]):i.apply(r,[function(e){t(s(a(e),e.result()))},n])}).then(t,n)},n},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}}),["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){t.apply(e,[r,i,n])})}return t.apply(this,arguments)}}),i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this,r=new Promise(function(r,i){t.apply(n,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)}}};t.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":10,"./getusermedia":4}],4:[function(e,t,n){"use strict";var r=e("../utils.js").log;t.exports=function(){var e=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},t=function(t,n){if(t=JSON.parse(JSON.stringify(t)),t&&t.audio&&(t.audio=e(t.audio)),t&&"object"==typeof t.video){var i=t.video.facingMode;if((i=i&&("object"==typeof i?i:{ideal:i}))&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode)&&(delete t.video.facingMode,"environment"===i.exact||"environment"===i.ideal))return navigator.mediaDevices.enumerateDevices().then(function(o){o=o.filter(function(e){return"videoinput"===e.kind});var a=o.find(function(e){return-1!==e.label.toLowerCase().indexOf("back")})||o.length&&o[o.length-1];return a&&(t.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),t.video=e(t.video),r("chrome: "+JSON.stringify(t)),n(t)});t.video=e(t.video)}return r("chrome: "+JSON.stringify(t)),n(t)},n=function(e){return{name:{PermissionDeniedError:"NotAllowedError",ConstraintNotSatisfiedError:"OverconstrainedError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},i=function(e,r,i){t(e,function(e){navigator.webkitGetUserMedia(e,r,function(e){i(n(e))})})};navigator.getUserMedia=i;var o=function(e){return new Promise(function(t,n){navigator.getUserMedia(e,t,n)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:o,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var a=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e,function(e){return a(e).catch(function(e){return Promise.reject(n(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return o(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){r("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){r("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":10}],5:[function(e,t,n){"use strict";var r=e("sdp"),i=e("../utils").browserDetails,o={shimPeerConnection:function(){window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e})),window.RTCPeerConnection=function(e){var t=this,n=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){t[e]=n[e].bind(n)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return t.localStreams},this.getRemoteStreams=function(){return t.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy;break;case"none":throw new TypeError('iceTransportPolicy "none" not supported')}if(this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers){var r=JSON.parse(JSON.stringify(e.iceServers));this.iceOptions.iceServers=r.filter(function(e){if(e&&e.urls){var t=e.urls;return"string"==typeof t&&(t=[t]),!!(t=t.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")||0===e.indexOf("stun:")&&i.version>=14393})[0])}return!1})}this.transceivers=[],this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype._emitBufferedCandidates=function(){var e=this,t=r.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(n){if(n.candidate&&0!==Object.keys(n.candidate).length)-1===n.candidate.candidate.indexOf("typ endOfCandidates")&&(t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n");else for(var r=1;r<t.length;r++)-1===t[r].indexOf("\r\na=end-of-candidates\r\n")&&(t[r]+="a=end-of-candidates\r\n");e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),n.candidate||"complete"===e.iceGatheringState||e.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&(e.iceGatheringState="complete")}),this._localIceCandidatesBuffer=[]},window.RTCPeerConnection.prototype.addStream=function(e){this.localStreams.push(e.clone()),this._maybeFireNegotiationNeeded()},window.RTCPeerConnection.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},window.RTCPeerConnection.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},window.RTCPeerConnection.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},window.RTCPeerConnection.prototype._getCommonCapabilities=function(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]};return e.codecs.forEach(function(e){for(var r=0;r<t.codecs.length;r++){var i=t.codecs[r];if(e.name.toLowerCase()===i.name.toLowerCase()&&e.clockRate===i.clockRate&&e.numChannels===i.numChannels){n.codecs.push(i),i.rtcpFeedback=i.rtcpFeedback.filter(function(t){for(var n=0;n<e.rtcpFeedback.length;n++)if(e.rtcpFeedback[n].type===t.type&&e.rtcpFeedback[n].parameter===t.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n},window.RTCPeerConnection.prototype._createIceAndDtlsTransports=function(e,t){var n=this,i=new RTCIceGatherer(n.iceOptions),o=new RTCIceTransport(i);i.onlocalcandidate=function(a){var s=new Event("icecandidate");s.candidate={sdpMid:e,sdpMLineIndex:t};var c=a.candidate,u=!c||0===Object.keys(c).length;u?(void 0===i.state&&(i.state="completed"),s.candidate.candidate="candidate:1 1 udp 1 0.0.0.0 9 typ endOfCandidates"):(c.component="RTCP"===o.component?2:1,s.candidate.candidate=r.writeCandidate(c));var l=r.splitSections(n.localDescription.sdp);-1===s.candidate.candidate.indexOf("typ endOfCandidates")?l[s.candidate.sdpMLineIndex+1]+="a="+s.candidate.candidate+"\r\n":l[s.candidate.sdpMLineIndex+1]+="a=end-of-candidates\r\n",n.localDescription.sdp=l.join("");var d=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(n.iceGatheringState){case"new":n._localIceCandidatesBuffer.push(s),u&&d&&n._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":n._emitBufferedCandidates(),n.dispatchEvent(s),null!==n.onicecandidate&&n.onicecandidate(s),d&&(n.dispatchEvent(new Event("icecandidate")),null!==n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete")}},o.onicestatechange=function(){n._updateConnectionState()};var a=new RTCDtlsTransport(o);return a.ondtlsstatechange=function(){n._updateConnectionState()},a.onerror=function(){a.state="failed",n._updateConnectionState()},{iceGatherer:i,iceTransport:o,dtlsTransport:a}},window.RTCPeerConnection.prototype._transceive=function(e,t,n){var i=this._getCommonCapabilities(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:r.localCName},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),n&&e.rtpReceiver&&(i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.cname},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},window.RTCPeerConnection.prototype.setLocalDescription=function(e){var t,n,i=this;if("offer"===e.type)this._pendingOffer&&(t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i._pendingOffer[t].localCapabilities=n}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=r.splitSections(i.remoteDescription.sdp),n=t.shift();var o=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var a=i.transceivers[t],s=a.iceGatherer,c=a.iceTransport,u=a.dtlsTransport,l=a.localCapabilities,d=a.remoteCapabilities;if("0"!==e.split("\n",1)[0].split(" ",2)[1]&&!a.isDatachannel){var p=r.getIceParameters(e,n);if(o){var f=r.matchPrefix(e,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});f.length&&c.setRemoteCandidates(f)}var h=r.getDtlsParameters(e,n);o&&(h.role="server"),i.usingBundle&&0!==t||(c.start(s,p,o?"controlling":"controlled"),u.start(h));var v=i._getCommonCapabilities(l,d);i._transceive(a,v.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var a=arguments.length>1&&"function"==typeof arguments[1];if(a){var s=arguments[1];window.setTimeout(function(){s(),"new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),i._emitBufferedCandidates()},0)}var c=Promise.resolve();return c.then(function(){a||("new"===i.iceGatheringState&&(i.iceGatheringState="gathering"),window.setTimeout(i._emitBufferedCandidates.bind(i),500))}),c},window.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t=this,n=new MediaStream,i=[],o=r.splitSections(e.sdp),a=o.shift(),s=r.matchPrefix(a,"a=ice-lite").length>0;switch(this.usingBundle=r.matchPrefix(a,"a=group:BUNDLE ").length>0,o.forEach(function(o,c){var u=r.splitLines(o),l=u[0].substr(2).split(" "),d=l[0],p="0"===l[1],f=r.getDirection(o,a),h=r.matchPrefix(o,"a=mid:");if(h=h.length?h[0].substr(6):r.generateIdentifier(),"application"===d&&"DTLS/SCTP"===l[2])return void(t.transceivers[c]={mid:h,isDatachannel:!0});var v,m,g,y,b,S,_,T,E,C,w,R,k=r.parseRtpParameters(o);p||(w=r.getIceParameters(o,a),R=r.getDtlsParameters(o,a),R.role="client"),T=r.parseRtpEncodingParameters(o);var I,P=r.matchPrefix(o,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];P&&(I=P.value);var A=r.matchPrefix(o,"a=end-of-candidates",a).length>0,D=r.matchPrefix(o,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return"1"===e.component});if("offer"!==e.type||p)"answer"!==e.type||p||(v=t.transceivers[c],m=v.iceGatherer,g=v.iceTransport,y=v.dtlsTransport,b=v.rtpSender,S=v.rtpReceiver,_=v.sendEncodingParameters,E=v.localCapabilities,t.transceivers[c].recvEncodingParameters=T,t.transceivers[c].remoteCapabilities=k,t.transceivers[c].cname=I,(s||A)&&D.length&&g.setRemoteCandidates(D),t.usingBundle&&0!==c||(g.start(m,w,"controlling"),y.start(R)),t._transceive(v,"sendrecv"===f||"recvonly"===f,"sendrecv"===f||"sendonly"===f),!S||"sendrecv"!==f&&"sendonly"!==f?delete v.rtpReceiver:(C=S.track,i.push([C,S]),n.addTrack(C)));else{var O=t.usingBundle&&c>0?{iceGatherer:t.transceivers[0].iceGatherer,iceTransport:t.transceivers[0].iceTransport,dtlsTransport:t.transceivers[0].dtlsTransport}:t._createIceAndDtlsTransports(h,c);if(A&&O.iceTransport.setRemoteCandidates(D),E=RTCRtpReceiver.getCapabilities(d),_=[{ssrc:1001*(2*c+2)}],S=new RTCRtpReceiver(O.dtlsTransport,d),C=S.track,i.push([C,S]),n.addTrack(C),t.localStreams.length>0&&t.localStreams[0].getTracks().length>=c){var L;"audio"===d?L=t.localStreams[0].getAudioTracks()[0]:"video"===d&&(L=t.localStreams[0].getVideoTracks()[0]),L&&(b=new RTCRtpSender(L,O.dtlsTransport))}t.transceivers[c]={iceGatherer:O.iceGatherer,iceTransport:O.iceTransport,dtlsTransport:O.dtlsTransport,localCapabilities:E,remoteCapabilities:k,rtpSender:b,rtpReceiver:S,kind:d,mid:h,cname:I,sendEncodingParameters:_,recvEncodingParameters:T},t._transceive(t.transceivers[c],!1,"sendrecv"===f||"sendonly"===f)}}),this.remoteDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}return n.getTracks().length&&(t.remoteStreams.push(n),window.setTimeout(function(){var e=new Event("addstream");e.stream=n,t.dispatchEvent(e),null!==t.onaddstream&&window.setTimeout(function(){t.onaddstream(e)},0),i.forEach(function(r){var i=r[0],o=r[1],a=new Event("track");a.track=i,a.receiver=o,a.streams=[n],t.dispatchEvent(e),null!==t.ontrack&&window.setTimeout(function(){t.ontrack(a)},0)})},0)),arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},window.RTCPeerConnection.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},window.RTCPeerConnection.prototype._maybeFireNegotiationNeeded=function(){var e=new Event("negotiationneeded");this.dispatchEvent(e),null!==this.onnegotiationneeded&&this.onnegotiationneeded(e)},window.RTCPeerConnection.prototype._updateConnectionState=function(){var e,t=this,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){n[e.iceTransport.state]++,n[e.dtlsTransport.state]++}),n.connected+=n.completed,e="new",n.failed>0?e="failed":n.connecting>0||n.checking>0?e="connecting":n.disconnected>0?e="disconnected":n.new>0?e="new":(n.connected>0||n.completed>0)&&(e="connected"),e!==t.iceConnectionState){t.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this.dispatchEvent(r),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(r)}},window.RTCPeerConnection.prototype.createOffer=function(){var e=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");var t;1===arguments.length&&"function"!=typeof arguments[0]?t=arguments[0]:3===arguments.length&&(t=arguments[2]);var n=[],i=0,o=0;if(this.localStreams.length&&(i=this.localStreams[0].getAudioTracks().length,o=this.localStreams[0].getVideoTracks().length),t){if(t.mandatory||t.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==t.offerToReceiveAudio&&(i=t.offerToReceiveAudio),void 0!==t.offerToReceiveVideo&&(o=t.offerToReceiveVideo)}for(this.localStreams.length&&this.localStreams[0].getTracks().forEach(function(e){n.push({kind:e.kind,track:e,wantReceive:"audio"===e.kind?i>0:o>0}),"audio"===e.kind?i--:"video"===e.kind&&o--});i>0||o>0;)i>0&&(n.push({kind:"audio",wantReceive:!0}),i--),o>0&&(n.push({kind:"video",wantReceive:!0}),o--);var a=r.writeSessionBoilerplate(),s=[];n.forEach(function(t,n){var i,o,a=t.track,c=t.kind,u=r.generateIdentifier(),l=e.usingBundle&&n>0?{iceGatherer:s[0].iceGatherer,iceTransport:s[0].iceTransport,dtlsTransport:s[0].dtlsTransport}:e._createIceAndDtlsTransports(u,n),d=RTCRtpSender.getCapabilities(c),p=[{ssrc:1001*(2*n+1)}];a&&(i=new RTCRtpSender(a,l.dtlsTransport)),t.wantReceive&&(o=new RTCRtpReceiver(l.dtlsTransport,c)),s[n]={iceGatherer:l.iceGatherer,iceTransport:l.iceTransport,dtlsTransport:l.dtlsTransport,localCapabilities:d,remoteCapabilities:null,rtpSender:i,rtpReceiver:o,kind:c,mid:u,sendEncodingParameters:p,recvEncodingParameters:null}}),this.usingBundle&&(a+="a=group:BUNDLE "+s.map(function(e){return e.mid}).join(" ")+"\r\n"),n.forEach(function(t,n){var i=s[n];a+=r.writeMediaSection(i,i.localCapabilities,"offer",e.localStreams[0])}),this._pendingOffer=s;var c=new RTCSessionDescription({type:"offer",sdp:a});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,c),Promise.resolve(c)},window.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=r.writeSessionBoilerplate();this.usingBundle&&(t+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(n){if(n.isDatachannel)return void(t+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+n.mid+"\r\n");var i=e._getCommonCapabilities(n.localCapabilities,n.remoteCapabilities);t+=r.writeMediaSection(n,i,"answer",e.localStreams[0])});var n=new RTCSessionDescription({type:"answer",sdp:t});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,n),Promise.resolve(n)},window.RTCPeerConnection.prototype.addIceCandidate=function(e){if(null===e)this.transceivers.forEach(function(e){e.iceTransport.addRemoteCandidate({})});else{var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var i=this.transceivers[t];if(i){var o=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===o.protocol&&(0===o.port||9===o.port))return;if("1"!==o.component)return;"endOfCandidates"===o.type&&(o={}),i.iceTransport.addRemoteCandidate(o);var a=r.splitSections(this.remoteDescription.sdp);a[t+1]+=(o.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}return arguments.length>1&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},window.RTCPeerConnection.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(n){var r=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){r.set(t,e[t]),r[t]=e[t]})}),t&&window.setTimeout(t,0,r),n(r)})})}}};t.exports={shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":10,"./getusermedia":6,sdp:1}],6:[function(e,t,n){"use strict";t.exports=function(){var e=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(n){return t(n).catch(function(t){return Promise.reject(e(t))})}}},{}],7:[function(e,t,n){"use strict";var r=e("../utils").browserDetails,i={shimOnTrack:function(){"object"!=typeof window||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"==typeof window&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(r.version<38&&e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var s={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(s.username=o.username,s.credential=o.credential),n.push(s)}else n.push(e.iceServers[i])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return null===arguments[0]?Promise.resolve():e.apply(this,arguments)};var t=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},n=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,r,i){return n.apply(this,[e||null]).then(function(e){return t(e)}).then(r,i)}}}};t.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":10,"./getusermedia":8}],8:[function(e,t,n){"use strict";var r=e("../utils").log,i=e("../utils").browserDetails;t.exports=function(){var e=function(e){return{name:{SecurityError:"NotAllowedError",PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},t=function(t,n,o){var a=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return t=JSON.parse(JSON.stringify(t)),i.version<38&&(r("spec: "+JSON.stringify(t)),t.audio&&(t.audio=a(t.audio)),t.video&&(t.video=a(t.video)),r("ff37: "+JSON.stringify(t))),navigator.mozGetUserMedia(t,n,function(t){o(e(t))})},n=function(e){return new Promise(function(n,r){t(e,n,r)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:n,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},i.version<41){var a=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return a().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(i.version<49){var s=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return s(t).catch(function(t){return Promise.reject(e(t))})}}navigator.getUserMedia=function(e,n,r){if(i.version<44)return t(e,n,r);o.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(n,r)}}},{"../utils":10}],9:[function(e,t,n){"use strict";var r={shimGetUserMedia:function(){navigator.getUserMedia=navigator.webkitGetUserMedia}};t.exports={shimGetUserMedia:r.shimGetUserMedia}},{}],10:[function(e,t,n){"use strict";var r=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(r=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},log:function(){if("object"==typeof window){if(r)return;void 0!==o&&"function"==typeof o.log&&o.log.apply(o,arguments)}},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(){var e={};if(e.browser=null,e.version=null,"undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/([0-9]+)\./,1)}else{if(!navigator.mediaDevices||!navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))return e.browser="Not a supported browser.",e;e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)}return e}};t.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion}},{}]},{},[2])(2)}()}(),a.parseWebrtcDetectedBrowser(),navigator.mozGetUserMedia?(MediaStreamTrack.getSources=function(e){setTimeout(function(){e([{kind:"audio",id:"default",label:"",facing:""},{kind:"video",id:"default",label:"",facing:""}])},0)},attachMediaStream=function(e,t){return e.srcObject=t,e},reattachMediaStream=function(e,t){return e.srcObject=t.srcObject,e},createIceServer=function(e,t,n){o.warn("createIceServer is deprecated. It should be replaced with an application level implementation.");var r=null,i=e.split(":");if(0===i[0].indexOf("stun"))r={urls:[e]};else if(0===i[0].indexOf("turn"))if(webrtcDetectedVersion<27){var a=e.split("?");1!==a.length&&0!==a[1].indexOf("transport=udp")||(r={urls:[a[0]],credential:n,username:t})}else r={urls:[e],credential:n,username:t};return r},createIceServers=function(e,t,n){o.warn("createIceServers is deprecated. It should be replaced with an application level implementation.");var r=[];for(i=0;i<e.length;i++){var a=createIceServer(e[i],t,n);null!==a&&r.push(a)}return r}):navigator.webkitGetUserMedia?(attachMediaStream=function(e,t){return webrtcDetectedVersion>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):o.error("Error attaching stream to element."),e},reattachMediaStream=function(e,t){return webrtcDetectedVersion>=43?e.srcObject=t.srcObject:e.src=t.src,e},createIceServer=function(e,t,n){o.warn("createIceServer is deprecated. It should be replaced with an application level implementation.");var r=null,i=e.split(":");return 0===i[0].indexOf("stun")?r={url:e}:0===i[0].indexOf("turn")&&(r={url:e,credential:n,username:t}),r},createIceServers=function(e,t,n){o.warn("createIceServers is deprecated. It should be replaced with an application level implementation.");var r=[];if(webrtcDetectedVersion>=34)r={urls:e,credential:n,username:t};else for(i=0;i<e.length;i++){var a=createIceServer(e[i],t,n);null!==a&&r.push(a)}return r}):navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)&&(attachMediaStream=function(e,t){return e.srcObject=t,e},reattachMediaStream=function(e,t){return e.srcObject=t.srcObject,e}),attachMediaStream_base=attachMediaStream,"opera"===webrtcDetectedBrowser&&(attachMediaStream_base=function(e,t){webrtcDetectedVersion>38?e.srcObject=t:void 0!==e.src&&(e.src=URL.createObjectURL(t))}),attachMediaStream=function(e,t){return"chrome"!==webrtcDetectedBrowser&&"opera"!==webrtcDetectedBrowser||t?attachMediaStream_base(e,t):e.src="",e},reattachMediaStream_base=reattachMediaStream,reattachMediaStream=function(e,t){return reattachMediaStream_base(e,t),e},window.attachMediaStream=attachMediaStream,window.reattachMediaStream=reattachMediaStream,window.getUserMedia=function(e,t,n){navigator.getUserMedia(e,t,n)},a.attachMediaStream=attachMediaStream,a.reattachMediaStream=reattachMediaStream,a.getUserMedia=getUserMedia,"undefined"==typeof Promise&&(requestUserMedia=null),a.maybeThroughWebRTCReady()),function(){"use strict";var e=null;a.TEXT.EXTENSION={REQUIRE_INSTALLATION_FF:"To enable screensharing you need to install the Skylink WebRTC tools Firefox Add-on.",REQUIRE_INSTALLATION_CHROME:"To enable screensharing you need to install the Skylink WebRTC tools Chrome Extension.",REQUIRE_REFRESH:"Please refresh this page after the Skylink WebRTC tools extension has been installed.",BUTTON_FF:"Install Now",BUTTON_CHROME:"Go to Chrome Web Store"};var t=function(e){if(null===e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t};if(window.navigator.mozGetUserMedia?(e=window.navigator.getUserMedia,navigator.getUserMedia=function(n,r,i){if(n&&n.video&&n.video.mediaSource){if("screen"!==n.video.mediaSource&&"window"!==n.video.mediaSource)return void i(new Error('GetUserMedia: Only "screen" and "window" are supported as mediaSource constraints'));var o=t(n);o.video.mozMediaSource=o.video.mediaSource;var s=setInterval(function(){"complete"===document.readyState&&(clearInterval(s),e(o,r,function(e){["PermissionDeniedError","SecurityError"].indexOf(e.name)>-1&&"https:"===window.parent.location.protocol?a.renderNotificationBar(a.TEXT.EXTENSION.REQUIRE_INSTALLATION_FF,a.TEXT.EXTENSION.BUTTON_FF,"https://addons.mozilla.org/en-US/firefox/addon/skylink-webrtc-tools/",!0,!0):i(e)}))},1)}else e(n,r,i)},a.getUserMedia=window.getUserMedia=navigator.getUserMedia):window.navigator.webkitGetUserMedia&&"safari"!==window.webrtcDetectedBrowser?(e=window.navigator.getUserMedia,navigator.getUserMedia=function(n,i,o){if(n&&n.video&&n.video.mediaSource){if("chrome"!==window.webrtcDetectedBrowser)return void o(new Error("Current browser does not support screensharing"));var s=t(n),c=function(t,n){t?o("permission-denied"===t?new Error("Permission denied for screen retrieval"):new Error("Failed retrieving selected screen")):(s.video.mandatory=s.video.mandatory||{},s.video.mandatory.chromeMediaSource="desktop",s.video.mandatory.maxWidth=window.screen.width>1920?window.screen.width:1920,s.video.mandatory.maxHeight=window.screen.height>1080?window.screen.height:1080,n&&(s.video.mandatory.chromeMediaSourceId=n),delete s.video.mediaSource,e(s,i,o))},u=function(e){e.data&&(e.data.chromeMediaSourceId&&("PermissionDeniedError"===e.data.chromeMediaSourceId?c("permission-denied"):c(null,e.data.chromeMediaSourceId)),e.data.chromeExtensionStatus&&("not-installed"===e.data.chromeExtensionStatus?a.renderNotificationBar(a.TEXT.EXTENSION.REQUIRE_INSTALLATION_CHROME,a.TEXT.EXTENSION.BUTTON_CHROME,e.data.data,!0,!0):c(e.data.chromeExtensionStatus,null)),window.removeEventListener("message",u))};window.addEventListener("message",u),r({captureSourceId:!0})}else e(n,i,o)},a.getUserMedia=window.getUserMedia=navigator.getUserMedia,navigator.mediaDevices.getUserMedia=function(e){return new Promise(function(t,n){window.getUserMedia(e,t,n)})}):navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?o.warn("Edge does not support screensharing feature in getUserMedia"):(e=window.navigator.getUserMedia,navigator.getUserMedia=function(n,r,i){if(n&&n.video&&n.video.mediaSource){var o=t(n);a.WebRTCPlugin.callWhenPluginReady(function(){if(!a.WebRTCPlugin.plugin.HasScreensharingFeature||!a.WebRTCPlugin.plugin.isScreensharingAvailable)return void i(new Error("Your version of the WebRTC plugin does not support screensharing"));o.video.optional=o.video.optional||[],o.video.optional.push({sourceId:a.WebRTCPlugin.plugin.screensharingKey||"Screensharing"}),delete o.video.mediaSource,e(o,r,i)})}else e(n,r,i)},a.getUserMedia=getUserMedia=window.getUserMedia=navigator.getUserMedia,navigator.mediaDevices&&"undefined"!=typeof Promise&&(navigator.mediaDevices.getUserMedia="undefined"==typeof requestUserMedia?void 0:requestUserMedia)),"chrome"===window.webrtcDetectedBrowser){var n=document.createElement("iframe");n.onload=function(){n.isLoaded=!0},n.src="https://cdn.temasys.com.sg/skylink/extensions/detectRTC.html",n.style.display="none",(document.body||document.documentElement).appendChild(n);var r=function(e){if(e=e||{},!n.isLoaded)return void setTimeout(function(){n.contentWindow.postMessage(e,"*")},100);n.contentWindow.postMessage(e,"*")}}else"opera"===window.webrtcDetectedBrowser&&o.warn("Opera does not support screensharing feature in getUserMedia")}()}).call(t,"modules/RTC/adapter.screenshare.js")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"STATUS_AVAILABLE",function(){return r}),n.d(t,"STATUS_UNDEFINED",function(){return i}),n.d(t,"STATUS_BUSY",function(){return o}),n.d(t,"STATE_ON",function(){return a}),n.d(t,"STATE_OFF",function(){return s}),n.d(t,"STATE_PENDING",function(){return c}),n.d(t,"STATE_RETRYING",function(){return u}),n.d(t,"STATE_FAILED",function(){return l});var r="available",i="undefined",o="busy",a="on",s="off",c="pending",u="retrying",l="failed"},function(e,t){function n(){var e={methodName:"",fileLocation:"",line:null,column:null},t=new Error,n=t.stack?t.stack.split("\n"):[];if(!n||n.length<1)return e;var r=null;return n[3]&&(r=n[3].match(/\s*at\s*(.+?)\s*\((\S*)\s*:(\d*)\s*:(\d*)\)/)),!r||r.length<=4?(0===n[2].indexOf("log@")?e.methodName=n[3].substr(0,n[3].indexOf("@")):e.methodName=n[2].substr(0,n[2].indexOf("@")),e):(e.methodName=r[1],e.fileLocation=r[2],e.line=r[3],e.column=r[4],e)}function r(){var e=arguments[0],t=arguments[1],r=Array.prototype.slice.call(arguments,2);if(!(o[t]<e.level))for(var i=n(),s=a.concat(e.transports),c=0;c<s.length;c++){var u=s[c],l=u[t];l&&"function"==typeof l&&l.bind(u,e.id?"["+e.id+"]":"","<"+i.methodName+">: ").apply(u,r)}}function i(e,t,n,i){this.id=t,this.format=i,this.transports=n,this.transports||(this.transports=[]),this.level=o[e];for(var a=Object.keys(o),s=0;s<a.length;s++)this[a[s]]=r.bind(null,this,a[s])}var o={trace:0,debug:1,info:2,log:3,warn:4,error:5};i.consoleTransport=console;var a=[i.consoleTransport];i.addGlobalTransport=function(e){-1===a.indexOf(e)&&a.push(e)},i.removeGlobalTransport=function(e){var t=a.indexOf(e);-1!==t&&a.splice(t,1)},i.prototype.setLevel=function(e){this.level=o[e]},e.exports=i,i.levels={TRACE:"trace",DEBUG:"debug",INFO:"info",LOG:"log",WARN:"warn",ERROR:"error"}},function(e,t,n){function r(e,t){this._id=e,this._clearFn=t}var i=Function.prototype.apply;t.setTimeout=function(){return new r(i.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(i.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n(81),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(22),a=function(){function e(t){r(this,e),this.connection=t,this.active=!1,this.results={}}return i(e,[{key:"getResults",value:function(){return this.results}},{key:"start",value:function(){var e=this,t=new o(function(t,n){e.resolveCb=t,e.rejectCb=n});return this.connection.setMessageCallback(this.handleMessage.bind(this)),this.connection.setErrorCallback(this.handleError.bind(this)),this.active=!0,this.forceStopped=!1,this.initiate(),t}},{key:"stop",value:function(){this.active=!1}},{key:"forceStop",value:function(){this.forceStopped=!0,this.stop(),this.finished()}},{key:"isActive",value:function(){return this.active}},{key:"initiate",value:function(){}},{key:"handleMessage",value:function(e){}},{key:"handleError",value:function(e){}},{key:"send",value:function(e){this.connection.send(e)}},{key:"finished",value:function(){this.active=!1,this.resolveCb()}},{key:"failed",value:function(e){this.active=!1,this.rejectCb(e)}}]),e}();t.TurnTest=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(35+58*Math.random());return t}Object.defineProperty(t,"__esModule",{value:!0}),t.randomAsciiString=t.MessageMaker=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(17),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(a),c=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1200;r(this,e),this.message={timestamp:"",sentBytes:1e4,padding:""};var n=i(t-s.getCurrent().toString().length-JSON.stringify(this.message).length);this.message.padding=n}return o(e,[{key:"make",value:function(e){return this.message.timestamp=s.getCurrent(),this.message.sentBytes=e,JSON.stringify(this.message)}}]),e}();t.MessageMaker=c,t.randomAsciiString=i},function(e,t,n){"use strict";function r(e){for(var t=0,n=e.length,r=0;r<n;r++)t<e[r]&&(t=e[r]);return parseFloat(((t-127)/128).toFixed(3))}function i(e,t){var n=0,r=t-e;return n=r>.2?t-.2:r<-.4?t+.4:e,parseFloat(n.toFixed(3))}function o(e,t,n){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=n}t.a=o;var a=n(1);window.AudioContext=window.AudioContext||window.webkitAudioContext;var s=null;window.AudioContext&&(s=new AudioContext,s.suspend&&s.suspend()),o.prototype.start=function(){if(o.isLocalStatsSupported()){s.resume();var e=s.createAnalyser();e.smoothingTimeConstant=.8,e.fftSize=2048,s.createMediaStreamSource(this.stream).connect(e);var t=this;this.intervalId=setInterval(function(){var n=new Uint8Array(e.frequencyBinCount);e.getByteTimeDomainData(n);var o=r(n);o!==t.audioLevel&&(t.audioLevel=i(o,t.audioLevel),t.callback(t.audioLevel))},this.intervalMilis)}},o.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},o.isLocalStatsSupported=function(){return Boolean(s&&!a.a.isTemasysPluginUsed())}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i}),n.d(t,"c",function(){return o}),n.d(t,"d",function(){return a});var r="statistics.audioLevel",i="statistics.before_disposed",o="statistics.byte_sent_stats",a="statistics.connectionstats"},function(e,t,n){var r=n(87),i={loadScript:function(e,t,n,i,o,a){var s=document,c=s.createElement("script"),u=s.getElementsByTagName("script")[0];if(c.async=t,i){var l=r();if(l){var d=l.src,p=d.substring(0,d.lastIndexOf("/")+1);d&&p&&(e=p+e)}}o&&(c.onload=o),a&&(c.onerror=a),c.src=e,n?u.parentNode.insertBefore(c,u):u.parentNode.appendChild(c)}};e.exports=i},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/http-bind";return e&&(t+=(-1===t.indexOf("?")?"?":"&")+"token="+e),new Strophe.Connection(t)}var s=n(0),c=(n.n(s),n(16)),u=n.n(c),l=n(43),d=n(23),p=n(1),f=n(92),h=n(95),v=n(102),m=n(103),g=n(104),y=n(105),b=n(8),S=n(106),_=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),T=Object(s.getLogger)(e),E=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.connection=null,o.disconnectInProgress=!1,o.connectionTimes={},o.forceMuted=!1,o.options=e,o.connectParams={},o.token=n,o.authenticatedUser=!1,o._initStrophePlugins(o),o.connection=a(n,e.bosh),o.caps=new S.a(o.connection,o.options.clientNode),o.initFeaturesList(),$(window).on("beforeunload unload",o.disconnect.bind(o)),o}return o(t,e),_(t,[{key:"initFeaturesList",value:function(){this.caps.addFeature("urn:xmpp:jingle:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:1"),this.caps.addFeature("urn:xmpp:jingle:transports:ice-udp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:dtls:0"),this.caps.addFeature("urn:xmpp:jingle:transports:dtls-sctp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:audio"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:video"),!this.options.disableRtx&&p.a.supportsRtx()&&this.caps.addFeature("urn:ietf:rfc:4588"),this.caps.addFeature("urn:ietf:rfc:5761"),this.caps.addFeature("urn:ietf:rfc:5888"),p.a.isChrome()&&!1!==this.options.enableLipSync&&(T.info("Lip-sync enabled !"),this.caps.addFeature("http://jitsi.org/meet/lipsync")),this.connection.rayo&&this.caps.addFeature("urn:xmpp:rayo:client:1")}},{key:"getConnection",value:function(){return this.connection}},{key:"connectionHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this,n=arguments[1],r=arguments[2],i=window.performance.now(),o=Strophe.getStatusString(n).toLowerCase();if(this.connectionTimes[o]=i,T.log("(TIME) Strophe "+o+(r?"["+r+"]":"")+":\t",i),n===Strophe.Status.CONNECTED||n===Strophe.Status.ATTACHED){(this.options.useStunTurn||this.options.p2p&&this.options.p2p.useStunTurn)&&this.connection.jingle.getStunAndTurnCredentials(),T.info("My Jabber ID: "+this.connection.jid);var a=this.connection.domain;this.connection.ping.hasPingSupport(a,function(e){e?t.connection.ping.startInterval(a):T.warn("Ping NOT supported by "+a)}),e.password&&(this.authenticatedUser=!0),this.connection&&this.connection.connected&&Strophe.getResourceFromJid(this.connection.jid)&&this.eventEmitter.emit(d.CONNECTION_ESTABLISHED,Strophe.getResourceFromJid(this.connection.jid))}else if(n===Strophe.Status.CONNFAIL)"x-strophe-bad-non-anon-jid"===r?this.anonymousConnectionFailed=!0:this.connectionFailed=!0,this.lastErrorMsg=r;else if(n===Strophe.Status.DISCONNECTED){this.connection.ping.stopInterval();var s=this.disconnectInProgress,c=r||this.lastErrorMsg;if(this.disconnectInProgress=!1,this.anonymousConnectionFailed)this.eventEmitter.emit(d.CONNECTION_FAILED,l.PASSWORD_REQUIRED);else if(this.connectionFailed)this.eventEmitter.emit(d.CONNECTION_FAILED,l.OTHER_ERROR,c);else if(s)this.eventEmitter.emit(d.CONNECTION_DISCONNECTED,c);else{T.error("XMPP connection dropped!");var u=Strophe.getLastErrorStatus();u>=500&&u<600?this.eventEmitter.emit(d.CONNECTION_FAILED,l.SERVER_ERROR,c||"server-error"):this.eventEmitter.emit(d.CONNECTION_FAILED,l.CONNECTION_DROPPED_ERROR,c||"connection-dropped-error")}}else n===Strophe.Status.AUTHFAIL&&this.eventEmitter.emit(d.CONNECTION_FAILED,l.PASSWORD_REQUIRED,r,e)}},{key:"_connect",value:function(e,t){this.anonymousConnectionFailed=!1,this.connectionFailed=!1,this.lastErrorMsg=void 0,this.connection.connect(e,t,this.connectionHandler.bind(this,{jid:e,password:t}))}},{key:"attach",value:function(e){var t=this.connectionTimes.attaching=window.performance.now();T.log("(TIME) Strophe Attaching\t:"+t),this.connection.attach(e.jid,e.sid,parseInt(e.rid,10)+1,this.connectionHandler.bind(this,{jid:e.jid,password:e.password}))}},{key:"connect",value:function(e,t){if(this.connectParams={jid:e,password:t},!e){var n=this.options.hosts,r=n.anonymousdomain,i=n.domain,o=r||i,a=window,s=a.location;if(r){var c=s&&s.search;(c&&-1!==c.indexOf("login=true")||this.token)&&(o=i)}e=o||s&&s.hostname}return this._connect(e,t)}},{key:"createRoom",value:function(e,t){var n=Strophe.getNodeFromJid(this.connection.jid),r=e+"@"+this.options.hosts.muc+"/",i=t.useNicks&&t.nick?t.nick:null;return i?n=t.nick:this.authenticatedUser||(n=n.substr(0,8)),(this.authenticatedUser||null!==i)&&(n+="-"+u.a.randomHexString(6)),r+=n,this.connection.emuc.createRoom(r,null,t)}},{key:"getJingleLog",value:function(){var e=this.connection.jingle;return e?e.getLog():{}}},{key:"getXmppLog",value:function(){return(this.connection.logger||{}).log||null}},{key:"dial",value:function(){var e;(e=this.connection.rayo).dial.apply(e,arguments)}},{key:"setMute",value:function(e,t){this.connection.moderate.setMute(e,t)}},{key:"eject",value:function(e){this.connection.moderate.eject(e)}},{key:"getSessions",value:function(){return this.connection.jingle.sessions}},{key:"disconnect",value:function(e){if(this.disconnectInProgress||!this.connection||!this.connection.connected)return void this.eventEmitter.emit(d.WRONG_STATE);if(this.disconnectInProgress=!0,this.connection.flush(),null!==e&&void 0!==e){var t=e.type;"beforeunload"!==t&&"unload"!==t||(this.connection.options.sync=!0)}this.connection.disconnect(),!0!==this.connection.options.sync&&this.connection.flush()}},{key:"_initStrophePlugins",value:function(){var e=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}],t=this.options.p2p&&this.options.p2p.stunServers||e;Object(f.a)(this),Object(h.a)(this,this.eventEmitter,t),Object(v.a)(),Object(m.a)(this),Object(g.a)(),Object(y.a)()}}]),t}(b.a);t.a=E}).call(t,"modules/xmpp/xmpp.js")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CONNECTION_DROPPED_ERROR",function(){return r}),n.d(t,"CONNECTION_ERROR",function(){return i}),n.d(t,"OTHER_ERROR",function(){return o}),n.d(t,"PASSWORD_REQUIRED",function(){return a}),n.d(t,"SERVER_ERROR",function(){return s});var r="connection.droppedError",i="connection.connectionError",o="connection.otherError",a="connection.passwordRequired",s="connection.serverError"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"ON",function(){return r}),n.d(t,"OFF",function(){return i});var r="on",i="off"},function(e,t){var n={IDENTITY_UPDATED:"authentication.identity_updated"};e.exports=n},function(e,t,n){"use strict";(function(e){function r(e){if("function"==typeof e.querySelector){var t=e.querySelector("error"),n=t&&t.querySelector("text");return t&&{code:t.attributes.code&&t.attributes.code.value,type:t.attributes.type&&t.attributes.type.value,message:n&&n.textContent}}var r=null,i=!0,o=!1,a=void 0;try{for(var s,c=e.children[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;if("error"===u.tagName){r=u;break}}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}if(!r)return null;var l=null,d=!0,p=!1,f=void 0;try{for(var h,v=r.children[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var m=h.value;if("text"===m.tagName){l=m.value;break}}}catch(e){p=!0,f=e}finally{try{!d&&v.return&&v.return()}finally{if(p)throw f}}return{code:r.attributes.code,type:r.attributes.type,message:l}}function i(e,t,n,r,o,a){this.eventEmitter=t,this.connection=n,this.state=null,this.focusMucJid=r,this.jirecon=o,this.url=null,this.type=e,this._isSupported=!(e===i.types.JIRECON&&!this.jirecon||e!==i.types.JIBRI&&e!==i.types.JIBRI_FILE&&e!==i.types.COLIBRI),this.jireconRid=null,this.roomjid=a}t.a=i;var o=n(0),a=(n.n(o),Object(o.getLogger)(e)),s=n(6),c=n(47),u=n(2);i.types={COLIBRI:"colibri",JIRECON:"jirecon",JIBRI:"jibri",JIBRI_FILE:"jibri_file"},i.status={ON:"on",OFF:"off",AVAILABLE:"available",UNAVAILABLE:"unavailable",PENDING:"pending",RETRYING:"retrying",ERROR:"error",BUSY:"busy",FAILED:"failed"},i.action={START:"start",STOP:"stop"},i.prototype.handleJibriPresence=function(e){var t=e.attributes;if(t){var n=t.status,o=r(e);a.log("Handle Jibri presence : "+n,o),n!==this.state&&("undefined"===n?this.state=i.status.UNAVAILABLE:n===i.status.OFF?this.state&&"undefined"!==this.state&&this.state!==i.status.UNAVAILABLE?this.state=i.status.OFF:this.state=i.status.AVAILABLE:this.state=n,this.eventEmitter.emit(s.RECORDER_STATE_CHANGED,this.state))}},i.prototype.setRecordingJibri=function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e===this.state&&n(c.INVALID_STATE);var s=$iq({to:this.focusMucJid,type:"set"}).c("jibri",{xmlns:"http://jitsi.org/protocol/jibri",action:e===i.status.ON?i.action.START:i.action.STOP,recording_mode:this.type===i.types.JIBRI_FILE?"file":"stream",streamid:this.type===i.types.JIBRI?o.streamId:void 0}).up();a.log("Set jibri recording: "+e,s.nodeTree),a.log(s.nodeTree),this.connection.sendIQ(s,function(e){a.log("Result",e);var n=$(e).find("jibri");t(n.attr("state"),n.attr("url"))},function(e){a.log("Failed to start recording, error: ",r(e)),n(e)})},i.prototype.setRecordingJirecon=function(e,t,n){e===this.state&&n(new Error("Invalid state!"));var r=$iq({to:this.jirecon,type:"set"}).c("recording",{xmlns:"http://jitsi.org/protocol/jirecon",action:e===i.status.ON?i.action.START:i.action.STOP,mucjid:this.roomjid});e===i.status.OFF&&r.attrs({rid:this.jireconRid}),a.log("Start recording");var o=this;this.connection.sendIQ(r,function(n){o.jireconRid=$(n).find("recording").attr("rid"),a.log("Recording "+(e===i.status.ON?"started":"stopped")+"(jirecon)"+n),o.state=e,e===i.status.OFF&&(o.jireconRid=null),t(e)},function(e){a.log("Failed to start recording, error: ",e),n(e)})},i.prototype.setRecordingColibri=function(e,t,n,r){var i=$iq({to:this.focusMucJid,type:"set"});i.c("conference",{xmlns:"http://jitsi.org/protocol/colibri"}),i.c("recording",{state:e,token:r.token});var o=this;this.connection.sendIQ(i,function(n){a.log('Set recording "',e,'". Result:',n);var r=$(n).find(">conference>recording"),i=r.attr("state");o.state=i,t(i),"pending"===i&&o.connection.addHandler(function(e){var n=$(e).find("recording").attr("state");n&&(o.state=i,t(n))},"http://jitsi.org/protocol/colibri","iq",null,null,null)},function(e){a.warn(e),n(e)})},i.prototype.setRecording=function(){switch(this.type){case i.types.JIRECON:this.setRecordingJirecon.apply(this,arguments);break;case i.types.COLIBRI:this.setRecordingColibri.apply(this,arguments);break;case i.types.JIBRI:case i.types.JIBRI_FILE:this.setRecordingJibri.apply(this,arguments);break;default:var e="Unknown recording type!";u.callErrorHandler(new Error(e)),a.error(e)}},i.prototype.toggleRecording=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=this.state;if(n===i.status.UNAVAILABLE||n===i.status.FAILED?t(i.status.FAILED,c.RECORDER_UNAVAILABLE):n===i.status.BUSY&&t(i.status.BUSY,c.RECORDER_BUSY),(n===i.status.OFF||n===i.status.AVAILABLE)&&(!e.token&&this.type===i.types.COLIBRI||!e.streamId&&this.type===i.types.JIBRI))return t(i.status.FAILED,c.NO_TOKEN),void a.error("No token passed!");var r=n===i.status.AVAILABLE||n===i.status.OFF?i.status.ON:i.status.OFF,o=this;a.log("Toggle recording (old state, new state): ",n,r),this.setRecording(r,function(e,r){e&&e!==n&&(o.state=e,o.url=r,t(e))},function(e){return t(i.status.FAILED,e)},e)},i.prototype.isSupported=function(){return this._isSupported},i.prototype.getState=function(){return this.state},i.prototype.getURL=function(){return this.url}}).call(t,"modules/xmpp/recording.js")},function(e,t){var n={RECORDER_UNAVAILABLE:"recorder.unavailable",RECORDER_BUSY:"recorder.busy",NO_TOKEN:"recorder.noToken",STATE_CHANGE_FAILED:"recorder.stateChangeFailed",INVALID_STATE:"recorder.invalidState"};e.exports=n},function(e,t,n){"use strict";n.d(t,"c",function(){return r}),n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r="pending",i="active",o="ended"},function(e,t,n){"use strict";function r(e){for(var t=e.split("\r\nm="),n=1,r=t.length;n<r;n++){var i="m="+t[n];n!==r-1&&(i+="\r\n"),t[n]=i}var o=t.shift()+"\r\n";this.media=t,this.raw=o+t.join(""),this.session=o}t.a=r;var i=n(10);r.prototype.failICE=!1,r.prototype.removeTcpCandidates=!1,r.prototype.removeUdpCandidates=!1,r.prototype.getMediaSsrcMap=function(){for(var e=this,t={},n=void 0,r=0;r<e.media.length;r++)!function(r){n=i.a.findLines(e.media[r],"a=ssrc:");var o=i.a.parseMID(i.a.findLine(e.media[r],"a=mid:")),a={mediaindex:r,mid:o,ssrcs:{},ssrcGroups:[]};t[r]=a,n.forEach(function(e){var t=e.substring(7).split(" ")[0];a.ssrcs[t]||(a.ssrcs[t]={ssrc:t,lines:[]}),a.ssrcs[t].lines.push(e)}),n=i.a.findLines(e.media[r],"a=ssrc-group:"),n.forEach(function(e){var t=e.indexOf(" "),n=e.substr(0,t).substr(13),r=e.substr(14+n.length).split(" ");r.length&&a.ssrcGroups.push({semantics:n,ssrcs:r})})}(r);return t},r.prototype.containsSSRC=function(e){var t=this.getMediaSsrcMap(),n=!1;return Object.keys(t).forEach(function(r){n||t[r].ssrcs[e]&&(n=!0)}),n},r.prototype.mangle=function(){var e=void 0,t=void 0,n=void 0,r=void 0,o=void 0,a=void 0;for(e=0;e<this.media.length;e++)if(n=this.media[e].split("\r\n"),n.pop(),r=i.a.parseMLine(n.shift()),"audio"===r.media){for(o="",r.fmt.length=0,t=0;t<n.length;t++){if("a=rtpmap:"===n[t].substr(0,9)){if(a=i.a.parseRTPMap(n[t]),"CN"===a.name||"ISAC"===a.name)continue;r.fmt.push(a.id)}o+=n[t]+"\r\n"}this.media[e]=i.a.buildMLine(r)+"\r\n"+o}this.raw=this.session+this.media.join("")},r.prototype.removeSessionLines=function(e){var t=this,n=i.a.findLines(this.session,e);return n.forEach(function(e){t.session=t.session.replace(e+"\r\n","")}),this.raw=this.session+this.media.join(""),n},r.prototype.removeMediaLines=function(e,t){var n=this,r=i.a.findLines(this.media[e],t);return r.forEach(function(t){n.media[e]=n.media[e].replace(t+"\r\n","")}),this.raw=this.session+this.media.join(""),r},r.prototype.toJingle=function(e,t){var n=void 0,r=void 0,o=void 0,a=void 0,s=void 0,c=void 0,u=void 0,l=void 0;if(a=i.a.findLines(this.session,"a=group:"),a.length)for(n=0;n<a.length;n++){l=a[n].split(" ");var d=l.shift().substr(8);for(e.c("group",{xmlns:"urn:xmpp:jingle:apps:grouping:0",semantics:d}),r=0;r<l.length;r++)e.c("content",{name:l[r]}).up();e.up()}for(n=0;n<this.media.length;n++)if(s=i.a.parseMLine(this.media[n].split("\r\n")[0]),"audio"===s.media||"video"===s.media||"application"===s.media){var p=i.a.findLine(this.media[n],"a=ssrc:");u=!!p&&p.substring(7).split(" ")[0],e.c("content",{creator:t,name:s.media});var f=i.a.findLine(this.media[n],"a=mid:");if(f){var h=i.a.parseMID(f);e.attrs({name:h})}if(i.a.findLine(this.media[n],"a=rtpmap:").length){for(e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:s.media}),u&&e.attrs({ssrc:u}),r=0;r<s.fmt.length;r++){c=i.a.findLine(this.media[n],"a=rtpmap:"+s.fmt[r]),e.c("payload-type",i.a.parseRTPMap(c));var v=i.a.findLine(this.media[n],"a=fmtp:"+s.fmt[r]);if(v)for(l=i.a.parseFmtp(v),o=0;o<l.length;o++)e.c("parameter",l[o]).up();this.rtcpFbToJingle(n,e,s.fmt[r]),e.up()}var m=i.a.findLines(this.media[n],"a=crypto:",this.session);if(m.length&&(e.c("encryption",{required:1}),m.forEach(function(t){return e.c("crypto",i.a.parseCrypto(t)).up()}),e.up()),u){e.c("source",{ssrc:u,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"});var g=i.a.findLines(this.media[n],"a=ssrc:");if(g.length>0)g.forEach(function(t){var n=t.indexOf(" "),r=t.substr(0,n).substr(7);r!==u&&(e.up(),u=r,e.c("source",{ssrc:u,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}));var o=t.substr(n+1);if(e.c("parameter"),-1===o.indexOf(":"))e.attrs({name:o});else{var a=o.split(":",2)[0];e.attrs({name:a});var s=o.split(":",2)[1];s=i.a.filterSpecialChars(s),e.attrs({value:s})}e.up()});else{e.up(),e.c("source",{ssrc:u,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.c("parameter"),e.attrs({name:"cname",value:Math.random().toString(36).substring(7)}),e.up();var y=null,b=APP.RTC.getLocalTracks(s.media);b&&(y=b.getTrackId()),null!==y&&(y=i.a.filterSpecialChars(y),e.c("parameter"),e.attrs({name:"msid",value:y}),e.up(),e.c("parameter"),e.attrs({name:"mslabel",value:y}),e.up(),e.c("parameter"),e.attrs({name:"label",value:y}),e.up())}e.up();var S=i.a.findLines(this.media[n],"a=ssrc-group:");S.forEach(function(t){var n=t.indexOf(" "),r=t.substr(0,n).substr(13),i=t.substr(14+r.length).split(" ");i.length&&(e.c("ssrc-group",{semantics:r,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),i.forEach(function(t){return e.c("source",{ssrc:t}).up()}),e.up())})}var _=i.a.findLines(this.media[n],"a=rid");if(_.length){var T=_.map(function(e){return e.split(":")[1]}).map(function(e){return e.split(" ")[0]});T.forEach(function(t){e.c("source",{rid:t,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.up()});var E=i.a.findLine(this.media[n],"a=simulcast");E&&(e.c("rid-group",{semantics:"SIM",xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),T.forEach(function(t){e.c("source",{rid:t}).up()}),e.up())}if(i.a.findLine(this.media[n],"a=rtcp-mux")&&e.c("rtcp-mux").up(),this.rtcpFbToJingle(n,e,"*"),a=i.a.findLines(this.media[n],"a=extmap:"),a.length)for(r=0;r<a.length;r++){if(l=i.a.parseExtmap(a[r]),e.c("rtp-hdrext",{xmlns:"urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",uri:l.uri,id:l.value}),l.hasOwnProperty("direction"))switch(l.direction){case"sendonly":e.attrs({senders:"responder"});break;case"recvonly":e.attrs({senders:"initiator"});break;case"sendrecv":e.attrs({senders:"both"});break;case"inactive":e.attrs({senders:"none"})}e.up()}e.up()}this.transportToJingle(n,e);var C=this.media[n];i.a.findLine(C,"a=sendrecv",this.session)?e.attrs({senders:"both"}):i.a.findLine(C,"a=sendonly",this.session)?e.attrs({senders:"initiator"}):i.a.findLine(C,"a=recvonly",this.session)?e.attrs({senders:"responder"}):i.a.findLine(C,"a=inactive",this.session)&&e.attrs({senders:"none"}),"0"===s.port&&e.attrs({senders:"rejected"}),e.up()}return e.up(),e},r.prototype.transportToJingle=function(e,t){var n=void 0,r=this;t.c("transport");var o=i.a.findLine(this.media[e],"a=sctpmap:",r.session);if(o){var a=i.a.parseSCTPMap(o);t.c("sctpmap",{xmlns:"urn:xmpp:jingle:transports:dtls-sctp:1",number:a[0],protocol:a[1]}),a.length>2&&t.attrs({streams:a[2]}),t.up()}if(i.a.findLines(this.media[e],"a=fingerprint:",this.session).forEach(function(o){n=i.a.parseFingerprint(o),n.xmlns="urn:xmpp:jingle:apps:dtls:0",t.c("fingerprint").t(n.fingerprint),delete n.fingerprint,o=i.a.findLine(r.media[e],"a=setup:",r.session),o&&(n.setup=o.substr(8)),t.attrs(n),t.up()}),n=i.a.iceparams(this.media[e],this.session)){n.xmlns="urn:xmpp:jingle:transports:ice-udp:1",t.attrs(n);var s=i.a.findLines(this.media[e],"a=candidate:",this.session);s.length&&s.forEach(function(e){var n=i.a.candidateToJingle(e);r.failICE&&(n.ip="1.1.1.1");var o=n&&"string"==typeof n.protocol?n.protocol.toLowerCase():"";r.removeTcpCandidates&&("tcp"===o||"ssltcp"===o)||r.removeUdpCandidates&&"udp"===o||t.c("candidate",n).up()})}t.up()},r.prototype.rtcpFbToJingle=function(e,t,n){i.a.findLines(this.media[e],"a=rtcp-fb:"+n).forEach(function(e){var n=i.a.parseRTCPFB(e);"trr-int"===n.type?(t.c("rtcp-fb-trr-int",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",value:n.params[0]}),t.up()):(t.c("rtcp-fb",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",type:n.type}),n.params.length>0&&t.attrs({subtype:n.params[0]}),t.up())})},r.prototype.rtcpFbFromJingle=function(e,t){var n="",r=e.find('>rtcp-fb-trr-int[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]');return r.length&&(n+="a=rtcp-fb:* trr-int ",r.attr("value")?n+=r.attr("value"):n+="0",n+="\r\n"),r=e.find('>rtcp-fb[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]'),r.each(function(){n+="a=rtcp-fb:"+t+" "+$(this).attr("type"),$(this).attr("subtype")&&(n+=" "+$(this).attr("subtype")),n+="\r\n"}),n},r.prototype.fromJingle=function(e){var t=this;this.raw="v=0\r\no=- 1923518516 2 IN IP4 0.0.0.0\r\ns=-\r\nt=0 0\r\n";var n=$(e).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]');n.length&&n.each(function(e,n){var r=$(n).find(">content").map(function(e,t){return t.getAttribute("name")}).get();r.length>0&&(t.raw+="a=group:"+(n.getAttribute("semantics")||n.getAttribute("type"))+" "+r.join(" ")+"\r\n")}),this.session=this.raw,e.find(">content").each(function(){var e=t.jingle2media($(this));t.media.push(e)}),this.raw=this.session+this.media.join("")},r.prototype.jingle2media=function(e){var t=e.find("description"),n="",r=this,o=e.find('>transport>sctpmap[xmlns="urn:xmpp:jingle:transports:dtls-sctp:1"]'),a={media:t.attr("media")};if(a.port="1","rejected"===e.attr("senders")&&(a.port="0"),e.find(">transport>fingerprint").length||t.find("encryption").length?a.proto=o.length?"DTLS/SCTP":"RTP/SAVPF":a.proto="RTP/AVPF",o.length){n+="m=application 1 DTLS/SCTP "+o.attr("number")+"\r\n",n+="a=sctpmap:"+o.attr("number")+" "+o.attr("protocol");var s=o.attr("streams");n+=s?" "+s+"\r\n":"\r\n"}else a.fmt=t.find("payload-type").map(function(){return this.getAttribute("id")}).get(),n+=i.a.buildMLine(a)+"\r\n";switch(n+="c=IN IP4 0.0.0.0\r\n",o.length||(n+="a=rtcp:1 IN IP4 0.0.0.0\r\n"),a=e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]'),a.length&&(a.attr("ufrag")&&(n+=i.a.buildICEUfrag(a.attr("ufrag"))+"\r\n"),a.attr("pwd")&&(n+=i.a.buildICEPwd(a.attr("pwd"))+"\r\n"),a.find(">fingerprint").each(function(){n+="a=fingerprint:"+this.getAttribute("hash"),n+=" "+$(this).text(),n+="\r\n",this.getAttribute("setup")&&(n+="a=setup:"+this.getAttribute("setup")+"\r\n")})),e.attr("senders")){case"initiator":n+="a=sendonly\r\n";break;case"responder":n+="a=recvonly\r\n";break;case"none":n+="a=inactive\r\n";break;case"both":n+="a=sendrecv\r\n"}return n+="a=mid:"+e.attr("name")+"\r\n",t.find("rtcp-mux").length&&(n+="a=rtcp-mux\r\n"),t.find("encryption").length&&t.find("encryption>crypto").each(function(){n+="a=crypto:"+this.getAttribute("tag"),n+=" "+this.getAttribute("crypto-suite"),n+=" "+this.getAttribute("key-params"),this.getAttribute("session-params")&&(n+=" "+this.getAttribute("session-params")),n+="\r\n"}),t.find("payload-type").each(function(){n+=i.a.buildRTPMap(this)+"\r\n",$(this).find(">parameter").length&&(n+="a=fmtp:"+this.getAttribute("id")+" ",n+=$(this).find("parameter").map(function(){return(this.getAttribute("name")?this.getAttribute("name")+"=":"")+this.getAttribute("value")}).get().join("; "),n+="\r\n"),n+=r.rtcpFbFromJingle($(this),this.getAttribute("id"))}),n+=r.rtcpFbFromJingle(t,"*"),a=t.find('>rtp-hdrext[xmlns="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0"]'),a.each(function(){n+="a=extmap:"+this.getAttribute("id")+" "+this.getAttribute("uri")+"\r\n"}),e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]>candidate').each(function(){var e=this.getAttribute("protocol");e="string"==typeof e?e.toLowerCase():"",r.removeTcpCandidates&&("tcp"===e||"ssltcp"===e)||r.removeUdpCandidates&&"udp"===e||(r.failICE&&this.setAttribute("ip","1.1.1.1"),n+=i.a.candidateFromJingle(this))}),e.find('description>ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map(function(){return this.getAttribute("ssrc")}).get();t.length&&(n+="a=ssrc-group:"+e+" "+t.join(" ")+"\r\n")}),a=e.find('description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]'),a.each(function(){var e=this.getAttribute("ssrc");$(this).find(">parameter").each(function(){var t=this.getAttribute("name"),r=this.getAttribute("value");r=i.a.filterSpecialChars(r),n+="a=ssrc:"+e+" "+t,r&&r.length&&(n+=":"+r),n+="\r\n"})}),n}},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var r="signaling.peerMuted",i="signaling.peerVideoType"},function(e,t){var n={ENVIRONMENT:"environment",USER:"user"};e.exports=n},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){var t=e.getOriginalStream();if(t){var n=t.stop;t.stop=function(){n.apply(t),e.isActive()&&t.onended()}}}function s(e,t){void 0===e.active?e.onended=t:e.oninactive=t}var c=n(12),u=n.n(c),l=n(0),d=(n.n(l),n(15)),p=n(3),f=n(1),h=n(25),v=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),m=Object(l.getLogger)(e),g={track_mute:"onmute",track_unmute:"onunmute",track_ended:"onended"},y=function(e){function t(e,n,o,a,s,c){r(this,t);var u=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return u.addEventListener=u.addListener,u.removeEventListener=u.off=u.removeListener,u.containers=[],u.conference=e,u.audioLevel=-1,u.type=s,u.track=o,u.videoType=c,u.handlers=new Map,u.disposed=!1,u._streamInactiveHandler=a,u._setStream(n),u}return o(t,e),v(t,[{key:"_bindInactiveHandler",value:function(e){f.a.isFirefox()&&a(this),s(this.stream,e)}},{key:"_setHandler",value:function(e,t){if(!g.hasOwnProperty(e))return void m.error("Invalid handler type "+e);if(t?this.handlers.set(e,t):this.handlers.delete(e),this.stream){var n=!0,r=!1,i=void 0;try{for(var o,a=this.stream.getVideoTracks()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)o.value[g[e]]=t}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}}},{key:"_unregisterHandlers",value:function(){if(!this.stream)return void m.warn(this+": unable to unregister handlers - no stream object");var e=!0,t=!1,n=void 0;try{for(var r,i=this.handlers.keys()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=!0,c=!1,u=void 0;try{for(var l,d=this.stream.getVideoTracks()[Symbol.iterator]();!(a=(l=d.next()).done);a=!0)l.value[g[o]]=void 0}catch(e){c=!0,u=e}finally{try{!a&&d.return&&d.return()}finally{if(c)throw u}}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this._streamInactiveHandler&&s(this.stream,void 0)}},{key:"_setStream",value:function(e){if(this.stream!==e&&(this.stream=e,this.stream)){var t=!0,n=!1,r=void 0;try{for(var i,o=this.handlers.keys()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this._setHandler(a,this.handlers.get(a))}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this._streamInactiveHandler&&this._bindInactiveHandler(this._streamInactiveHandler)}}},{key:"getType",value:function(){return this.type}},{key:"isAudioTrack",value:function(){return this.getType()===p.a}},{key:"isWebRTCTrackMuted",value:function(){return this.track&&this.track.muted}},{key:"isVideoTrack",value:function(){return this.getType()===p.b}},{key:"isLocal",value:function(){throw new Error("Not implemented by subclass")}},{key:"getOriginalStream",value:function(){return this.stream}},{key:"getStreamId",value:function(){return this.stream?this.stream.id:null}},{key:"getTrack",value:function(){return this.track}},{key:"getTrackId",value:function(){return this.track?this.track.id:null}},{key:"getUsageLabel",value:function(){return this.isAudioTrack()?"mic":this.videoType?this.videoType:"default"}},{key:"_maybeFireTrackAttached",value:function(e){this.conference&&e&&this.conference._onTrackAttach(this,e)}},{key:"attach",value:function(e){var t=e;return this.stream&&(t=h.a.attachMediaStream(e,this.stream)),this.containers.push(t),this._maybeFireTrackAttached(t),this._attachTTFMTracker(t),t}},{key:"detach",value:function(e){for(var t=this.containers,n=t.length-1;n>=0;--n){var r=t[n];e||h.a.attachMediaStream(r,null),e&&r!==e||t.splice(n,1)}e&&h.a.attachMediaStream(e,null)}},{key:"_attachTTFMTracker",value:function(e){}},{key:"dispose",value:function(){return this.removeAllListeners(),this.disposed=!0,Promise.resolve()}},{key:"isScreenSharing",value:function(){}},{key:"getId",value:function(){return this.stream?h.a.getStreamID(this.stream):null}},{key:"isActive",value:function(){return void 0===this.stream.active||this.stream.active}},{key:"setAudioLevel",value:function(e,t){this.audioLevel!==e&&(this.audioLevel=e,this.emit(d.TRACK_AUDIO_LEVEL_CHANGED,e,t))}},{key:"getMSID",value:function(){var e=this.getStreamId(),t=this.getTrackId();return e&&t?e+" "+t:null}},{key:"setAudioOutput",value:function(e){var t=this;return h.a.isDeviceChangeAvailable("output")?this.isVideoTrack()?Promise.resolve():Promise.all(this.containers.map(function(t){return t.setSinkId(e).catch(function(e){throw m.warn("Failed to change audio output device on element. Default or previously set audio output device will be used.",t,e),e})})).then(function(){t.emit(d.TRACK_AUDIO_OUTPUT_CHANGED,e)}):Promise.reject(new Error("Audio output device change is not supported"))}}]),t}(u.a);t.a=y}).call(t,"modules/RTC/JitsiTrack.js")},function(e,t){var n=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},function(e,t,n){function r(e){if(void 0===e.recorder)throw new Error("Passed an object to startRecorder which is not a TrackRecorder object");e.recorder.start(),e.startTime=new Date}function i(e){if(void 0===e.recorder)throw new Error("Passed an object to stopRecorder which is not a TrackRecorder object");e.recorder.stop()}function o(){if(MediaRecorder.isTypeSupported(u))return u;if(MediaRecorder.isTypeSupported(l))return l;throw new Error("unable to create a MediaRecorder with the right mimetype!")}function a(e){this.recorders=[],this.fileType=o(),this.isRecording=!1,this.jitsiConference=e}function s(){if("undefined"!=typeof MediaStream)return new MediaStream;if("undefined"!=typeof webkitMediaStream)return new webkitMediaStream;throw new Error("cannot create a clean mediaStream")}var c=n(138),u="audio/webm",l="audio/ogg",d=function(e){this.track=e,this.recorder=null,this.data=null,this.name=null,this.startTime=null};a.determineCorrectFileType=o,a.prototype.addTrack=function(e){if(e.isAudioTrack()){var t=this.instantiateTrackRecorder(e);this.recorders.push(t),this.updateNames(),this.isRecording&&r(t)}},a.prototype.instantiateTrackRecorder=function(e){var t=new d(e),n=t.track.getOriginalStream(),r=s();return n.getAudioTracks().forEach(function(e){return r.addTrack(e)}),t.recorder=new MediaRecorder(r,{mimeType:this.fileType}),t.data=[],t.recorder.ondataavailable=function(e){e.data.size>0&&t.data.push(e.data)},t},a.prototype.removeTrack=function(e){if(!e.isVideoTrack()){var t=this.recorders,n=void 0;for(n=0;n<t.length;n++)if(t[n].track.getParticipantId()===e.getParticipantId()){var r=t[n];this.isRecording?i(r):t.splice(n,1)}this.updateNames()}},a.prototype.updateNames=function(){var e=this.jitsiConference;this.recorders.forEach(function(t){if(t.track.isLocal())t.name="the transcriber";else{var n=t.track.getParticipantId(),r=e.getParticipantById(n),i=r.getDisplayName();"undefined"!==i&&(t.name=i)}})},a.prototype.start=function(){if(this.isRecording)throw new Error("audiorecorder is already recording");this.isRecording=!0,this.recorders.forEach(function(e){return r(e)}),console.log("Started the recording of the audio. There are currently "+this.recorders.length+" recorders active.")},a.prototype.stop=function(){this.isRecording=!1,this.recorders.forEach(function(e){return i(e)}),console.log("stopped recording")},a.prototype.download=function(){var e=this;this.recorders.forEach(function(t){var n=new Blob(t.data,{type:e.fileType}),r=URL.createObjectURL(n),i=document.createElement("a");document.body.appendChild(i),i.style="display: none",i.href=r,i.download="test."+e.fileType.split("/")[1],i.click(),window.URL.revokeObjectURL(r)})},a.prototype.getRecordingResults=function(){var e=this;if(this.isRecording)throw new Error("cannot get blobs because the AudioRecorder is still recording!");this.updateNames();var t=[];return this.recorders.forEach(function(n){return t.push(new c(new Blob(n.data,{type:e.fileType}),n.name,n.startTime))}),t},a.prototype.getFileType=function(){return this.fileType},e.exports=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"DEVICE_LIST_CHANGED",function(){return r}),n.d(t,"PERMISSION_PROMPT_IS_SHOWN",function(){return i});var r="mediaDevices.devicechange",i="mediaDevices.permissionPromptIsShown"},function(e,t,n){e.exports=n(57).default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function r(e){if(!P.a[e])return null;var t=P.a[e].order,n=null,r=null;return Object.keys(P.a).forEach(function(e){var i=P.a[e];(!n||n.order<i.order&&i.order<t)&&(r=e,n=i)}),r}function i(e,t){var n=e;return-1!==t.devices.indexOf("audio")&&(n+=".audio"),-1!==t.devices.indexOf("desktop")&&(n+=".desktop"),-1!==t.devices.indexOf("video")&&(n+=".video."+t.resolution),n}var o=n(58),a=n.n(o),s=n(27),c=n(2),u=n.n(c),l=n(28),d=n(4),p=n(59),f=n(43),h=n(23),v=n(146),m=n(55),g=n(47),y=n.n(g),b=n(9),S=n(13),_=n(15),T=n(44),E=n(39),C=n(46),w=n(0),R=n.n(w),k=n(3),I=n(31),P=n.n(I),A=n(32),D=n(24),O=n(1),L=n(147),N=n(41),M=n.n(N),x=n(19),F=n(5),j=n(34),U=R.a.getLogger(e);t.default={version:"jitsi-meet_2495#8b93184",JitsiConnection:p.a,constants:{participantConnectionStatus:A.a,recordingStatus:C.a.status,recordingTypes:C.a.types,sipVideoGW:j,transcriptionStatus:T},events:{conference:d,connection:h,track:_,mediaDevices:m,connectionQuality:s},errors:{conference:l,connection:f,recorder:y.a,track:S},errorTypes:{JitsiTrackError:b.a},logLevels:R.a.levels,mediaDevices:v.a,analytics:null,init:function(e){F.a.init(e),window.connectionTimes||(window.connectionTimes={}),this.analytics=F.a.analytics,!0===e.enableAnalyticsLogging&&this.analytics.init(O.a.getBrowserName()),e.enableWindowOnErrorHandler&&u.a.addHandler(this.getGlobalOnErrorHandler.bind(this));var t=e.deploymentInfo;if(t&&Object.keys(t).length>0){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);n.id="deployment_info",F.a.sendLog(JSON.stringify(n))}if(this.version){var i={id:"component_version",component:"lib-jitsi-meet",version:this.version};F.a.sendLog(JSON.stringify(i))}return D.a.init(e||{})},isDesktopSharingEnabled:function(){return D.a.isDesktopSharingEnabled()},setLogLevel:function(e){R.a.setLogLevel(e)},setLogLevelById:function(e,t){R.a.setLogLevelById(e,t)},addGlobalLogTransport:function(e){R.a.addGlobalTransport(e)},removeGlobalLogTransport:function(e){R.a.removeGlobalTransport(e)},createLocalTracks:function(e,t){var n=this,o=!1;return!0===t&&window.setTimeout(function(){o||v.a.emitEvent(m.PERMISSION_PROMPT_IS_SHOWN,O.a.getBrowserName())},1e3),window.connectionTimes||(window.connectionTimes={}),window.connectionTimes["obtainPermissions.start"]=window.performance.now(),D.a.obtainAudioAndVideoPermissions(e||{}).then(function(t){if(o=!0,window.connectionTimes["obtainPermissions.end"]=window.performance.now(),F.a.analytics.sendEvent(i("getUserMedia.success",e),{value:e}),!D.a.options.disableAudioLevels)for(var n=0;n<t.length;n++)!function(e){var n=t[e],r=n.getOriginalStream();n.getType()===k.a&&(F.a.startLocalStats(r,n.setAudioLevel.bind(n)),n.addEventListener(_.LOCAL_TRACK_STOPPED,function(){F.a.stopLocalStats(r)}))}(n);var r=D.a.getCurrentlyAvailableMediaDevices();if(r)for(var n=0;n<t.length;n++){var a=t[n];a._setRealDeviceIdFromDeviceList(r)}return t}).catch(function(t){if(o=!0,t.name===S.UNSUPPORTED_RESOLUTION){var a=e.resolution||"720",s=r(a);if(null!==s)return e.resolution=s,U.debug("Retry createLocalTracks with resolution",s),F.a.analytics.sendEvent("getUserMedia.fail.resolution."+a),n.createLocalTracks(e)}if(S.CHROME_EXTENSION_USER_CANCELED===t.name){var c={id:"chrome_extension_user_canceled",message:t.message};F.a.sendLog(JSON.stringify(c)),F.a.analytics.sendEvent("getUserMedia.userCancel.extensionInstall")}else if(S.NOT_FOUND===t.name){var u={id:"usermedia_missing_device",status:t.gum.devices};F.a.sendLog(JSON.stringify(u)),F.a.analytics.sendEvent("getUserMedia.deviceNotFound."+t.gum.devices.join("."))}else{F.a.sendGetUserMediaFailed(t);var l=i("getUserMedia.failed",e);F.a.analytics.sendEvent(l+"."+t.name,{value:e})}return window.connectionTimes["obtainPermissions.end"]=window.performance.now(),Promise.reject(t)})},isDeviceListAvailable:function(){return U.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceListAvailable instead"),this.mediaDevices.isDeviceListAvailable()},isDeviceChangeAvailable:function(e){return U.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceChangeAvailable instead"),this.mediaDevices.isDeviceChangeAvailable(e)},isMultipleAudioInputSupported:function(){return this.mediaDevices.isMultipleAudioInputSupported()},isCollectingLocalStats:function(){return F.a.audioLevelsEnabled&&E.a.isLocalStatsSupported()},enumerateDevices:function(e){U.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.enumerateDevices instead"),this.mediaDevices.enumerateDevices(e)},getGlobalOnErrorHandler:function(e,t,n,r,i){U.error("UnhandledError: "+e,"Script: "+t,"Line: "+n,"Column: "+r,"StackTrace: ",i),F.a.reportGlobalError(i)},getMachineId:function(){return x.a.machineId},util:{AuthUtil:a.a,RTCUIHelper:L.a,ScriptUtil:M.a}}}.call(t,"JitsiMeetJS.js")},function(e,t){var n={getTokenAuthUrl:function(e,t,n){var r=e;return"string"!=typeof r?null:r.replace("{room}",t).replace("{roleUpgrade}",!0===n)}};e.exports=n},function(e,t,n){"use strict";function r(e,t,n){this.appID=e,this.token=t,this.options=n,this.xmpp=new s.a(n,t),this.addEventListener(o.CONNECTION_FAILED,function(e,t){a.a.sendEventToAll("connection.failed."+e,{label:t})}),this.addEventListener(o.CONNECTION_DISCONNECTED,function(e){e&&a.a.analytics.sendEvent("connection.disconnected."+e),a.a.sendLog(JSON.stringify({id:"connection.disconnected",msg:e}))})}t.a=r;var i=n(60),o=n(23),a=n(5),s=n(42);r.prototype.connect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.xmpp.connect(e.id,e.password)},r.prototype.attach=function(e){this.xmpp.attach(e)},r.prototype.disconnect=function(){var e;(e=this.xmpp).disconnect.apply(e,arguments)},r.prototype.setToken=function(e){this.token=e},r.prototype.initJitsiConference=function(e,t){return new i.a({name:e,config:t,connection:this})},r.prototype.addEventListener=function(e,t){this.xmpp.addListener(e,t)},r.prototype.removeEventListener=function(e,t){this.xmpp.removeListener(e,t)},r.prototype.getConnectionTimes=function(){return this.xmpp.connectionTimes},r.prototype.addFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.xmpp.caps.addFeature(e,t)},r.prototype.removeFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.xmpp.caps.removeFeature(e,t)}},function(e,t,n){"use strict";(function(e){function r(e){if(!e.name||e.name.toLowerCase()!==e.name){var t="Invalid conference name (no conference name passed or it contains invalid characters like capital letters)!";throw j.error(t),new Error(t)}this.eventEmitter=new d.a,this.options=e,this.eventManager=new h.a(this),this.participants={},this._init(e),this.componentsVersions=new o.a(this),this.jvbJingleSession=null,this.lastDominantSpeaker=null,this.dtmfManager=null,this.somebodySupportsDTMF=!1,this.authEnabled=!1,this.startAudioMuted=!1,this.startVideoMuted=!1,this.startMutedPolicy={audio:!1,video:!1},this.availableDevices={audio:void 0,video:void 0},this.isMutedByFocus=!1,this.wasStopped=!1,this.connectionQuality=new a.a(this,this.eventEmitter,e),this.avgRtpStatsReporter=new i.a(this,e.config.avgRtpStatsN||15),this.isJvbConnectionInterrupted=!1,this.speakerStatsCollector=new F.a(this),this.deferredStartP2PTask=null;var n=parseInt(e.config.p2p&&e.config.p2p.backToP2PDelay,10);this.backToP2PDelay=isNaN(n)?5:n,j.info("backToP2PDelay: "+this.backToP2PDelay),this.isP2PConnectionInterrupted=!1,this.p2p=!1,this.p2pJingleSession=null}t.a=r;var i=n(61),o=n(89),a=n(90),s=n(0),c=(n.n(s),n(2)),u=n.n(c),l=n(12),d=n.n(l),p=n(91),f=n(28),h=n(107),v=n(4),m=n(109),g=n.n(m),y=n(110),b=n(9),S=n(13),_=n(15),T=n(111),E=n(3),C=n(32),w=n(112),R=n(24),k=n(1),I=n(7),P=(n.n(I),n(5)),A=n(136),D=n(137),O=n.n(D),L=n(14),N=n.n(L),M=n(142),x=n(6),F=(n.n(x),n(144)),j=Object(s.getLogger)(e);r.prototype.constructor=r,r.prototype._init=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.connection&&(this.connection=t.connection,this.xmpp=this.connection.xmpp,this.eventManager.setupXMPPListeners());var n=this.options.config;if(this.room=this.xmpp.createRoom(this.options.name,n),this._onIceConnectionInterrupted=this._onIceConnectionInterrupted.bind(this),this.room.addListener(x.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),this._onIceConnectionRestored=this._onIceConnectionRestored.bind(this),this.room.addListener(x.CONNECTION_RESTORED,this._onIceConnectionRestored),this._onIceConnectionEstablished=this._onIceConnectionEstablished.bind(this),this.room.addListener(x.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),this.room.updateDeviceAvailability(R.a.getDeviceAvailability()),this.rtc||(this.rtc=new R.a(this,t),this.eventManager.setupRTCListeners()),this.participantConnectionStatus=new C.b(this.rtc,this,{rtcMuteTimeout:n._peerConnStatusRtcMuteTimeout,outOfLastNTimeout:n._peerConnStatusOutOfLastNTimeout}),this.participantConnectionStatus.init(),!this.statistics){var r=window.location;this.statistics=new P.a(this.xmpp,{callStatsAliasName:this.myUserId(),callStatsConfIDNamespace:n.callStatsConfIDNamespace||r&&r.hostname||n.hosts&&n.hosts.domain,callStatsCustomScriptUrl:n.callStatsCustomScriptUrl,callStatsID:n.callStatsID,callStatsSecret:n.callStatsSecret,roomName:this.options.name})}this.eventManager.setupChatRoomListeners(),this.eventManager.setupStatisticsListeners(),n.enableTalkWhileMuted&&new A.a(this,function(){return e.eventEmitter.emit(v.TALK_WHILE_MUTED)}),"channelLastN"in n&&this.setLastN(n.channelLastN),this.jvb121Status=new T.a(this),this.p2pDominantSpeakerDetection=new w.a(this)},r.prototype.join=function(e){this.room&&this.room.join(e)},r.prototype.authenticateAndUpgradeRole=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return p.a.apply(this,t)},r.prototype.isJoined=function(){return this.room&&this.room.joined},r.prototype.isP2PEnabled=function(){return Boolean(this.options.config.p2p&&this.options.config.p2p.enabled)||void 0===this.options.config.p2p},r.prototype.isP2PTestModeEnabled=function(){return Boolean(this.options.config.testing&&this.options.config.testing.p2pTestMode)},r.prototype.leave=function(){var e=this;if(this.participantConnectionStatus&&(this.participantConnectionStatus.dispose(),this.participantConnectionStatus=null),this.avgRtpStatsReporter&&(this.avgRtpStatsReporter.dispose(),this.avgRtpStatsReporter=null),this.getLocalTracks().forEach(function(t){return e.onLocalTrackRemoved(t)}),this.rtc.closeBridgeChannel(),this.statistics&&this.statistics.dispose(),this.jvbJingleSession&&(this.jvbJingleSession.close(),this.jvbJingleSession=null),this.p2pJingleSession&&(this.p2pJingleSession.close(),this.p2pJingleSession=null),this.room){var t=this.room;return t.removeListener(x.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),t.removeListener(x.CONNECTION_RESTORED,this._onIceConnectionRestored),t.removeListener(x.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),this.room=null,t.leave().catch(function(){e.getParticipants().forEach(function(t){return e.onMemberLeft(t.getJid())})})}return Promise.reject(new Error("The conference is has been already left"))},r.prototype.getName=function(){return this.options.name},r.prototype.isAuthEnabled=function(){return this.authEnabled},r.prototype.isLoggedIn=function(){return Boolean(this.authIdentity)},r.prototype.getAuthLogin=function(){return this.authIdentity},r.prototype.isExternalAuthEnabled=function(){return this.room&&this.room.moderator.isExternalAuthEnabled()},r.prototype.getExternalAuthUrl=function(e){var t=this;return new Promise(function(n,r){if(!t.isExternalAuthEnabled())return void r();e?t.room.moderator.getPopupLoginUrl(n,r):t.room.moderator.getLoginUrl(n,r)})},r.prototype.getLocalTracks=function(e){var t=[];return this.rtc&&(t=this.rtc.getLocalTracks(e)),t},r.prototype.getLocalAudioTrack=function(){return this.rtc?this.rtc.getLocalAudioTrack():null},r.prototype.getLocalVideoTrack=function(){return this.rtc?this.rtc.getLocalVideoTrack():null},r.prototype.on=function(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)},r.prototype.off=function(e,t){this.eventEmitter&&this.eventEmitter.removeListener(e,t)},r.prototype.addEventListener=r.prototype.on,r.prototype.removeEventListener=r.prototype.off,r.prototype.addCommandListener=function(e,t){this.room&&this.room.addPresenceListener(e,t)},r.prototype.removeCommandListener=function(e){this.room&&this.room.removePresenceListener(e)},r.prototype.sendTextMessage=function(e){this.room&&this.room.sendMessage(e)},r.prototype.sendCommand=function(e,t){this.room&&(this.room.addToPresence(e,t),this.room.sendPresence())},r.prototype.sendCommandOnce=function(e,t){this.sendCommand(e,t),this.removeCommand(e)},r.prototype.removeCommand=function(e){this.room&&this.room.removeFromPresence(e)},r.prototype.setDisplayName=function(e){this.room&&(this.room.removeFromPresence("nick"),this.room.addToPresence("nick",{attributes:{xmlns:"http://jabber.org/protocol/nick"},value:e}),this.room.sendPresence())},r.prototype.setSubject=function(e){this.room&&this.isModerator()&&this.room.setSubject(e)},r.prototype.getTranscriber=function(){if(void 0===this.transcriber){this.transcriber=new O.a;var e=this.getLocalTracks(E.a),t=!0,n=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;this.transcriber.addTrack(a)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var s=this.rtc.getRemoteTracks(E.a),c=!0,u=!1,l=void 0;try{for(var d,p=s[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value;this.transcriber.addTrack(f)}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}}return this.transcriber},r.prototype.getTranscriptionStatus=function(){return this.room.transcriptionStatus},r.prototype.addTrack=function(e){if(e.isVideoTrack()){var t=this.rtc.getLocalVideoTrack();if(t)return e===t?Promise.resolve(e):Promise.reject(new Error("cannot add second video track to the conference"))}return this.replaceTrack(null,e)},r.prototype._fireAudioLevelChangeEvent=function(e,t){var n=this.getActivePeerConnection();t&&n!==t||this.eventEmitter.emit(v.TRACK_AUDIO_LEVEL_CHANGED,this.myUserId(),e)},r.prototype._fireMuteChangeEvent=function(e){this.isMutedByFocus&&e.isAudioTrack()&&!e.isMuted()&&(this.isMutedByFocus=!1,this.room.muteParticipant(this.room.myroomjid,!1)),this.eventEmitter.emit(v.TRACK_MUTE_CHANGED,e)},r.prototype.onLocalTrackRemoved=function(e){e._setConference(null),this.rtc.removeLocalTrack(e),e.removeEventListener(_.TRACK_MUTE_CHANGED,e.muteHandler),e.removeEventListener(_.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e.isVideoTrack()&&e.videoType===N.a.DESKTOP&&this.statistics.sendScreenSharingEvent(!1),this.eventEmitter.emit(v.TRACK_REMOVED,e)},r.prototype.removeTrack=function(e){return this.replaceTrack(e,null)},r.prototype.replaceTrack=function(e,t){var n=this;return e&&e.disposed?Promise.reject(new b.a(S.TRACK_IS_DISPOSED)):t&&t.disposed?Promise.reject(new b.a(S.TRACK_IS_DISPOSED)):this._doReplaceTrack(e,t).then(function(){return e&&n.onLocalTrackRemoved(e),t&&n._setupNewTrack(t),Promise.resolve()},function(e){return Promise.reject(new Error(e))})},r.prototype._doReplaceTrack=function(e,t){var n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.replaceTrack(e,t)):j.info("_doReplaceTrack - no JVB JingleSession"),this.p2pJingleSession?n.push(this.p2pJingleSession.replaceTrack(e,t)):j.info("_doReplaceTrack - no P2P JingleSession"),Promise.all(n)},r.prototype._setupNewTrack=function(e){if(e.isAudioTrack()||e.isVideoTrack()&&e.videoType!==N.a.DESKTOP){var t=R.a.getCurrentlyAvailableMediaDevices(),n=t.find(function(t){return t.kind===e.getTrack().kind+"input"&&t.label===e.getTrack().label});n&&P.a.sendActiveDeviceListEvent(R.a.getEventDataForActiveDevice(n))}e.isVideoTrack()&&(this.removeCommand("videoType"),this.sendCommand("videoType",{value:e.videoType,attributes:{xmlns:"http://jitsi.org/jitmeet/video"}})),this.rtc.addLocalTrack(e),e.isAudioTrack()?this.room.setAudioMute(e.isMuted()):this.room.setVideoMute(e.isMuted()),e.muteHandler=this._fireMuteChangeEvent.bind(this,e),e.audioLevelHandler=this._fireAudioLevelChangeEvent.bind(this),e.addEventListener(_.TRACK_MUTE_CHANGED,e.muteHandler),e.addEventListener(_.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e._setConference(this),e.isVideoTrack()&&e.videoType===N.a.DESKTOP&&this.statistics.sendScreenSharingEvent(!0),this.eventEmitter.emit(v.TRACK_ADDED,e)},r.prototype._addLocalTrackAsUnmute=function(e){var t=[];return this.jvbJingleSession?t.push(this.jvbJingleSession.addTrackAsUnmute(e)):j.info("Add local MediaStream as unmute - no JVB Jingle session started yet"),this.p2pJingleSession?t.push(this.p2pJingleSession.addTrackAsUnmute(e)):j.info("Add local MediaStream as unmute - no P2P Jingle session started yet"),Promise.all(t)},r.prototype._removeLocalTrackAsMute=function(e){var t=[];return this.jvbJingleSession?t.push(this.jvbJingleSession.removeTrackAsMute(e)):j.info("Remove local MediaStream - no JVB JingleSession started yet"),this.p2pJingleSession?t.push(this.p2pJingleSession.removeTrackAsMute(e)):j.info("Remove local MediaStream - no P2P JingleSession started yet"),Promise.all(t)},r.prototype.getRole=function(){return this.room.role},r.prototype.isModerator=function(){return this.room?this.room.isModerator():null},r.prototype.lock=function(e){var t=this;return this.isModerator()?new Promise(function(n,r){t.room.lockRoom(e||"",function(){return n()},function(e){return r(e)},function(){return r(f.PASSWORD_NOT_SUPPORTED)})}):Promise.reject()},r.prototype.unlock=function(){return this.lock()},r.prototype.selectParticipant=function(e){this.rtc.selectEndpoint(e)},r.prototype.pinParticipant=function(e){this.rtc.pinEndpoint(e)},r.prototype.getLastN=function(){return this.rtc.getLastN()},r.prototype.setLastN=function(e){if(!Number.isInteger(e)&&!Number.parseInt(e,10))throw new Error("Invalid value for lastN: "+e);var t=Number(e);if(t<-1)throw new RangeError("lastN cannot be smaller than -1");if(this.rtc.setLastN(t),this.p2pJingleSession){var n=0!==t;this.p2pJingleSession.setMediaTransferActive(!0,n).catch(function(e){j.error("Failed to adjust video transfer status ("+n+")",e)})}},r.prototype.isInLastN=function(e){return this.rtc.isInLastN(e)},r.prototype.getParticipants=function(){return Object.keys(this.participants).map(function(e){return this.participants[e]},this)},r.prototype.getParticipantCount=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getParticipants();return e||(t=t.filter(function(e){return!e.isHidden()})),t.length+1},r.prototype.getParticipantById=function(e){return this.participants[e]},r.prototype.kickParticipant=function(e){var t=this.getParticipantById(e);t&&this.room.kick(t.getJid())},r.prototype.muteParticipant=function(e){var t=this.getParticipantById(e);t&&this.room.muteParticipant(t.getJid(),!0)},r.prototype.onMemberJoined=function(e,t,n,r){var i=this,o=Strophe.getResourceFromJid(e);if("focus"!==o&&this.myUserId()!==o){var a=new y.a(e,this,t,r);a._role=n,this.participants[o]=a,this.eventEmitter.emit(v.USER_JOINED,o,a),this.xmpp.caps.getFeatures(e).then(function(e){a._supportsDTMF=e.has("urn:xmpp:jingle:dtmf:0"),i.updateDTMFSupport()},function(t){return j.error("Failed to discover features of "+e,t)}),this._maybeStartOrStopP2P()}},r.prototype.onMemberLeft=function(e){var t=this,n=Strophe.getResourceFromJid(e);if("focus"!==n&&this.myUserId()!==n){var r=this.participants[n];delete this.participants[n],this.rtc.removeRemoteTracks(n).forEach(function(e){return t.eventEmitter.emit(v.TRACK_REMOVED,e)}),r&&this.eventEmitter.emit(v.USER_LEFT,n,r),this._maybeStartOrStopP2P(!0)}},r.prototype.onLocalRoleChanged=function(e){this.eventEmitter.emit(v.USER_ROLE_CHANGED,this.myUserId(),e),this._maybeStartOrStopP2P()},r.prototype.onUserRoleChanged=function(e,t){var n=Strophe.getResourceFromJid(e),r=this.getParticipantById(n);r&&(r._role=t,this.eventEmitter.emit(v.USER_ROLE_CHANGED,n,t))},r.prototype.onDisplayNameChanged=function(e,t){var n=Strophe.getResourceFromJid(e),r=this.getParticipantById(n);r&&r._displayName!==t&&(r._displayName=t,this.eventEmitter.emit(v.DISPLAY_NAME_CHANGED,n,t))},r.prototype.onRemoteTrackAdded=function(e){var t=this;if(e.isP2P&&!this.isP2PActive())return void j.info("Trying to add remote P2P track, when not in P2P - IGNORED");if(!e.isP2P&&this.isP2PActive())return void j.info("Trying to add remote JVB track, when in P2P - IGNORED");var n=e.getParticipantId(),r=this.getParticipantById(n);if(!r)return void j.error("No participant found for id: "+n);r._tracks.push(e),this.transcriber&&this.transcriber.addTrack(e);var i=this.eventEmitter;e.addEventListener(_.TRACK_MUTE_CHANGED,function(){return i.emit(v.TRACK_MUTE_CHANGED,e)}),e.addEventListener(_.TRACK_AUDIO_LEVEL_CHANGED,function(e,r){t.getActivePeerConnection()===r&&i.emit(v.TRACK_AUDIO_LEVEL_CHANGED,n,e)}),i.emit(v.TRACK_ADDED,e)},r.prototype.onCallAccepted=function(e,t){this.p2pJingleSession===e&&(j.info("P2P setAnswer"),this.p2pJingleSession.setAnswer(t))},r.prototype.onTransportInfo=function(e,t){this.p2pJingleSession===e&&(j.info("P2P addIceCandidates"),this.p2pJingleSession.addIceCandidates(t))},r.prototype.onRemoteTrackRemoved=function(e){var t=this;this.getParticipants().forEach(function(n){for(var r=n.getTracks(),i=0;i<r.length;i++)if(r[i]===e){n._tracks.splice(i,1),t.eventEmitter.emit(v.TRACK_REMOVED,e),t.transcriber&&t.transcriber.removeTrack(e);break}},this)},r.prototype.onIncomingCall=function(e,t,n){var r=this;if(e.isP2P)return void("moderator"!==this.room.getMemberRole(e.peerjid)?this._rejectIncomingCallNonModerator(e):k.a.isP2PSupported()?this.isP2PEnabled()||this.isP2PTestModeEnabled()?this.p2pJingleSession?this._rejectIncomingCall(e,{reasonTag:"busy",reasonMsg:"P2P already in progress",errorMsg:'Duplicated P2P "session-initiate"'}):this._acceptP2PIncomingCall(e,t):this._rejectIncomingCall(e,{reasonTag:"decline",reasonMsg:"P2P disabled",errorMsg:"P2P mode disabled in the configuration"}):this._rejectIncomingCall(e,{reasonTag:"unsupported-applications",reasonMsg:"P2P not supported",errorMsg:"This client does not support P2P connections"}));if(!this.room.isFocus(e.peerjid))return void this._rejectIncomingCall(e);this.jvbJingleSession=e,this.room.connectionTimes["session.initiate"]=n,this.wasStopped&&P.a.sendEventToAll("session.restart");var i=null;this.options.config&&this.options.config.deploymentInfo&&void 0!==this.options.config.deploymentInfo.crossRegion&&(i=this.options.config.deploymentInfo.crossRegion),P.a.analytics.sendEvent("session.initiate",{value:n-this.room.connectionTimes["muc.joined"],label:i});try{e.initialize(!1,this.room,this.rtc)}catch(e){u.a.callErrorHandler(e)}this._setBridgeChannel(t,e.peerconnection);try{e.acceptOffer(t,function(){r.isP2PActive()&&r.jvbJingleSession&&r._suspendMediaTransferForJvbConnection()},function(e){u.a.callErrorHandler(e),j.error("Failed to accept incoming Jingle session",e)},this.getLocalTracks()),j.info("Starting CallStats for JVB connection..."),this.statistics.startCallStats(this.jvbJingleSession.peerconnection,"jitsi"),this.statistics.startRemoteStats(this.jvbJingleSession.peerconnection)}catch(e){u.a.callErrorHandler(e),j.error(e)}},r.prototype._setBridgeChannel=function(e,t){var n=null,r=$(e).find(">content>transport>web-socket").first();1===r.length&&(n=r[0].getAttribute("url"));var i=void 0;switch(this.options.config.openBridgeChannel){case"datachannel":case!0:case void 0:i="datachannel";break;case"websocket":i="websocket"}"datachannel"!==i||k.a.supportsDataChannels()||(i="websocket"),"datachannel"===i?this.rtc.initializeBridgeChannel(t,null):"websocket"===i&&n&&this.rtc.initializeBridgeChannel(null,n)},r.prototype._rejectIncomingCallNonModerator=function(e){this._rejectIncomingCall(e,{reasonTag:"security-error",reasonMsg:"Only focus can start new sessions",errorMsg:"Rejecting session-initiate from non-focus andnon-moderator user: "+e.peerjid})},r.prototype._rejectIncomingCall=function(e,t){t&&t.errorMsg&&u.a.callErrorHandler(new Error(t.errorMsg)),e.terminate(null,function(e){j.warn("An error occurred while trying to terminate invalid Jingle session",e)},{reason:t&&t.reasonTag,reasonDescription:t&&t.reasonMsg,sendSessionTerminate:!0})},r.prototype.onCallEnded=function(e,t,n){j.info("Call ended: "+t+" - "+n+" P2P ?"+e.isP2P),e===this.jvbJingleSession?(this.wasStopped=!0,P.a.sendEventToAll("session.terminate"),this.statistics&&(this.statistics.stopRemoteStats(this.jvbJingleSession.peerconnection),j.info("Stopping JVB CallStats"),this.statistics.stopCallStats(this.jvbJingleSession.peerconnection)),this.jvbJingleSession=null,this.rtc.onCallEnded()):e===this.p2pJingleSession?("decline"===t&&"force JVB121"===n?(j.info("In forced JVB 121 mode..."),P.a.analytics.addPermanentProperties({forceJvb121:!0})):"connectivity-error"===t&&"ICE FAILED"===n&&P.a.analytics.addPermanentProperties({p2pFailed:!0}),this._stopP2PSession()):j.error("Received onCallEnded for invalid session",e.sid,e.peerjid,t,n)},r.prototype.onSuspendDetected=function(e){e.isP2P||(this.leave(),this.eventEmitter.emit(v.SUSPEND_DETECTED))},r.prototype.updateDTMFSupport=function(){for(var e=!1,t=this.getParticipants(),n=0;n<t.length;n+=1)if(t[n].supportsDTMF()){e=!0;break}e!==this.somebodySupportsDTMF&&(this.somebodySupportsDTMF=e,this.eventEmitter.emit(v.DTMF_SUPPORT_CHANGED,e))},r.prototype.isDTMFSupported=function(){return this.somebodySupportsDTMF},r.prototype.myUserId=function(){return this.room&&this.room.myroomjid?Strophe.getResourceFromJid(this.room.myroomjid):null},r.prototype.sendTones=function(e,t,n){if(!this.dtmfManager){var r=this.getActivePeerConnection();if(!r)return void j.warn("cannot sendTones: no peer connection");var i=this.getLocalAudioTrack();if(!i)return void j.warn("cannot sendTones: no local audio stream");this.dtmfManager=new g.a(i,r)}this.dtmfManager.sendTones(e,t,n)},r.prototype.isRecordingSupported=function(){return!!this.room&&this.room.isRecordingSupported()},r.prototype.getRecordingState=function(){return this.room?this.room.getRecordingState():void 0},r.prototype.getRecordingURL=function(){return this.room?this.room.getRecordingURL():null},r.prototype.toggleRecording=function(e){var t=this;if(this.room)return this.room.toggleRecording(e,function(e,n){t.eventEmitter.emit(v.RECORDER_STATE_CHANGED,e,n)});this.eventEmitter.emit(v.RECORDER_STATE_CHANGED,"error",new Error("The conference is not created yet!"))},r.prototype.isSIPCallingSupported=function(){return!!this.room&&this.room.isSIPCallingSupported()},r.prototype.dial=function(e){return this.room?this.room.dial(e):new Promise(function(e,t){t(new Error("The conference is not created yet!"))})},r.prototype.hangup=function(){return this.room?this.room.hangup():new Promise(function(e,t){t(new Error("The conference is not created yet!"))})},r.prototype.startTranscriber=function(){return this.dial("jitsi_meet_transcribe")},r.prototype.stopTranscriber=r.prototype.hangup,r.prototype.getPhoneNumber=function(){return this.room?this.room.getPhoneNumber():null},r.prototype.getPhonePin=function(){return this.room?this.room.getPhonePin():null},r.prototype.getActivePeerConnection=function(){return this.isP2PActive()?this.p2pJingleSession.peerconnection:this.jvbJingleSession?this.jvbJingleSession.peerconnection:null},r.prototype.getConnectionState=function(){var e=this.getActivePeerConnection();return e?e.getConnectionState():null},r.prototype.setStartMutedPolicy=function(e){this.isModerator()&&(this.startMutedPolicy=e,this.room.removeFromPresence("startmuted"),this.room.addToPresence("startmuted",{attributes:{audio:e.audio,video:e.video,xmlns:"http://jitsi.org/jitmeet/start-muted"}}),this.room.sendPresence())},r.prototype.getStartMutedPolicy=function(){return this.startMutedPolicy},r.prototype.isStartAudioMuted=function(){return this.startAudioMuted},r.prototype.isStartVideoMuted=function(){return this.startVideoMuted},r.prototype.getLogs=function(){var e=this.xmpp.getJingleLog(),t={};t.time=new Date,t.url=window.location.href,t.ua=navigator.userAgent;var n=this.xmpp.getXmppLog();return n&&(t.xmpp=n),e.metadata=t,e},r.prototype.getConnectionTimes=function(){return this.room.connectionTimes},r.prototype.setLocalParticipantProperty=function(e,t){this.sendCommand("jitsi_participant_"+e,{value:t})},r.prototype.sendFeedback=function(e,t){this.statistics.sendFeedback(e,t)},r.prototype.isCallstatsEnabled=function(){return this.statistics.isCallstatsEnabled()},r.prototype._onTrackAttach=function(e,t){var n=e.isLocal(),r=null,i=e.isP2P,o=i?e.getParticipantId():"jitsi",a=i?this.p2pJingleSession&&this.p2pJingleSession.peerconnection:this.jvbJingleSession&&this.jvbJingleSession.peerconnection;n?a&&(r=a.getLocalSSRC(e)):r=e.getSSRC(),t.id&&r&&a&&this.statistics.associateStreamWithVideoTag(a,r,n,o,e.getUsageLabel(),t.id)},r.prototype.sendApplicationLog=function(e){P.a.sendLog(e)},r.prototype._isFocus=function(e){return this.room?this.room.isFocus(e):null},r.prototype._fireIncompatibleVersionsEvent=function(){this.eventEmitter.emit(v.CONFERENCE_FAILED,f.INCOMPATIBLE_SERVER_VERSIONS)},r.prototype.sendEndpointMessage=function(e,t){this.rtc.sendChannelMessage(e,t)},r.prototype.broadcastEndpointMessage=function(e){this.sendEndpointMessage("",e)},r.prototype.isConnectionInterrupted=function(){return this.isP2PActive()?this.isP2PConnectionInterrupted:this.isJvbConnectionInterrupted},r.prototype._onIceConnectionInterrupted=function(e){e.isP2P?this.isP2PConnectionInterrupted=!0:this.isJvbConnectionInterrupted=!0,e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(v.CONNECTION_INTERRUPTED)},r.prototype._onIceConnectionFailed=function(e){e.isP2P&&(P.a.analytics.addPermanentProperties({p2pFailed:!0}),this.p2pJingleSession&&this.p2pJingleSession.isInitiator&&P.a.sendEventToAll("p2p.failed"),this._stopP2PSession("connectivity-error","ICE FAILED"))},r.prototype._onIceConnectionRestored=function(e){e.isP2P?this.isP2PConnectionInterrupted=!1:this.isJvbConnectionInterrupted=!1,e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(v.CONNECTION_RESTORED)},r.prototype._acceptP2PIncomingCall=function(e,t){this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=e,this.p2pJingleSession.initialize(!1,this.room,this.rtc),j.info("Starting CallStats for P2P connection..."),this.statistics.startCallStats(this.p2pJingleSession.peerconnection,Strophe.getResourceFromJid(this.p2pJingleSession.peerjid));var n=this.getLocalTracks();this.p2pJingleSession.acceptOffer(t,function(){j.debug('Got RESULT for P2P "session-accept"')},function(e){j.error("Failed to accept incoming P2P Jingle session",e)},n)},r.prototype._addRemoteJVBTracks=function(){this._addRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},r.prototype._addRemoteP2PTracks=function(){this._addRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},r.prototype._addRemoteTracks=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;j.info("Adding remote "+e+" track: "+s),this.rtc.eventEmitter.emit(I.REMOTE_TRACK_ADDED,s)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}},r.prototype._onIceConnectionEstablished=function(e){null!==this.p2pJingleSession&&(this.p2pEstablishmentDuration=this.p2pJingleSession.establishmentDuration),null!==this.jvbJingleSession&&(this.jvbEstablishmentDuration=this.jvbJingleSession.establishmentDuration);var t=!1,n=this.options.config.forceJVB121Ratio;if(e.isP2P?this.p2pJingleSession!==e?(j.error("CONNECTION_ESTABLISHED - wrong P2P session instance ?!"),t=!0):!e.isInitiator&&"number"==typeof n&&Math.random()<n&&(j.info("Forcing JVB 121 mode (ratio="+n+")..."),P.a.analytics.addPermanentProperties({forceJvb121:!0}),this._stopP2PSession("decline","force JVB121"),t=!0):t=!0,!isNaN(this.p2pEstablishmentDuration)&&!isNaN(this.jvbEstablishmentDuration)){var r=this.p2pEstablishmentDuration-this.jvbEstablishmentDuration;P.a.analytics.sendEvent("ice.establishmentDurationDiff",{value:r})}t||(this._setP2PStatus(!0),this.jvbJingleSession?this._removeRemoteJVBTracks():j.info("Not removing remote JVB tracks - no session yet"),this._addRemoteP2PTracks(),this.jvbJingleSession&&this._suspendMediaTransferForJvbConnection(),j.info("Starting remote stats with p2p connection"),this.statistics.startRemoteStats(this.p2pJingleSession.peerconnection),this.p2pJingleSession.isInitiator&&P.a.sendEventToAll("p2p.established"))},r.prototype._maybeClearDeferredStartP2P=function(){this.deferredStartP2PTask&&(j.info("Cleared deferred start P2P task"),clearTimeout(this.deferredStartP2PTask),this.deferredStartP2PTask=null)},r.prototype._removeRemoteJVBTracks=function(){this._removeRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},r.prototype._removeRemoteP2PTracks=function(){this._removeRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},r.prototype._removeRemoteTracks=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;j.info("Removing remote "+e+" track: "+s),this.rtc.eventEmitter.emit(I.REMOTE_TRACK_REMOVED,s)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}},r.prototype._resumeMediaTransferForJvbConnection=function(){j.info("Resuming media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!0,!0).then(function(){j.info("Resumed media transfer over the JVB connection!")},function(e){j.error("Failed to resume media transfer over the JVB connection:",e)})},r.prototype._setP2PStatus=function(e){if(this.p2p===e)return void j.debug("Called _setP2PStatus with the same status: "+e);if(this.p2p=e,e){j.info("Peer to peer connection established!"),P.a.analytics.addPermanentProperties({p2pFailed:!1,forceJvb121:!1});var t=0!==this.rtc.getLastN();this.p2pJingleSession.setMediaTransferActive(!0,t).catch(function(e){j.error("Failed to sync up P2P video transfer status("+t+")",e)})}else j.info("Peer to peer connection closed!");this.jvbJingleSession&&this.statistics.sendConnectionResumeOrHoldEvent(this.jvbJingleSession.peerconnection,!e),this.dtmfManager=null,this.eventEmitter.emit(v.P2P_STATUS,this,this.p2p),this.eventEmitter.emit(this.isConnectionInterrupted()?v.CONNECTION_INTERRUPTED:v.CONNECTION_RESTORED)},r.prototype._startP2PSession=function(e){if(this._maybeClearDeferredStartP2P(),this.p2pJingleSession)return void j.error("P2P session already started!");this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=this.xmpp.connection.jingle.newP2PJingleSession(this.room.myroomjid,e),j.info("Created new P2P JingleSession",this.room.myroomjid,e),this.p2pJingleSession.initialize(!0,this.room,this.rtc),j.info("Starting CallStats for P2P connection..."),this.statistics.startCallStats(this.p2pJingleSession.peerconnection,Strophe.getResourceFromJid(this.p2pJingleSession.peerjid));var t=this.getLocalTracks();this.p2pJingleSession.invite(t)},r.prototype._suspendMediaTransferForJvbConnection=function(){j.info("Suspending media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!1,!1).then(function(){j.info("Suspended media transfer over the JVB connection !")},function(e){j.error("Failed to suspend media transfer over the JVB connection:",e)})},r.prototype._maybeStartOrStopP2P=function(e){if(!k.a.isP2PSupported()||!this.isP2PEnabled()||this.isP2PTestModeEnabled())return void j.info("Auto P2P disabled");var t=this.getParticipants(),n=t.length,r=this.isModerator(),i=1===n;if(j.debug("P2P? isModerator: "+r+", peerCount: "+n+" => "+i),!i&&this.deferredStartP2PTask&&this._maybeClearDeferredStartP2P(),r&&!this.p2pJingleSession&&i){var o=n&&t[0];if(r&&"moderator"===o.getRole()){var a=this.myUserId(),s=o.getId();if(a>s)return void j.debug("Everyone's a moderator - the other peer should start P2P",a,s);if(a===s)return void j.error("The same IDs ? ",a,s)}var c=o.getJid();if(e){if(this.deferredStartP2PTask)return void j.error("Deferred start P2P task's been set already!");j.info("Will start P2P with: "+c+" after "+this.backToP2PDelay+" seconds..."),this.deferredStartP2PTask=setTimeout(this._startP2PSession.bind(this,c),1e3*this.backToP2PDelay)}else j.info("Will start P2P with: "+c),this._startP2PSession(c)}else this.p2pJingleSession&&!i&&(j.info("Will stop P2P with: "+this.p2pJingleSession.peerjid),this.p2pJingleSession.isInitiator&&n>1&&P.a.sendEventToAll("p2p.switch_to_jvb"),this._stopP2PSession())},r.prototype._stopP2PSession=function(e,t){if(!this.p2pJingleSession)return void j.error("No P2P session to be stopped!");var n=this.isP2PActive();n&&(this.jvbJingleSession&&this._resumeMediaTransferForJvbConnection(),this._removeRemoteP2PTracks()),j.info("Stopping remote stats for P2P connection"),this.statistics.stopRemoteStats(this.p2pJingleSession.peerconnection),j.info("Stopping CallStats for P2P connection"),this.statistics.stopCallStats(this.p2pJingleSession.peerconnection),this.p2pJingleSession.terminate(function(){j.info("P2P session terminate RESULT")},function(t){e&&j.error("An error occurred while trying to terminate P2P Jingle session",t)},{reason:e||"success",reasonDescription:t||"Turing off P2P session",sendSessionTerminate:this.room&&this.getParticipantById(Strophe.getResourceFromJid(this.p2pJingleSession.peerjid))}),this.p2pJingleSession=null,this._setP2PStatus(!1),n&&(this.jvbJingleSession?this._addRemoteJVBTracks():j.info("Not adding remote JVB tracks - no session yet"))},r.prototype.isP2PActive=function(){return this.p2p},r.prototype.getP2PConnectionState=function(){return this.isP2PActive()?this.p2pJingleSession.peerconnection.getConnectionState():null},r.prototype.startP2PSession=function(){var e=this.getParticipants();if(1!==e.length)throw new Error("There must be exactly 1 participant to start the P2P session !");var t=e[0].getJid();this._startP2PSession(t)},r.prototype.stopP2PSession=function(){this._stopP2PSession()},r.prototype.getSpeakerStats=function(){return this.speakerStatsCollector.getStats()},r.prototype.setReceiverVideoConstraint=function(e){this.rtc.setReceiverVideoConstraint(e)},r.prototype._getVideoSIPGWHandle=function(){return this.videoSIPGWHandler||(this.videoSIPGWHandler=new M.a(this.room),j.info("Created VideoSIPGW")),this.videoSIPGWHandler},r.prototype.isVideoSIPGWAvailable=function(){return this._getVideoSIPGWHandle().isVideoSIPGWAvailable()},r.prototype.createVideoSIPGWSession=function(e,t){return this.room?this._getVideoSIPGWHandle().createVideoSIPGWSession(e,t):null}}).call(t,"JitsiConference.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(27)),a=n(4),s=n(3),c=n(1),u=n(5),l=n(14),d=(n.n(l),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),p=Object(i.getLogger)(e),f=function(){function e(t){r(this,e),this.name=t,this.count=0,this.sum=0,this.samples=[]}return d(e,[{key:"addNext",value:function(e){"number"!=typeof e?p.error(this.name+" - invalid value for idx: "+this.count,e):isNaN(e)||(this.sum+=e,this.samples.push(e),this.count+=1)}},{key:"calculate",value:function(){return this.sum/this.count}},{key:"appendReport",value:function(e){e[this.name]={value:this.calculate(),samples:this.samples}}},{key:"reset",value:function(){this.samples=[],this.sum=0,this.count=0}}]),e}(),h=function(){function e(t,n,i){var s=this;r(this,e),this.isP2P=n,this._n=i,this._sampleIdx=0,this._avgRTT=new f("stat_avg_rtt"),this._avgRemoteRTTMap=new Map,this._avgRtpStatsReporter=t,this._avgEnd2EndRTT=void 0,this._onConnectionStats=function(e,t){s.isP2P===e.isP2P&&s._calculateAvgStats(t)};var c=t._conference;c.statistics.addConnectionStatsListener(this._onConnectionStats),this.isP2P||(this._onUserLeft=function(e){return s._avgRemoteRTTMap.delete(e)},c.on(a.USER_LEFT,this._onUserLeft),this._onRemoteStatsUpdated=function(e,t){return s._processRemoteStats(e,t)},c.on(o.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated))}return d(e,[{key:"_calculateAvgStats",value:function(e){if(!e)return void p.error("No stats");if(c.a.supportsRTTStatistics()&&e.transport&&e.transport.length&&this._avgRTT.addNext(e.transport[0].rtt),this._sampleIdx+=1,this._sampleIdx>=this._n){if(c.a.supportsRTTStatistics()){var t=this._avgRtpStatsReporter._conference,n={p2p:this.isP2P,size:t.getParticipantCount()};if(e.transport&&e.transport.length&&Object.assign(n,{localCandidateType:e.transport[0].localCandidateType,remoteCandidateType:e.transport[0].remoteCandidateType,transportType:e.transport[0].type}),this._avgRTT.appendReport(n),this.isP2P){var r=this._avgRtpStatsReporter.jvbStatsMonitor._avgEnd2EndRTT;if(!isNaN(r)){var i=this._avgRTT.calculate()-r;n.stat_avg_rtt_diff={value:i}}}else{var o=this._calculateAvgRemoteRTT(),a=this._avgRTT.calculate();this._avgEnd2EndRTT=a+o,isNaN(a)||isNaN(o)||(n.stat_avg_end2endrtt={value:this._avgEnd2EndRTT})}u.a.analytics.sendEvent("avg.rtp.stats",n)}this._resetAvgStats()}}},{key:"_calculateAvgRemoteRTT",value:function(){var e=0,t=0,n=!0,r=!1,i=void 0;try{for(var o,a=this._avgRemoteRTTMap.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=s.calculate();isNaN(c)||(t+=c,e+=1,s.reset())}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t/e}},{key:"_processRemoteStats",value:function(e,t){var n="number"==typeof t.jvbRTT,r=this._avgRemoteRTTMap.get(e);!r&&n&&(r=new f(e+"_stat_rtt"),this._avgRemoteRTTMap.set(e,r)),n?r.addNext(t.jvbRTT):r&&this._avgRemoteRTTMap.delete(e)}},{key:"_resetAvgStats",value:function(){this._avgRTT.reset(),this._avgRemoteRTTMap&&this._avgRemoteRTTMap.clear(),this._sampleIdx=0}},{key:"dispose",value:function(){var e=this._avgRtpStatsReporter._conference;e.statistics.removeConnectionStatsListener(this._onConnectionStats),this.isP2P||(e.off(o.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated),e.off(a.USER_LEFT,this._onUserLeft))}}]),e}(),v=function(){function e(t,n){var i=this;if(r(this,e),this._n=n,!(n>0))return void p.info("Avg RTP stats reports are disabled.");p.info("Avg RTP stats will be calculated every "+n+" samples"),this._sampleIdx=0,this._conference=t,this._avgAudioBitrateUp=new f("stat_avg_bitrate_audio_upload"),this._avgAudioBitrateDown=new f("stat_avg_bitrate_audio_download"),this._avgVideoBitrateUp=new f("stat_avg_bitrate_video_upload"),this._avgVideoBitrateDown=new f("stat_avg_bitrate_video_download"),this._avgBandwidthUp=new f("stat_avg_bandwidth_upload"),this._avgBandwidthDown=new f("stat_avg_bandwidth_download"),this._avgPacketLossTotal=new f("stat_avg_packetloss_total"),this._avgPacketLossUp=new f("stat_avg_packetloss_upload"),this._avgPacketLossDown=new f("stat_avg_packetloss_download"),this._avgRemoteFPS=new f("stat_avg_framerate_remote"),this._avgRemoteScreenFPS=new f("stat_avg_framerate_screen_remote"),this._avgLocalFPS=new f("stat_avg_framerate_local"),this._avgLocalScreenFPS=new f("stat_avg_framerate_screen_local"),this._avgRemoteCameraPixels=new f("stat_avg_pixels_remote"),this._avgRemoteScreenPixels=new f("stat_avg_pixels_screen_remote"),this._avgLocalCameraPixels=new f("stat_avg_pixels_local"),this._avgLocalScreenPixels=new f("stat_avg_pixels_screen_local"),this._avgCQ=new f("stat_avg_cq"),this._onLocalStatsUpdated=function(e){return i._calculateAvgStats(e)},t.on(o.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._onP2PStatusChanged=function(){p.debug("Resetting average stats calculation"),i._resetAvgStats(),i.jvbStatsMonitor._resetAvgStats(),i.p2pStatsMonitor._resetAvgStats()},t.on(a.P2P_STATUS,this._onP2PStatusChanged),this._onJvb121StatusChanged=function(e,t){!0===t&&(p.info("Resetting JVB avg RTP stats"),i._resetAvgJvbStats())},t.on(a.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor=new h(this,!1,n),this.p2pStatsMonitor=new h(this,!0,n)}return d(e,[{key:"_calculateAvgStats",value:function(e){if(!e)return void p.error("No stats");var t=this._conference.isP2PActive(),n=this._conference.getParticipantCount();if(t||!(n<2)){var r=e.bitrate,i=e.bandwidth,o=e.packetLoss,a=e.framerate,s=e.resolution;if(!r)return void p.error('No "bitrate"');if(!i)return void p.error('No "bandwidth"');if(!o)return void p.error('No "packetloss"');if(!a)return void p.error('No "framerate"');if(!s)return void p.error("No resolution");if(this._avgAudioBitrateUp.addNext(r.audio.upload),this._avgAudioBitrateDown.addNext(r.audio.download),this._avgVideoBitrateUp.addNext(r.video.upload),this._avgVideoBitrateDown.addNext(r.video.download),c.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.addNext(i.upload),this._avgBandwidthDown.addNext(i.download)),this._avgPacketLossUp.addNext(o.upload),this._avgPacketLossDown.addNext(o.download),this._avgPacketLossTotal.addNext(o.total),this._avgCQ.addNext(e.connectionQuality),a&&(this._avgRemoteFPS.addNext(this._calculateAvgVideoFps(a,!1,l.CAMERA)),this._avgRemoteScreenFPS.addNext(this._calculateAvgVideoFps(a,!1,l.DESKTOP)),this._avgLocalFPS.addNext(this._calculateAvgVideoFps(a,!0,l.CAMERA)),this._avgLocalScreenFPS.addNext(this._calculateAvgVideoFps(a,!0,l.DESKTOP))),s&&(this._avgRemoteCameraPixels.addNext(this._calculateAvgVideoPixels(s,!1,l.CAMERA)),this._avgRemoteScreenPixels.addNext(this._calculateAvgVideoPixels(s,!1,l.DESKTOP)),this._avgLocalCameraPixels.addNext(this._calculateAvgVideoPixels(s,!0,l.CAMERA)),this._avgLocalScreenPixels.addNext(this._calculateAvgVideoPixels(s,!0,l.DESKTOP))),this._sampleIdx+=1,this._sampleIdx>=this._n){var d={p2p:t,size:n};e.transport&&e.transport.length&&Object.assign(d,{localCandidateType:e.transport[0].localCandidateType,remoteCandidateType:e.transport[0].remoteCandidateType,transportType:e.transport[0].type}),this._avgAudioBitrateUp.appendReport(d),this._avgAudioBitrateDown.appendReport(d),this._avgVideoBitrateUp.appendReport(d),this._avgVideoBitrateDown.appendReport(d),c.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.appendReport(d),this._avgBandwidthDown.appendReport(d)),this._avgPacketLossUp.appendReport(d),this._avgPacketLossDown.appendReport(d),this._avgPacketLossTotal.appendReport(d),this._avgRemoteFPS.appendReport(d),isNaN(this._avgRemoteScreenFPS.calculate())||this._avgRemoteScreenFPS.appendReport(d),this._avgLocalFPS.appendReport(d),isNaN(this._avgLocalScreenFPS.calculate())||this._avgLocalScreenFPS.appendReport(d),this._avgRemoteCameraPixels.appendReport(d),isNaN(this._avgRemoteScreenPixels.calculate())||this._avgRemoteScreenPixels.appendReport(d),this._avgLocalCameraPixels.appendReport(d),isNaN(this._avgLocalScreenPixels.calculate())||this._avgLocalScreenPixels.appendReport(d),this._avgCQ.appendReport(d),u.a.analytics.sendEvent("avg.rtp.stats",d),this._resetAvgStats()}}}},{key:"_calculateAvgVideoPixels",value:function(e,t,n){var r=0,i=0,o=this._conference.myUserId(),a=!0,s=!1,c=void 0;try{for(var u,l=Object.keys(e)[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;if(t?d===o:d!==o){var p=t?null:this._conference.getParticipantById(d),f=e[d];if((t||p)&&f){var h=this._calculatePeerAvgVideoPixels(f,p,n);isNaN(h)||(r+=h,i+=1)}}}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return r/i}},{key:"_calculatePeerAvgVideoPixels",value:function(e,t,n){var r=Object.keys(e).map(function(e){return Number(e)}),i=null,o=this._conference.getActivePeerConnection();t?(i=t.getTracksByMediaType(s.b))&&(r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n})})):(i=this._conference.getLocalTracks(s.b),r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&o.getLocalSSRC(t)===e&&t.videoType===n})}));var a=0,c=0,u=!0,l=!1,d=void 0;try{for(var p,f=r[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value,v=Number(e[h].height)*Number(e[h].width);!isNaN(v)&&v>0&&(a+=v,c+=1)}}catch(e){l=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(l)throw d}}return a/c}},{key:"_calculateAvgVideoFps",value:function(e,t,n){var r=0,i=0,o=this._conference.myUserId(),a=!0,s=!1,c=void 0;try{for(var u,l=Object.keys(e)[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;if(t?d===o:d!==o){var p=t?null:this._conference.getParticipantById(d),f=e[d];if((t||p)&&f){var h=this._calculatePeerAvgVideoFps(f,p,n);isNaN(h)||(r+=h,i+=1)}}}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}return r/i}},{key:"_calculatePeerAvgVideoFps",value:function(e,t,n){var r=Object.keys(e).map(function(e){return Number(e)}),i=null,o=this._conference.getActivePeerConnection();t?(i=t.getTracksByMediaType(s.b))&&(r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n})})):(i=this._conference.getLocalTracks(s.b),r=r.filter(function(e){return i.find(function(t){return!t.isMuted()&&o.getLocalSSRC(t)===e&&t.videoType===n})}));var a=0,c=0,u=!0,l=!1,d=void 0;try{for(var p,f=r[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value,v=Number(e[h]);!isNaN(v)&&v>0&&(a+=v,c+=1)}}catch(e){l=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(l)throw d}}return a/c}},{key:"_resetAvgJvbStats",value:function(){this._resetAvgStats(),this.jvbStatsMonitor._resetAvgStats()}},{key:"_resetAvgStats",value:function(){this._avgAudioBitrateUp.reset(),this._avgAudioBitrateDown.reset(),this._avgVideoBitrateUp.reset(),this._avgVideoBitrateDown.reset(),this._avgBandwidthUp.reset(),this._avgBandwidthDown.reset(),this._avgPacketLossUp.reset(),this._avgPacketLossDown.reset(),this._avgPacketLossTotal.reset(),this._avgRemoteFPS.reset(),this._avgRemoteScreenFPS.reset(),this._avgLocalFPS.reset(),this._avgLocalScreenFPS.reset(),this._avgRemoteCameraPixels.reset(),this._avgRemoteScreenPixels.reset(),this._avgLocalCameraPixels.reset(),this._avgLocalScreenPixels.reset(),this._avgCQ.reset(),this._sampleIdx=0}},{key:"dispose",value:function(){this._conference.off(a.P2P_STATUS,this._onP2PStatusChanged),this._conference.off(o.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._conference.off(a.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor.dispose(),this.p2pStatsMonitor.dispose()}}]),e}();t.a=v}).call(t,"modules/statistics/AvgRTPStatsReporter.js")},function(e,t,n){function r(e,t){this.logStorage=e,this.stringifyObjects=!(!t||!t.stringifyObjects)&&t.stringifyObjects,this.storeInterval=t&&t.storeInterval?t.storeInterval:3e4,this.maxEntryLength=t&&t.maxEntryLength?t.maxEntryLength:1e4,Object.keys(o.levels).forEach(function(e){this[o.levels[e]]=function(e){this._log.apply(this,arguments)}.bind(this,e)}.bind(this)),this.storeLogsIntervalID=null,this.queue=[],this.totalLen=0,this.outputCache=[]}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(35);r.prototype.stringify=function(e){try{return JSON.stringify(e)}catch(e){return"[object with circular refs?]"}},r.prototype.formatLogMessage=function(e){for(var t="",n=1,r=arguments.length;n<r;n++){var a=arguments[n];!this.stringifyObjects&&e!==o.levels.ERROR||"object"!==(void 0===a?"undefined":i(a))||(a=this.stringify(a)),t+=a,n!=r-1&&(t+=" ")}return t.length?t:null},r.prototype._log=function(){var e=this.formatLogMessage.apply(this,arguments);if(e){var t=this.queue.length?this.queue[this.queue.length-1]:void 0;("object"===(void 0===t?"undefined":i(t))?t.text:t)==e?"object"===(void 0===t?"undefined":i(t))?t.count+=1:this.queue[this.queue.length-1]={text:e,count:2}:(this.queue.push(e),this.totalLen+=e.length)}this.totalLen>=this.maxEntryLength&&this._flush(!0,!0)},r.prototype.start=function(){this._reschedulePublishInterval()},r.prototype._reschedulePublishInterval=function(){this.storeLogsIntervalID&&(window.clearTimeout(this.storeLogsIntervalID),this.storeLogsIntervalID=null),this.storeLogsIntervalID=window.setTimeout(this._flush.bind(this,!1,!0),this.storeInterval)},r.prototype.flush=function(){this._flush(!1,!0)},r.prototype._flush=function(e,t){this.totalLen>0&&(this.logStorage.isReady()||e)&&(this.logStorage.isReady()?(this.outputCache.length&&(this.outputCache.forEach(function(e){this.logStorage.storeLogs(e)}.bind(this)),this.outputCache=[]),this.logStorage.storeLogs(this.queue)):this.outputCache.push(this.queue),this.queue=[],this.totalLen=0),t&&this._reschedulePublishInterval()},r.prototype.stop=function(){this._flush(!1,!1)},e.exports=r},function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=n(19),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(){function e(){o(this,e)}return s(e,[{key:"sendEvent",value:function(){}}]),e}(),u=function(e){function t(){o(this,t);var e=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.eventCache=[],e}return i(t,e),s(t,[{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.eventCache.push({action:e,data:t})}},{key:"drainCachedEvents",value:function(){var e=this.eventCache.slice();return this.eventCache=[],e}}]),t}(c),l=new u,d=function(){function e(){o(this,e),this.analyticsHandlers=new Set,this.permanentProperties=Object.create(null),this.addPermanentProperties({callstatsname:a.a.callStatsUserName})}return s(e,[{key:"init",value:function(e){this.browserName=e,this.analyticsHandlers.add(l)}},{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({browserName:this.browserName},this.permanentProperties,t);this.analyticsHandlers.forEach(function(t){return t.sendEvent(e,n)})}},{key:"dispose",value:function(){l.drainCachedEvents(),this.analyticsHandlers.clear()}},{key:"setAnalyticsHandlers",value:function(e){var t=this;this.analyticsHandlers=new Set(e),l.drainCachedEvents().forEach(function(e){return t.sendEvent(e.action,e.data)})}},{key:"addPermanentProperties",value:function(e){this.permanentProperties=Object.assign(this.permanentProperties,e)}}]),e}();t.a=new d},function(e,t,n){function r(){return i.randomElement(o)+"-"+i.randomAlphanumStr(3)}var i=n(16),o=["Aaliyah","Aaron","Abagail","Abbey","Abbie","Abbigail","Abby","Abdiel","Abdul","Abdullah","Abe","Abel","Abelardo","Abigail","Abigale","Abigayle","Abner","Abraham","Ada","Adah","Adalberto","Adaline","Adam","Adan","Addie","Addison","Adela","Adelbert","Adele","Adelia","Adeline","Adell","Adella","Adelle","Aditya","Adolf","Adolfo","Adolph","Adolphus","Adonis","Adrain","Adrian","Adriana","Adrianna","Adriel","Adrien","Adrienne","Afton","Aglae","Agnes","Agustin","Agustina","Ahmad","Ahmed","Aida","Aidan","Aiden","Aileen","Aisha","Aiyana","Akeem","Al","Alaina","Alan","Alana","Alanis","Alanna","Alayna","Alba","Albert","Alberta","Albertha","Alberto","Albin","Albina","Alda","Alden","Alec","Aleen","Alejandra","Alejandrin","Alek","Alena","Alene","Alessandra","Alessandro","Alessia","Aletha","Alex","Alexa","Alexander","Alexandra","Alexandre","Alexandrea","Alexandria","Alexandrine","Alexandro","Alexane","Alexanne","Alexie","Alexis","Alexys","Alexzander","Alf","Alfonso","Alfonzo","Alford","Alfred","Alfreda","Alfredo","Ali","Alia","Alice","Alicia","Alisa","Alisha","Alison","Alivia","Aliya","Aliyah","Aliza","Alize","Allan","Allen","Allene","Allie","Allison","Ally","Alphonso","Alta","Althea","Alva","Alvah","Alvena","Alvera","Alverta","Alvina","Alvis","Alyce","Alycia","Alysa","Alysha","Alyson","Alysson","Amalia","Amanda","Amani","Amara","Amari","Amaya","Amber","Ambrose","Amelia","Amelie","Amely","America","Americo","Amie","Amina","Amir","Amira","Amiya","Amos","Amparo","Amy","Amya","Ana","Anabel","Anabelle","Anahi","Anais","Anastacio","Anastasia","Anderson","Andre","Andreane","Andreanne","Andres","Andrew","Andy","Angel","Angela","Angelica","Angelina","Angeline","Angelita","Angelo","Angie","Angus","Anibal","Anika","Anissa","Anita","Aniya","Aniyah","Anjali","Anna","Annabel","Annabell","Annabelle","Annalise","Annamae","Annamarie","Anne","Annetta","Annette","Annie","Ansel","Ansley","Anthony","Antoinette","Antone","Antonetta","Antonette","Antonia","Antonietta","Antonina","Antonio","Antwan","Antwon","Anya","April","Ara","Araceli","Aracely","Arch","Archibald","Ardella","Arden","Ardith","Arely","Ari","Ariane","Arianna","Aric","Ariel","Arielle","Arjun","Arlene","Arlie","Arlo","Armand","Armando","Armani","Arnaldo","Arne","Arno","Arnold","Arnoldo","Arnulfo","Aron","Art","Arthur","Arturo","Arvel","Arvid","Arvilla","Aryanna","Asa","Asha","Ashlee","Ashleigh","Ashley","Ashly","Ashlynn","Ashton","Ashtyn","Asia","Assunta","Astrid","Athena","Aubree","Aubrey","Audie","Audra","Audreanne","Audrey","August","Augusta","Augustine","Augustus","Aurelia","Aurelie","Aurelio","Aurore","Austen","Austin","Austyn","Autumn","Ava","Avery","Avis","Axel","Ayana","Ayden","Ayla","Aylin","Baby","Bailee","Bailey","Barbara","Barney","Baron","Barrett","Barry","Bart","Bartholome","Barton","Baylee","Beatrice","Beau","Beaulah","Bell","Bella","Belle","Ben","Benedict","Benjamin","Bennett","Bennie","Benny","Benton","Berenice","Bernadette","Bernadine","Bernard","Bernardo","Berneice","Bernhard","Bernice","Bernie","Berniece","Bernita","Berry","Bert","Berta","Bertha","Bertram","Bertrand","Beryl","Bessie","Beth","Bethany","Bethel","Betsy","Bette","Bettie","Betty","Bettye","Beulah","Beverly","Bianka","Bill","Billie","Billy","Birdie","Blair","Blaise","Blake","Blanca","Blanche","Blaze","Bo","Bobbie","Bobby","Bonita","Bonnie","Boris","Boyd","Brad","Braden","Bradford","Bradley","Bradly","Brady","Braeden","Brain","Brandi","Brando","Brandon","Brandt","Brandy","Brandyn","Brannon","Branson","Brant","Braulio","Braxton","Brayan","Breana","Breanna","Breanne","Brenda","Brendan","Brenden","Brendon","Brenna","Brennan","Brennon","Brent","Bret","Brett","Bria","Brian","Briana","Brianne","Brice","Bridget","Bridgette","Bridie","Brielle","Brigitte","Brionna","Brisa","Britney","Brittany","Brock","Broderick","Brody","Brook","Brooke","Brooklyn","Brooks","Brown","Bruce","Bryana","Bryce","Brycen","Bryon","Buck","Bud","Buddy","Buford","Bulah","Burdette","Burley","Burnice","Buster","Cade","Caden","Caesar","Caitlyn","Cale","Caleb","Caleigh","Cali","Calista","Callie","Camden","Cameron","Camila","Camilla","Camille","Camren","Camron","Camryn","Camylle","Candace","Candelario","Candice","Candida","Candido","Cara","Carey","Carissa","Carlee","Carleton","Carley","Carli","Carlie","Carlo","Carlos","Carlotta","Carmel","Carmela","Carmella","Carmelo","Carmen","Carmine","Carol","Carolanne","Carole","Carolina","Caroline","Carolyn","Carolyne","Carrie","Carroll","Carson","Carter","Cary","Casandra","Casey","Casimer","Casimir","Casper","Cassandra","Cassandre","Cassidy","Cassie","Catalina","Caterina","Catharine","Catherine","Cathrine","Cathryn","Cathy","Cayla","Ceasar","Cecelia","Cecil","Cecile","Cecilia","Cedrick","Celestine","Celestino","Celia","Celine","Cesar","Chad","Chadd","Chadrick","Chaim","Chance","Chandler","Chanel","Chanelle","Charity","Charlene","Charles","Charley","Charlie","Charlotte","Chase","Chasity","Chauncey","Chaya","Chaz","Chelsea","Chelsey","Chelsie","Chesley","Chester","Chet","Cheyanne","Cheyenne","Chloe","Chris","Christ","Christa","Christelle","Christian","Christiana","Christina","Christine","Christop","Christophe","Christopher","Christy","Chyna","Ciara","Cicero","Cielo","Cierra","Cindy","Citlalli","Clair","Claire","Clara","Clarabelle","Clare","Clarissa","Clark","Claud","Claude","Claudia","Claudie","Claudine","Clay","Clemens","Clement","Clementina","Clementine","Clemmie","Cleo","Cleora","Cleta","Cletus","Cleve","Cleveland","Clifford","Clifton","Clint","Clinton","Clotilde","Clovis","Cloyd","Clyde","Coby","Cody","Colby","Cole","Coleman","Colin","Colleen","Collin","Colt","Colten","Colton","Columbus","Concepcion","Conner","Connie","Connor","Conor","Conrad","Constance","Constantin","Consuelo","Cooper","Cora","Coralie","Corbin","Cordelia","Cordell","Cordia","Cordie","Corene","Corine","Cornelius","Cornell","Corrine","Cortez","Cortney","Cory","Coty","Courtney","Coy","Craig","Crawford","Creola","Cristal","Cristian","Cristina","Cristobal","Cristopher","Cruz","Crystal","Crystel","Cullen","Curt","Curtis","Cydney","Cynthia","Cyril","Cyrus","Dagmar","Dahlia","Daija","Daisha","Daisy","Dakota","Dale","Dallas","Dallin","Dalton","Damaris","Dameon","Damian","Damien","Damion","Damon","Dan","Dana","Dandre","Dane","D'angelo","Dangelo","Danial","Daniela","Daniella","Danielle","Danika","Dannie","Danny","Dante","Danyka","Daphne","Daphnee","Daphney","Darby","Daren","Darian","Dariana","Darien","Dario","Darion","Darius","Darlene","Daron","Darrel","Darrell","Darren","Darrick","Darrin","Darrion","Darron","Darryl","Darwin","Daryl","Dashawn","Dasia","Dave","David","Davin","Davion","Davon","Davonte","Dawn","Dawson","Dax","Dayana","Dayna","Dayne","Dayton","Dean","Deangelo","Deanna","Deborah","Declan","Dedric","Dedrick","Dee","Deion","Deja","Dejah","Dejon","Dejuan","Delaney","Delbert","Delfina","Delia","Delilah","Dell","Della","Delmer","Delores","Delpha","Delphia","Delphine","Delta","Demarco","Demarcus","Demario","Demetris","Demetrius","Demond","Dena","Denis","Dennis","Deon","Deondre","Deontae","Deonte","Dereck","Derek","Derick","Deron","Derrick","Deshaun","Deshawn","Desiree","Desmond","Dessie","Destany","Destin","Destinee","Destiney","Destini","Destiny","Devan","Devante","Deven","Devin","Devon","Devonte","Devyn","Dewayne","Dewitt","Dexter","Diamond","Diana","Dianna","Diego","Dillan","Dillon","Dimitri","Dina","Dino","Dion","Dixie","Dock","Dolly","Dolores","Domenic","Domenica","Domenick","Domenico","Domingo","Dominic","Dominique","Don","Donald","Donato","Donavon","Donna","Donnell","Donnie","Donny","Dora","Dorcas","Dorian","Doris","Dorothea","Dorothy","Dorris","Dortha","Dorthy","Doug","Douglas","Dovie","Doyle","Drake","Drew","Duane","Dudley","Dulce","Duncan","Durward","Dustin","Dusty","Dwight","Dylan","Earl","Earlene","Earline","Earnest","Earnestine","Easter","Easton","Ebba","Ebony","Ed","Eda","Edd","Eddie","Eden","Edgar","Edgardo","Edison","Edmond","Edmund","Edna","Eduardo","Edward","Edwardo","Edwin","Edwina","Edyth","Edythe","Effie","Efrain","Efren","Eileen","Einar","Eino","Eladio","Elaina","Elbert","Elda","Eldon","Eldora","Eldred","Eldridge","Eleanora","Eleanore","Eleazar","Electa","Elena","Elenor","Elenora","Eleonore","Elfrieda","Eli","Elian","Eliane","Elias","Eliezer","Elijah","Elinor","Elinore","Elisa","Elisabeth","Elise","Eliseo","Elisha","Elissa","Eliza","Elizabeth","Ella","Ellen","Ellie","Elliot","Elliott","Ellis","Ellsworth","Elmer","Elmira","Elmo","Elmore","Elna","Elnora","Elody","Eloisa","Eloise","Elouise","Eloy","Elroy","Elsa","Else","Elsie","Elta","Elton","Elva","Elvera","Elvie","Elvis","Elwin","Elwyn","Elyse","Elyssa","Elza","Emanuel","Emelia","Emelie","Emely","Emerald","Emerson","Emery","Emie","Emil","Emile","Emilia","Emiliano","Emilie","Emilio","Emily","Emma","Emmalee","Emmanuel","Emmanuelle","Emmet","Emmett","Emmie","Emmitt","Emmy","Emory","Ena","Enid","Enoch","Enola","Enos","Enrico","Enrique","Ephraim","Era","Eriberto","Eric","Erica","Erich","Erick","Ericka","Erik","Erika","Erin","Erling","Erna","Ernest","Ernestina","Ernestine","Ernesto","Ernie","Ervin","Erwin","Eryn","Esmeralda","Esperanza","Esta","Esteban","Estefania","Estel","Estell","Estella","Estelle","Estevan","Esther","Estrella","Etha","Ethan","Ethel","Ethelyn","Ethyl","Ettie","Eudora","Eugene","Eugenia","Eula","Eulah","Eulalia","Euna","Eunice","Eusebio","Eva","Evalyn","Evan","Evangeline","Evans","Eve","Eveline","Evelyn","Everardo","Everett","Everette","Evert","Evie","Ewald","Ewell","Ezekiel","Ezequiel","Ezra","Fabian","Fabiola","Fae","Fannie","Fanny","Fatima","Faustino","Fausto","Favian","Fay","Faye","Federico","Felicia","Felicita","Felicity","Felipa","Felipe","Felix","Felton","Fermin","Fern","Fernando","Ferne","Fidel","Filiberto","Filomena","Finn","Fiona","Flavie","Flavio","Fleta","Fletcher","Flo","Florence","Florencio","Florian","Florida","Florine","Flossie","Floy","Floyd","Ford","Forest","Forrest","Foster","Frances","Francesca","Francesco","Francis","Francisca","Francisco","Franco","Frank","Frankie","Franz","Fred","Freda","Freddie","Freddy","Frederic","Frederick","Frederik","Frederique","Fredrick","Fredy","Freeda","Freeman","Freida","Frida","Frieda","Friedrich","Fritz","Furman","Gabe","Gabriel","Gabriella","Gabrielle","Gaetano","Gage","Gail","Gardner","Garett","Garfield","Garland","Garnet","Garnett","Garret","Garrett","Garrick","Garrison","Garry","Garth","Gaston","Gavin","Gay","Gayle","Gaylord","Gene","General","Genesis","Genevieve","Gennaro","Genoveva","Geo","Geoffrey","George","Georgette","Georgiana","Georgianna","Geovanni","Geovanny","Geovany","Gerald","Geraldine","Gerard","Gerardo","Gerda","Gerhard","Germaine","German","Gerry","Gerson","Gertrude","Gia","Gianni","Gideon","Gilbert","Gilberto","Gilda","Giles","Gillian","Gina","Gino","Giovani","Giovanna","Giovanni","Giovanny","Gisselle","Giuseppe","Gladyce","Gladys","Glen","Glenda","Glenna","Glennie","Gloria","Godfrey","Golda","Golden","Gonzalo","Gordon","Grace","Gracie","Graciela","Grady","Graham","Grant","Granville","Grayce","Grayson","Green","Greg","Gregg","Gregoria","Gregorio","Gregory","Greta","Gretchen","Greyson","Griffin","Grover","Guadalupe","Gudrun","Guido","Guillermo","Guiseppe","Gunnar","Gunner","Gus","Gussie","Gust","Gustave","Guy","Gwen","Gwendolyn","Hadley","Hailee","Hailey","Hailie","Hal","Haleigh","Haley","Halie","Halle","Hallie","Hank","Hanna","Hannah","Hans","Hardy","Harley","Harmon","Harmony","Harold","Harrison","Harry","Harvey","Haskell","Hassan","Hassie","Hattie","Haven","Hayden","Haylee","Hayley","Haylie","Hazel","Hazle","Heath","Heather","Heaven","Heber","Hector","Heidi","Helen","Helena","Helene","Helga","Hellen","Helmer","Heloise","Henderson","Henri","Henriette","Henry","Herbert","Herman","Hermann","Hermina","Herminia","Herminio","Hershel","Herta","Hertha","Hester","Hettie","Hilario","Hilbert","Hilda","Hildegard","Hillard","Hillary","Hilma","Hilton","Hipolito","Hiram","Hobart","Holden","Hollie","Hollis","Holly","Hope","Horace","Horacio","Hortense","Hosea","Houston","Howard","Howell","Hoyt","Hubert","Hudson","Hugh","Hulda","Humberto","Hunter","Hyman","Ian","Ibrahim","Icie","Ida","Idell","Idella","Ignacio","Ignatius","Ike","Ila","Ilene","Iliana","Ima","Imani","Imelda","Immanuel","Imogene","Ines","Irma","Irving","Irwin","Isaac","Isabel","Isabell","Isabella","Isabelle","Isac","Isadore","Isai","Isaiah","Isaias","Isidro","Ismael","Isobel","Isom","Israel","Issac","Itzel","Iva","Ivah","Ivory","Ivy","Izabella","Izaiah","Jabari","Jace","Jacey","Jacinthe","Jacinto","Jack","Jackeline","Jackie","Jacklyn","Jackson","Jacky","Jaclyn","Jacquelyn","Jacques","Jacynthe","Jada","Jade","Jaden","Jadon","Jadyn","Jaeden","Jaida","Jaiden","Jailyn","Jaime","Jairo","Jakayla","Jake","Jakob","Jaleel","Jalen","Jalon","Jalyn","Jamaal","Jamal","Jamar","Jamarcus","Jamel","Jameson","Jamey","Jamie","Jamil","Jamir","Jamison","Jammie","Jan","Jana","Janae","Jane","Janelle","Janessa","Janet","Janice","Janick","Janie","Janis","Janiya","Jannie","Jany","Jaquan","Jaquelin","Jaqueline","Jared","Jaren","Jarod","Jaron","Jarred","Jarrell","Jarret","Jarrett","Jarrod","Jarvis","Jasen","Jasmin","Jason","Jasper","Jaunita","Javier","Javon","Javonte","Jay","Jayce","Jaycee","Jayda","Jayde","Jayden","Jaydon","Jaylan","Jaylen","Jaylin","Jaylon","Jayme","Jayne","Jayson","Jazlyn","Jazmin","Jazmyn","Jazmyne","Jean","Jeanette","Jeanie","Jeanne","Jed","Jedediah","Jedidiah","Jeff","Jefferey","Jeffery","Jeffrey","Jeffry","Jena","Jenifer","Jennie","Jennifer","Jennings","Jennyfer","Jensen","Jerad","Jerald","Jeramie","Jeramy","Jerel","Jeremie","Jeremy","Jermain","Jermaine","Jermey","Jerod","Jerome","Jeromy","Jerrell","Jerrod","Jerrold","Jerry","Jess","Jesse","Jessica","Jessie","Jessika","Jessy","Jessyca","Jesus","Jett","Jettie","Jevon","Jewel","Jewell","Jillian","Jimmie","Jimmy","Jo","Joan","Joana","Joanie","Joanne","Joannie","Joanny","Joany","Joaquin","Jocelyn","Jodie","Jody","Joe","Joel","Joelle","Joesph","Joey","Johan","Johann","Johanna","Johathan","John","Johnathan","Johnathon","Johnnie","Johnny","Johnpaul","Johnson","Jolie","Jon","Jonas","Jonatan","Jonathan","Jonathon","Jordan","Jordane","Jordi","Jordon","Jordy","Jordyn","Jorge","Jose","Josefa","Josefina","Joseph","Josephine","Josh","Joshua","Joshuah","Josiah","Josiane","Josianne","Josie","Josue","Jovan","Jovani","Jovanny","Jovany","Joy","Joyce","Juana","Juanita","Judah","Judd","Jude","Judge","Judson","Judy","Jules","Julia","Julian","Juliana","Julianne","Julie","Julien","Juliet","Julio","Julius","June","Junior","Junius","Justen","Justice","Justina","Justine","Juston","Justus","Justyn","Juvenal","Juwan","Kacey","Kaci","Kacie","Kade","Kaden","Kadin","Kaela","Kaelyn","Kaia","Kailee","Kailey","Kailyn","Kaitlin","Kaitlyn","Kale","Kaleb","Kaleigh","Kaley","Kali","Kallie","Kameron","Kamille","Kamren","Kamron","Kamryn","Kane","Kara","Kareem","Karelle","Karen","Kari","Kariane","Karianne","Karina","Karine","Karl","Karlee","Karley","Karli","Karlie","Karolann","Karson","Kasandra","Kasey","Kassandra","Katarina","Katelin","Katelyn","Katelynn","Katharina","Katherine","Katheryn","Kathleen","Kathlyn","Kathryn","Kathryne","Katlyn","Katlynn","Katrina","Katrine","Kattie","Kavon","Kay","Kaya","Kaycee","Kayden","Kayla","Kaylah","Kaylee","Kayleigh","Kayley","Kayli","Kaylie","Kaylin","Keagan","Keanu","Keara","Keaton","Keegan","Keeley","Keely","Keenan","Keira","Keith","Kellen","Kelley","Kelli","Kellie","Kelly","Kelsi","Kelsie","Kelton","Kelvin","Ken","Kendall","Kendra","Kendrick","Kenna","Kennedi","Kennedy","Kenneth","Kennith","Kenny","Kenton","Kenya","Kenyatta","Kenyon","Keon","Keshaun","Keshawn","Keven","Kevin","Kevon","Keyon","Keyshawn","Khalid","Khalil","Kian","Kiana","Kianna","Kiara","Kiarra","Kiel","Kiera","Kieran","Kiley","Kim","Kimberly","King","Kip","Kira","Kirk","Kirsten","Kirstin","Kitty","Kobe","Koby","Kody","Kolby","Kole","Korbin","Korey","Kory","Kraig","Kris","Krista","Kristian","Kristin","Kristina","Kristofer","Kristoffer","Kristopher","Kristy","Krystal","Krystel","Krystina","Kurt","Kurtis","Kyla","Kyle","Kylee","Kyleigh","Kyler","Kylie","Kyra","Lacey","Lacy","Ladarius","Lafayette","Laila","Laisha","Lamar","Lambert","Lamont","Lance","Landen","Lane","Laney","Larissa","Laron","Larry","Larue","Laura","Laurel","Lauren","Laurence","Lauretta","Lauriane","Laurianne","Laurie","Laurine","Laury","Lauryn","Lavada","Lavern","Laverna","Laverne","Lavina","Lavinia","Lavon","Lavonne","Lawrence","Lawson","Layla","Layne","Lazaro","Lea","Leann","Leanna","Leanne","Leatha","Leda","Lee","Leif","Leila","Leilani","Lela","Lelah","Leland","Lelia","Lempi","Lemuel","Lenna","Lennie","Lenny","Lenora","Lenore","Leo","Leola","Leon","Leonard","Leonardo","Leone","Leonel","Leonie","Leonor","Leonora","Leopold","Leopoldo","Leora","Lera","Lesley","Leslie","Lesly","Lessie","Lester","Leta","Letha","Letitia","Levi","Lew","Lewis","Lexi","Lexie","Lexus","Lia","Liam","Liana","Libbie","Libby","Lila","Lilian","Liliana","Liliane","Lilla","Lillian","Lilliana","Lillie","Lilly","Lily","Lilyan","Lina","Lincoln","Linda","Lindsay","Lindsey","Linnea","Linnie","Linwood","Lionel","Lisa","Lisandro","Lisette","Litzy","Liza","Lizeth","Lizzie","Llewellyn","Lloyd","Logan","Lois","Lola","Lolita","Loma","Lon","London","Lonie","Lonnie","Lonny","Lonzo","Lora","Loraine","Loren","Lorena","Lorenz","Lorenza","Lorenzo","Lori","Lorine","Lorna","Lottie","Lou","Louie","Louisa","Lourdes","Louvenia","Lowell","Loy","Loyal","Loyce","Lucas","Luciano","Lucie","Lucienne","Lucile","Lucinda","Lucio","Lucious","Lucius","Lucy","Ludie","Ludwig","Lue","Luella","Luigi","Luis","Luisa","Lukas","Lula","Lulu","Luna","Lupe","Lura","Lurline","Luther","Luz","Lyda","Lydia","Lyla","Lynn","Lyric","Lysanne","Mabel","Mabelle","Mable","Mac","Macey","Maci","Macie","Mack","Mackenzie","Macy","Madaline","Madalyn","Maddison","Madeline","Madelyn","Madelynn","Madge","Madie","Madilyn","Madisen","Madison","Madisyn","Madonna","Madyson","Mae","Maegan","Maeve","Mafalda","Magali","Magdalen","Magdalena","Maggie","Magnolia","Magnus","Maia","Maida","Maiya","Major","Makayla","Makenna","Makenzie","Malachi","Malcolm","Malika","Malinda","Mallie","Mallory","Malvina","Mandy","Manley","Manuel","Manuela","Mara","Marc","Marcel","Marcelina","Marcelino","Marcella","Marcelle","Marcellus","Marcelo","Marcia","Marco","Marcos","Marcus","Margaret","Margarete","Margarett","Margaretta","Margarette","Margarita","Marge","Margie","Margot","Margret","Marguerite","Maria","Mariah","Mariam","Marian","Mariana","Mariane","Marianna","Marianne","Mariano","Maribel","Marie","Mariela","Marielle","Marietta","Marilie","Marilou","Marilyne","Marina","Mario","Marion","Marisa","Marisol","Maritza","Marjolaine","Marjorie","Marjory","Mark","Markus","Marlee","Marlen","Marlene","Marley","Marlin","Marlon","Marques","Marquis","Marquise","Marshall","Marta","Martin","Martina","Martine","Marty","Marvin","Mary","Maryam","Maryjane","Maryse","Mason","Mateo","Mathew","Mathias","Mathilde","Matilda","Matilde","Matt","Matteo","Mattie","Maud","Maude","Maudie","Maureen","Maurice","Mauricio","Maurine","Maverick","Mavis","Max","Maxie","Maxime","Maximilian","Maximillia","Maximillian","Maximo","Maximus","Maxine","Maxwell","May","Maya","Maybell","Maybelle","Maye","Maymie","Maynard","Mayra","Mazie","Mckayla","Mckenna","Mckenzie","Meagan","Meaghan","Meda","Megane","Meggie","Meghan","Mekhi","Melany","Melba","Melisa","Melissa","Mellie","Melody","Melvin","Melvina","Melyna","Melyssa","Mercedes","Meredith","Merl","Merle","Merlin","Merritt","Mertie","Mervin","Meta","Mia","Micaela","Micah","Michael","Michaela","Michale","Micheal","Michel","Michele","Michelle","Miguel","Mikayla","Mike","Mikel","Milan","Miles","Milford","Miller","Millie","Milo","Milton","Mina","Minerva","Minnie","Miracle","Mireille","Mireya","Misael","Missouri","Misty","Mitchel","Mitchell","Mittie","Modesta","Modesto","Mohamed","Mohammad","Mohammed","Moises","Mollie","Molly","Mona","Monica","Monique","Monroe","Monserrat","Monserrate","Montana","Monte","Monty","Morgan","Moriah","Morris","Mortimer","Morton","Mose","Moses","Moshe","Mossie","Mozell","Mozelle","Muhammad","Muriel","Murl","Murphy","Murray","Mustafa","Mya","Myah","Mylene","Myles","Myra","Myriam","Myrl","Myrna","Myron","Myrtice","Myrtie","Myrtis","Myrtle","Nadia","Nakia","Name","Nannie","Naomi","Naomie","Napoleon","Narciso","Nash","Nasir","Nat","Natalia","Natalie","Natasha","Nathan","Nathanael","Nathanial","Nathaniel","Nathen","Nayeli","Neal","Ned","Nedra","Neha","Neil","Nelda","Nella","Nelle","Nellie","Nels","Nelson","Neoma","Nestor","Nettie","Neva","Newell","Newton","Nia","Nicholas","Nicholaus","Nichole","Nick","Nicklaus","Nickolas","Nico","Nicola","Nicolas","Nicole","Nicolette","Nigel","Nikita","Nikki","Nikko","Niko","Nikolas","Nils","Nina","Noah","Noble","Noe","Noel","Noelia","Noemi","Noemie","Noemy","Nola","Nolan","Nona","Nora","Norbert","Norberto","Norene","Norma","Norris","Norval","Norwood","Nova","Novella","Nya","Nyah","Nyasia","Obie","Oceane","Ocie","Octavia","Oda","Odell","Odessa","Odie","Ofelia","Okey","Ola","Olaf","Ole","Olen","Oleta","Olga","Olin","Oliver","Ollie","Oma","Omari","Omer","Ona","Onie","Opal","Ophelia","Ora","Oral","Oran","Oren","Orie","Orin","Orion","Orland","Orlando","Orlo","Orpha","Orrin","Orval","Orville","Osbaldo","Osborne","Oscar","Osvaldo","Oswald","Oswaldo","Otha","Otho","Otilia","Otis","Ottilie","Ottis","Otto","Ova","Owen","Ozella","Pablo","Paige","Palma","Pamela","Pansy","Paolo","Paris","Parker","Pascale","Pasquale","Pat","Patience","Patricia","Patrick","Patsy","Pattie","Paul","Paula","Pauline","Paxton","Payton","Pearl","Pearlie","Pearline","Pedro","Peggie","Penelope","Percival","Percy","Perry","Pete","Peter","Petra","Peyton","Philip","Phoebe","Phyllis","Pierce","Pierre","Pietro","Pink","Pinkie","Piper","Polly","Porter","Precious","Presley","Preston","Price","Prince","Princess","Priscilla","Providenci","Prudence","Queen","Queenie","Quentin","Quincy","Quinn","Quinten","Quinton","Rachael","Rachel","Rachelle","Rae","Raegan","Rafael","Rafaela","Raheem","Rahsaan","Rahul","Raina","Raleigh","Ralph","Ramiro","Ramon","Ramona","Randal","Randall","Randi","Randy","Ransom","Raoul","Raphael","Raphaelle","Raquel","Rashad","Rashawn","Rasheed","Raul","Raven","Ray","Raymond","Raymundo","Reagan","Reanna","Reba","Rebeca","Rebecca","Rebeka","Rebekah","Reece","Reed","Reese","Regan","Reggie","Reginald","Reid","Reilly","Reina","Reinhold","Remington","Rene","Renee","Ressie","Reta","Retha","Retta","Reuben","Reva","Rex","Rey","Reyes","Reymundo","Reyna","Reynold","Rhea","Rhett","Rhianna","Rhiannon","Rhoda","Ricardo","Richard","Richie","Richmond","Rick","Rickey","Rickie","Ricky","Rico","Rigoberto","Riley","Rita","River","Robb","Robbie","Robert","Roberta","Roberto","Robin","Robyn","Rocio","Rocky","Rod","Roderick","Rodger","Rodolfo","Rodrick","Rodrigo","Roel","Rogelio","Roger","Rogers","Rolando","Rollin","Roma","Romaine","Roman","Ron","Ronaldo","Ronny","Roosevelt","Rory","Rosa","Rosalee","Rosalia","Rosalind","Rosalinda","Rosalyn","Rosamond","Rosanna","Rosario","Roscoe","Rose","Rosella","Roselyn","Rosemarie","Rosemary","Rosendo","Rosetta","Rosie","Rosina","Roslyn","Ross","Rossie","Rowan","Rowena","Rowland","Roxane","Roxanne","Roy","Royal","Royce","Rozella","Ruben","Rubie","Ruby","Rubye","Rudolph","Rudy","Rupert","Russ","Russel","Russell","Rusty","Ruth","Ruthe","Ruthie","Ryan","Ryann","Ryder","Rylan","Rylee","Ryleigh","Ryley","Sabina","Sabrina","Sabryna","Sadie","Sadye","Sage","Saige","Sallie","Sally","Salma","Salvador","Salvatore","Sam","Samanta","Samantha","Samara","Samir","Sammie","Sammy","Samson","Sandra","Sandrine","Sandy","Sanford","Santa","Santiago","Santina","Santino","Santos","Sarah","Sarai","Sarina","Sasha","Saul","Savanah","Savanna","Savannah","Savion","Scarlett","Schuyler","Scot","Scottie","Scotty","Seamus","Sean","Sebastian","Sedrick","Selena","Selina","Selmer","Serena","Serenity","Seth","Shad","Shaina","Shakira","Shana","Shane","Shanel","Shanelle","Shania","Shanie","Shaniya","Shanna","Shannon","Shanny","Shanon","Shany","Sharon","Shaun","Shawn","Shawna","Shaylee","Shayna","Shayne","Shea","Sheila","Sheldon","Shemar","Sheridan","Sherman","Sherwood","Shirley","Shyann","Shyanne","Sibyl","Sid","Sidney","Sienna","Sierra","Sigmund","Sigrid","Sigurd","Silas","Sim","Simeon","Simone","Sincere","Sister","Skye","Skyla","Skylar","Sofia","Soledad","Solon","Sonia","Sonny","Sonya","Sophia","Sophie","Spencer","Stacey","Stacy","Stan","Stanford","Stanley","Stanton","Stefan","Stefanie","Stella","Stephan","Stephania","Stephanie","Stephany","Stephen","Stephon","Sterling","Steve","Stevie","Stewart","Stone","Stuart","Summer","Sunny","Susan","Susana","Susanna","Susie","Suzanne","Sven","Syble","Sydnee","Sydney","Sydni","Sydnie","Sylvan","Sylvester","Sylvia","Tabitha","Tad","Talia","Talon","Tamara","Tamia","Tania","Tanner","Tanya","Tara","Taryn","Tate","Tatum","Tatyana","Taurean","Tavares","Taya","Taylor","Teagan","Ted","Telly","Terence","Teresa","Terrance","Terrell","Terrence","Terrill","Terry","Tess","Tessie","Tevin","Thad","Thaddeus","Thalia","Thea","Thelma","Theo","Theodora","Theodore","Theresa","Therese","Theresia","Theron","Thomas","Thora","Thurman","Tia","Tiana","Tianna","Tiara","Tierra","Tiffany","Tillman","Timmothy","Timmy","Timothy","Tina","Tito","Titus","Tobin","Toby","Tod","Tom","Tomas","Tomasa","Tommie","Toney","Toni","Tony","Torey","Torrance","Torrey","Toy","Trace","Tracey","Tracy","Travis","Travon","Tre","Tremaine","Tremayne","Trent","Trenton","Tressa","Tressie","Treva","Trever","Trevion","Trevor","Trey","Trinity","Trisha","Tristian","Tristin","Triston","Troy","Trudie","Trycia","Trystan","Turner","Twila","Tyler","Tyra","Tyree","Tyreek","Tyrel","Tyrell","Tyrese","Tyrique","Tyshawn","Tyson","Ubaldo","Ulices","Ulises","Una","Unique","Urban","Uriah","Uriel","Ursula","Vada","Valentin","Valentina","Valentine","Valerie","Vallie","Van","Vance","Vanessa","Vaughn","Veda","Velda","Vella","Velma","Velva","Vena","Verda","Verdie","Vergie","Verla","Verlie","Vern","Verna","Verner","Vernice","Vernie","Vernon","Verona","Veronica","Vesta","Vicenta","Vicente","Vickie","Vicky","Victor","Victoria","Vida","Vidal","Vilma","Vince","Vincent","Vincenza","Vincenzo","Vinnie","Viola","Violet","Violette","Virgie","Virgil","Virginia","Virginie","Vita","Vito","Viva","Vivian","Viviane","Vivianne","Vivien","Vivienne","Vladimir","Wade","Waino","Waldo","Walker","Wallace","Walter","Walton","Wanda","Ward","Warren","Watson","Wava","Waylon","Wayne","Webster","Weldon","Wellington","Wendell","Wendy","Werner","Westley","Weston","Whitney","Wilber","Wilbert","Wilburn","Wiley","Wilford","Wilfred","Wilfredo","Wilfrid","Wilhelm","Wilhelmine","Will","Willa","Willard","William","Willie","Willis","Willow","Willy","Wilma","Wilmer","Wilson","Wilton","Winfield","Winifred","Winnifred","Winona","Winston","Woodrow","Wyatt","Wyman","Xander","Xavier","Xzavier","Yadira","Yasmeen","Yasmin","Yasmine","Yazmin","Yesenia","Yessenia","Yolanda","Yoshiko","Yvette","Yvonne","Zachariah","Zachary","Zachery","Zack","Zackary","Zackery","Zakary","Zander","Zane","Zaria","Zechariah","Zelda","Zella","Zelma","Zena","Zetta","Zion","Zita","Zoe","Zoey","Zoie","Zoila","Zola","Zora","Zula"];e.exports={generateUsername:r}},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(1),o=n(2),a=n.n(o),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0).getLogger(e),u={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationLog:"applicationLog"},l={fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",activeDeviceList:"activeDeviceList"},d="jitsi",p={ERROR:"error",EVENT:"event",MST_WITH_USERID:"mstWithUserID"},f=void 0,h=function(){function e(t,n){if(r(this,e),!e.backend)throw new Error("CallStats backend not intiialized!");this.confID=n.confID,this.tpc=t,this.peerconnection=t.peerconnection,this.remoteUserID=n.remoteUserID||d,this.hasFabric=!1,e.fabrics.add(this),e.initialized&&this._addNewFabric()}return s(e,null,[{key:"_addNewFabricCallback",value:function(t,n){e.backend&&"success"!==t&&c.error("Monitoring status: "+t+" msg: "+n)}},{key:"_initCallback",value:function(t,n){if(c.log("CallStats Status: err="+t+" msg="+n),"success"===t){var r=!1,i=null,o=!0,a=!1,s=void 0;try{for(var u,l=e.fabrics.values()[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var d=u.value;d.hasFabric||(c.debug("addNewFabric - initCallback"),d._addNewFabric()&&(r=!0,i||(i=d)))}}catch(e){a=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}if(r){e.initialized=!0;var f=i.confID,h=i.peerconnection,v=!0,m=!1,g=void 0;try{for(var y,b=e.reportsQueue[Symbol.iterator]();!(v=(y=b.next()).done);v=!0){var S=y.value;if(S.type===p.ERROR){var _=S.data;e._reportError(i,_.type,_.error,_.pc||h)}else if(S.type===p.EVENT){var T=S.data;e.backend.sendFabricEvent(S.pc||h,T.event,f,T.eventData)}else if(S.type===p.MST_WITH_USERID){var E=S.data;e.backend.associateMstWithUserID(S.pc||h,E.callStatsId,f,E.ssrc,E.usageLabel,E.containerId)}}}catch(e){m=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(m)throw g}}e.reportsQueue.length=0}}}},{key:"_reportError",value:function(t,n,r,i){var o=r;o||(c.warn("No error is passed!"),o=new Error("Unknown error")),e.initialized&&t?e.backend.reportError(i,t.confID,n,o):e.reportsQueue.push({type:p.ERROR,data:{error:o,pc:i,type:n}})}},{key:"_reportEvent",value:function(t,n,r){var i=t&&t.peerconnection,o=t&&t.confID;e.initialized&&t?e.backend.sendFabricEvent(i,n,o,r):e.reportsQueue.push({confID:o,pc:i,type:p.EVENT,data:{event:n,eventData:r}})}},{key:"_traceAndCatchBackendCalls",value:function(e){var t=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"],n=!0,r=!1,o=void 0;try{for(var s,l=t[Symbol.iterator]();!(n=(s=l.next()).done);n=!0)!function(){var t=s.value,n=e[t];e[t]=function(){try{for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];return n.apply(e,r)}catch(e){a.a.callErrorHandler(e)}}}()}catch(e){r=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw o}}var d=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"],p=!0,f=!1,h=void 0;try{for(var v,m=d[Symbol.iterator]();!(p=(v=m.next()).done);p=!0)!function(){var t=v.value,n=e[t];e[t]=function(){for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];c.debug(t,i),n.apply(e,i)}}()}catch(e){f=!0,h=e}finally{try{!p&&m.return&&m.return()}finally{if(f)throw h}}var g=e.reportError;e.reportError=function(t,n,r){for(var o=arguments.length,s=Array(o>3?o-3:0),l=3;l<o;l++)s[l-3]=arguments[l];r===u.applicationLog?i.a.isReactNative()||console&&console.debug("reportError",t,n,r):c.debug.apply(c,["reportError",t,n,r].concat(s));try{g.call.apply(g,[e,t,n,r].concat(s))}catch(e){r===u.applicationLog?console&&console.error("reportError",e):a.a.callErrorHandler(e)}}}},{key:"initBackend",value:function(t){if(e.backend)throw new Error("CallStats backend has been initialized already!");try{var r=i.a.isReactNative()?n(66):callstats;return e.backend=new r,e._traceAndCatchBackendCalls(e.backend),e.userID={aliasName:t.aliasName,userName:t.userName},e.callStatsID=t.callStatsID,e.callStatsSecret=t.callStatsSecret,e.backend.initialize(e.callStatsID,e.callStatsSecret,e.userID,e._initCallback),!0}catch(t){return a.a.callErrorHandler(t),e.backend=null,c.error(t),!1}}},{key:"isBackendInitialized",value:function(){return Boolean(e.backend)}},{key:"sendActiveDeviceListEvent",value:function(t,n){e._reportEvent(n,l.activeDeviceList,t)}},{key:"sendApplicationLog",value:function(t,n){try{e._reportError(n,u.applicationLog,t,n&&n.peerconnection)}catch(e){console&&"function"==typeof console.error&&console.error("sendApplicationLog failed",e)}}},{key:"sendFeedback",value:function(t,n,r){e.backend?e.backend.sendUserFeedback(t,{userID:e.userID,overall:n,comment:r}):c.error("Failed to submit feedback to CallStats - no backend")}},{key:"sendGetUserMediaFailed",value:function(t,n){e._reportError(n,u.getUserMedia,t,null)}},{key:"sendMuteEvent",value:function(t,n,r){var i=void 0;i="video"===n?t?l.videoPause:l.videoResume:t?l.audioMute:l.audioUnmute,e._reportEvent(r,i)}},{key:"fabrics",get:function(){return f||(f=new Set),f}}]),s(e,[{key:"_addNewFabric",value:function(){c.info("addNewFabric",this.remoteUserID);try{var t=e.backend.addNewFabric(this.peerconnection,this.remoteUserID,e.backend.fabricUsage.multiplex,this.confID,e._addNewFabricCallback);this.hasFabric=!0;var n="success"===t.status;return n||c.error("callstats fabric not initilized",t.message),n}catch(e){return a.a.callErrorHandler(e),!1}}},{key:"associateStreamWithVideoTag",value:function(t,n,r,i,o){if(e.backend){var a=n?e.userID:r;e.initialized?e.backend.associateMstWithUserID(this.peerconnection,a,this.confID,t,i,o):e.reportsQueue.push({type:p.MST_WITH_USERID,pc:this.peerconnection,data:{callStatsId:a,containerId:o,ssrc:t,usageLabel:i}})}}},{key:"sendDominantSpeakerEvent",value:function(){e._reportEvent(this,l.dominantSpeaker)}},{key:"sendTerminateEvent",value:function(){e.initialized&&e.backend.sendFabricEvent(this.peerconnection,e.backend.fabricEvent.fabricTerminated,this.confID),e.fabrics.delete(this)}},{key:"sendIceConnectionFailedEvent",value:function(){e._reportError(this,u.iceConnectionFailure,null,this.peerconnection)}},{key:"sendCreateOfferFailed",value:function(t){e._reportError(this,u.createOffer,t,this.peerconnection)}},{key:"sendCreateAnswerFailed",value:function(t){e._reportError(this,u.createAnswer,t,this.peerconnection)}},{key:"sendResumeOrHoldEvent",value:function(t){e._reportEvent(this,t?l.fabricResume:l.fabricHold)}},{key:"sendScreenSharingEvent",value:function(t){e._reportEvent(this,t?l.screenShareStart:l.screenShareStop)}},{key:"sendSetLocalDescFailed",value:function(t){e._reportError(this,u.setLocalDescription,t,this.peerconnection)}},{key:"sendSetRemoteDescFailed",value:function(t){e._reportError(this,u.setRemoteDescription,t,this.peerconnection)}},{key:"sendAddIceCandidateFailed",value:function(t){e._reportError(this,u.addIceCandidate,t,this.peerconnection)}}]),e}();t.a=h,h.backend=null,h.reportsQueue=[],h.initialized=!1,h.callStatsID=null,h.callStatsSecret=null,h.userID=null}).call(t,"modules/statistics/CallStats.js")},function(e,t,n){"use strict";(function(r){var i,o,a,s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function r(){function e(){var e=(Math.random()+1).toString(36);return e.substring(2,e.length)}function t(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function r(){return t()+je.currentOffset}function i(){return window.performance.now?window.performance.now():null}function o(){if(Me)return Me.level}function a(){if(Me)return Me.charging}function c(e,t){return e.sort().toString()===t.sort().toString()}function u(e){navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(t){oe?c(oe,t)||(oe=t,Lt(e)):(oe=t,Lt(e)),setTimeout(function(){u(e)},pe)}).catch(function(){setTimeout(function(){u(e)},pe)})}function l(){le||window&&window.addEventListener&&window.addEventListener("beforeunload",function(e){var t;for(t in Fe)Fe.hasOwnProperty(t)&&Pt(Ke.userLeft,null,t,Fe[t].ucID,null,null,null);return"Are you sure you want to close the call?"})}function d(e,t,n,r,o){var a=Wt(n,r),s=null;a&&(s=i(),Pt(Ke.mediaPlaybackStartEvent,t,n,e,{ssrc:o,highResTs:s},a,null))}function p(e,t,n,r,o){var a=Wt(n,r),s=null;a&&(s=i(),Pt(Ke.mediaSuspendedEvent,t,n,e,{ssrc:o,highResTs:s},a,null))}function f(e,t,n,r){var i,o=document.getElementById(t);o&&(o.oncanplay=function(){i=Fe[e].ucID;var t=Vt(e,n);d(i,t.remoteUserID,e,n,r)},o.onsuspend=function(){i=Fe[e].ucID;var t=Vt(e,n);p(i,t.remoteUserID,e,n,r)})}function h(e){var t=ge.codebase,n=!1;if(null===e)n=!1;else if(t===ft.firefox){var r="undefined"==typeof mozRTCPeerConnection?"undefined":s(mozRTCPeerConnection),i="undefined"==typeof RTCPeerConnection?"undefined":s(RTCPeerConnection);"undefined"!==r&&e instanceof mozRTCPeerConnection?n=!0:"undefined"!==i&&e instanceof RTCPeerConnection&&(n=!0)}else null!==Ve&&e instanceof Ve&&(n=!0),"function"!=typeof e&&t!==ft.edge||(n=!0),void 0!==s(e.createOffer)&&(n=!0);return n}function v(e,t){var n;return e&&(t===ft.chrome?e.googLocalAddress?(n=e.googLocalAddress,n.concat(":",e.googRemoteAddress)):e.selectedCandidatePairId&&(n=e.selectedCandidatePairId):t===ft.firefox&&(n=e.localAddr,n.concat(":",e.remoteAddr))),Ft(n)}function m(){return!0===navigator.onLine?"online":"offline"}function g(e,t,n){var r=null;n.ssrcMap.hasOwnProperty(e.data.ssrc)&&(n.ssrcMap[e.data.ssrc].mediaType=e.data.mediaType,e.data.googCodecName?r=e.data.googCodecName:e.data.codec&&(r=e.data.codec),n.ssrcMap[e.data.ssrc].codec=r,e.data.codecImplementationName&&(n.ssrcMap[e.data.ssrc].codecImplementationName=e.data.codecImplementationName))}function y(e,t,n){var r,i,o,a,s,c,u,l,d=[];if(void 0!==e.lastStatsSent&&void 0!==e.lastStatsSent.statistics.Transport)for(o=e.lastStatsSent.statistics.Transport,a=e.latestEventSent,s=void 0,r=0;r<t.length;r++){for(s=void 0,i=0;i<o.length;i++)if(t[r].hash===o[i].hash){s=o[i];break}void 0!==s&&(c=parseInt(s.bytesReceived,10),u=parseInt(s.bytesSent,10),l=n-a,l>0&&(t[r].csioReceivedBwKbps=8*(parseInt(t[r].bytesReceived,10)-c)/l,t[r].csioSentBwKbps=8*(parseInt(t[r].bytesSent,10)-u)/l,t[r].csioIntBytesReceived=parseInt(t[r].bytesReceived,10)-c,t[r].csioIntBytesSent=parseInt(t[r].bytesSent,10)-u,void 0!==s.packetsSent&&void 0!==t[r].packetsSent&&(t[r].csioSentPacketRate=(parseInt(t[r].packetsSent,10)-parseInt(s.packetsSent,10))/(l/1e3),t[r].csioIntPacketsSent=parseInt(t[r].packetsSent,10)-parseInt(s.packetsSent,10)),void 0!==s.packetsReceived&&void 0!==t[r].packetsReceived&&(t[r].csioReceivedPacketRate=(parseInt(t[r].packetsReceived,10)-parseInt(s.packetsReceived,10))/(l/1e3),t[r].csioIntPacketsReceived=parseInt(t[r].packetsReceived,10)-parseInt(s.packetsReceived,10))),d.push(t[r]))}return d}function b(e,t,n,r){var i=[];return n===ft.firefox?i=null:t&&(i=y(e,t,r)),i}function S(e){var t,n,r;for(t in e.streams)if(e.streams.hasOwnProperty(t)){if(e.streams[t].inbound)for(r in e.streams[t].inbound)e.streams[t].inbound.hasOwnProperty(r)&&(n=e.streams[t].inbound[r].mark,n===it.bad?e.streams[t].inbound[r].mark=2:n===it.fair?e.streams[t].inbound[r].mark=1:e.streams[t].inbound[r].mark=0);if(e.streams[t].outbound)for(r in e.streams[t].outbound)e.streams[t].outbound.hasOwnProperty(r)&&(n=e.streams[t].outbound[r].mark,n===it.bad?e.streams[t].outbound[r].mark=2:n===it.fair?e.streams[t].outbound[r].mark=1:e.streams[t].outbound[r].mark=0)}return e}function _(e,t,n){var r,i,o;for(r=0;r<e.length;r++)i=t[e[r].localCandidateId],o=n[e[r].remoteCandidateId],e[r].localAddr=i.ipAddress+":"+i.portNumber,e[r].remoteAddr=o.ipAddress+":"+o.portNumber,e[r].localAddrType=i.candidateType,e[r].remoteAddrType=o.candidateType,e[r].transportType=i.transport;return e}function T(e){var t={},n=zn.getConferenceURL();return e.connectionState&&(t.connectionState=e.connectionState),e.fabricState&&(t.fabricState=e.fabricState),n&&(t.conferenceURL=n),t.streams={},null===e.streams?t:(e.streams.forEach(function(e){var n={cname:e.cname,ssrc:e.ssrc,msid:e.msid,remoteUserID:e.userID,usageLabel:e.usage,associatedVideoTag:e.associatedVideoTag};e.data.hasOwnProperty("csioIntFL")&&(n.fractionLoss=e.data.csioIntFL),e.data.hasOwnProperty("csioIntBRKbps")&&(n.bitrate=e.data.csioIntBRKbps),e.data.hasOwnProperty("csioMark")&&(n.quality=e.data.csioMark),e.data.hasOwnProperty("csioMediaType")&&(n.mediaType=e.data.csioMediaType),e.data.hasOwnProperty("googRtt")&&(n.rtt=e.data.googRtt),e.data.hasOwnProperty("mozRtt")&&(n.rtt=e.data.mozRtt),e.data.hasOwnProperty("roundTripTime")&&(n.rtt=e.data.roundTripTime),e.data.hasOwnProperty("jitter")&&(n.jitter=e.data.jitter),e.data.hasOwnProperty("googJitterReceived")&&(n.jitter=e.data.googJitterReceived),e.data.hasOwnProperty("audioOutputLevel")&&(n.audioOutputLevel=e.data.audioOutputLevel),e.data.hasOwnProperty("audioInputLevel")&&(n.audioInputLevel=e.data.audioInputLevel),e.data.hasOwnProperty("audioLevel")&&(n.audioLevel=e.data.audioLevel),e.data.hasOwnProperty("csioAvgRtt")&&(n.averageRTT=e.data.csioAvgRtt),e.data.hasOwnProperty("csioAvgJitter")&&(n.averageJitter=e.data.csioAvgJitter),e.data.hasOwnProperty("csioPktLossPercentage")&&(n.packetLossPercentage=e.data.csioPktLossPercentage),e.reportType&&"local"===e.reportType?e.streamType&&(n.statsType=e.streamType+"-rtp"):e.reportType&&"remote"===e.reportType&&e.streamType&&(n.statsType="remote-"+e.streamType+"-rtp"),t.streams[e.ssrc]=n}),t)}function E(e,t,n,i,o,a){var s=r();e.hasOwnProperty("token")&&e.hasOwnProperty("ucID")&&!Ue?(H(qe.processedStats,e,a),t.latestEventSent=s,t.lastFabricState=t.pcState):(e.clockUnsynced=Ue,ke.cacheEvent({channel:qe.processedStats,data:e}),e.hasOwnProperty("token")||Oe.sendAuthenticationRequest(ae,o))}function C(e,t){for(var n in t)t.hasOwnProperty(n)&&"id"!==n&&"type"!==n&&(e[n]=t[n]);return e}function w(e,n,i,s,c){function u(u){if(u){var l=r(),d=t();void 0===s.lastRawStatsSentInterval||null===s.lastRawStatsSentInterval?s.lastRawStatsSentInterval=d-s.statsPollingStart:s.lastRawStatsSentInterval=d-s.rawstatsTS+s.lastRawStatsSentInterval,void 0===s.lastProcessedStatsSentInterval||null===s.lastProcessedStatsSentInterval?s.lastProcessedStatsSentInterval=_e+1:s.lastProcessedStatsSentInterval=d-s.rawstatsTS+s.lastProcessedStatsSentInterval,s.rawstatsTS=d;var p={},f=ge.codebase,h=s.conferenceID,y=s.remoteUserID;p.version=ee,p.appID=ae,p.conferenceID=encodeURIComponent(h),p.apiTS=l,p.timeShift=0,p.fabricState=s.pcState,p.pcID=s.pcHash,void 0!==i&&(p.ucID=i),Oe.authToken?p.token=Oe.authToken:Oe.sendAuthenticationRequest(ae,n),p.localID=encodeURIComponent(n),p.remoteID=y?encodeURIComponent(y):null,p.deviceID=ue;var C,w,R,I,O,L,M,x={streams:[]},F=null,j=!1,U=!1,B={},G={};for(F=zt(u),C=0;C<F.length;++C)if(w=A(F[C]),R=k(w),!D(R))if(R.hasOwnProperty("Transport"))I="Transport",x.hasOwnProperty(I)||(x[I]=[]),f!==ft.firefox?(parseInt(R[I].bytesReceived,10)>0||parseInt(R[I].bytesSent,10)>0)&&(x[I].push(R[I]),"true"!==R[I].googActiveConnection&&!0!==R[I].googActiveConnection||(p.activeConnectionIndex=x[I].length)):(x[I].push(R[I]),"true"!==R[I].selected&&!0!==R[I].selected||(p.activeConnectionIndex=x[I].length));else if(R.localCandidate)B[R.localCandidate.id]=R.localCandidate;else if(R.remoteCandidate)G[R.remoteCandidate.id]=R.remoteCandidate;else if(R.bwe)x.bwe=R.bwe;else if(R.trackStats)x.trackStats||(x.trackStats=[]),x.trackStats.push(R.trackStats);else if(R.codec)x.codec||(x.codec=[]),x.codec.push(R.codec);else if(R.candidatePair)x.candidatePair||(x.candidatePair=[]),x.candidatePair.push(R.candidatePair);else{L=Rt(s,R.ssrc),void 0!==L&&L.localStartTime||(M=It(y,h,i,s,c,null),M&&(U=!0),L=Rt(s,R.ssrc)),L&&(O=L.remoteUserID),void 0===O&&(O=y);var J={userID:O,data:R.data,reportType:R.reportType,streamType:R.streamType,ssrc:R.ssrc};void 0!==L&&(J.cname=L.cname,J.msid=L.msid,J.associatedVideoTag=L.associatedVideoTag,J.usage=L.usageLabel),x.streams.push(J)}if(x.Transport){f===ft.firefox&&(x.Transport=_(x.Transport,B,G));for(var H=0;H<x.Transport.length;H++)x.Transport[H].hash=v(x.Transport[H],f)}p.statistics=x,x.Transport&&(j=P(x.Transport,s)),j&&xn(c,Ke.fabricTransportSwitch,h),s.pcState===ot.disrupted&&N(p),x.trackStats&&(x=Gn(x)),x.Transport&&x.candidatePair&&(x=Bn(x)),U&&Pt(Ke.ssrcMap,y,h,i,kt(s),s.pcHash);var V={},K={response:null},q={response:null};if(ie.fire(ie.events.OnPolling,{streams:x.streams,codeBase:f}),ie.fire(ie.events.OnOneWayAudioDisruptionsRequest,q),null!==q.response&&q.response.forEach(function(e){_t(ae,se,"log",{msg:e.name})}),ie.fire(ie.events.OnStatsRequest,K),null!==K.response){if(K.response.streams)for(C=0;C<K.response.streams.length;C++)g(K.response.streams[C],f,s);if(V.streams=K.response.streams,V.fabricState=s.pcState,V.connectionState=m(),x.Transport&&(V.Transport=b(s,x.Transport,f,l)),x.bwe&&(V.bwe=x.bwe),void 0===s.processedStatsTupleArray&&(s.processedStatsTupleArray=[]),Se.stats){var z=T(V);Se.stats(z)}V.apiTS=l,V.batteryStatus={},V.batteryStatus.batteryLevel=o(),V.batteryStatus.isBatteryCharging=a(),V=S(V),s.processedStatsTupleArray.push(V),p.processedStatistics=s.processedStatsTupleArray,s.lastStatsSent=p;var Q=W(p),$=W(p);delete Q.processedStatistics,delete $.statistics,s.lastProcessedStatsSentInterval>=_e&&(s.processedStatsTupleArray=[],Ae.add($,$.processedStatistics.length),$.msgStat=Ae.getStat(),E($,s,h,y,n,e),s.lastProcessedStatsSentInterval=0)}}}return u}function R(e){var t;return at.hasOwnProperty(e)?e===at.createOffer||e===at.createAnswer||e===at.setRemoteDescription?t=st.negotiationFailure:e===at.setLocalDescription?t=st.sdpError:e===at.addIceCandidate?t=st.sdpError:e===at.getUserMedia?t=st.mediaConfigError:e===at.iceConnectionFailure?t=st.iceFailure:e===at.signalingError?t=st.signalingError:(e===at.applicationLog||at.applicationError)&&(t=st.applicationLog):t=Tt.invalidWebRTCFunctionName,t}function k(e){var t={};if("inboundrtp"===e.type||"outboundrtp"===e.type||"inbound-rtp"===e.type||"outbound-rtp"===e.type){if(t.ssrc=e.ssrc,t.streamType="inboundrtp"===e.type||"inbound-rtp"===e.type?"inbound":"outbound","Safari"===ge.name&&!e.mediaType){e.id.includes("Audio")?e.mediaType="audio":e.id.includes("Video")&&(e.mediaType="video");var n=e.id.split("_");if(n[1])try{e.ssrc=parseInt(n[1]),t.ssrc=e.ssrc}catch(e){}}t.data=e,void 0!==e.isRemote?t.reportType="true"===e.isRemote||!0===e.isRemote?"remote":"local":t.reportType="local",e.trackId&&(t.trackId=e.trackId),e.mediaType&&(t.mediaType=e.mediaType)}else"candidatepair"===e.type&&e.selected?t.Transport=e:"localcandidate"===e.type||"local-candidate"===e.type?t.localCandidate=e:"remotecandidate"===e.type||"remote-candidate"===e.type?t.remoteCandidate=e:"transport"===e.type||"googCandidatePair"===e.type?t.Transport=e:"VideoBwe"===e.type?t.bwe=e:"track"===e.type?t.trackStats=e:"candidate-pair"===e.type?t.candidatePair=e:"codec"===e.type?t.codec=e:"ssrc"===e.type&&(t.reportType="local",e.bytesSent?t.streamType="outbound":t.streamType="inbound",t.ssrc=e.ssrc,t.data=e);return t}function I(e){var t="None";switch(e){case 0:t="TURN/TLS";break;case 1:t="TURN/TCP";break;case 2:t="TURN/UDP"}return t}function P(e,t){var n,r,i,o,a,s,c,u,l,d=!1,p="None",f=!1,h=function(e){if(e.typePreference){var t=e.typePreference>>24;return"rtp"===e.protocol&&e.address===n&&(t>=0&&t<=2&&(p=I(t)),!0)}return!1};for(c=0;c<e.length;c++)if(u=e[c],!navigator.mozGetUserMedia||"candidatepair"!==u.type||"true"!==u.selected&&!0!==u.selected?"googCandidatePair"!==u.type||"true"!==u.googActiveConnection&&!0!==u.googActiveConnection?"transport"===u.type&&(f=!0,u.selectedCandidatePairId&&(l=u.selectedCandidatePairId)):(f=!0,n=u.googLocalAddress,r=u.googRemoteAddress,i=u.googLocalCandidateType,o=u.googRemoteCandidateType,a=u.googTransportType):(f=!0,n=u.localAddr,r=u.remoteAddr,i=u.localAddrType,o=u.remoteAddrType,a=u.transportType),f){n&&(s=0===n.indexOf("[")),t.iceCandidates.some(h);break}if(!f)return d;var v=t.transportData;return void 0!==v&&v.localAddr===n&&v.remoteAddr===r&&v.transportType===a&&v.selectedCandidatePairId===l||(t.transportData={localAddr:n,remoteAddr:r,localAddrType:i,remoteAddrType:o,transportType:a,ipv6:s,relayType:p,selectedCandidatePairId:l},d=!0),d}function A(e){var t,n={};e.timestamp instanceof Date&&(n.timestamp=e.timestamp.getTime().toString()),e.type&&(n.type=e.type);var r=0;if(e.names){var i=e.names();for(r=0;r<i.length;++r)n[i[r]]=e.stat(i[r])}else for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);if(n.values){for(r=0;r<n.values.length;++r){e=n.values[r];for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t])}delete n.values}return n}function D(e){if(null===e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}function O(e){return{magicKey:e,statsSubmissionInterval:_e,endpoint:xe,localUserIDObject:ce}}function L(e,t,n){void 0===Fe[e]&&(Fe[e]={},Fe[e].participants=null,n&&(Fe[e].userJoinedSent=!0),t&&(Fe[e].refreshPresence=t))}function N(e){var t,n=e.statistics.outbound;if(void 0!==n)for(t in n)n.hasOwnProperty(t)&&(navigator.mozGetUserMedia&&n[t].data.mozRtt?n[t].data.mozRtt=0:n[t].data.googRtt&&(n[t].data.googRtt=0))}function M(e){return clearInterval(e),null}function x(){var e;for(e in Fe)Fe.hasOwnProperty(e)&&(Fe[e].refreshPresence=M(Fe[e].refreshPresence),delete Fe[e].refreshPresence);q()}function F(e){var t=!1;if(!e)return t;var n=Fe[e];return void 0!==n&&n.participants&&n.participants.length>0&&(t=!0),t}function j(e,t){var n=Fe[e],r=[];if(void 0===n)r.push(t),Fe[e]={},Fe[e].participants=r;else{var i=n.participants;null===i?(r.push(t),n.participants=r):i.push(t)}}function U(e){var t=!1;if(!Fe[e])return{conferenceFinished:t,ucID:null};var n=Fe[e].ucID;return 0===Fe[e].participants.length&&(M(Fe[e].refreshPresence),q(),ke.sendCachedEvents(Oe,Ue),delete Fe[e],t=!0),{conferenceFinished:t,ucID:n}}function B(e,t){Pt(Ke.userLeft,null,e,t,null,null,null),q(),Be=Ct,Ct=null}function G(){var e;for(e in Fe)if(Fe.hasOwnProperty(e)){if(e===re)return;Nt(e),Fe[e].refreshPresence=function(e){return setInterval(function(){Nt(e)},Ee)}(e)}z()}function J(e){try{if(window&&window.sessionStorage){var t=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));if(t&&t[e])return t[e].ucID}}catch(e){return null}return null}function H(e,t,n){var r=t.action,i=t.remoteID,o=t.ucID;t.channel=e,Oe._isTokenValid(Oe.authToken,ae,se)?(o&&!Ue&&i||-1!==vt.indexOf(r))&&t.conferenceID!==re?(t.token=Oe.authToken,Qn(e,t,n),n&&r&&n($e.success,r+" sent to the backend.")):(t.clockUnsynced=Ue,ke.cacheEvent({channel:e,data:t,callback:n})):Oe.sendAuthenticationRequest(ae,se,function(a,s){a!==$e.success?(a===Xe.authOngoing&&(t.clockUnsynced=Ue,ke.cacheEvent({channel:e,data:t,callback:n})),n&&a!==Xe.authOngoing&&n(a,s)):a===$e.success&&"SDK authentication successful."===s&&((o&&!Ue&&i||-1!==vt.indexOf(r))&&t.conferenceID!==re?(t.token=Oe.authToken,Qn(e,t,n),n&&r&&n($e.success,r+" sent to the backend.")):(t.clockUnsynced=Ue,ke.cacheEvent({channel:e,data:t,callback:n})))})}function V(e){e&&e(Xe.authOngoing,null)}function W(e){if(null===e||"object"!=(void 0===e?"undefined":s(e)))return e;var t,n=new e.constructor;for(t in e)e.hasOwnProperty(t)&&(n[t]=W(e[t]));return n}function K(){var e={};Object.keys(Fe).forEach(function(t){var n=Fe[t];if(!n)return!0;var r,i,o={ucID:n.ucID,userJoinedSent:n.userJoinedSent},a=[];if(n.participants){var s,c=n.participants;for(r=0;r<c.length;r++)i={},s=c[r],i={pcID:s.pcHash,pcState:s.pcState,iceConnectionState:s.iceConnectionState,iceGatheringState:s.iceGatheringState,iceCandidatesNumber:s.iceCandidates.length,remoteUserID:s.remoteUserID},a.push(i)}o.participants=a,e[t]=o});var t={authStatus:!!Oe.tokenData,clockSync:!Ue,stateMachine:e,pageURL:window.location.href,eventType:"warn",version:ee};t.wsStatus=zn.getWSConnectionState(),_t(ae,se,"stateMachine",t)}function q(){Ge||(Ge=setInterval(function(){K()},Je))}function z(){M(Ge),Ge=null}var Q=n(67),$=n(68),X=n(75),Y="https://collector.callstats.io:443/",Z="https://auth.callstats.io/",ee="3.24.1",te="wss://collector.callstats.io:443/csiows/collectCallStats",ne="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",re="csio-conf-id-tmp",ie=new $.Reporter;window&&(window.csioChromeLegacyGetStats=!0);var oe,ae=null,se=null,ce=null,ue=null,le=!1,de=!1,pe=1e4,fe=function(e,t){var n="precalltest error ("+e+"): "+t;console.warn(n),_t&&_t(ae,se,"log",{msg:n})},he=n(76),ve=null;try{ve=new he.PreCallTest}catch(e){fe("initializing",e)}var me,ge,ye=[],be={create:Date.now()},Se={stats:null,configService:null,preCallTest:null},_e=15e3,Te=!1,Ee=1e4,Ce=!1,we=!0,Re=function(){function e(e,t){setTimeout(function(){var t=r(),n=t-e.data.apiTS;e.data.timeShift=n,H(e.channel,e.data,e.callback)},t)}this.eventCache=[],this.updateRemoteUserID=function(e,t){for(var n,r=this,i=0;i<r.eventCache.length;i++)n=r.eventCache[i],n.data.pcID===t&&(n.data.remoteID=e)},this.sendCachedEvents=function(t,n,i,o,a,s){var c=this;if(!t.authToken)return void t.sendAuthenticationRequest(ae,se);if(!n){var u,l,d,p,f=r(),h=[],v=Math.max(_e/c.eventCache.length,He);for(u=0;u<c.eventCache.length;u++)if(d=c.eventCache[u],!d.data.remoteID&&d.data.pcID||d.data.conferenceID===re)h.push(c.eventCache[u]);else if(d.data.action!==Ke.userJoined){if(d.data.token=t.authToken,i&&d.data.apiTS>=f-o||!d.data.ucID)if(p=decodeURIComponent(d.data.conferenceID),Fe[p]&&Fe[p].ucID)d.data.ucID=Fe[p].ucID;else{if(p!==a){h.push(c.eventCache[u]);continue}d.data.ucID=s}if(d.data.clockUnsynced&&(d.data.apiTS+=je.currentOffset),d.channel===qe.processedStats&&d.data.clockUnsynced&&d.data.processedStatistics&&d.data.processedStatistics.length>0)for(l=0;l<d.data.processedStatistics.length;l++)d.data.processedStatistics[l].apiTS+=je.currentOffset;delete d.data.clockUnsynced,e(d,v*(u+1))}else h.push(c.eventCache[u]);c.eventCache=h}},this.sendCachedUserJoinedEvents=function(t){var n=this;if(!t.authToken)return void t.sendAuthenticationRequest(ae,se);var r,i,o=[],a=Math.max(_e/n.eventCache.length,He);for(r=0;r<n.eventCache.length;r++)i=n.eventCache[r],!i.data.remoteID&&i.data.pcID||i.data.conferenceID===re?o.push(n.eventCache[r]):i.data.action===Ke.userJoined||i.data.action===We.fabricSetupFailed?(i.data.token=t.authToken,i.data.clockUnsynced&&(i.data.apiTS=i.data.apiTS+je.currentOffset),i.data.value&&(i.data.value.statsSubmissionInterval=_e),e(i,a*(r+1))):o.push(n.eventCache[r]);n.eventCache=o},this.updateConferenceId=function(e){for(var t,n=this,r=0;r<n.eventCache.length;r++)t=n.eventCache[r],t.data.conferenceID===re&&(t.data.conferenceID=e)},this.cacheEvent=function(e){this.eventCache.push(e)},this.sendCachedFeedback=function(){var e=gt("feedback"),t=JSON.parse(gt("csio_auth_data"));if(e&&t){var n=JSON.parse(e),r=t===n.token;r||se!==n.userID||(n.token=t,r=!0),r?H(qe.userFeedback,n):yt("feedback")}}},ke=new Re,Ie=function(){this.size_max=0,this.size_ewma=0,this.statNum_max=0,this.statNum_ewma=0,this.msg_num=0},Pe=function(){this.stat=new Ie,this.add=function(e,t){var n=this.memorySizeOf(e);this.stat.size_ewma=.5*this.stat.size_ewma+.5*n,this.stat.size_max<n&&(this.stat.size_max=n),this.stat.statNum_ewma=.5*this.stat.statNum_ewma+.5*t,this.stat.statNum_max<t&&(this.stat.statNum_max=t),this.stat.msg_num+=1},this.getStat=function(){return this.stat},this.memorySizeOf=function(e){function t(e){if(null!==e&&void 0!==e)switch(void 0===e?"undefined":s(e)){case"number":n+=8;break;case"string":n+=2*e.length;break;case"boolean":n+=4;break;case"object":var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r||"Array"===r)for(var i in e)e.hasOwnProperty(i)&&t(e[i]);else n+=2*e.toString().length}return n}var n=0;return t(e)}},Ae=new Pe,De=function(){var e=this,t="urn:x-callstats:auth:errorActions";this.authInProgress=!1,this.tokenData=null,this.authToken=null,this.tokenGenerator=function(e,t){t("Token generator not set")};var n=null,i=null,o=!1,a=window.atob,s=window.btoa,c=function(e){return s(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},u=function(e){return s(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},l=function(e){return c(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},d=function(e){for(var t=a(e.replace(/[ \r\n]+$/,"")),n=[],r=0;r<t.length;++r){var i=t.charCodeAt(r).toString(16);1===i.length&&(i="0"+i),n.push(i)}return n.join("")},p={};p.cryptotype=null,window.crypto&&window.crypto.subtle?(p.cryptotype="standard",p.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(p.cryptotype="webkit",p.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(p.cryptotype="ie",p.subtlecrypto=window.msCrypto.subtle):(p.subtlecrypto=null,console.info("WebCryptography API not supported in this browser.")),p.sign=function(e,t,n,r){if("HS256"!==e.alg)return r("Use header.alg=HS256");e=JSON.stringify(e),"string"!=typeof t&&(t=JSON.stringify(t));var i=l(e)+"."+l(t);if(window.csioReactNative)return void window.csiosign(i,n,function(e,t){return e?(console.log("Token sign error",e),r(e)):r(null,t)});for(var o=new ArrayBuffer(i.length),a=new Uint8Array(o),s=i.length-1;s>=0;s--)a[s]=i.charCodeAt(s);var c=function(e){for(var t="",n=new Uint8Array(e),o=n.byteLength,a=0;a<o;a++)t+=String.fromCharCode(n[a]);return i+="."+u(t),r(null,i)},d=function(e){return r(e)},f={name:"HMAC"};"ie"!==p.cryptotype&&"webkit"!==p.cryptotype||(f.hash={name:"sha-256"});var h=p.subtlecrypto.sign(f,n,a);"ie"===p.cryptotype?(h.onerror=d,h.oncomplete=function(e){c(e.target.result)}):h.then(c).catch(d)},p.decode=function(e){try{return JSON.parse(a(e.split(".")[1]))}catch(e){return console.error("Couldn't decode token. ",e),null}},p.importKey=function(e,t,n){if(window.csioReactNative)return void t(e);if("webkit"===p.cryptotype)for(;e.length<32;)e+="\0";var r={kty:"oct",k:u(e),alg:"HS256"},i={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===p.cryptotype?r.extractable=!1:r.ext=!1,"webkit"===p.cryptotype&&(i=null,r.use="sig"),"ie"===p.cryptotype||"webkit"===p.cryptotype){var o=JSON.stringify(r);r=new Uint8Array(o.length);for(var a=0;a<o.length;a++)r[a]=o.charCodeAt(a)}var s=p.subtlecrypto.importKey("jwk",r,i,!1,["sign"]);"ie"===p.cryptotype?(s.onerror=n,s.oncomplete=function(e){t(e.target.result)}):s.then(t).catch(n)},this._isTokenValid=function(e,t,n){var i=!1;if(null===e)return!1;try{var o=p.decode(e);if(null!==o&&o.appID===t&&o.userID===encodeURIComponent(n)){var a=null;if(navigator.mozGetUserMedia){var s=o.expiry.split(" ").join("T");a=Date.parse(s)}else a=new Date(o.expiry);new Date(r())<a&&(i=!0)}return i}catch(e){}return!1},this.setupAuthToken=function(e){mt("csio_auth_data",JSON.stringify(e)),this.authToken=e,this.tokenData=p.decode(e),_e=parseInt(this.tokenData.submissionInterval,10),ie.setSubmissionInterval(_e),ie.setReportingMode(this.tokenData.adaptiveInterval),Te=this.tokenData.collectSDP},this.sendAuthenticationRequest=function(r,i,a){if(r&&i){if(e.authInProgress)return void V(a);null!==n&&(clearTimeout(n),n=null),f(),e.authInProgress=!0,e.tokenGenerator(o,function(s,c){if(null!==s)return e.authInProgress=!1,void(a&&a($e.tokenGenerationError,s.toString()));Hn(Z+"authenticate",{client_id:i+"@"+ae,code:c,grant_type:"authorization_code"},function(s,c){var u=null;e.authInProgress=!1,be.auth=c;try{u=JSON.parse(s.response)}catch(e){console.error("Authentication response parse error")}if(!u)return void(n=setTimeout(e.sendAuthenticationRequest,5e3,r,i,a));if(200===s.status){if("bearer"!==u.token_type)return console.error("Authentication was successful, but token type was not bearer. Scheduling retry."),void(n=setTimeout(e.sendAuthenticationRequest,5e3,r,i,a));e.setupAuthToken(u.access_token);var l=parseInt(1e3*parseInt(u.expires_in)*.9);if(h(l,r,i,a),o=!1,a&&a($e.success,"SDK authentication successful."),u.iceServers&&!de&&ve){try{ve.start(u.iceServers,Gt.bind(this))}catch(e){fe("start",e)}_t(ae,se,"log",{msg:"precalltest started"})}de&&_t(ae,se,"log",{msg:"precalltest disabled"}),Jt(),zn._isChannelReady()?(ke.sendCachedUserJoinedEvents(Oe),a&&a($e.success,"WebSocket establishment successful.")):zn._setupWebSocketConnection(function(e,t){a&&a(e,t)})}else{if(u[t]&&u[t].length>0)return v(r,i,a,u[t]);console.error("Authentication failed, but no error actions were defined in response."),n=setTimeout(e.sendAuthenticationRequest,5e3,r,i,a)}})})}};var f=function(){null!==i&&(clearTimeout(i),i=null)},h=function(t,n,r,o){f(),i=setTimeout(function(){e.sendAuthenticationRequest(n,r,o)},t)},v=function e(t,n,r,i){if(0!==i.length){var a=i.shift();return a.action===Et.RETRY?(h(a.params.timeout,t,n,r),e(t,n,r,i)):a.action===Et.GET_NEW_TOKEN?(o=!0,e(t,n,r,i)):a.action===Et.REPORT_ERROR?e(t,n,r,i):void 0}};this.appSecretTokenGenerator=function(t){var n=null,i=null,o=!1,a=null;t.indexOf(":")>-1&&(a=d(t.split(":")[0]),t=t.split(":")[1]);var s=function(e){t=null,n=e},c=function(e){o=!0,t=null,console.error("Couldn't import key",e)};return p.importKey(t,s,c),function(t,s){if(o)return s("appsecret based token generation failed");if(!t&&null!==i)return s(null,i);if(null===n)return setTimeout(function(){e.tokenGenerator(t,s)},100);var c={userID:se,appID:ae,exp:parseInt(r()/1e3)+3600,nbf:parseInt(r()/1e3)-3600};a&&(c.keyID=a),p.sign({alg:"HS256"},c,n,function(e,t){return e?s(e):(i=t,s(null,t))})}}},Oe=new De,Le=new Q;try{ge=Le.detectBrowserInfo()}catch(e){console.log("detectBrowserInfo: Error",e)}var Ne;window.csioReactNative||(Ne=Le.measureAppLoadingPerformance(ge),be.loading=Ne);var Me,xe={type:"browser",name:ge.name,ver:ge.ver,os:ge.os,osVersion:ge.osVersion,userAgent:ge.userAgent},Fe={},je={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},Ue=!0,Be=null,Ge=null,Je=2e4,He=100,Ve=null;"Firefox"===ge.name?Ve=mozRTCPeerConnection:"Chrome"===ge.name||"Opera"===ge.name?Ve=webkitRTCPeerConnection:"Safari"===ge.name?console.log("Browser type Safari"):"Edge"===ge.name&&(Ve=window.RTCPeerConnection);var We={fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},Ke={autoFabricSetup:"autoFabricSetup",userJoined:"userJoined",userLeft:"userLeft",refreshPresence:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDevices:"connectedDevices",iceCompleted:"iceCompleted",iceCandidateFound:"iceCandidateFound"},qe={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync",preCallTest:"preCallTest"},ze={results:"preCallTestResults",associate:"preCallTestAssociate"},Qe={success:"success",failure:"failure"},$e={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK"},Xe={authOngoing:"authOngoing"},Ye={peer:"peer",server:"server"},Ze={sendonly:"sendonly",receiveonly:"receiveonly",sendrecv:"sendrecv",inactive:"inactive"},et={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},tt={local:"local",remote:"remote"},nt={excellent:5,good:4,fair:3,poor:2,bad:1},rt={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},it={excellent:"excellent",fair:"fair",bad:"bad"},ot={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",checkingDisrupted:"checkingDisrupted"},at={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},st={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},ct={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},ut={video:{gThreshold:.8,rThreshold:.3}},lt={video:{gThreshold:400,rThreshold:1e3}},dt={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},pt={audio:{gThreshold:240,rThreshold:400}},ft={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},ht={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},vt=[Ke.userJoined,Ke.refreshPresence,We.fabricSetupFailed,We.applicationErrorLog],mt=function(e,t){try{window&&window.localStorage&&window.localStorage.setItem(e,t)}catch(e){return}},gt=function(e){try{if(window&&window.localStorage)return window.localStorage.getItem(e)}catch(e){return null}return null},yt=function(e){try{window&&window.localStorage&&window.localStorage.removeItem(e)}catch(e){return}},bt=function(e,n,r,i,o){var a=null,s=null,c=null,u=new XMLHttpRequest;if("Microsoft Internet Explorer"!==ge.name&&(u.timeout=r),u){u.open("GET",encodeURI(e));for(var l in n)u.setRequestHeader(l,n[l]);a=t(),u.onload=function(){s=t(),c=s-a,i(u,c)},u.ontimeout=o,u.send()}},St=function(e,t,n){var r=new XMLHttpRequest;r&&(r.open("POST",encodeURI(e)),r.setRequestHeader("Content-Type","application/json"),r.onload=function(){n(r)},r.send(t))},_t=function(e,t,n,r){if(Ce&&e){var i=Y+"generics",o={appID:e,userID:encodeURIComponent(t),version:ee,eventType:n,data:r},a=JSON.stringify(o);me!==a&&(me=a,St(i,a,function(e){200===e.status?console.log("Got generic response: %o",e.response):200!==e.status&&console.log("Got error for generic request %o, %s",e,e.status)}))}};window&&window.addEventListener&&window.addEventListener("error",function(e){if(e&&e.filename&&e.filename.indexOf("callstats")>-1){var t,n=!1,r={fileName:e.filename,line:e.lineno,col:e.colno,jsVersion:ee,eventType:"error",message:e.message,pageURL:window.location.href};for(t in Fe)Fe.hasOwnProperty(t)&&(r.conferenceID=t,_t(ae,se,"onErrorLog",r),n=!0);n||_t(ae,se,"onErrorLog",r)}});var Tt={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Et={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2},Ct=e(),wt=function(e,n,i){var o=RegExp.prototype.test.bind(/^([a-z])=(.*)/),a=/^ssrc:(\d*) ([\w_]*):(.*)/,s=/^ssrc-group:SIM (\d*)/;n.split(/(\r\n|\r|\n)/).filter(o).forEach(function(n){var o=n[0],c=n.slice(2);if("a"===o){if(a.test(c)){var u=c.match(a),l=u[1];void 0===e.ssrcMap[l]&&(e.ssrcMap[l]={}),e.ssrcMap[l][u[2]]=u[3],e.ssrcMap[l].localStartTime=t(),e.ssrcMap[l].syncedStartTime=r(),e.ssrcMap[l].streamType=i}s.test(c)&&(void 0===e.ssrcMap.ssrcGroup&&(e.ssrcMap.ssrcGroup={},e.ssrcMap.ssrcGroup[i]={}),e.ssrcMap.ssrcGroup[i].simulcastGroup=c.match(/\d+/g))}})},Rt=function(e,t){return e.ssrcMap[t]},kt=function(e){return e.ssrcMap},It=function(e,t,n,r,i,o){if(!i.localDescription||!i.remoteDescription)return!1;var a=i.localDescription.sdp,s=i.remoteDescription.sdp;if(!a||!s||a===r.localSDP&&s===r.remoteSDP)return!1;if(wt(r,a,rt.outbound),wt(r,s,rt.inbound),Te){var c={sdp:{}};c.sdp.localSDP=a!==r.localSDP?a:-1,c.sdp.remoteSDP=s!==r.remoteSDP?s:-1,Dt(e,t,n,c,r.pcHash,o)}return r.localSDP=a,r.remoteSDP=s,!0},Pt=function(e,t,n,i,o,a,s){if(!e)return void console.error("sendEvent: Invalid eventType ");var c=r(),u={version:ee,apiTS:c,action:e,localID:encodeURIComponent(se),remoteID:t?encodeURIComponent(t):null,conferenceID:encodeURIComponent(n),timeShift:0,appID:ae,ucID:i,pcID:a,deviceID:ue,value:o};return null===n?void _t(ae,se,"log",{msg:"conferenceID is null in sendEvent for "+e}):void H(qe.callStatsEvent,u,s)},At=function(e,t,n,i){if(!e)return void console.error("sendEvent: Invalid eventType ");var o=r(),a={version:ee,channel:qe.preCallTest,timestamp:o,apiTS:o,action:e,eventType:e,localID:encodeURIComponent(se),conferenceID:encodeURIComponent(t),timeShift:0,appID:ae,ucID:n,deviceID:ue,token:Oe.authToken};return e===ze.results&&(a.results=i,null==t)?void Qn(qe.preCallTest,a):(e===ze.associate&&(a.ids=i),void(n&&!Ue?H(qe.preCallTest,a):(a.clockUnsynced=Ue,ke.cacheEvent({channel:qe.preCallTest,data:a,callback:null}))))},Dt=function(e,t,n,i,o,a){var s=r(),c={version:ee,appID:ae,conferenceID:encodeURIComponent(t),ucID:n,apiTS:s,localID:encodeURIComponent(se),remoteID:encodeURIComponent(e),pcID:o,deviceID:ue,sdpPayload:i};Oe.authToken&&n&&!Ue?(c.token=Oe.authToken,H(qe.sdpSubmission,c,a)):(c.clockUnsynced=Ue,ke.cacheEvent({channel:qe.sdpSubmission,data:c,callback:a}),Oe.authToken||Oe.sendAuthenticationRequest(ae,se))},Ot=function(e,t,n,r,i,o,a){Zt(e,function(e){t.localCandidates=e.localIceCandidates,t.remoteCandidates=e.remoteCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.activeIceCandidatePair=Sn(t.iceCandidatePairs),a.currPair=t.activeIceCandidatePair,Pt(Ke.fabricStateChange,i,n,r,a,o)})},Lt=function(e){var t={connectedDevices:oe},n=Fe[e]?Fe[e].ucID:null;Pt(Ke.connectedDevices,null,e,n,t,null)},Nt=function(e){var t={ucID:Fe[e].ucID,endpoint:xe,magicKey:Ct};Pt(Ke.refreshPresence,null,e,Fe[e].ucID,t,null)},Mt=function(){var e={appID:ae,userID:encodeURIComponent(se),version:ee,endpoint:xe,pagePerf:Ne,endpointID:ue,action:"registerPresence",channel:qe.registerPresence};-1!==ae&&Oe.authToken&&(e.token=Oe.authToken,Qn(qe.registerPresence,e))},xt=function(e,t){var n={};return n.status=e,t&&(n.message=t),n},Ft=function(e,t){var n,r,i,o=0;if(!e)return o;for(n=0,i=e.length;n<i;n++)r=e.charCodeAt(n),o=(o<<5)-o+r,o|=0;return t&&t(o),o},jt=function(e,n,r,i,o,a){if(!e||!r||!n)return console.error("initialize: Argument missing/invalid"),xt(Qe.failure,"initialize: Argument missing/invalid");if(i&&"function"!=typeof i)return console.error("initialize: Argument missing/invalid"),xt(Qe.failure,"initialize: Argument missing/invalid");if(o&&"function"!=typeof o)return console.error("initialize: Argument missing/invalid"),xt(Qe.failure,"initialize: Argument missing/invalid");if("function"!=typeof n){if(!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle||window.csioReactNative))return console.error("Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),i&&i($e.tokenGenerationError,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),xt(Qe.failure,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API");n=Oe.appSecretTokenGenerator(n)}if("string"==typeof e&&(e=parseInt(e,10)),ae=e,"object"==(void 0===r?"undefined":s(r))?(se=r.aliasName,ce=r):se=r,be.initializeSinceCreate=t()-be.create,_t(ae,se,"log",{msg:"callstats initialize in progress"}),a&&(!0===a.disableBeforeUnloadHandler&&(le=!0),null===a.applicationVersion&&void 0===a.applicationVersion||(xe.appVer=a.applicationVersion),!0===a.disablePrecalltest&&(de=!0)),Oe.tokenGenerator=n,gt("csio_auth_data"))try{var c=JSON.parse(gt("csio_auth_data"));Oe._isTokenValid(c,ae,se)&&(i&&i($e.success,"SDK authentication successful."),Oe.setupAuthToken(c),Jt(),zn._isChannelReady()||zn._setupWebSocketConnection(i))}catch(e){console.log("initialize: Error",e)}l(),o&&(Se.stats=o);try{Oe.sendAuthenticationRequest(ae,se,i)}catch(e){console.log("initialize: Error",e)}return xt(Qe.success)},Ut=function(){be.sent||(be.remoteofferSinceCreate&&be.config||be.errorSinceCreate)&&(_t(ae,se,"timing",be),be.sent=!0)},Bt=function(e,t){"function"==typeof t&&Se.hasOwnProperty(e)&&(Se[e]=t)},Gt=function(e){_t(ae,se,"log",{msg:"precalltest finished"}),Se.preCallTest&&Se.preCallTest(e);try{ye.push(e.id);var t=null,n=null;for(var r in Fe)if(Fe.hasOwnProperty(r)){t=r,Fe[r].ucID&&(n=Fe[r].ucID);break}At(ze.results,t,n,e)}catch(e){fe("send results",e)}},Jt=function e(){var t="https://appsettings.callstats.io/v1/apps/"+ae,n={Authorization:"Bearer "+Oe.authToken};bt(t,n,2e3,function(t,n){200!==t.status&&setTimeout(function(){e()},100),be.config=n,Ut();var r=JSON.parse(t.response);if(_e=parseInt(r.default.submissionIntervalMs,10),ie.setSubmissionInterval(_e),"adaptiveInterval"in r.default&&ie.setReportingMode(r.default.adaptiveInterval),"collectSDP"in r.default&&(Te=r.default.collectSDP),"qmodelThresholdsAPI"in r.default){var i=r.default.qmodelThresholdsAPI;Jn("eModelThreshold",i,pt),Jn("throughputThreshold",i,ct),Jn("fractionalLossThreshold",i,dt),Jn("rttThreshold",i,lt),Jn("currOverPrevFrameRateThreshold",i,ut)}Se.configService&&Se.configService(r)},function(){console.log("Config service request timed out, retrying."),e()})},Ht=function(e){return function(t){return t.pc===e||!(!e.callstatsID||t.pcHash!==e.callstatsID)||void 0}},Vt=function(e,t){var n=null;return Fe[e]&&Fe[e].participants&&(n=Fe[e].participants.filter(Ht(t))),n&&n.length>0?n[0]:null},Wt=function(e,t){var n=null,r=null;return n=Vt(e,t),n&&(r=n.pcHash),r},Kt=function(e){var t=null,n=null,r=null;for(t in Fe)if(Fe.hasOwnProperty(t)&&(r=Vt(t,e))){n={fabric:r,conferenceID:t};break}return n},qt=function(e,t){var n=0;if(e&&Fe[t].participants)for(n=0;n<Fe[t].participants.length;n++)if(Fe[t].participants[n].pcHash===e.pcHash){Fe[t].participants.splice(n,1);break}},zt=function(e){if(e){var t=[],n=0;if(e&&e.result)t=e.result();else if(e&&e.forEach)e.forEach(function(e){t.push(e)});else for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},Qt=function(e){var t,n=null,r=null,i=null,o=[],a=[],s=[],c=0;if(!(n=zt(e)))return{localCandidates:o,remoteCandidates:a};for(c=0;c<n.length;++c)if(r=A(n[c]),i=k(r),i.localCandidate)o.push(i.localCandidate);else if(i.remoteCandidate)a.push(i.remoteCandidate);else if(i.Transport){if("transport"===i.Transport.type){t=i.Transport.selectedCandidatePairId;continue}s.push(i.Transport)}else i.candidatePair&&s.push(i.candidatePair);if(t)for(c=0;c<s.length;c++)s[c].id===t&&(s[c].googActiveConnection="true");return{localCandidates:o,remoteCandidates:a,iceCandidatePairs:s}},$t=function(e){function t(t){var n={};n=Qt(t),e(n)}return t},Xt=function(e){var t=null;return e&&(t=e.message+" : "+e.stack),t},Yt=function(e,t,n,r,i,o){var a=ge.codebase,s=ge.name;if(a===ft.firefox)if(we)try{e.getStats().then(n(t,r,i,o,e)).catch(function(s){we=!1,_t(ae,r,"log",{msg:"### "+a+" getStats reports error "+Xt(s)}),e.getStats(null,n(t,r,i,o,e))})}catch(s){we=!1,_t(ae,r,"log",{msg:"### "+a+" getStats reports error "+Xt(s)}),e.getStats(null,n(t,r,i,o,e))}else e.getStats(null,n(t,r,i,o,e),function(e){console.log("getstats error ",e)});else if("Safari"===s)e.getStats().then(n(t,r,i,o,e)).catch(function(e){_t(ae,r,"log",{msg:"### "+a+" getStats reports error "+Xt(e)})});else if(a===ft.chrome)if(window&&window.csioReactNative)e.getStats(null,n(t,r,i,o,e),function(e){_t(ae,r,"log",{msg:"### "+a+" getStats reports error "+Xt(e)})});else if(we)try{e.getStats().then(n(t,r,i,o,e)).catch(function(s){we=!1,_t(ae,r,"log",{msg:"### "+a+" getStats reports error "+Xt(s)}),e.getStats(n(t,r,i,o,e))})}catch(s){we=!1,_t(ae,r,"log",{msg:"### "+a+" getStats reports error "+Xt(s)}),e.getStats(n(t,r,i,o,e))}else e.getStats(n(t,r,i,o,e));else a===ft.edge&&e.getStats().then(n(t,r,i,o,e)).catch(function(e){_t(ae,r,"log",{msg:"### "+a+" getStats reports error "+Xt(e)})})},Zt=function(e,t){try{Yt(e,t,$t)}catch(e){console.log("csioGetStats: Error",e)}},en=function(e,t,n,r){if(n||(n=re),!e||!t)return console.error("sendFabricEvent: Arguments missing/Invalid"),xt(Qe.failure,"sendFabricEvent: Arguments missing/Invalid");if(!ae||!se||!Fe[n])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),xt(Qe.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(t===We.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),xt(Qe.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!h(e))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),xt(Qe.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!We.hasOwnProperty(t)&&!Ke.hasOwnProperty(t))return console.error("sendFabricEvent: Invalid fabricEvents value: ",t),xt(Qe.failure,"sendFabricEvent: Invalid fabricEvents value: "+t);var i={},o=null,a=Fe[n],s=null;if(void 0===a)return console.error("sendFabricEvent: Conference ID not found!"),xt(Qe.failure,"sendFabricEvent: Conference ID not found!");if(null===(s=Vt(n,e)))return console.error("sendFabricEvent: fabricData is null"),xt(Qe.failure,"sendFabricEvent: fabricData is null");if(o=s.remoteUserID,t===We.activeDeviceList){if(!r||!r.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),xt(Qe.failure,"sendFabricEvent: Arguments missing/Invalid");if(!(r.deviceList instanceof Array))return console.error("sendFabricEvent: DeviceList Invalid"),xt(Qe.failure,"sendFabricEvent: DeviceList Invalid");i={magicKey:Ct,endpoint:xe,activeDevicelist:r.deviceList}}if(Pt(t,o,n,a.ucID,i,s.pcHash,s.pcCallback),t===We.fabricTerminated){if(Fe[n].participants){s&&(s.statsInterval=M(s.statsInterval),qt(s,n));var c=U(n);c.conferenceFinished&&B(n,c.ucID)}}else t===We.fabricHold?(s.statsInterval=M(s.statsInterval),s.onHold=!0):t===We.fabricResume&&(s.onHold=!1,Tn(s,e,n,o));return xt(Qe.success)},tn=function(e){return e.length>2e4&&(console.log("Log exceeds 20kb, It will be truncated"),e=e.substring(0,2e4)),e},nn=function(e){return e&&"string"==typeof e?e=tn(e):e&&"object"==(void 0===e?"undefined":s(e))&&e.message&&(e.message=tn(e.message)),e},rn=function(e,t,n){return t||(e&&e[n]?e[n].sdp:-1)},on=function(n,r,i,o,a,c){if(r||(r=re),void 0===n||!i)return console.error("reportError: Arguments missing/invalid"),xt(Qe.error,"reportError: Arguments missing/invalid");if(!ae||!se)return console.error("reportError: SDK is not initialized"),xt(Qe.error,"reportError: SDK is not initialized");if(!at.hasOwnProperty(i))return console.error("reportError: Invalid webRTC functionName value: %o",i),xt(Qe.error,"reportError: Invalid webRTC functionName value: "+i);void 0===o&&console.warn("reportError: Missing dom error parameter");var u,l,d=null,p=null,f=t(),v=Fe[r],m=null,g=f,y=null,b=null,S=null,_=null;if(S=J(r),u=R(i),i!==at.getUserMedia&&(_=e()),o)if(window.DOMException&&o instanceof window.DOMException)o={message:o.message,name:o.name};else if("object"==(void 0===o?"undefined":s(o))){var T={};o.message&&(T.message=o.message),o.name&&(T.name=o.name),o.constraintName&&(T.constraintName=o.constraintName),o.stack&&(T.stack=o.stack),o=T}if(o=nn(o),h(n)){if(v&&(S=v.ucID),(m=Vt(r,n))&&(p=m.remoteUserID,g=m.startTime,y=m.pcState,b=m.pc.iceConnectionState,_=m.pcHash,l=m.pcCallback),d={failureDelay:f-g,reason:u,domError:o,fabricState:y,iceConnectionState:b,function:i,magicKey:Ct,endpoint:xe},i===at.applicationLog||i===at.applicationError?Pt(We.applicationErrorLog,p,r,S,d,_,l):(Pt(We.fabricSetupFailed,p,r,S,d,_,l),be.errorSinceCreate=t()-be.create,Ut()),a||c||n&&n.localDescription||n&&n.remoteDescription){var E={sdp:{}};E.sdp.localSDP=rn(n,a,"localDescription"),E.sdp.remoteSDP=rn(n,c,"remoteDescription"),Dt(p,r,S,E,_)}}else null===Ct&&(Ct=e()),d={failureDelay:0,reason:u,domError:o,function:i,magicKey:Ct,endpoint:xe},i===at.applicationLog||i===at.applicationError?Pt(We.applicationErrorLog,p,r,S,d,null,null):Pt(We.fabricSetupFailed,p,r,S,d,_,null);return xt(Qe.success)},an=function(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t[t.length]=r:r>127&&r<2048?(t[t.length]=r>>6|192,t[t.length]=63&r|128):(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128,t[t.length]=63&r|128)}return new Uint8Array(t).buffer},sn=function(e){for(var t,n=new DataView(e),r="",i=0;i<n.byteLength;i++)t=n.getUint8(i).toString(16),t.length<2&&(t="0"+t),r+=t;return r},cn=function(e,t){var n={name:"SHA-256"};if(window.crypto){var r=window.crypto.subtle||window.crypto.webkitSubtle;if(!r)return void Ft(e,t);r.digest(n,an(e)).then(function(e){t(sn(e))}).catch(function(){Ft(e,t)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void Ft(e,t);var i=window.msCrypto.subtle.digest(n,an(e));i.oncomplete=function(e){e.target&&t(sn(e.target.result))},i.onerror=function(){Ft(e,t)}}else Ft(e,t)},un=function(e,t,n){var r;if(!t||!e)return console.error("sendUserFeedback: Arguments missing/Invalid"),xt(Qe.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=(void 0===t?"undefined":s(t)))return console.error("sendUserFeedback: Invalid feedback object."),xt(Qe.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(t).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),xt(Qe.error,"sendUserFeedback: Feedback data object must not be empty.");var i=Fe[e],o=null;void 0!==i&&void 0!==i.ucID&&(o=i.ucID);var a=null;if(a=null===Ct?Be:Ct,null===o&&(o=J(e)),null===o)return console.error("sendUserFeedback: ucID unavailable"),xt(Qe.error,"sendUserFeedback: ucID unavailable");r="object"==s(t.userID)?t.userID.aliasName:t.userID,t&&t.overall<=0&&(t.overall=null);var c={conferenceID:encodeURIComponent(e),magicKey:a,appID:ae,version:ee,ucID:o,userID:encodeURIComponent(r),userQoe:{overall:t.overall}};return t.video&&(c.userQoe.video=t.video),t.audio&&(c.userQoe.audio=t.audio),t.screen&&(c.userQoe.screen=t.screen),t.comment&&(c.userQoe.comment=t.comment),Oe.authToken&&!Ue?(c.token=Oe.authToken,mt("feedback",JSON.stringify(c)),H(qe.userFeedback,c,n)):(c.clockUnsynced=Ue,ke.cacheEvent({channel:qe.userFeedback,data:c,callback:n}),Oe.sendAuthenticationRequest(ae,r)),xt(Qe.success)},ln=function(e,t,n,r,i,o){var a=null;if(a="object"==(void 0===t?"undefined":s(t))?t.aliasName:t,n||(n=re),!(e&&r&&i&&a))return console.error("associateMstWithUserID: Arguments missing"),xt(Qe.error,"associateMstWithUserID: Arguments missing");if(!h(e))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),xt(Qe.error,"associateMstWithUserID: Invalid PeerConnection object passed");if(void 0===Fe[n])return console.error("associateMstWithUserID: conferenceID doesn't exist"),xt(Qe.error,"associateMstWithUserID: conferenceID doesn't exist");var c=null;if(null===(c=Vt(n,e)))return console.error("associateMstWithUserID: Unknown pcObject passed"),xt(Qe.error,"associateMstWithUserID: Unknown pcObject passed");var u=Rt(c,r);return void 0===u&&(c.ssrcMap[r]={},u=Rt(c,r)),u.remoteUserID=a,u.ssrc=r,u.associatedVideoTag=o,u.usageLabel=i,o&&a!==se&&f(n,o,e,r),xt(Qe.success)},dn=function(e){if(Fe[re]){var t=Fe[re].participants;if(t)for(var n=0;n<t.length;n++)t[n].conferenceID=e}},pn=function(e){ke.updateConferenceId(encodeURIComponent(e))},fn=function(e,t){var n=Kt(t);n&&ke.updateRemoteUserID(e,n.fabric.pcHash)},hn=function(e,t){var n=null;(n=Kt(t))&&(n.fabric.remoteUserID=e)},vn=function(){ke.sendCachedUserJoinedEvents(Oe),ke.sendCachedEvents(Oe,Ue)},mn=function(e,t){return e?(e.conferenceID&&(console.log("setIdentifiers: update conf ID ",e.conferenceID),dn(e.conferenceID),Fe[e.conferenceID]=Fe[re],pn(e.conferenceID),vn()),e.remoteUserID&&t&&(fn(e.remoteUserID,t),hn(e.remoteUserID,t),vn()),xt(Qe.success)):(console.error("setIdentifiers: Arguments missing/Invalid"),xt(Qe.error,"_setIdentifiers: Arguments missing/Invalid"))},gn=function(e){return window&&!window.csioproxy?(console.error("setCallstatsURLs: cannot be called if window.csioproxy is false"),xt(Qe.error,"setCallstatsURLs: cannot be called if window.csioproxy is false")):e?(e.collectorURL&&(Y=e.collectorURL),e.authServiceURL&&(Z=e.authServiceURL),e.csioInternalAPIURL&&(ne=e.csioInternalAPIURL),e.wsURL&&(te=e.wsURL),Ce=!0,Vn(),Wn(),q(),xt(Qe.success)):(console.error("setCallstatsURLs: Arguments missing/Invalid"),xt(Qe.error,"setCallstatsURLs: Arguments missing/Invalid"))},yn=function(n,r,i,o,a,c){var l=null,d=Ye.peer,p=Ze.sendrecv,f={authStatus:!!Oe.tokenData,clockSync:!Ue,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:o,version:ee};if(q(),_t(ae,se,"stateMachine",f),l=r&&"object"==(void 0===r?"undefined":s(r))?r.aliasName:r,o||(o=re),!n||!i)return console.error("addNewFabric: Arguments missing/Invalid"),xt(Qe.error,"addNewFabric: Arguments missing/Invalid");if(!ae||!se)return console.error("addNewFabric: SDK not initialized."),xt(Qe.error,"addNewFabric: SDK not initialized");if(!h(n))return console.error("addNewFabric: Invalid PeerConnection object passed"),xt(Qe.error,"addNewFabric: Invalid PeerConnection object passed");if(!et.hasOwnProperty(i)||i instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),xt(Qe.error,"addNewFabric: Invalid fabricUsage value");if(a&&"function"!=typeof a){if(a.remoteEndpointType){if(!Ye.hasOwnProperty(a.remoteEndpointType))return console.error("addNewFabric: Invalid remoteEndpointType value"),xt(Qe.error,"addNewFabric: Invalid remoteEndpointType value");d=a.remoteEndpointType}if(a.fabricTransmissionDirection){if(!Ze.hasOwnProperty(a.fabricTransmissionDirection))return console.error("addNewFabric: Invalid fabricTransmissionDirection value"),xt(Qe.error,"addNewFabric: Invalid fabricTransmissionDirection value");p=a.fabricTransmissionDirection}}var v=t();be.addnewfabricSinceCreate=v-be.create,Ut(),null===Ct&&(Ct=e());var m=!1;if(!F(o)){var g=O(Ct);Pt(Ke.userJoined,null,o,null,g,null,null),m=!0,f={authStatus:!!Oe.tokenData,clockSync:!Ue,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:o,version:ee},_t(ae,se,"stateMachine",f)}if(L(o,null,m),!Vt(o,n)){n&&new X(n,Ln,Dn,_n,An);var y=e(),b={pc:n,remoteUserID:l,fabricUsage:i,magicKey:Ct,startTime:v,pcCallback:c,pcState:ot.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:n.iceConnectionState,latestEventSent:v,pcHash:y,localSDP:-1,remoteSDP:-1,statsInterval:null,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0,currentActivePhaseIndex:0,onHold:!1,ssrcMap:{},conferenceID:o,remoteEndpointType:d,fabricTransmissionDirection:p};"function"!=typeof n||n.callstatsID||(n.callstatsID=y),"connected"!==n.iceConnectionState&&"completed"!==n.iceConnectionState||(b.pcState=ot.established),j(o,b),b.pcState===ot.established&&(Mn(n,Ke.autoFabricSetup,o),Tn(b,n,o))}if(u(o),ve)try{var S=ye;ye=[];var _=null;if(_=ve.getId(),_&&S.push(_),S.length>0){var T=Fe[o].ucID;At(ze.associate,o,T,S)}}catch(e){fe("send associate",e)}return xt(Qe.success)},bn=function(e,t,n,r){if(!(e&&n&&r&&t))return console.error("reportUserIDChange: Arguments missing/Invalid"),xt(Qe.error,"reportUserIDChange: Arguments missing/Invalid");if(!ae||!se)return console.error("reportUserIDChange: SDK not initialized."),xt(Qe.error,"reportUserIDChange: SDK not initialized");if(""===n||""===t)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),xt(Qe.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!h(e))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),xt(Qe.error,"reportUserIDChange: Invalid PeerConnection object passed");var i=null,o=Fe[t];if(void 0===o)return console.error("reportUserIDChange: Conference ID not found!"),xt(Qe.error,"reportUserIDChange: Conference ID not found!");var a=null;if(void 0===o.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),_t(ae,se,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),xt(Qe.error,"reportUserIDChange: addNewFabric was not called");if(a=o.ucID,null===(i=Vt(t,e)))return console.error("reportUserIDChange: Invalid pcObject passed as argument"),xt(Qe.error,"reportUserIDChange: Invalid pcObject passed as argument");var s={id:n,idType:r};return Pt(We.userIDChangedEvent,void 0,t,a,s,null,i.pcCallback),xt(Qe.success)},Sn=function(e){var t=null;if(e&&e.length>0){var n=e.filter(function(e){return"true"===e.selected||"true"===e.googActiveConnection||!0===e.selected||!0===e.googActiveConnection});n.length>0&&(t=n[0])}return t},_n=function(e,n){if(e){var r,i=null;if(void 0!==n){var o=n.signalingState;if((i=Kt(n))&&i.fabric){r=i.fabric.signalingState,i.fabric.signalingState=o;var a=i.conferenceID,s=i.fabric,c=s.remoteUserID,u=Fe[a].ucID,l={changedState:ht.signalingState,prevState:r,newState:o};if(Ot(n,s,a,u,c,s.pcHash,l),"closed"===o&&(en(n,We.fabricTerminated,i.conferenceID),ve))try{ve.callFinished()}catch(e){fe("callFinished",e)}}if("have-remote-offer"===o||"stable"===o){if(be.remoteofferSinceCreate=t()-be.create,Ut(),ve)try{ve.callStarts()}catch(e){fe("callStarts",e)}_t(ae,se,"log",{msg:"precalltest told to stop"})}}}},Tn=function(e,n,r){if(!e.onHold){var i=n,o=r;null===e.statsInterval&&(e.statsPollingStart=t(),Nn(i,o),e.statsInterval=setInterval(function(){Nn(i,o)},1e3))}},En=function(e,t,n,r,i,o){Zt(e,function(e){t.localCandidates=e.localIceCandidates,t.remoteCandidates=e.remoteCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.activeIceCandidatePair=Sn(t.iceCandidatePairs),o.localCandidates=t.localCandidates,Pt(Ke.iceFailed,n,r,i,o,t.pcHash,t.pcCallback)})},Cn=function(e,t,n,r){var i=t.iceConnectionState,o=t.remoteUserID,a=Fe[n],s={prevIceConnectionState:i,currIceConnectionState:e.iceConnectionState,currPair:t.activeIceCandidatePair,failureDelay:r};t.pcState=ot.failed,"checking"===i?En(e,t,o,n,a.ucID,s):"completed"===i||"connected"===i?Pt(Ke.fabricDropped,o,n,a.ucID,s,t.pcHash,t.pcCallback):"disconnected"===i&&t.established?Pt(Ke.fabricDropped,o,n,a.ucID,s,t.pcHash,t.pcCallback):"disconnected"===i&&En(e,t,o,n,a.ucID,s)},wn=function(e,n,r,i){var o=n.iceConnectionState,a=n.remoteUserID,s=Fe[r],c=t(),u={prevIceConnectionState:o,currIceConnectionState:e.iceConnectionState,prevPair:n.activeIceCandidatePair},l=n.pcState===ot.disrupted,d="completed"===e.iceConnectionState;n.connectivityIceStatusDelay=i,n.established=!0,Zt(e,function(e){if(n.localCandidates=e.localIceCandidates,n.remoteCandidates=e.remoteCandidates,n.iceCandidatePairs=e.iceCandidatePairs,n.activeIceCandidatePair=Sn(n.iceCandidatePairs),u.currPair=n.activeIceCandidatePair,u.disruptionDelay=c-n.disruptedTS,l)Pt(Ke.iceDisruptionEnd,a,r,s.ucID,u,n.pcHash);else if(d){var t={};t.iceCandidatePairs=e.iceCandidatePairs,Pt(Ke.iceCompleted,a,r,s.ucID,t,n.pcHash)}}),Mn(n.pc,Ke.autoFabricSetup,r),n.pcState=ot.established,Tn(n,e,r,a)},Rn=function(e,n,r){var i=n.iceConnectionState,o=n.remoteUserID,a=Fe[r],s=t(),c={prevIceConnectionState:i,currIceConnectionState:e.iceConnectionState,prevIceConnectionStateTs:n.iceConnectionStateTS,currPair:n.activeIceCandidatePair};n.startTime=s,"connected"===i||"completed"===i?(n.pcState=ot.disrupted,n.disruptedTS=s,Pt(Ke.iceDisruptionStart,o,r,a.ucID,c,n.pcHash,n.pcCallback),n.pcCallback&&n.pcCallback($e.appConnectivityError,"Connectivity check for PC object to "+o+" failed.")):"checking"===i&&(n.pcState=ot.checkingDisrupted,n.disruptedTS=s,Pt(Ke.iceConnectionDisruptionStart,o,r,a.ucID,c,n.pcHash,n.pcCallback),n.pcCallback&&n.pcCallback($e.appConnectivityError,"Connectivity check for PC object to "+o+" failed."))},kn=function(e,t,n,r){var i=t.iceConnectionState,o=t.remoteUserID,a=Fe[n],s={prevIceConnectionState:i,currIceConnectionState:e.iceConnectionState};"new"===i||"checking"===i?(s.failureDelay=r,Pt(Ke.iceAborted,o,n,a.ucID,s,t.pcHash,t.pcCallback)):(s.currPair=t.activeIceCandidatePair,Pt(Ke.iceTerminated,o,n,a.ucID,s,t.pcHash,t.pcCallback))},In=function(e,t,n){var r=t.iceConnectionState,i=t.remoteUserID,o=Fe[n],a={prevIceConnectionState:r,currIceConnectionState:e.iceConnectionState,prevPair:t.activeIceCandidatePair};"new"!==r&&(t.established=!1,Pt(Ke.iceRestarted,i,n,o.ucID,a,t.pcHash,t.pcCallback))},Pn=function(e,n,r,i){var o=n.iceConnectionState,a=n.remoteUserID,s=Fe[r],c=t(),u={prevIceConnectionState:o,currIceConnectionState:e.iceConnectionState};n.gatheringIceCandidatesDelay=i,"disconnected"===o&&n.pcState===ot.checkingDisrupted&&(u.disruptionDelay=c-n.disruptedTS,Pt(Ke.iceConnectionDisruptionEnd,a,r,s.ucID,u,n.pcHash,n.pcCallback))},An=function(e,t){if(e&&void 0!==t){var n=null;(n=Kt(t))&&n.fabric&&n.fabric.numNegotiationNeededCalls++}},Dn=function(e,n){if(e&&void 0!==n){var r,i,o,a,s,c=null,u=null;if((u=Kt(n))&&u.fabric){c=u.fabric,r=u.conferenceID,i=t(),o=i-c.startTime,a=c.iceConnectionState,s=c.iceGatheringState;var l=c.remoteUserID,d=Fe[r].ucID,p={changedState:ht.iceConnectionState,prevState:a,newState:n.iceConnectionState};if(Ot(n,c,r,d,l,c.pcHash,p),s!==n.iceGatheringState){var f={changedState:ht.iceGatheringState,prevState:s,newState:n.iceGatheringState};Ot(n,c,r,d,l,c.pcHash,f)}"complete"===n.iceGatheringState&&"checking"===n.iceConnectionState&&Pn(n,c,r,o),"connected"===n.iceConnectionState||"completed"===n.iceConnectionState?wn(n,c,r,o):"failed"===n.iceConnectionState?Cn(n,c,r,o):"disconnected"===n.iceConnectionState?Rn(n,c,r):"closed"===n.iceConnectionState?kn(n,c,r,o):"new"===n.iceConnectionState&&In(),c.iceConnectionState=n.iceConnectionState,c.iceGatheringState=n.iceGatheringState,c.iceConnectionStateTS=t()}}},On=function(e,t){var n=Kt(e);if(n&&n.fabric){var r=n.fabric,i=r.remoteUserID,o=n.conferenceID,a=Fe[o].ucID;Pt(Ke.iceCandidateFound,i,o,a,t,r.pcHash)}},Ln=function(e,t){var n,r,i;if(void 0!==t){if(null!==e.candidate){r=e.candidate.candidate.split(" ");var o="1"===r[1]?"rtp":"rtcp";"0"!==r[5]&&(i=-1!==r[4].indexOf(":"),n={transport:r[2],protocol:o,typePreference:r[3],address:i?"["+r[4]+"]:"+r[5]:r[4]+":"+r[5],type:r[7],media:e.candidate.sdpMid})}var a=null;(a=Kt(t))&&a.fabric&&(void 0!==n&&-1===a.fabric.iceCandidates.indexOf(n)&&a.fabric.iceCandidates.push(n),n&&a.fabric.fabricSetupSent&&On(t,n))}},Nn=function(e,t){if(!Fe.hasOwnProperty(t))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",t);if("closed"===e.signalingState)return en(e,We.fabricTerminated,t),!0;var n=Vt(t,e);if(n.pcState!==ot.established&&n.lastFabricState===n.pcState&&"connected"!==e.iceConnectionState&&"completed"!==e.iceConnectionState)return!0;var r=Fe[t].ucID;try{Yt(e,n.pcCallback,w,se,r,n)}catch(e){console.log("csioGetStats: Error",e)}},Mn=function(e,n,r){var i,o=null,a=Fe[r],s=null,c=t();if(void 0===a&&console.error("sendAutoFabricSetupEvent: Conference ID not found!"),s=Vt(r,e),null===s&&console.error("sendAutoFabricSetupEvent: fabricData is null"),!s.fabricSetupSent){o=s.remoteUserID,i=c-s.startTime;var u={setupDelay:i,iceGatheringDelay:s.gatheringIceCandidatesDelay,iceConnectivityDelay:s.connectivityIceStatusDelay,remoteEndpointType:s.remoteEndpointType,fabricTransmissionDirection:s.fabricTransmissionDirection};Ue||(u.clockSyncOffset=je.currentOffset),Zt(e,function(e){u.localCandidates=e.localCandidates,u.remoteCandidates=e.remoteCandidates,u.iceCandidatePairs=e.iceCandidatePairs,s.localCandidates=e.localCandidates,s.remoteCandidates=e.remoteCandidates,s.iceCandidatePairs=e.iceCandidatePairs,s.pcState=ot.established,s.fabricSetupSent=!0,s.activeIceCandidatePair=Sn(s.iceCandidatePairs),Pt(n,o,r,a.ucID,u,s.pcHash,s.pcCallback)})}},xn=function(e,t,n){var r={},i=null,o=Fe[n],a=null;void 0===o&&console.error("sendFabricTransportSwitchEvent: Conference ID not found!"),a=Vt(n,e),null===a&&console.error("sendFabricTransportSwitchEvent: fabricData is null"),i=a.remoteUserID,r.prevPair=a.activeIceCandidatePair,Zt(e,function(e){r.currPair=Sn(e.iceCandidatePairs),a.activeIceCandidatePair=r.currPair,r.switchDelay=null,r.relayType=a.transportData.relayType,Pt(t,i,n,o.ucID,r,a.pcHash,a.pcCallback)})},Fn=function(e,t){if(e.trackStats){var n=e.trackStats.filter(function(e){return e.id===t});if(n.length>0)return n[0]}},jn=function(e,t){if(e.codec){var n=e.codec.filter(function(e){return e.id===t});if(n.length>0)return n[0]}},Un=function(e,t){if(e.candidatePair){var n=e.candidatePair.filter(function(e){return e.id===t});if(n.length>0)return n[0]}},Bn=function(e){for(var t,n,r=e.Transport.length,i=0;i<r;i++)n=e.Transport[i],n.selectedCandidatePairId&&(t=Un(e,n.selectedCandidatePairId))&&(e.Transport[i]=C(e.Transport[i],t));return e},Gn=function(e){for(var t,n,r,i=e.streams.length,o=0;o<i;o++)t=e.streams[o],t.data.trackId&&(n=Fn(e,t.data.trackId))&&(e.streams[o].data=C(e.streams[o].data,n)),t.data.codecId&&(r=jn(e,t.data.codecId))&&(e.streams[o].data=C(e.streams[o].data,r));return e},Jn=function(e,t,n){t.hasOwnProperty(e)&&(t[e].hasOwnProperty("video")&&(t[e].video.isGreaterBetter?(n.video.gThreshold=t[e].video.upperThreshold,n.video.rThreshold=t[e].video.lowerThreshold):(n.video.gThreshold=t[e].video.lowerThreshold,n.video.rThreshold=t[e].video.upperThreshold)),t[e].hasOwnProperty("audio")&&(t[e].audio.isGreaterBetter?(n.audio.gThreshold=t[e].audio.upperThreshold,n.audio.rThreshold=t[e].audio.lowerThreshold):(n.audio.gThreshold=t[e].audio.lowerThreshold,n.audio.rThreshold=t[e].audio.upperThreshold)))},Hn=function(e,n,r){var i=[],o=null,a=null;for(var s in n)n.hasOwnProperty(s)&&i.push(encodeURIComponent(s)+"="+encodeURIComponent(n[s]));var c=i.join("&"),u=new XMLHttpRequest;u.open("POST",e),u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o=t(),u.onload=function(){a=t(),r(u,a-o)},u.send(c)},Vn=function(){bt(ne,null,5e3,function(e){if(200===e.status)try{var t=JSON.parse(e.responseText);Jn("eModelThreshold",t,pt),Jn("throughputThreshold",t,ct),Jn("fractionalLossThreshold",t,dt),Jn("rttThreshold",t,lt),Jn("currOverPrevFrameRateThreshold",t,ut)}catch(e){return e}},function(){Ue&&Wn()})},Wn=function e(){var n=Y+"clockSync",r=null,i=null;bt(n,null,5e3,function(n,o){200===n.status?(r=JSON.parse(n.response),i=t(),Kn(r,o,i)):Ue&&setTimeout(function(){e()},100)},function(){Ue&&e()})},Kn=function(e,t,n){if(Ue){var r=t/2;if(r>je.maxAllowedLatency)je.offsetResults=[],_t(ae,se,"log",{msg:"clockSync restarting"});else{var i=e.now+r,o=i-n;je.offsetResults.push(o)}if(je.offsetResults.length>=je.syncAttempts){var a=je.offsetResults.reduce(function(e,t){return e+t});je.currentOffset=a/je.offsetResults.length,je.offsetResults=[],Ue=!1,_t(ae,se,"log",{msg:"clockSync Done"}),ke.sendCachedUserJoinedEvents(Oe),ke.sendCachedEvents(Oe,Ue)}else Ue&&setTimeout(function(){Wn()},100)}},qn=function(){var e=this,n=null,r=!1,i=!1,o={},a={initiated:"initiated",connected:"connected",closed:"closed"};this._wsConnectionState=a.closed;var s=function(e,t){try{if(window&&window.sessionStorage){var n=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));n||(n={}),n[e]||(n[e]={}),n[e].ucID=t,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(n))}}catch(e){return}o[e]="https://dashboard.callstats.io/apps/"+ae+"/conferences/"+encodeURIComponent(e)+"/"+t+"/general"};this.getConferenceURL=function(){return o},this._setupWebSocketConnection=function(o){return e._wsConnectionState===a.initiated||e._wsConnectionState===a.connected?(_t(ae,se,"log",{msg:"### _setupWebSocketConnection is called when already connected!"}),console.log("### _setupWebSocketConnection is called when already connected!"),void(o&&o($e.success,"WebSocket establishment successful."))):(e._wsConnectionState=a.initiated,n=new WebSocket(te,"echo-protocol"),n.onopen=function(){console.log("**** Successfully connected to the backend ",i,se),_t(ae,se,"log",{msg:"Successfully connected to the backend"}),e._wsConnectionState=a.connected,r?i=!0:r=!0,je.syncHandler||(_t(ae,se,"log",{msg:"start clockSync"}),je.offsetResults=[],Wn(),je.syncHandler=!0),ke.sendCachedUserJoinedEvents(Oe),i?(G(),ke.sendCachedEvents(Oe,Ue)):Mt(),i=!1},n.onclose=function(){e._wsConnectionState=a.closed,console.log("**** Connection to the server closed."),_t(ae,se,"log",{msg:"Connection to the server closed."}),x(),Ue&&(je.offsetResults=[],je.syncHandler=null,Ue=!1),n&&(n=null),o&&o($e.httpError,"Connection to the server closed.")},n.onerror=function(t){e._wsConnectionState=a.closed,_t(ae,se,"log",{msg:"WebSocket establishment failed."}),console.log("WebSocket establishment failed.",t),o&&o($e.wsChannelFailure,"WebSocket establishment failed.",t)},void(n.onmessage=function(e){var n,r=e.data,i=t(),a=JSON.parse(r);if("Error"===a.status)"Invalid client token."===a.reason&&(Oe.tokenData=null,Oe.authToken=null,Oe.sendAuthenticationRequest(ae,se)),o&&o($e.csProtoError,r.reason);else if("200 OK"===a.status)if("feedback"===a.event)yt("feedback");else if(a.event===Ke.userJoined||a.event===Ke.refreshPresence){var c=!1,u=null;n=decodeURIComponent(a.conferenceID),Fe.hasOwnProperty(n)&&(Fe[n].ucID!==a.ucID&&(c=!0,s(n,a.ucID),u=a.conferenceCreationTS?a.conferenceCreationTS:a.conferenceDuration),a.event!==Ke.userJoined||Fe[n].refreshPresence||(Fe[n].refreshPresence=function(e){return setInterval(function(){Nt(e)},Ee)}(n),z()),Fe[n].ucID=a.ucID),ke.sendCachedFeedback(),ke.sendCachedEvents(Oe,Ue,c,u,n,a.ucID)}else a.event===qe.clockSync?Kn(a,i):a.event===We.fabricSetupFailed&&(n=decodeURIComponent(a.conferenceID),a.ucID&&(s(n,a.ucID),ke.sendCachedFeedback(),ke.sendCachedEvents(Oe,Ue,!0,0,n,a.ucID)))}))},this._isChannelReady=function(){return!(!n||1!==n.readyState)},this.getWSConnectionState=function(){return n?n.readyState:-1},this.send=function(e){n.send(JSON.stringify(e))}},zn=new qn,Qn=function(e,t,n){if(zn._isChannelReady())try{zn.send(t)}catch(r){r&&"InvalidStateError"===r.name&&ke.cacheEvent({channel:e,data:t,callback:n})}else ke.cacheEvent({channel:e,data:t,callback:n}),zn._setupWebSocketConnection()};return function(){navigator&&"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(e){Me=e})}(),function(){if(null===(ue=gt("endpointID"))){var e=t(),n=Math.random()*e;cn(n.toString(),function(e){ue=e,mt("endpointID",ue)})}}(),function(){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,i=arguments[1],o=0;o<r;o++)if(t=n[o],e.call(i,t,o,n))return t}})}(),window&&!window.csioproxy&&(Ce=!0,Vn(),Wn()),window&&window.csioChromeLegacyGetStats&&(we=!1),{version:ee,initialize:jt,on:Bt,fabricEvent:We,addNewFabric:yn,sendFabricEvent:en,sendUserFeedback:un,associateMstWithUserID:ln,csError:$e,fabricUsage:et,qualityRating:nt,webRTCFunctions:at,reportError:on,reportUserIDChange:bn,userIDType:tt,setProxyConfig:gn,callStatsAPIReturnStatus:Qe,setIdentifiers:mn,transmissionDirection:Ze,endpointType:Ye}}o=[],i=r,void 0!==(a="function"==typeof i?i.apply(t,o):i)&&(e.exports=a),e.exports=r}("undefined"!=typeof window&&window)}).call(t,n(20))},function(e,t,n){"use strict";function r(){}r.prototype.measureAppLoadingPerformance=function(e){var t=0,n=Number.MAX_VALUE,r=0,i="",o="",a=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var s=a.timing.loadEventEnd-a.timing.navigationStart;if("Chrome"===e.name||"Opera"===e.name){var c,u=a.getEntriesByType("resource");for(c=0;c<u.length;c++)u[c].duration>r&&(o=u[c].name.substr(u[c].name.lastIndexOf("/")+1),r=u[c].duration),u[c].duration<n&&(i=u[c].name.substr(u[c].name.lastIndexOf("/")+1),n=u[c].duration),u[c].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(t=u[c].duration);return{support:"full",callstats:t,min:{name:i,time:n},max:{name:o,time:r},total:s}}return"Firefox"===e.name?{support:"limited",total:s}:void 0},r.prototype.detectBrowserInfo=function(){var e="Chrome",t=null,n=null,r=null,i={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"},o=i.goog;if(!window.navigator.userAgent||window.csioReactNative)return console.log("Invalid userAgent"),window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{name:e,codebase:o,os:t,osVersion:n,userAgent:r};r=navigator.userAgent;var a,s=r.toLowerCase(),c=navigator.appVersion,u=""+parseFloat(navigator.appVersion);-1!==(a=s.indexOf("opera"))?(e="Opera",u=s.substring(a+6),-1!==(a=s.indexOf("Version"))&&(u=s.substring(a+8)),o=i.goog):-1!==(a=s.indexOf("opr"))?(e="Opera",u=s.substring(a+4),-1!==(a=s.indexOf("Version"))&&(u=s.substring(a+8)),o=i.goog):-1!==(a=s.indexOf("msie"))?(e="Microsoft Internet Explorer",u=s.substring(a+5),o=i.goog):-1!==(a=s.indexOf("edge"))?(e=i.edge,u=s.substring(a+5),o=i.edge):-1!==(a=s.indexOf("chrome"))?(e=i.goog,u=s.substring(a+7),o=i.goog):-1!==(a=s.indexOf("safari"))?(e="Safari",u=s.substring(a+7),-1!==(a=s.indexOf("version"))&&(u=s.substring(a+8)),o=i.goog):-1!==(a=s.indexOf("firefox"))?(e="Firefox",u=s.substring(a+8),o=i.moz):-1!==(a=s.indexOf("trident"))&&(e="Microsoft Internet Explorer",a=s.indexOf("rv"),u=s.substring(a+3,a+7),o=i.goog);var l,d,p=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}];for(l in p)if(d=p[l],d.r.test(s)){t=d.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t="Windows"),t){case"Mac OS X":n=/mac os x (10[\.\_\d]+)/.exec(s)[1];break;case"Android":n=/android ([\.\_\d]+)/.exec(s)[1];break;case"iOS":n=/os (\d+)_(\d+)_?(\d+)?/.exec(c),n=n[1]+"."+n[2]+"."+(0|n[3])}return{name:e,ver:u.toString(),os:t,osVersion:n,codebase:o,userAgent:r}},e.exports=r},function(e,t,n){function r(){this.invoker=null,this.receiver=null}function i(){this.listeners=[]}function o(e){this.stats=null,this.lastResponsed=(new Date).getTime(),this.onDataSent=e}function a(e){this.ssrc=null,this.direction=void 0,this.mediaType=null,this.resolution=null,this.frameRateReceived=null,this.frameWidth=null,this.rtt=null,this.droppedFramesNum=null,this.packetLosts=null,this.jitter=null,this.bytesReceived=-1,this.packetsReceived=-1,this.packetsDiscarded=-1,this.bytesSent=-1,this.packetsSent=-1,this.stream=e}function s(e,t){return e.rtt===t.rtt?0:e.rtt<t.rtt?-1:1}function c(e,t){return e.frameHeight===t.frameHeight?0:e.frameHeight<t.frameHeight?-1:1}function u(e,t){return e.frameWidth===t.frameWidth?0:e.frameWidth<t.frameWidth?-1:1}function l(e,t){return e.jitter===t.jitter?0:e.jitter<t.jitter?-1:1}function d(e,t){var n=parseInt(e.frameRateReceived),r=parseInt(t.frameRateReceived);return n===r?0:n<r?-1:1}function p(e,t){return e}function f(){this.codeBase=null,this.mediaType={unknown:"unknown",audio:"audio",video:"video"},this.codeBaseType={chrome:"Chrome",firefox:"Firefox",edge:"Edge"}}function h(e){A.call(this),this.extractorFnc=e,this.prev=0,this.delta=0,this.first=0,this.actual=0,this.addSignalListener(I.Signals.onDataSent,this.onDataSent,this)}function v(e){A.call(this),this.extractorFnc=e,this.prev=null}function m(e,t){this.intervalPacketsRecv=t,this.intervalLoss=e}function g(e,t){var n=e.getValue(),r=t.getValue();return n===r?0:n<r?-1:1}function y(e,t){return new m((e.getIntervalLoss()+t.getIntervalLoss())/2,(e.getIntervalPacketsRecv()+t.getIntervalPacketsRecv())/2)}function b(){this.measurements=new P(I.maxItemsNum,I.timeoutInMs),this.packetLostTracker=new h(function(e){return e.packetLosts}),this.measurements.addPlugin(this.packetLostTracker),this.packetsDiscardedTracker=new h(function(e){return e.packetsDiscarded}),this.measurements.addPlugin(this.packetsDiscardedTracker),this.resolutionTracker=new v(function(e){return e.resolution}),this.measurements.addPlugin(this.resolutionTracker),this.jitter95PercentileTracker=new D(l,95,p),this.measurements.addPlugin(this.jitter95PercentileTracker),this.jitter95PercentileTracker.addFilter(function(e){return void 0!==e.jitter&&null!==e.jitter}),this.rtt95PercentileTracker=new D(s,95,p),this.measurements.addPlugin(this.rtt95PercentileTracker),this.rtt95PercentileTracker.addFilter(function(e){return void 0!==e.rtt&&null!==e.rtt&&0<e.rtt}),this.frameHeight50PercentileTracker=new D(c,50,p),this.measurements.addPlugin(this.frameHeight50PercentileTracker),this.frameHeight50PercentileTracker.addFilter(function(e){return void 0!==e.frameHeight&&null!==e.frameHeight&&0<e.frameHeight}),this.frameHeight95PercentileTracker=new D(c,95,p),this.measurements.addPlugin(this.frameHeight95PercentileTracker),this.frameHeight95PercentileTracker.addFilter(function(e){return void 0!==e.frameHeight&&null!==e.frameHeight&&0<e.frameHeight}),this.frameRate50PercentileTracker=new D(d,50,p),this.measurements.addPlugin(this.frameRate50PercentileTracker),this.frameRate50PercentileTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived}),this.frameRate95PercentileTracker=new D(d,95,p),this.measurements.addPlugin(this.frameRate95PercentileTracker),this.frameRate95PercentileTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived}),this.frameWidth50PercentileTracker=new D(u,50,p),this.measurements.addPlugin(this.frameWidth50PercentileTracker),this.frameWidth50PercentileTracker.addFilter(function(e){return void 0!==e.frameWidth&&null!==e.frameWidth&&0<e.frameWidth}),this.frameWidth95PercentileTracker=new D(u,95,p),this.measurements.addPlugin(this.frameWidth95PercentileTracker),this.frameWidth95PercentileTracker.addFilter(function(e){return void 0!==e.frameWidth&&null!==e.frameWidth&&0<e.frameWidth}),this.rttAvgRTTracker=new O(function(e){return e.rtt}),this.measurements.addPlugin(this.rttAvgRTTracker),this.rttAvgRTTracker.addFilter(function(e){return void 0!==e.rtt&&null!==e.rtt&&0<e.rtt}),this.frameRateMeanTracker=new O(function(e){return e.frameRateReceived}),this.measurements.addPlugin(this.frameRateMeanTracker),this.frameRateMeanTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived&&0<e.frameRateReceived}),this.frameHeightMeanTracker=new O(function(e){return e.frameHeight}),this.measurements.addPlugin(this.frameHeightMeanTracker),this.frameHeightMeanTracker.addFilter(function(e){return void 0!==e.frameHeight&&null!==e.frameHeight&&0<e.frameHeight}),this.frameWidthMeanTracker=new O(function(e){return e.frameWidth}),this.measurements.addPlugin(this.frameWidthMeanTracker),this.frameWidthMeanTracker.addFilter(function(e){return void 0!==e.frameHeight&&null!==e.frameWidth&&0<e.frameWidth}),this.jitterAvgTracker=new O(function(e){return e.jitter}),this.measurements.addPlugin(this.jitterAvgTracker),this.jitterAvgTracker.addFilter(function(e){return void 0!==e.jitter&&null!==e.jitter&&0<e.jitter}),this.intervalFractionLosts=new P(I.maxItemsNum,I.timeoutInMs),this.FLPercentileTracker=new D(g,95,y),this.intervalFractionLosts.addPlugin(this.FLPercentileTracker),this.deltaAdded=0,this.firstAdded=0,this.lastAdded=0,this.doSending=!1,this.mediaType=null,this.direction=null,this.lastTraffic=0}function S(){b.call(this),this.bytesReceivedTracker=new h(function(e){return e.bytesReceived}),this.packetsReceivedTracker=new h(function(e){return e.packetsReceived}),this.addPlugin(this.bytesReceivedTracker),this.addPlugin(this.packetsReceivedTracker)}function _(){S.call(this),this.quality={eModel:0,bandwidth:0},this.direction=a.Direction.inbound,this.mediaType=a.MediaTypes.audio}function T(){S.call(this),this.frameRateReceivedTracker=new h(function(e){return e.frameRateReceived}),this.frameRatePercTracker=new D(d,10,p),this.frameRatePercTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived}),this.frameRatePercTracker.attach(this.setFrameRateReceived10,this),this.frameRateReceived10=null,this.addPlugin(this.frameRatePercTracker),this.addPlugin(this.frameRateReceivedTracker),this.quality={eModel:0,bandwidth:0,frameRate:0},this.direction=a.Direction.inbound,this.mediaType=a.MediaTypes.video}function E(){b.call(this),this.bytesSentTracker=new h(function(e){return e.bytesSent}),this.packetsSentTracker=new h(function(e){return e.packetsSent}),this.addPlugin(this.bytesSentTracker),this.addPlugin(this.packetsSentTracker)}function C(){E.call(this),this.frameRateReceivedTracker=new h(function(e){return e.frameRateReceived}),this.frameRatePercTracker=new D(d,10,p),this.frameRatePercTracker.addFilter(function(e){return void 0!==e.frameRateReceived&&null!==e.frameRateReceived}),this.frameRatePercTracker.attach(this.setFrameRateReceived10,this),this.frameRateReceived10=null,this.addPlugin(this.frameRatePercTracker),this.addPlugin(this.frameRateReceivedTracker),this.quality={eModel:0,bandwidth:0,frameRate:0},this.direction=a.Direction.outbound,this.mediaType=a.MediaTypes.video}function w(){E.call(this),this.quality={eModel:0,bandwidth:0},this.direction=a.Direction.outbound,this.mediaType=a.MediaTypes.audio}function R(){this.monitors={},this.assembler=new f,this.sendable=!1,this.inbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0},this.outbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0}}function k(e){this.monitors=new R,this.output=new r,this.lastForwarded=(new Date).getTime(),this.lastInterval=0,e.addListener(this.monitors.onDataSent,this.monitors)}function I(){this.states={Idle:"Idle",Run:"Run"},this.events={OnPolling:"OnPolling",OnStatsRequest:"OnStatsRequest",OnStop:"OnStop",OnStart:"OnStart",OnOneWayAudioDisruptionsRequest:"OnOneWayAudioDisruptionsRequest"},this.onDataSent=new i,this.analyzer=new k(this.onDataSent),this.senderGate=new o(this.onDataSent),this.analyzer.output.connect(this.senderGate.receiver,this.senderGate),this.currentState=this.states.Run}var P=n(69),A=n(29),D=n(71),O=n(74);I.disruptions=[],I.adaptiveSending=!0,I.minMeasurementsNum=20,I.SendingTimeTresholds={max:3e4,min:1e3,regular:5e3},I.maxItemsNum=1e3,I.timeoutInMs=3e5,I.Signals={onDataSent:"onDataSent"},r.prototype={constructor:r,connect:function(e,t){this.invoker=void 0===t?null:t,this.receiver=e},send:function(e){return null===this.receiver?void console.warn("There is no receiver to call"):null===this.invoker?void this.receiver(e):void this.receiver.call(this.invoker,e)}},i.prototype={constructor:i,addListener:function(e,t){this.listeners.push({callback:e,that:t})},notify:function(){for(var e=0;e<this.listeners.length;++e){var t=this.listeners[e];void 0!==t.callback&&null!==t.callback&&(null===t.that?t.callback():t.callback.call(t.that))}}},o.prototype={constructor:o,receiver:function(e){this.stats=e,this.initiate=!1},requestStats:function(){var e=null,t=(new Date).getTime();return null===this.stats?null:this.initiate&&t-I.SendingTimeTresholds.min<this.lastResponsed?null:(e={streams:this.stats},this.stats=null,this.lastResponsed=t,this.onDataSent.notify(),this.initiate=!0,e)}},a.MediaTypes={audio:"audio",video:"video"},a.Direction={inbound:"inbound",outbound:"outbound"},a.prototype={constructor:a,toString:function(){return"Measurement {RTT: "+this.RTT+"; }"}},f.prototype={constructor:f,do:function(e,t){var n=new a(e);if(n.ssrc=e.ssrc,n.mediaType=this.getMediaType(e),n.resolution=this.getResolution(e),n.frameRateReceived=this.getFrameRate(e),n.frameWidth=this.getFrameWidth(e),n.frameHeight=this.getFrameHeight(e),n.rtt=this.getLatencyData(e),n.droppedFramesNum=this.getDroppedFramesNum(e),n.packetLosts=this.getPacketLosts(e),n.jitter=this.getJitter(e),e.streamType===a.Direction.inbound?(n.direction=a.Direction.inbound,n.bytesReceived=this.getBytesReceived(e),n.packetsReceived=this.getPacketsReceived(e),n.packetsDiscarded=this.getPacketsDiscarded(e)):e.streamType===a.Direction.outbound&&(n.direction=a.Direction.outbound,n.bytesSent=this.getBytesSent(e),n.packetsSent=this.getPacketsSent(e)),void 0!==t&&!0===t){n.rawdats={};for(var r in e.data)e.data.hasOwnProperty(r)&&(n.rawdats[r]=e.data[r])}return n},setupCodeBase:function(e){this.codeBase=e},getBytesSent:function(e){if(void 0===e.data.bytesSent)return 0;var t=this.checkForNan(parseInt(e.data.bytesSent,10));return null!==t?t:0},getBytesReceived:function(e){if(void 0===e.data.bytesReceived)return 0;var t=this.checkForNan(parseInt(e.data.bytesReceived,10));return null!==t?t:0},getPacketsReceived:function(e){if(void 0===e.data.packetsReceived)return 0;var t=this.checkForNegativeValue(parseInt(e.data.packetsReceived,10));return null!==t?t:0},getPacketsSent:function(e){if(void 0===e.data.packetsSent)return 0;var t=this.checkForNegativeValue(parseInt(e.data.packetsSent,10));return null!==t?t:0},getPacketsDiscarded:function(e){if(void 0===e.data.discardedPackets)return 0;var t=this.checkForNan(parseInt(e.data.discardedPackets,10));return null!==t?t:0},getPacketLosts:function(e){if(void 0===e.data.packetsLost)return 0;var t=this.checkForNegativeValue(parseInt(e.data.packetsLost,10));return null!==t?t:0},getDroppedFramesNum:function(e){if(void 0===e.data.droppedFrames)return 0;var t=this.checkForNegativeValue(parseInt(e.data.droppedFrames,10));return null!==t?t:0},getFrameRate:function(e){var t;return void 0!==e.data.googFrameRateOutput?t=parseInt(e.data.googFrameRateOutput,10):void 0!==e.data.googFrameRateDecoded?t=parseInt(e.data.googFrameRateDecoded,10):void 0!==e.data.googFrameRateReceived?t=parseInt(e.data.googFrameRateReceived,10):void 0!==e.data.googFrameRateSent?t=parseInt(e.data.googFrameRateSent,10):void 0!==e.data.framerateMean&&(t=parseInt(e.data.framerateMean,10)),void 0!==t&&(t=isNaN(t)||t<0?null:t),t},getFrameHeight:function(e){var t;return void 0!==e.data.googFrameHeightReceived?t=e.data.googFrameHeightReceived:void 0!==e.data.googFrameHeightSent?t=e.data.googFrameHeightSent:void 0!==e.data.frameHeight&&(t=e.data.frameHeight),t},getJitter:function(e){if(void 0!==e){var t;return void 0!==e.data.googJitterReceived?(t=this.checkForNan(parseInt(e.data.googJitterReceived,10)),t?t/1e3:t):this.codeBase===this.codeBaseType.chrome&&void 0!==e.data.jitter?(t=this.checkForNan(parseInt(e.data.jitter,10)),t?t/1e3:t):this.codeBase===this.codeBaseType.firefox&&void 0!==e.data.jitter?this.checkForNan(parseInt(e.data.jitter,10)):void 0}},getResolution:function(e){var t,n,r,i="unavailable";return t=this.getFrameRate(e),r=this.getFrameWidth(e),n=this.getFrameHeight(e),void 0!==t&&void 0!==r&&void 0!==n&&r>0&&n>0&&(i=r.concat("x",n,"@",t)),i},getFrameWidth:function(e){var t;return void 0!==e.data.googFrameWidthReceived?t=e.data.googFrameWidthReceived:void 0!==e.data.googFrameWidthSent?t=e.data.googFrameWidthSent:void 0!==e.data.frameWidth&&(t=e.data.frameWidth),t},validateRTT:function(e){return isNaN(e)||e<0?null:e},getLatencyData:function(e){return void 0===e?null:void 0!==e.data.googRtt?this.validateRTT(parseInt(e.data.googRtt,10)):void 0!==e.data.roundTripTime?this.validateRTT(parseInt(e.data.roundTripTime,10)):void 0!==e.data.mozRtt?this.validateRTT(parseInt(e.data.mozRtt,10)):null},getMediaType:function(e){var t=this.mediaType.unknown;if(void 0!==e)return e.data&&void 0!==e.data.mediaType?e.data.mediaType:(e.data.mediaType?t=e.data.mediaType:void 0!==e.data.googFrameRateReceived||void 0!==e.data.googFrameRateSent?t=this.mediaType.video:void 0!==e.data.audioInputLevel||void 0!==e.data.audioOutputLevel||void 0!==e.data.audioLevel?t=this.mediaType.audio:void 0!==e.data.framerateMean&&(t=this.mediaType.video),t)},checkForNan:function(e){return isNaN(e)?null:e},checkForNegativeValue:function(e){if(null!==(e=this.checkForNan(e)))return e<0?null:e},toString:function(){return"ToString function is not defined. for this object"}},h.prototype=Object.create(A.prototype),h.prototype.constructor=h,h.prototype.onDataSent=function(){this.prev=this.actual},h.prototype.getActual=function(){return this.actual},h.prototype.getFirst=function(){return this.first},h.prototype.getDelta=function(){return this.delta=this.actual-this.prev,this.delta},h.prototype.getPrevious=function(){return this.prev},h.prototype.add=function(e){var t=this.extractorFnc(e);if(void 0!==t&&null!==t){if(0===this.first)return this.first=t,void(this.actual=t);this.actual=t,this.notify({last:this.prev,delta:this.delta})}},h.prototype.remove=function(){},v.prototype=Object.create(A.prototype),v.prototype.constructor=v,v.prototype.add=function(e){void 0!==e&&null!==e&&(this.prev=this.extractorFnc(e))},v.prototype.remove=function(){},v.prototype.getPrevious=function(){return this.prev},m.prototype={constructor:m,getIntervalLoss:function(){return this.intervalLoss},getIntervalPacketsRecv:function(){return this.intervalPacketsRecv},getValue:function(){return void 0===this.intervalPacketsRecv||void 0===this.intervalLoss?null:null===this.intervalPacketsRecv||null===this.intervalLoss?null:0===this.intervalLoss&&0===this.intervalPacketsRecv?0:this.intervalLoss/(this.intervalPacketsRecv+this.intervalLoss)}},b.VideoThroughputThresholds={green:1024,red:256},b.AudioThroughputThresholds={green:30,red:8},b.FrameRateRatioTresholds={green:.8,red:.3},b.VideoRTTThresholds={green:400,red:1e3},b.VideoFractionLostTreshdolds={green:10,red:50},b.AudioFractionLostTresholds={green:15,red:30},b.AudioEModelTresholds={green:240,red:400},b.avQualityRating={excellent:3,fair:2,bad:1},b.avQualityRatingString={excellent:"excellent",fair:"fair",bad:"bad"},b.prototype={constructor:b,doStart:function(){return!0},getStartTime:function(){return this.firstAdded},hasTraffic:function(){var e=this.getLastMeasurement();return this.direction===a.Direction.inbound?0<e.bytesReceived:this.direction===a.Direction.outbound&&0<e.bytesSent},getTotalTimeInMs:function(){return 0===this.firstAdded?0:this.lastAdded-this.firstAdded},getDeltaTimeInMs:function(){return 0===this.firstAdded?0:this.deltaAdded},getLastMeasurement:function(){return this.measurements.getLast()},add:function(e){var t=(new Date).getTime();if(0===this.firstAdded){if(!this.doStart(e))return;this.firstAdded=t,this.lastAdded=t}this.measurements.add(e)},requestSending:function(){this.doSending=!0},requestSendingIf:function(e,t){this.doSending=this.doSending||e},getAvgRTT:function(){return this.rttAvgRTTracker.getResult()},getResolution:function(){return this.resolutionTracker.getPrevious()},percentileTrackerExtractor:function(e,t,n){var r=null,i=e.getResult();return null===i?n:(r=t(i.actual),null===r?n:r)},getRTT95:function(){var e=this.percentileTrackerExtractor(this.rtt95PercentileTracker,function(e){return e.rtt},null),t=this.getLastMeasurement();if(null!==t&&null!==e){var n=Math.max(.1*e,100);this.requestSendingIf(e+n<t.rtt,"RTT95 the reason of sending "+e+" < "+t.rtt)}return e},getJitter95:function(){var e=this.percentileTrackerExtractor(this.jitter95PercentileTracker,function(e){return e.jitter},null),t=this.getLastMeasurement();if(null!==t){var n=Math.max(.1*e,10);this.requestSendingIf(e+n<t.jitter,"RTT95 the reason of sending "+e+" < "+t.rtt)}return this.result},getFrameRateMean:function(){return this.frameRateMeanTracker.getResult()},getFrameWidth50Percentile:function(){return this.percentileTrackerExtractor(this.frameWidth50PercentileTracker,function(e){return e.frameWidth},null)},getFrameWidth95Percentile:function(){return this.percentileTrackerExtractor(this.frameWidth95PercentileTracker,function(e){return e.frameWidth},null)},getFrameHeight50Percentile:function(){return this.percentileTrackerExtractor(this.frameHeight50PercentileTracker,function(e){return e.frameHeight},null)},getFrameHeight95Percentile:function(){return this.percentileTrackerExtractor(this.frameHeight95PercentileTracker,function(e){return e.frameHeight},null)},getFrameRate50Percentile:function(){return this.percentileTrackerExtractor(this.frameRate50PercentileTracker,function(e){return e.frameRateReceived},null)},getFrameRate95Percentile:function(){return this.percentileTrackerExtractor(this.frameRate95PercentileTracker,function(e){return e.frameRateReceived},null)},getFrameHeightMean:function(){return this.frameHeightMeanTracker.getResult()},getFrameWidthMean:function(){return this.frameWidthMeanTracker.getResult()},getAvgJitter:function(){return this.jitterAvgTracker.getResult()},getQualityEvaluation:function(e,t){if(void 0!==e&&void 0!==t)return null===e||null===e?null:t.green<=e?b.avQualityRating.excellent:t.red<e&&e<t.green?b.avQualityRating.fair:b.avQualityRating.bad},getQualityReverseEvaluation:function(e,t){if(void 0!==e&&void 0!==t)return null===e||null===e?null:t.red<e?b.avQualityRating.bad:t.green<=e&&e<=t.red?b.avQualityRating.fair:b.avQualityRating.excellent},hasData:function(){return this.measurements.refresh(),1<this.measurements.getItemsNum()},addPlugin:function(e){this.measurements.addPlugin(e)},setup:function(e){e.data.csioIntBRKbps=0,e.data.csioAvgBRKbps=0,e.data.csioIntFL=void 0,e.data.csioIntMs=Math.max(I.SendingTimeTresholds.regular,this.getDeltaTimeInMs()),e.data.csioIntPR=void 0,e.data.csioPercentileFl=void 0,e.data.csioAvgJitter=this.getAvgJitter(),e.data.csioAvgRtt=this.getAvgRTT(),e.data.csioPercentileJitter=this.getJitter95(),e.data.csioSig2Latency=this.getRTT95(),e.data.csioTimeElapseMs=this.getTotalTimeInMs(),e.data.csioeM=(null!==this.getRTT95()?this.getRTT95():0)+40,e.data.csiores=this.getResolution(),e.data.csioFrameWidth95Percentile=this.getFrameWidth95Percentile(),e.data.csioFrameWidth50Percentile=this.getFrameWidth50Percentile(),e.data.csioFrameHeight95Percentile=this.getFrameHeight95Percentile(),e.data.csioFrameHeight50Percentile=this.getFrameHeight50Percentile(),e.data.csioFrameRate95Percentile=this.getFrameRate95Percentile(),e.data.csioFrameRate50Percentile=this.getFrameRate50Percentile(),e.data.csioFrameWidthMean=this.getFrameWidthMean(),e.data.csioFrameHeightMean=this.getFrameHeightMean(),e.data.csioFrameRateMean=this.getFrameRateMean()},addIntervalFractionLost:function(e){this.intervalFractionLosts.add(e)},getLastFractionLost:function(){return this.intervalFractionLosts.getLast()},getIntervalFractionLost95:function(){var e=this.FLPercentileTracker.getResult();return null===e?0:e.actual.getValue()},onDataSent:function(){var e=(new Date).getTime();this.measurements.signalize(I.Signals.onDataSent,null),this.deltaAdded=e-this.lastAdded,this.lastAdded=e},isValid:function(){for(var e=0;e<arguments.length;e++)if(null===arguments[e]||void 0===arguments[e])return!1;return!0},doSend:function(){if(!1===this.hasData())return!0;var e=this.doSending;return this.doSending=!1,e},getMediaType:function(){return this.mediaType},getDirection:function(){return this.direction}},S.prototype=Object.create(b.prototype),S.prototype.constructor=S,S.prototype.setRTT95=function(e){b.prototype.setRTT95(e)},S.prototype.setup=function(e){b.prototype.setup.call(this,e);var t=new m(this.packetLostTracker.getDelta(),this.packetsReceivedTracker.getDelta());this.addIntervalFractionLost(t),e.data.csioIntPktRcv=this.packetsReceivedTracker.getDelta();var n=Math.max(I.SendingTimeTresholds.regular,this.getDeltaTimeInMs());e.data.csioIntBRKbps=8*this.bytesReceivedTracker.getDelta()/n,e.data.csioIntPR=this.packetsReceivedTracker.getDelta()/(n/1e3),this.getTotalTimeInMs()>0&&(e.data.csioAvgBRKbps=8*this.bytesReceivedTracker.getPrevious()/this.getTotalTimeInMs()),e.data.csioIntFL=t.getValue(),e.data.csioPercentileFl=this.getIntervalFractionLost95(),e.data.csioeM=(null!==this.getRTT95()?this.getRTT95():0)+40,void 0!==e.data.csioAvgBRKbps&&null!==e.data.csioAvgBRKbps?e.data.csioAvgPacketSize=this.bytesReceivedTracker.getDelta()/this.packetsReceivedTracker.getDelta():e.data.csioAvgPacketSize=null,e.data.csioPktLossPercentage=this.packetLostTracker.getDelta()/this.packetsReceivedTracker.getDelta()*100},_.prototype=Object.create(S.prototype),_.prototype.constructor=_,_.prototype.setup=function(e){S.prototype.setup.call(this,e),e.data.csioMediaType=a.MediaTypes.audio,this.quality.eModel=this.getQualityReverseEvaluation(e.data.csioeM,b.AudioEModelTresholds),this.quality.bandwidth=this.getQualityEvaluation(e.data.csioIntBRKbps,b.AudioThroughputThresholds),e.data.csioMark=this.getQuality()},_.prototype.getQuality=function(){var e=0,t=.5*this.quality.bandwidth+.5*this.quality.eModel;return t=Math.floor(t),t===b.avQualityRating.excellent?e=b.avQualityRatingString.excellent:t===b.avQualityRating.fair?e=b.avQualityRatingString.fair:t===b.avQualityRating.bad&&(e=b.avQualityRatingString.bad),e},T.prototype=Object.create(S.prototype),T.prototype.constructor=T,T.prototype.setFrameRatioQuality=function(){var e=this.frameRateReceivedTracker.getActual(),t=this.frameRateReceivedTracker.getPrevious(),n=0;this.quality.frameRate=0,void 0!==e&&void 0!==t&&null!==e&&null!==t&&0!==t&&(n=e/t,this.quality.frameRate=this.getQualityEvaluation(n,b.FrameRateRatioTresholds))},T.prototype.setFrameRateReceived10=function(e){return null===e?void(this.frameRateReceived10=null):void(this.frameRateReceived10=e.actual)},T.prototype.setup=function(e){S.prototype.setup.call(this,e),e.data.csioMediaType=a.MediaTypes.video,this.setFrameRatioQuality(),this.quality.eModel=this.getQualityReverseEvaluation(e.data.csioeM,b.AudioEModelTresholds),this.quality.bandwidth=this.getQualityEvaluation(e.data.csioIntBRKbps,b.VideoThroughputThresholds),e.data.csioMark=this.getQuality()},T.prototype.getQuality=function(){var e=0,t=.33*this.quality.bandwidth+.33*this.quality.eModel+.33*this.quality.frameRate;return t=Math.floor(t),t===b.avQualityRating.excellent?e=b.avQualityRatingString.excellent:t===b.avQualityRating.fair?e=b.avQualityRatingString.fair:t===b.avQualityRating.bad&&(e=b.avQualityRatingString.bad),e},E.prototype=Object.create(b.prototype),E.prototype.constructor=E,E.prototype.setup=function(e){b.prototype.setup.call(this,e);var t=new m(this.packetLostTracker.getDelta(),this.packetsSentTracker.getDelta());this.addIntervalFractionLost(t);var n=Math.max(I.SendingTimeTresholds.regular,this.getDeltaTimeInMs());e.data.csioIntBRKbps=8*this.bytesSentTracker.getDelta()/n,e.data.csioIntPR=this.packetsSentTracker.getDelta()/(n/1e3),this.getTotalTimeInMs()>0&&(e.data.csioAvgBRKbps=8*this.bytesSentTracker.getPrevious()/this.getTotalTimeInMs()),e.data.csioIntFL=t.getValue(),e.data.csioIntPktRcv=this.packetsSentTracker.getDelta(),e.data.csioPercentileFl=this.getIntervalFractionLost95(),e.data.csioeM=(null!==this.getRTT95()?this.getRTT95():0)+40,void 0!==e.data.csioAvgBRKbps&&null!==e.data.csioAvgBRKbps?e.data.csioAvgPacketSize=this.bytesSentTracker.getDelta()/this.packetsSentTracker.getDelta():e.data.csioAvgPacketSize=null,e.data.csioPktLossPercentage=this.packetLostTracker.getDelta()/this.packetsSentTracker.getDelta()*100},C.prototype=Object.create(E.prototype),C.prototype.constructor=C,C.prototype.setFrameRatioQuality=function(){var e=this.frameRateReceivedTracker.getActual(),t=this.frameRateReceivedTracker.getPrevious(),n=0;this.quality.frameRate=0,void 0!==e&&void 0!==t&&null!==e&&null!==t&&0!==t&&(n=e/t,this.quality.frameRate=this.getQualityEvaluation(n,b.FrameRateRatioTresholds))},C.prototype.setFrameRateReceived10=function(e){return null===e?void(this.frameRateReceived10=null):void(this.frameRateReceived10=e.actual)},C.prototype.setup=function(e){E.prototype.setup.call(this,e),e.data.csioMediaType=a.MediaTypes.video,this.setFrameRatioQuality(),this.quality.eModel=this.getQualityReverseEvaluation(e.data.csioeM,b.AudioEModelTresholds),this.quality.bandwidth=this.getQualityEvaluation(e.data.csioIntBRKbps,b.VideoThroughputThresholds),e.data.csioMark=this.getQuality()},C.prototype.getQuality=function(){var e=0,t=.33*this.quality.bandwidth+.33*this.quality.eModel+.33*this.quality.frameRate;return t=Math.floor(t),t===b.avQualityRating.excellent?e=b.avQualityRatingString.excellent:t===b.avQualityRating.fair?e=b.avQualityRatingString.fair:t===b.avQualityRating.bad&&(e=b.avQualityRatingString.bad),e},w.prototype=Object.create(E.prototype),w.prototype.constructor=w,w.prototype.setEModelQuality=function(e){e<b.AudioEModelTresholds.green?this.quality.eModel=b.avQualityRating.excellent:e>b.AudioEModelTresholds.green&&e<b.AudioEModelTresholds.red?this.quality.eModel=b.avQualityRating.fair:e>b.AudioEModelTresholds.red&&(this.quality.eModel=b.avQualityRating.bad)},w.prototype.setThroughputQuality=function(e){null!==e&&void 0!==e&&(e>b.AudioThroughputThresholds.green?this.quality.bandwidth=b.avQualityRating.excellent:e>b.AudioThroughputThresholds.red&&e<b.AudioThroughputThresholds.green?this.quality.bandwidth=b.avQualityRating.fair:e<b.AudioThroughputThresholds.red&&(this.quality.bandwidth=b.avQualityRating.bad))},w.prototype.setup=function(e){E.prototype.setup.call(this,e),this.setThroughputQuality(e.data.csioIntBRKbps),this.setEModelQuality(e.data.csioeM),e.data.csioMediaType=a.MediaTypes.audio,e.data.csioMark=this.getQuality()},w.prototype.doSend=function(){return this.hasData(),!1},w.prototype.getQuality=function(){var e=0,t=.5*this.quality.bandwidth+.5*this.quality.eModel;return t=Math.floor(t),t===b.avQualityRating.excellent?e=b.avQualityRatingString.excellent:t===b.avQualityRating.fair?e=b.avQualityRatingString.fair:t===b.avQualityRating.bad&&(e=b.avQualityRatingString.bad),e},R.OneWayAudioDisruptionTimeout=5e3,R.prototype={constructor:R,getMonitor:function(e){var t;if(this.monitors[e.direction]&&(t=this.monitors[e.direction][e.ssrc]),void 0!==t)return this.monitors[e.direction][e.ssrc];var n=e.direction===a.Direction.inbound,r=e.direction===a.Direction.outbound,i=e.mediaType===a.MediaTypes.audio,o=e.mediaType===a.MediaTypes.video;return t=n&&i?new _:r&&i?new w:n&&o?new T:r&&o?new C:null,this.monitors[e.direction]||(this.monitors[e.direction]={}),this.monitors[e.direction][e.ssrc]=t,t},setupCodeBase:function(e){this.assembler.setupCodeBase(e)},isSendable:function(){var e=this.sendable;return this.sendable=!1,e},process:function(e){var t=this.assembler.do(e),n=this.getMonitor(t);return null===n||void 0===n?void console.warn("For ssrc "+t.ssrc+"we do not have monitor"):(n.doSend(t)&&(this.sendable=!0),n.add(t),void n.setup(e))},checkDistortions:function(){var e,t=[],n=[],r=this.monitors[a.Direction.inbound];r&&Object.keys(r).forEach(function(n){e=r[n],e.getMediaType()===a.MediaTypes.audio&&t.push(e)}),r=this.monitors[a.Direction.outbound],r&&Object.keys(r).forEach(function(t){e=r[t],e.getMediaType()===a.MediaTypes.audio&&n.push(e)}),[this.getInbOneWayAudioDisruption(t,n),this.getOutbOneWayAudioDisruption(t,n)].forEach(function(e){e&&I.disruptions.push(e)})},getInbOneWayAudioDisruption:function(e,t){var n=this.inbOneWayAudioDisruption,r=(new Date).getTime();if(n.sent)return null;var i=t.filter(function(e){return 0===e.getStartTime()}).length<1,o=t.filter(function(e){return!e.hasTraffic()}).length<1;return!i||o?null:e.length?e.filter(function(e){return!e.hasTraffic()}).length<1?(n.started=0,null):0===n.started?(n.started=r,null):r-R.OneWayAudioDisruptionTimeout<n.started?null:(n.sent=!0,{name:"InbOneWayAudioDisruption"}):null},getOutbOneWayAudioDisruption:function(e,t){var n=this.outbOneWayAudioDisruption,r=(new Date).getTime();if(n.sent)return null;var i=e.filter(function(e){return 0===e.getStartTime()}).length<1,o=e.filter(function(e){return!e.hasTraffic()}).length<1;return i&&o&&t.length?t.filter(function(e){return!e.hasTraffic()}).length<1?(n.started=0,null):0===n.started?(n.started=r,null):r-R.OneWayAudioDisruptionTimeout<n.started?null:(n.sent=!0,{name:"OutbOneWayAudioDisruption"}):null},toString:function(){return"ToString function is not defined. for this object"},onDataSent:function(){for(var e in this.monitors)if(this.monitors.hasOwnProperty(e))for(var t in this.monitors[e])if(this.monitors[e].hasOwnProperty(t)){var n=this.monitors[e][t];null!==n?n.onDataSent():console.warn("A Monitor with ssrc: "+t+" should not be null but it is!")}}},k.prototype={constructor:k,receive:function(e){var t=(new Date).getTime(),n=e.streams,r=e.codeBase;this.monitors.setupCodeBase(r);for(var i=0;i<n.length;++i){var o=n[i];this.monitors.process(o)}if(this.monitors.checkDistortions(),!1===I.adaptiveSending)this.lastForwarded+I.SendingTimeTresholds.regular<t&&(this.output.send(n),this.lastForwarded=t);else{var a=3*Math.random()+1;(this.lastForwarded+Math.min(I.SendingTimeTresholds.max,this.lastInterval*a)<t||this.monitors.isSendable())&&(this.output.send(n),this.lastInterval=t-this.lastForwarded,this.lastForwarded=t)}}},I.prototype={constructor:I,fire:function(e){var t;switch(this.currentState){case this.states.Idle:switch(e){case this.events.OnStart:this.currentState=this.states.Run;break;default:console.warn("Unhandled event "+e+" in "+this.currentState+" mode")}break;case this.states.Run:switch(e){case this.events.OnStop:this.currentState=this.states.Idle;break;case this.events.OnPolling:var n=arguments[1];this.analyzer.receive(n);break;case this.events.OnOneWayAudioDisruptionsRequest:if(void 0===(t=arguments[1])){console.warn("OnStatsRequest event required a parameter to store the response");break}0<I.disruptions.length&&(t.response=I.disruptions,I.disruptions=[]);break;case this.events.OnStatsRequest:if(void 0===(t=arguments[1])){console.warn("OnStatsRequest event required a parameter to store the response");break}t.response=this.senderGate.requestStats();break;default:console.warn("Unhandled event "+e+" in "+this.currentState+" mode")}break;default:console.error("The Reporter machine is in an unkown state: "+this.currentState)}},toString:function(){return"Reporter is in "+this.currentState},setReportingMode:function(e){I.adaptiveSending=!0===e},setSubmissionInterval:function(e){I.SendingTimeTresholds.regular=e,I.SendingTimeTresholds.min=e,I.SendingTimeTresholds.max=e}},e.exports.Reporter=I},function(e,t,n){function r(e,t){this.items=[],this.plugins=[],this.timeoutInMs=t,this.maxItemsNum=e,this.minItemsNum=0,this.last=null}var i=n(70);r.prototype={constructor:r,signalize:function(e,t){for(var n=0;n<this.plugins.length;++n){var r=this.plugins[n];null!==r.signalize&&void 0!==r.signalize?r.signalize.call(r,e,t):console.warn(r)}},toString:function(){return""}},r.prototype.getLast=function(){return this.last},r.prototype.setMaxItemsNum=function(e){this.maxItemsNum=e},r.prototype.setTimeoutInMs=function(e){this.timeoutInMs=e},r.prototype.setMinItemsNum=function(e){this.minItemsNum=e},r.prototype.refresh=function(){if(!(this.items.length<=this.minItemsNum)){for(;0<this.maxItemsNum&&this.maxItemsNum<=this.items.length;)this.remove();0<this.timeoutInMs&&this.timeoutInMs<this.items[0].getElapsed()&&(this.remove(),this.refresh())}},r.prototype.getItemsNum=function(){return this.items.length},r.prototype.add=function(e){this.refresh(),this.items.push(new i(e));for(var t=0;t<this.plugins.length;t++)this.plugins[t].add(e);this.last=e},r.prototype.map=function(e){for(var t=0;t<this.plugins.length;t++)this.plugins[t].map(e)},r.prototype.remove=function(){for(var e=this.items.shift(),t=0;t<this.plugins.length;t++)this.plugins[t].remove(e.value)},r.prototype.foreach=function(e,t){var n=this.items;void 0!==t&&(n=t(n));for(var r=0;r<n.length;r++)e(n[r].value)},r.prototype.addPlugin=function(e){this.plugins.push(e)},e.exports=r},function(e,t){function n(e){this.value=e,this.created=(new Date).getTime()}n.prototype={constructor:n,getElapsed:function(){return(new Date).getTime()-this.created},toString:function(){return""}},e.exports=n},function(e,t,n){function r(e,t,n){if(a.call(this),99<t||t<1)throw new RangeError("Percentile parameter must be between 1 and 99");this.comparator=e,this.percentile=t,this.meanCalcer=void 0===n?function(e,t){return(e+t)/2}:n,this.ratio=t/(100-t),this.maxtree=new o(e),this.mintree=new o(e),this.ratio<1?this.required=1/this.ratio+1:1<this.ratio?this.required=this.ratio+1:this.required=2,this.maxcounter=this.mincounter=0,this.result=null,this.filter=null}var i=n(72),o=n(73),a=n(29);r.prototype=Object.create(a.prototype),r.prototype.constructor=r,r.prototype.addFilter=function(e,t){this.filter={callback:e,that:t}},r.prototype.doFilter=function(e){return null===this.filter||(void 0===this.filter.that||null===this.filter.that?this.filter.callback(e):this.filter.callback.call(this.filter.that,e))},r.prototype.getResult=function(){return this.result},r.prototype.add=function(e){if(this.doFilter(e)){if(this.maxcounter<1)return this.maxtree.insert(e),void++this.maxcounter;this.comparator(e,this.maxtree.getTopValue())<=0?(this.maxtree.insert(e),++this.maxcounter):(this.mintree.insert(e),++this.mincounter),this.balancing(),this.calculate()}},r.prototype.remove=function(e){if(this.doFilter(e)){if(this.maxtree.delete(e))--this.maxcounter;else{if(!this.mintree.delete(e))throw new ReferenceError("The requested value "+e+" is not found in trees");--this.mincounter}this.balancing(),this.calculate()}},r.prototype.balancing=function(){var e=function(){for(var e=(this.maxcounter+1)/(this.mincounter-1);;e=(this.maxcounter+1)/(this.mincounter-1)){if(this.ratio<e||this.mincounter<1)return;this.maxtree.insertByTop(this.mintree.deleteBottomValue()),++this.maxcounter,--this.mincounter}},t=function(){for(var e=(this.maxcounter-1)/(this.mincounter+1);;e=(this.maxcounter-1)/(this.mincounter+1)){if(e<this.ratio||this.maxcounter<1)return;this.mintree.insertByBottom(this.maxtree.deleteTopValue()),++this.mincounter,--this.maxcounter}};if(!(this.maxcounter+this.mincounter<this.required)){if(this.mincounter<1)return void t.call(this);if(this.maxcounter<1)return void e.call(this);var n=this.maxcounter/this.mincounter;this.ratio<n?t.call(this):e.call(this)}},r.prototype.calculate=function(){var e,t,n=new i,r=null,o=this.mincounter+this.maxcounter;if(!(o<1)){if(this.mincounter<1?(t=this.maxtree.getTopValue(),e=this.maxtree.getBottomValue()):this.maxcounter<1?(t=this.mintree.getTopValue(),e=this.mintree.getBottomValue()):(t=this.mintree.getTopValue(),e=this.maxtree.getBottomValue()),n.min=e,n.max=t,n.tracked=o,o<this.required||this.mincounter<1)return r=this.ratio<1?e:1<this.ratio?t:this.meanCalcer(e,t),n.actual=r,n.estimated=!0,this.result=n,void this.notify(this.result);var a=this.maxcounter/this.mincounter;r=this.ratio<a?this.maxtree.getTopValue():a<this.ratio?this.mintree.getBottomValue():this.meanCalcer(this.mintree.getBottomValue(),this.maxtree.getTopValue()),n.actual=r,this.result=n,this.notify(this.result)}},r.prototype.map=function(e){this.mapping(this.result.actual,e)},e.exports=r},function(e,t){function n(){this.estimated=!1,this.tracked=0,this.max=this.min=this.actual=null}n.prototype={constructor:n,toString:function(){return"Tracked: "+this.tracked+" Estimated: "+this.estimated+" Min: "+this.min+" Max: "+this.max+" Actual: "+this.actual}},e.exports=n},function(e,t){function n(e){this.value=[],this.value.push(e),this.left=null,this.right=null}function r(e){this.root=null,this.top=null,this.bottom=null,this.comparator=e,this.node_counter=0,this.duplicate_counter=0}n.prototype={constructor:n,toString:function(){return this.value.toString()}},r.prototype={constructor:r},r.prototype.getTop=function(){return this.top},r.prototype.getTopValue=function(){return null===this.top?null:this.top.value[0]},r.prototype.getBottomValue=function(){return null===this.bottom?null:this.bottom.value[0]},r.prototype.getBottom=function(){return this.bottom},r.prototype.getDuplicatedCounter=function(){return this.duplicate_counter},r.prototype.getNodeCounter=function(){return this.node_counter},r.prototype.getSize=function(){return this.duplicate_counter+this.node_counter},r.prototype.logTree=function(){function e(t,n,r){if(null!==t){for(var i="-",o=0;o<n;++o)i+="--";console.log(i+"> ("+r+") values: ["+t.value.toString()+"]"),null!==t.left&&e(t.left,n+1,"Left"),null!==t.right&&e(t.right,n+1,"Right")}}return null===this.root?void console.log("This tree is empty"):(console.log("Size of the tree: "+this.getSize()+" Node: "+this.getNodeCounter()+" Duplicates: "+this.getDuplicatedCounter()+" Top: "+this.getTop().toString()+" Bottom: "+this.getBottom().toString()),void e(this.root,0,"Root"))},r.prototype.insertByTop=function(e){this.inserting(e,this.top)},r.prototype.insertByBottom=function(e){this.inserting(e,this.bottom)},r.prototype.insert=function(e){this.inserting(e,this.root)},r.prototype.inserting=function(e,t){var r=function(){var t=new n(e);return(null===this.top||this.comparator(this.top.value[0],t.value[0])<0)&&(this.top=t),(null===this.bottom||this.comparator(t.value[0],this.bottom.value[0])<0)&&(this.bottom=t),t};if(null===this.root)return this.root=r.call(this),void(this.node_counter=1);for(var i=null,o=t,a=0,s=function(t){return t===e};null!==o;){if(0===(a=this.comparator(e,o.value[0])))return void(o.value.find(s)||(o.value.push(e),++this.duplicate_counter));i=o,o=a<0?o.left:o.right}++this.node_counter,a<0?i.left=r.call(this):i.right=r.call(this)},r.prototype.search=function(e){for(var t,n=this.root,r=null,i=function(t){return t===e};null!==n;){if(0===(t=this.comparator(e,n.value[0])))return n.value.find(i)?(n.parent=r,n):null;r=n,n=t<0?n.left:n.right}return null},r.prototype.getRightist=function(e){for(var t=null;null!==e.right;)t=e,e=e.right;return e.parent=t,e},r.prototype.getLeftist=function(e){for(var t=null;null!==e.left;)t=e,e=e.left;return e.parent=t,e},r.prototype.deleteBottomValue=function(){for(;null===this.bottom;)return null;var e=this.bottom.value[0];return this.delete(e),e},r.prototype.deleteTopValue=function(){for(;null===this.top;)return null;var e=this.top.value[0];return this.delete(e),e},r.prototype.delete=function(e){var t=null,n=function(e,t,n){null!==t?t.left===e?t.left=n:t.right=n:this.root=n},r=function(e){return null===this.root?void(this.bottom=this.top=null):(0===this.comparator(this.top.value[0],e.value[0])&&(this.top=this.getRightist(this.root)),void(0===this.comparator(this.bottom.value[0],e.value[0])&&(this.bottom=this.getLeftist(this.root))))};if(null===(t=this.search(e)))return!1;if(1<t.value.length)return t.value.splice(t.value.indexOf(e),1),--this.duplicate_counter,!0;if(--this.node_counter,null===t.left&&null===t.right)n.call(this,t,t.parent,null);else if(null===t.left)n.call(this,t,t.parent,t.right);else if(null===t.right)n.call(this,t,t.parent,t.left);else{for(var i=t.left,o=t;null!==i.right;o=i,i=i.right);o===t?o.left=i.left:o.right=i.left,t.value.shift(),t.value=t.value.concat(i.value)}return r.call(this,t),!0},e.exports=r},function(e,t,n){function r(e){i.call(this),this.avg=0,this.sum=0,this.count=0,this.filter=null,this.extractor=void 0===e?function(e){return e}:e}var i=n(29);r.prototype=Object.create(i.prototype),r.prototype.constructor=r,r.prototype.add=function(e){(null===this.filter||void 0===this.filter||this.filter(e))&&(this.sum+=parseInt(this.extractor(e)),++this.count,this.calc(this))},r.prototype.addFilter=function(e){this.filter=e},r.prototype.remove=function(e){(null===this.filter||void 0===this.filter||this.filter(e))&&(this.sum-=parseInt(this.extractor(e)),--this.count,this.calc(this))},r.prototype.calc=function(){this.count<1||(this.avg=this.sum/this.count,this.notify(this.avg))},r.prototype.getResult=function(){return this.avg},e.exports=r},function(e,t){function n(e,t,n,r,i){this.pc=e,this.onIceCandidateCallback=t,this.onIceConnectionStateChangeCallback=n,this.onPcSignalingStateChangeCallback=r,this.onPcNegotiationNeededCallback=i,e.addEventListener?(this.pc.addEventListener("icecandidate",this.iceCandidateCallback.bind(this),!1),this.pc.addEventListener("iceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this),!1),this.pc.addEventListener("signalingstatechange",this.pcSignalingStateChangeCallback.bind(this),!1),this.pc.addEventListener("negotiationneeded",this.pcNegotiationNeededCallback.bind(this),!1)):e.attachEvent&&(this.pc.attachEvent("onicecandidate",this.iceCandidateCallback.bind(this)),this.pc.attachEvent("oniceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this)),this.pc.attachEvent("onsignalingstatechange",this.pcSignalingStateChangeCallback.bind(this)),this.pc.attachEvent("onnegotiationneeded",this.pcNegotiationNeededCallback.bind(this)))}n.prototype.iceCandidateCallback=function(e){try{this.onIceCandidateCallback(e,this.pc)}catch(e){console.log("onIceCandidateCallback: Error",e)}},n.prototype.iceConnectionStateChangeCallback=function(e){try{this.onIceConnectionStateChangeCallback(e,this.pc)}catch(e){console.log("onIceConnectionStateChangeCallback: Error",e)}},n.prototype.pcSignalingStateChangeCallback=function(e){try{this.onPcSignalingStateChangeCallback(e,this.pc)}catch(e){console.log("onPcSignalingStateChangeCallback: Error",e)}},n.prototype.pcNegotiationNeededCallback=function(e){try{this.onPcNegotiationNeededCallback(e,this.pc)}catch(e){console.log("onPcNegotiationNeededCallback: Error",e)}},e.exports=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.PreCallTest=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(77),a=n(82),s=n(83),c=n(84),u=n(85),l=n(21),d=n(22),p={RTT:"rtt",THROUGHPUT:"throughput"},f=function(){function e(){r(this,e),this.browserInfo=(0,l.detect)(),this.turnConnection=new o.TurnConnection(this.browserInfo),this.onlineCheck=new u.OnlineCheck,this.callsInProgress=0,this.turnTests=[p.RTT,p.THROUGHPUT],this.active=!1,this.rtt=null,this.resultsHandler=null}return i(e,[{key:"start",value:function(e,t){if(this.browserInfo.browserName!==l.Constants.browserName.msie&&(!window||!window.csioReactNative)&&(this.iceServers=e,this.callback=t,!this.active&&!(this.callsInProgress>0)&&e)){this.turnTestCounter=0,this.resultsHandler=new c.ResultsHandler;var n={type:"browser",os:this.browserInfo.os,osVersion:this.browserInfo.osVersion,buildName:this.browserInfo.browserName,buildVersion:this.browserInfo.browserVersion};this.resultsHandler.add("endpointInfo",n),this.onlineCheck.start(),this.active=!0,this._start()}}},{key:"_start",value:function(){var e=this;this.active&&this.turnConnection.connect(this.iceServers).then(function(){e.active&&e.startTurnTests().then(function(){e.stop()},function(t){e.stop()})},function(t){e.resultsHandler.failure(t),e.resultsHandler.getFailureNumber()>=10?e.stop():(e.turnConnection.disconnect(),setTimeout(function(){e._start()},0))})}},{key:"stop",value:function(){var e=this;if(this.browserInfo.browserName!==l.Constants.browserName.msie&&this.active){this.active=!1,this.activeTurnTest&&this.activeTurnTest.forceStop();var t=this.onlineCheck.stop();this.resultsHandler.add("onlineStatus",t),this.turnConnection.getIceResults().then(function(t){e.resultsHandler.add("ice",t),e.turnConnection.disconnect(),e.sendResults()},function(t){e.resultsHandler.failure(t),e.turnConnection.disconnect(),e.sendResults()})}}},{key:"sendResults",value:function(){var e=this.resultsHandler.getResults();this.callback&&this.callback(e),this.resultsHandler=null}},{key:"callStarts",value:function(){this.callsInProgress+=1,this.stop()}},{key:"callFinished",value:function(){this.callsInProgress-=1}},{key:"getId",value:function(){return this.resultsHandler?this.resultsHandler.getId():null}},{key:"crashDisconnect",value:function(){try{this.turnConnection.disconnect()}catch(e){}}},{key:"startTurnTests",value:function(){var e=this;if(this.turnTestCounter>=this.turnTests.length)return new d(function(e,t){e()});var t=this.turnTests[this.turnTestCounter],n=null;switch(t){case p.RTT:n=new a.RttTest(this.turnConnection);break;case p.THROUGHPUT:n=new s.ThroughputTest(this.turnConnection,this.rtt);break;default:return new d(function(e,n){n(new Error("Unknown test: "+t))})}return this.activeTurnTest=n,this.active?n.start().then(function(){return e.handleTestResults(t,n.getResults()),e.turnTestCounter+=1,e.activeTurnTest=null,e.startTurnTests()},function(r){return e.handleTestResults(t,n.getResults(),r),e.turnTestCounter+=1,e.activeTurnTest=null,e.startTurnTests()}):new d(function(e,t){t(new Error("Test trying to start while testing is not active"))})}},{key:"handleTestResults",value:function(e,t){null==(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)&&e==p.RTT&&(this.rtt=t.median),this.resultsHandler&&this.resultsHandler.add(e,t)}}]),e}();t.PreCallTest=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.TurnConnection=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(78),a=n(79),s=n(21),c=n(22),u=function(){function e(t){r(this,e),this.reset(),this.statshandler=new a.GetStatsHandler(t)}return i(e,[{key:"reset",value:function(){this.iceServers=null,this.pctpc1=null,this.pctpc2=null,this.sendChannel=null,this.messageCallback=null,this.errorCallback=null,this.parsedIceResults={}}},{key:"setMessageCallback",value:function(e){this.messageCallback=e}},{key:"setErrorCallback",value:function(e){this.errorCallback=e}},{key:"send",value:function(e){if(this.sendChannel)try{this.sendChannel.send(e)}catch(e){this.raiseSendError(e)}else this.raiseSendError(new Error("No send channel"))}},{key:"raiseSendError",value:function(e){this.errorCallback&&this.errorCallback(e)}},{key:"assignEvent",value:function(e,t,n){e.addEventListener?e.addEventListener(t,n.bind(this),!1):e.attachEvent&&(t="on"+t,e.attachEvent(t,n.bind(this)))}},{key:"connect",value:function(e){var t=this;this.reset();var n=new c(function(e,n){t.resolveCb=e,t.rejectCb=n});this.iceServers=e;var r=null;try{if(RTCPeerConnection?r=RTCPeerConnection:webkitRTCPeerConnection?r=webkitRTCPeerConnection:mozRTCPeerConnection?r=mozRTCPeerConnection:window&&window.RTCPeerConnection&&(r=window.RTCPeerConnection),!r)return this.rejectCb(new Error("RTCPeerConnection not found")),n}catch(e){return this.rejectCb(e),n}var i={ordered:!1,maxRetransmits:0},o={iceTransportPolicy:"all",iceServers:this.iceServers};try{this.pctpc1=new r(o),this.pctpc2=new r(o)}catch(e){return this.rejectDisconnect(e),n}return this.connectionTimer=setTimeout(function(){delete t.connectionTimer,t.rejectDisconnect(new Error("Connection timeout"))},3e4),this.sendChannel=this.pctpc1.createDataChannel("precalltest",i),this.sendChannel.binaryType="arraybuffer",this.assignEvent(this.sendChannel,"error",function(e){t.raiseSendError(e),t.rejectDisconnect(e)}),this.assignEvent(this.pctpc2,"datachannel",function(e){var n=e.channel;t.assignEvent(n,"open",function(e){t.resolveCb&&t.resolveCb()}),t.assignEvent(n,"close",function(e){t&&t.disconnect&&t.disconnect()}),t.assignEvent(n,"message",function(e){t.messageCallback&&t.messageCallback(e.data)}),t.assignEvent(n,"error",function(e){t.errorCallback&&t.errorCallback(e),t.rejectDisconnect(e)})}),this.assignEvent(this.pctpc1,"icecandidate",function(e){t.onIceCandidate(t.pctpc1,e)}),this.assignEvent(this.pctpc1,"iceconnectionstatechange",function(e){t.onIceStateChange(t.pctpc1,e)}),this.assignEvent(this.pctpc2,"icecandidate",function(e){t.onIceCandidate(t.pctpc2,e)}),this.assignEvent(this.pctpc2,"iceconnectionstatechange",function(e){t.onIceStateChange(t.pctpc2,e)}),this.pctpc1.createOffer().then(function(e,n){t.onCreateOfferSuccess(e)},function(e){t.onCreateOfferError(t.pctpc1,e)}),n}},{key:"rejectDisconnect",value:function(e){this.rejectCb&&(this.rejectCb(e),this.disconnect())}},{key:"disconnect",value:function(){if(clearTimeout(this.connectionTimer),this.pctpc1)try{this.pctpc1.close()}catch(e){}if(this.pctpc1=null,this.pctpc2)try{this.pctpc2.close()}catch(e){}this.pctpc2=null,this.resolveCb=null,this.rejectCb=null}},{key:"getName",value:function(e){return e===this.pctpc1?"pctpc1":"pctpc2"}},{key:"getOtherPc",value:function(e){return e===this.pctpc1?this.pctpc2:this.pctpc1}},{key:"onCreateOfferError",value:function(e,t){this.rejectDisconnect(t)}},{key:"onCreateAnswerError",value:function(e,t){this.rejectDisconnect(t)}},{key:"onCreateOfferSuccess",value:function(e){var t=this;this.pctpc1.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc1)},function(e){t.onSetSessionDescriptionError(t.pctpc1,e)}),this.pctpc2.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc2)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc2,e)}),this.pctpc2.createAnswer().then(function(e){t.onCreateAnswerSuccess(e)},function(e){t.onCreateAnswerError(t.pctpc2,e)})}},{key:"onSetLocalSuccess",value:function(e){}},{key:"onSetRemoteSuccess",value:function(e){}},{key:"onSetSessionDescriptionError",value:function(e,t){this.rejectDisconnect(t)}},{key:"onSetRemoteSessionDescriptionError",value:function(e,t){this.rejectDisconnect(t)}},{key:"onCreateAnswerSuccess",value:function(e){var t=this;this.pctpc2.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc2)},function(e){t.onSetSessionDescriptionError(t.pctpc2,e)}),this.pctpc1.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc1)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc1,e)})}},{key:"onIceCandidate",value:function(e,t){var n=this;if(t.candidate){var r=new o.ParsedIceCandidate(t.candidate);e==this.pctpc1&&this.statshandler.codeBase==s.Constants.codeBaseType.chrome&&(r.isRelay()&&(r.isTypeTransportUdp()&&(this.parsedIceResults.relayUdpGathered=!0),r.isTypeTransportTcp()&&(this.parsedIceResults.relayTcpGathered=!0),r.isTypeTransportTls()&&(this.parsedIceResults.relayTlsGathered=!0)),r.isServerReflexive()&&(this.parsedIceResults.srflxGathered=!0)),r.isRelay()&&this.getOtherPc(e).addIceCandidate(t.candidate).then(function(){n.onAddIceCandidateSuccess(e)},function(t){n.onAddIceCandidateError(e,t,r.isRelay())})}}},{key:"onAddIceCandidateSuccess",value:function(e){}},{key:"onAddIceCandidateError",value:function(e,t,n){n&&this.rejectDisconnect(t)}},{key:"onIceStateChange",value:function(e,t){var n=this,r="(?)";e&&(r=e.iceConnectionState),"failed"===r&&this.rejectDisconnect(new Error("ICE failure")),"checking"!==r||this.iceTimer||(this.iceTimer=setTimeout(function(){delete n.iceTimer,n.rejectDisconnect(new Error("ICE timeout"))},1e4)),"completed"!==r&&"connected"!==r||delete this.iceTimer}},{key:"getIceResults",value:function(){var e=this;return new c(function(t,n){var r=e.iceServers,i=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;r.hasOwnProperty(u)||delete u.credential}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}var l={turnIpAddress:"",turnIpVersion:"",turnTransport:"",iceServers:r,ipv6Supported:!1,ipv4Supported:!1,relayTlsGathered:!1,relayTcpGathered:!1,relayUdpGathered:!1,srflxGathered:!1,relayTlsSuccess:!1,relayTcpSuccess:!1,relayUdpSuccess:!1,srflxSuccess:!1};for(var d in e.parsedIceResults)e.parsedIceResults.hasOwnProperty(d)&&(l[d]=e.parsedIceResults[d]);e.pctpc1?e.statshandler.getIceCandidates(e.pctpc1).then(function(e){var n=!0,r=!1,i=void 0;try{for(var o,a=e.iceCandidatePairs[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s.googActiveConnection||s.selected){var c=!0,u=!1,d=void 0;try{for(var p,f=e.localCandidates[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var h=p.value,v=null;if(v=h.ip?h.ip:h.ipAddress,h.id==s.localCandidateId){l.turnIpAddress=v;var m=-1!==v.indexOf(":");l.turnIpVersion=m?"ipv6":"ipv4",l.turnTransport=h.mozLocalTransport}"relay"!==h.candidateType&&"relayed"!==h.candidateType||("udp"===h.mozLocalTransport&&(l.relayUdpSuccess=!0),"tcp"===h.mozLocalTransport&&(l.relayTcpSuccess=!0),"tls"===h.mozLocalTransport&&(l.relayTlsSuccess=!0)),-1!==v.indexOf(":")?l.ipv6Supported=!0:l.ipv4Supported=!0}}catch(e){u=!0,d=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw d}}}}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}var g=!0,y=!1,b=void 0;try{for(var S,_=e.localCandidates[Symbol.iterator]();!(g=(S=_.next()).done);g=!0){var T=S.value;"relay"!==T.candidateType&&"relayed"!==T.candidateType||("udp"===T.mozLocalTransport&&(l.relayUdpGathered=!0),"tcp"===T.mozLocalTransport&&(l.relayTcpGathered=!0),"tls"===T.mozLocalTransport&&(l.relayTlsGathered=!0)),"srflx"!==T.candidateType&&"serverreflexive"!==T.candidateType||(l.srflxGathered=!0)}}catch(e){y=!0,b=e}finally{try{!g&&_.return&&_.return()}finally{if(y)throw b}}var E=!0,C=!1,w=void 0;try{for(var R,k=e.iceCandidatePairs[Symbol.iterator]();!(E=(R=k.next()).done);E=!0){var I=R.value;if("succeeded"===I.state){var P=!0,A=!1,D=void 0;try{for(var O,L=e.localCandidates[Symbol.iterator]();!(P=(O=L.next()).done);P=!0){var N=O.value;N.id==I.localCandidateId&&("relay"!==N.candidateType&&"relayed"!==N.candidateType||("udp"===N.mozLocalTransport&&(l.relayUdpSuccess=!0),"tcp"===N.mozLocalTransport&&(l.relayTcpSuccess=!0),"tls"===N.mozLocalTransport&&(l.relayTlsSuccess=!0)),"srflx"!==N.candidateType&&"serverreflexive"!==N.candidateType||(l.srflxSuccess=!0))}}catch(e){A=!0,D=e}finally{try{!P&&L.return&&L.return()}finally{if(A)throw D}}}}}catch(e){C=!0,w=e}finally{try{!E&&k.return&&k.return()}finally{if(C)throw w}}t(l)},function(e){n(e)}):n(new Error("PC not available for stats"))},function(e){reject(e)})}}]),e}();t.TurnConnection=u},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){r(this,e),this.iceCandidateStr=t.candidate,this.parse()}return i(e,[{key:"parse",value:function(){var e=this.iceCandidateStr.split(" ");e.length<8||(this.protocol="1"===e[1]?"rtp":"rtcp",this.transport=e[2],this.typeTransport=this.extractTypeTransport(e[3]),this.ipv6=-1!==e[4].indexOf(":"),this.ipAddress=e[4],this.port=e[5],this.type=e[7])}},{key:"extractTypeTransport",value:function(e){var t="None",n=e>>24;if("rtp"===this.protocol&&n>=0&&n<=2)switch(n){case 0:t="TLS";break;case 1:t="TCP";break;case 2:t="UDP"}return t}},{key:"getString",value:function(){return this.iceCandidateStr}},{key:"getType",value:function(){return this.type}},{key:"isHost",value:function(){return"host"===this.type.toLowerCase()}},{key:"isServerReflexive",value:function(){return"srflx"===this.type.toLowerCase()}},{key:"isPeerReflexive",value:function(){return"prflx"===this.type.toLowerCase()}},{key:"isRelay",value:function(){return"relay"===this.type.toLowerCase()||"relayed"===this.type.toLowerCase()}},{key:"getTypeTransport",value:function(){return this.typeTransport}},{key:"isTypeTransportUdp",value:function(){return"UDP"===this.typeTransport}},{key:"isTypeTransportTcp",value:function(){return"TCP"===this.typeTransport}},{key:"isTypeTransportTls",value:function(){return"TLS"===this.typeTransport}},{key:"getTransport",value:function(){return this.transport}},{key:"isUdp",value:function(){return"udp"===this.transport.toLowerCase()}},{key:"isTcp",value:function(){return"tcp"===this.transport.toLowerCase()}},{key:"getProtocol",value:function(){return this.protocol}},{key:"isRtp",value:function(){return"rtp"===this.protocol}},{key:"isRtcp",value:function(){return"rtcp"===this.protocol}},{key:"isIpv6",value:function(){return this.ipv6}},{key:"getIpAddress",value:function(){return this.ipAddress}},{key:"getPort",value:function(){return this.port}}]),e}();t.ParsedIceCandidate=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.GetStatsHandler=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(21),a=n(80),s=n(22),c=function(){function e(t){r(this,e),this.codeBase=t.codeBase,this.browserName=t.browserName,this.adapter=new a.StatsAdapter(this.codeBase,this.browserName),this.isPromiseBased=!0}return i(e,[{key:"getIceCandidates",value:function(e){var t=this;return new s(function(n,r){t.csioGetStats(t.iceCandidatesHandler.bind(t),e,function(e){n(e)})})}},{key:"iceCandidatesHandler",value:function(e,t){t(this.adapter.getIceCandidates(e))}},{key:"csioGetStats",value:function(e,t,n){var r=o.Constants.codeBaseType.firefox,i=o.Constants.codeBaseType.chrome,a=o.Constants.codeBaseType.edge,s=o.Constants.browserName.safari;t&&(this.codeBase===r?this.getStatsFirefox(e,t,n):this.browserName===s?this.getStatsSafari(e,t,n):this.codeBase===i?this.getStatsChrome(e,t,n):this.codeBase===a&&this.getStatsEdge(e,t,n))}},{key:"getStatsFirefox",value:function(e,t,n){var r=this;if(r.isPromiseBased)try{t.getStats().then(function(t){e(t,n)}).catch(function(i){r.isPromiseBased=!1,t.getStats(null,function(t){e(t,n)},function(){})})}catch(i){r.isPromiseBased=!1,t.getStats(null,function(t){e(t,n)},function(){})}else t.getStats(null,function(t){e(t,n)},function(){})}},{key:"getStatsChrome",value:function(e,t,n){var r=this;if(window&&window.csioReactNative)t.getStats(null,function(t){e(t,n)},function(e){});else if(r.isPromiseBased)try{t.getStats().then(function(t){e(t,n)}).catch(function(i){r.isPromiseBased=!1,t.getStats(function(t){e(t,n)})})}catch(r){isPromiseBased=!1,t.getStats(function(t){e(t,n)})}else t.getStats(function(t){e(t,n)})}},{key:"getStatsEdge",value:function(e,t,n){t.getStats().then(function(t){e(t,n)}).catch(function(e){})}},{key:"getStatsSafari",value:function(e,t,n){t.getStats().then(function(t){e(t,n)}).catch(function(e){})}}]),e}();t.GetStatsHandler=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.StatsAdapter=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(21),a=function(){function e(t,n){r(this,e),this.codeBase=t,this.browser=n}return i(e,[{key:"getIceCandidates",value:function(e){if(!e)return null;var t=this.extractRawStats(e);return this.processRawStatsForIceInfo(t)}},{key:"extractRawStats",value:function(e){var t=[],n=void 0,r=o.Constants.codeBaseType.firefox,i=o.Constants.codeBaseType.chrome,a=o.Constants.browserName.safari;if(this.codeBase===r&&this.browser!==a)e.forEach(function(e){t.push(e)});else if(this.codeBase===i&&this.browser!==a)e&&e.result?t=e.result():e&&e.forEach&&(t=[],e.forEach(function(e){t.push(e)}));else for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},{key:"processRawStatsForIceInfo",value:function(e){var t=[],n=[],r=[],i=void 0;if(!e)return null;for(var o=0;o<e.length;++o){var a=this.getParsedStats(e[o]),s=this.statsClassifier(a);if(s.candidatePair)r.push(s.candidatePair);else if(s.transportStats){if("transport"===s.transportStats.type){i=s.transportStats.selectedCandidatePairId;continue}r.push(s.transportStats)}else if(s.localCandidate){var c=s.localCandidate;if("relay"==c.candidateType||"relayed"==c.candidateType){if(!c.mozLocalTransport){var u=c.priority>>24;c.mozLocalTransport=this.formatRelayType(u)}c.mozLocalTransport=c.mozLocalTransport.toLowerCase()}t.push(c)}else s.remoteCandidate&&n.push(s.remoteCandidate)}if(i)for(var l=0;l<r.length;++l)r[l].id===i&&(r[l].googActiveConnection="true");return{localCandidates:t,remoteCandidates:n,iceCandidatePairs:r}}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names)for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);else Object.assign(t,e);if(t.values){var i=!0,o=!1,a=void 0;try{for(var s,c=t.values[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;Object.assign(t,u)}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}delete t.values}return t}},{key:"statsClassifier",value:function(e){var t={},n=function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=!0,o=!1,a=void 0;try{for(var s,c=n[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;if(e.type===u)return!0}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return!1},r=n("inbound-rtp","inboundrtp"),i="true"===e.isRemote||!0===e.isRemote;return r||n("outbound-rtp","outboundrtp")?(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.streamType=r?"inbound":"outbound",t.tracks.reportType="local",void 0!==e.isRemote&&(t.tracks.reportType=i?"remote":"local")):n("candidatepair")&&e.selected?t.transportStats=e:n("localcandidate","local-candidate")?t.localCandidate=e:n("remotecandidate","remote-candidate")?t.remoteCandidate=e:n("transport","googCandidatePair")?t.transportStats=e:n("VideoBwe")?t.bwe=e:n("track")?t.trackStats=e:n("candidate-pair")?t.candidatePair=e:n("codec")?t.codec=e:n("ssrc")&&(t.tracks={},t.tracks.data=e,t.tracks.ssrc=e.ssrc,t.tracks.reportType="local",t.tracks.streamType=e.bytesSent?"outbound":"inbound"),t}},{key:"formatRelayType",value:function(e){var t="none";switch(e){case 0:t="tls";break;case 1:t="tcp";break;case 2:t="udp"}return t}}]),e}();t.StatsAdapter=a},function(e,t,n){(function(e,t){!function(e,n){"use strict";function r(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var r={callback:e,args:t};return u[c]=r,s(c),c++}function i(e){delete u[e]}function o(e){var t=e.callback,r=e.args;switch(r.length){case 0:t();break;case 1:t(r[0]);break;case 2:t(r[0],r[1]);break;case 3:t(r[0],r[1],r[2]);break;default:t.apply(n,r)}}function a(e){if(l)setTimeout(a,0,e);else{var t=u[e];if(t){l=!0;try{o(t)}finally{i(e),l=!1}}}}if(!e.setImmediate){var s,c=1,u={},l=!1,d=e.document,p=Object.getPrototypeOf&&Object.getPrototypeOf(e);p=p&&p.setTimeout?p:e,"[object process]"==={}.toString.call(e.process)?function(){s=function(e){t.nextTick(function(){a(e)})}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),s=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){a(e.data)},s=function(t){e.port2.postMessage(t)}}():d&&"onreadystatechange"in d.createElement("script")?function(){var e=d.documentElement;s=function(t){var n=d.createElement("script");n.onreadystatechange=function(){a(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){s=function(e){setTimeout(a,0,e)}}(),p.setImmediate=r,p.clearImmediate=i}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(20),n(30))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t.RttTest=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},u=n(17),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),d=n(37),p=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.sendTimer=null,n.countSent=0,n.rtts=[],n}return o(t,d.TurnTest),s(t,[{key:"initiate",value:function(){this.results.startTimestamp=l.getCurrent(),this.sendPing()}},{key:"handleMessage",value:function(e){if(this.isActive()){var t=parseInt(e,10),n=this.calculateRtt(t);this.rtts.push(n),this.countSent<10?this.sendPing():this.calculateMetrics()}}},{key:"handleError",value:function(e){this.fillResults(),this.failed(e)}},{key:"sendPing",value:function(){if(this.isActive()){var e=l.getCurrent();this.send(e.toString()),this.countSent+=1,this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.countSent<10?this.sendTimer=setTimeout(this.sendPing.bind(this),100):this.sendTimer=setTimeout(this.calculateMetrics.bind(this),500)}}},{key:"calculateRtt",value:function(e){return l.getCurrent()-e}},{key:"calculateMetrics",value:function(){this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.fillResults(),this.finished()}},{key:"fillResults",value:function(){this.results.sentMessages=this.countSent,this.results.unAckedMessages=this.countSent-this.rtts.length,this.results.maxMessages=10,this.results.forceStopped=this.forceStopped,this.results.median=this.median(),this.results.variance=this.variance(),this.results.endTimestamp=l.getCurrent()}},{key:"median",value:function(){if(0==this.rtts.length)return null;this.rtts.sort();var e=Math.floor(this.rtts.length/2);return this.rtts[e]}},{key:"variance",value:function(){if(0==this.rtts.length)return null;var e=0,t=this.median(),n=!0,r=!1,i=void 0;try{for(var o,a=this.rtts[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;e+=Math.abs(s-t)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return e/=this.rtts.length}},{key:"stop",value:function(){this.isActive()&&(c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();t.RttTest=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":a(t))&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":a(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t.ThroughputTest=void 0;var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},u=n(17),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(u),d=n(38),p=n(37),f=function(e){function t(e,n){r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(o.sentBytes=0,o.receivedBytes=0,o.secondHalfBytes=0,o.secondHalfStart=null,o.bufferEmpty=0,o.chunkSize=1200,o.messageMaker=new d.MessageMaker(o.chunkSize),o.duration=5e3,null!=n){var a=50*n;o.duration=Math.max(Math.min(a,1e4),1e3)}return o.sendTimer=null,o.lastMessage=null,o.intervals=[],o.intervalStart=0,o.intervalLength=100,o.intervalBytes=0,o}return o(t,p.TurnTest),s(t,[{key:"initiate",value:function(){this.startSend()}},{key:"handleMessage",value:function(e){var t=this;if(this.isActive()){this.lastMessage=e,this.receivedBytes+=e.length;var n=l.getCurrent();if(this.sendTimer||(this.results.startTimestamp=n,this.sendTimer=setTimeout(function(){t.stop(),t.finished()},this.duration)),0==this.intervalStart&&(this.intervalStart=n),this.intervalBytes+=e.length,n-this.intervalStart>=this.intervalLength){var r=n-this.intervalStart,i=this.averageThroughput(this.intervalBytes,r),o=null;try{o=n-JSON.parse(this.lastMessage).timestamp}catch(e){}this.intervals.push({startTimestamp:this.intervalStart,endTimestamp:n,bytesReceived:this.intervalBytes,average:i,rtt:o}),this.intervalStart=n,this.intervalBytes=0}this.results.startTimestamp&&n-this.results.startTimestamp>this.duration/2&&(this.secondHalfStart||(this.secondHalfStart=n),this.secondHalfBytes+=e.length)}}},{key:"handleError",value:function(e){this.stop(),this.failed(e)}},{key:"averageThroughput",value:function(e,t){return e/(t/1e3)*8/1024}},{key:"bufferListener",value:function(){this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this)),this.fillBuffer()}},{key:"fillBuffer",value:function(){for(0==this.sendChannel.bufferedAmount&&(this.bufferEmpty+=1);this.isActive();){if(this.sendChannel.bufferedAmount>this.bufferFullThreshold)return void(this.usePolling?setTimeout(this.fillBuffer.bind(this),250):this.sendChannel.addEventListener("bufferedamountlow",this.bufferListener.bind(this)));var e=this.messageMaker.make(this.sentBytes);this.sentBytes+=e.length,this.send(e)}this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this))}},{key:"startSend",value:function(){this.isActive()&&(this.bufferFullThreshold=1e3*this.chunkSize,this.sendChannel=this.connection.sendChannel,this.usePolling=!0,"number"==typeof this.sendChannel.bufferedAmountLowThreshold&&(this.usePolling=!1,this.sendChannel.bufferedAmountLowThreshold=this.bufferFullThreshold/10),setTimeout(this.fillBuffer.bind(this),0))}},{key:"fillResults",value:function(){this.results.endTimestamp=l.getCurrent(),this.results.maxDuration=this.duration,this.results.forceStopped=this.forceStopped,this.results.bufferEmpty=this.bufferEmpty,this.results.intervals=this.intervals,this.results.bytesPrepared=this.sentBytes,this.results.bytesReceived=this.receivedBytes;var e=0,t=0;this.secondHalfStart&&(e=this.results.endTimestamp-this.secondHalfStart,t=this.averageThroughput(this.secondHalfBytes,e));var n=this.results.endTimestamp-this.results.startTimestamp,r=this.averageThroughput(this.receivedBytes,n);r>t&&(t=r),this.results.average=t;var i=null;try{i=JSON.parse(this.lastMessage)}catch(e){return}var o=i.sentBytes+this.lastMessage.length;this.results.bytesSent=o,this.results.fractionLostBytes=1-this.receivedBytes/o}},{key:"stop",value:function(){this.isActive()&&(clearTimeout(this.sendTimer),this.sendTimer=null,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"stop",this).call(this),this.fillResults())}}]),t}();t.ThroughputTest=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t.ResultsHandler=void 0;var o="function"==typeof Symbol&&"symbol"==i(Symbol.iterator)?function(e){return void 0===e?"undefined":i(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":i(e)},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(17),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(s),u=n(38),l=function(){function e(){r(this,e),this.start=c.getCurrent(),this.id=Math.trunc(this.start)+"-"+(0,u.randomAsciiString)(20),this.version="1.1.2",this.failures=[],this.results={},this.forceStopped=!1}return a(e,[{key:"getResults",value:function(){return{id:this.id,version:this.version,forceStopped:this.forceStopped,startTimestamp:this.start,endTimestamp:c.getCurrent(),failures:this.failures,tests:this.results}}},{key:"getFailureNumber",value:function(){return this.failures.length}},{key:"getId",value:function(){return this.id}},{key:"add",value:function(e,t){this.results[e]=t,t.forceStopped&&!0===t.forceStopped&&(this.forceStopped=!0)}},{key:"failure",value:function(e){"object"===(void 0===e?"undefined":o(e))&&(e=e.toString());var t={timestamp:c.getCurrent(),reason:e};this.failures.push(t)}}]),e}();t.ResultsHandler=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.OnlineCheck=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(17),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(o),s=function(){function e(){r(this,e)}return i(e,[{key:"start",value:function(){var e=this;this.onlineCheck=[],window&&window.addEventListener&&"function"==typeof window.addEventListener&&(window.addEventListener("offline",function(){e.addEntry()}),window.addEventListener("online",function(){e.addEntry()}),this.addEntry())}},{key:"addEntry",value:function(){var e=a.getCurrent();if(navigator&&navigator.onLine){var t=navigator.onLine;this.onlineCheck.push({timestamp:e,online:t})}}},{key:"stop",value:function(){var e=this;return window.removeEventListener("offline",function(){e.addEntry()}),window.removeEventListener("online",function(){e.addEntry()}),this.onlineCheck}}]),e}();t.OnlineCheck=s},function(e,t,n){"use strict";(function(e){function r(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}function i(){this.loss={},this.bitrate={download:0,upload:0},this.resolution={},this.framerate=0}function o(){this.bandwidth={},this.bitrate={},this.packetLoss=null,this.transport=[]}function a(e,t,n,r){this._browserType=s.a.getBrowserType();var i=f[this._browserType];if(!i)throw"The browser type '"+this._browserType+"' isn't supported!";this._getStatValue=this._defineGetStatValueMethod(i),this.peerconnection=e,this.baselineAudioLevelsReport=null,this.currentAudioLevelsReport=null,this.currentStatsReport=null,this.previousStatsReport=null,this.audioLevelsIntervalId=null,this.eventEmitter=r,this.conferenceStats=new o,this.audioLevelsIntervalMilis=t,this.statsIntervalId=null,this.statsIntervalMilis=n,this.ssrc2stats=new Map}t.a=a;var s=n(1),c=n(40),u=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=n(2),d=n(0).getLogger(e),p=s.a.isChrome()||s.a.isOpera()||s.a.isFirefox()||s.a.isNWJS()||s.a.isElectron()||s.a.isTemasysPluginUsed()||s.a.isEdge(),f={};f[s.a.RTC_BROWSER_FIREFOX]={ssrc:"ssrc",packetsReceived:"packetsReceived",packetsLost:"packetsLost",packetsSent:"packetsSent",bytesReceived:"bytesReceived",bytesSent:"bytesSent",framerateMean:"framerateMean"},f[s.a.RTC_BROWSER_CHROME]={receiveBandwidth:"googAvailableReceiveBandwidth",sendBandwidth:"googAvailableSendBandwidth",remoteAddress:"googRemoteAddress",transportType:"googTransportType",localAddress:"googLocalAddress",activeConnection:"googActiveConnection",ssrc:"ssrc",packetsReceived:"packetsReceived",packetsSent:"packetsSent",packetsLost:"packetsLost",bytesReceived:"bytesReceived",bytesSent:"bytesSent",googFrameHeightReceived:"googFrameHeightReceived",googFrameWidthReceived:"googFrameWidthReceived",googFrameHeightSent:"googFrameHeightSent",googFrameWidthSent:"googFrameWidthSent",googFrameRateReceived:"googFrameRateReceived",googFrameRateSent:"googFrameRateSent",audioInputLevel:"audioInputLevel",audioOutputLevel:"audioOutputLevel",currentRoundTripTime:"googRtt",remoteCandidateType:"googRemoteCandidateType",localCandidateType:"googLocalCandidateType"},f[s.a.RTC_BROWSER_EDGE]={sendBandwidth:"googAvailableSendBandwidth",remoteAddress:"remoteAddress",transportType:"protocol",localAddress:"localAddress",activeConnection:"activeConnection",ssrc:"ssrc",packetsReceived:"packetsReceived",packetsSent:"packetsSent",packetsLost:"packetsLost",bytesReceived:"bytesReceived",bytesSent:"bytesSent",googFrameHeightReceived:"frameHeight",googFrameWidthReceived:"frameWidth",googFrameHeightSent:"frameHeight",googFrameWidthSent:"frameWidth",googFrameRateReceived:"framesPerSecond",googFrameRateSent:"framesPerSecond",audioInputLevel:"audioLevel",audioOutputLevel:"audioLevel",currentRoundTripTime:"roundTripTime"},f[s.a.RTC_BROWSER_OPERA]=f[s.a.RTC_BROWSER_CHROME],f[s.a.RTC_BROWSER_NWJS]=f[s.a.RTC_BROWSER_CHROME],f[s.a.RTC_BROWSER_ELECTRON]=f[s.a.RTC_BROWSER_CHROME],f[s.a.RTC_BROWSER_IEXPLORER]=f[s.a.RTC_BROWSER_CHROME],f[s.a.RTC_BROWSER_SAFARI]=f[s.a.RTC_BROWSER_CHROME],f[s.a.RTC_BROWSER_REACT_NATIVE]=f[s.a.RTC_BROWSER_CHROME],i.prototype.setLoss=function(e){this.loss=e||{}},i.prototype.setResolution=function(e){this.resolution=e||{}},i.prototype.addBitrate=function(e){this.bitrate.download+=e.download,this.bitrate.upload+=e.upload},i.prototype.resetBitrate=function(){this.bitrate.download=0,this.bitrate.upload=0},i.prototype.setFramerate=function(e){this.framerate=e||0},a.prototype.stop=function(){this.audioLevelsIntervalId&&(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null),this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},a.prototype.errorCallback=function(e){l.callErrorHandler(e),d.error("Get stats error",e),this.stop()},a.prototype.start=function(e){var t=this;e&&(this.audioLevelsIntervalId=setInterval(function(){t.peerconnection.getStats(function(e){var n=null;n=e&&e.result&&"function"==typeof e.result?e.result():e,t.currentAudioLevelsReport=n,t.processAudioLevelReport(),t.baselineAudioLevelsReport=t.currentAudioLevelsReport},t.errorCallback)},t.audioLevelsIntervalMilis)),p&&(this.statsIntervalId=setInterval(function(){t.peerconnection.getStats(function(e){var n=null;n=e&&e.result&&"function"==typeof e.result?e.result():e,t.currentStatsReport=n;try{t.processStatsReport()}catch(e){l.callErrorHandler(e),d.error("Unsupported key:"+e,e)}t.previousStatsReport=t.currentStatsReport},t.errorCallback)},t.statsIntervalMilis))},a.prototype._defineGetStatValueMethod=function(e){var t=function(t){var n=e[t];if(n)return n;throw"The property '"+t+"' isn't supported!"},n=void 0;switch(this._browserType){case s.a.RTC_BROWSER_CHROME:case s.a.RTC_BROWSER_OPERA:case s.a.RTC_BROWSER_NWJS:case s.a.RTC_BROWSER_ELECTRON:n=function(e,t){return e.stat(t)};break;case s.a.RTC_BROWSER_REACT_NATIVE:n=function(e,t){var n=void 0;return e.values.some(function(e){return!!e.hasOwnProperty(t)&&(n=e[t],!0)}),n};break;case s.a.RTC_BROWSER_EDGE:n=function(e,t){return e[t]};break;default:n=function(e,t){return e[t]}}return function(e,r){return n(e,t(r))}},a.prototype.getNonNegativeStat=function(e,t){var n=this._getStatValue(e,t);return"number"!=typeof n&&(n=Number(n)),isNaN(n)?0:Math.max(0,n)},a.prototype.processStatsReport=function(){var e=this;if(this.previousStatsReport){var t=this._getStatValue,n={};for(var o in this.currentStatsReport)if(this.currentStatsReport.hasOwnProperty(o)){var a=this.currentStatsReport[o];if(a){try{var l=t(a,"receiveBandwidth"),p=t(a,"sendBandwidth");(l||p)&&(this.conferenceStats.bandwidth={download:Math.round(l/1e3),upload:Math.round(p/1e3)})}catch(e){}if("googCandidatePair"===a.type){var f=function(){var n=void 0,r=void 0,i=void 0,o=void 0,s=void 0,c=void 0,u=void 0;try{if(!(n=t(a,"activeConnection")))return"continue";r=t(a,"remoteAddress"),u=t(a,"transportType"),o=t(a,"localAddress"),i=t(a,"localCandidateType"),s=t(a,"remoteCandidateType"),c=e.getNonNegativeStat(a,"currentRoundTripTime")}catch(e){}if(!r||!u||!o||"true"!==n)return"continue";var l=e.conferenceStats.transport;return l.some(function(e){return e.ip===r&&e.type===u&&e.localip===o})||l.push({ip:r,type:u,localip:o,p2p:e.peerconnection.isP2P,localCandidateType:i,remoteCandidateType:s,rtt:c}),"continue"}();if("continue"===f)continue}if("candidatepair"===a.type){if("succeeded"!==a.state)continue;var h=this.currentStatsReport[a.localCandidateId],v=this.currentStatsReport[a.remoteCandidateId];this.conferenceStats.transport.push({ip:v.ipAddress+":"+v.portNumber,type:h.transport,localip:h.ipAddress+":"+h.portNumber,p2p:this.peerconnection.isP2P,localCandidateType:h.candidateType,remoteCandidateType:v.candidateType})}if("transportdiagnostics"===a.msType&&this.conferenceStats.transport.push({ip:a.remoteAddress,type:a.protocol,localip:a.localAddress,p2p:this.peerconnection.isP2P}),("ssrc"===a.type||"outboundrtp"===a.type||"inboundrtp"===a.type||"track"===a.type)&&(!s.a.isEdge()||"inboundrtp"!==a.type&&"outboundrtp"!==a.type)){var m=this.previousStatsReport[o],g=this.getNonNegativeStat(a,"ssrc");if("track"===a.type&&Array.isArray(a.ssrcIds)&&(g=Number(a.ssrcIds[0])),m&&g&&(s.a.isEdge()||!0!==a.isRemote&&!0!==a.remoteSource)){var y=this.ssrc2stats.get(g);y||(y=new i,this.ssrc2stats.set(g,y));var b=!0,S="packetsReceived",_=t(a,S);void 0!==_&&null!==_&&""!==_||(b=!1,S="packetsSent",void 0!==(_=t(a,S))&&null!==_||d.warn("No packetsReceived nor packetsSent stat found")),(!_||_<0)&&(_=0);var T=this.getNonNegativeStat(m,S),E=Math.max(0,_-T),C=this.getNonNegativeStat(a,"packetsLost"),w=this.getNonNegativeStat(m,"packetsLost"),R=Math.max(0,C-w);y.setLoss({packetsTotal:E+R,packetsLost:R,isDownloadStream:b});var k=this.getNonNegativeStat(a,"bytesReceived"),I=this.getNonNegativeStat(m,"bytesReceived"),P=Math.max(0,k-I),A=0,D=t(a,"bytesSent");"number"!=typeof D&&"string"!=typeof D||(D=Number(D),isNaN(D)||(n[g]=D,D>0&&(A=D-t(m,"bytesSent")))),A=Math.max(0,A);var O=a.timestamp-m.timestamp,L=0,N=0;O>0&&(L=Math.round(8*P/O),N=Math.round(8*A/O)),y.addBitrate({download:L,upload:N});var M={height:null,width:null};try{var x=void 0,F=void 0;(x=t(a,"googFrameHeightReceived"))&&(F=t(a,"googFrameWidthReceived"))?(M.height=x,M.width=F):(x=t(a,"googFrameHeightSent"))&&(F=t(a,"googFrameWidthSent"))&&(M.height=x,M.width=F)}catch(e){}var j=void 0;try{j=t(a,"googFrameRateReceived")||t(a,"googFrameRateSent")||0}catch(e){try{j=this.getNonNegativeStat(a,"framerateMean")}catch(e){}}y.setFramerate(Math.round(j||0)),M.height&&M.width?y.setResolution(M):y.setResolution(null)}}}}var U={download:0,upload:0},B={download:0,upload:0},G=0,J=0,H={},V={},W=0,K=0,q=0,z=0,Q=!0,$=!1,X=void 0;try{for(var Y,Z=this.ssrc2stats[Symbol.iterator]();!(Q=(Y=Z.next()).done);Q=!0){var ee=u(Y.value,2),te=ee[0],ne=ee[1],re=ne.loss,ie=re.isDownloadStream?"download":"upload";U[ie]+=re.packetsTotal,B[ie]+=re.packetsLost,G+=ne.bitrate.download,J+=ne.bitrate.upload;var oe=this.peerconnection.getTrackBySSRC(te);if(oe){oe.isAudioTrack()?(W+=ne.bitrate.download,K+=ne.bitrate.upload):(q+=ne.bitrate.download,z+=ne.bitrate.upload);var ae=oe.getParticipantId();if(ae){var se=ne.resolution;if(se.width&&se.height&&-1!==se.width&&-1!==se.height){var ce=H[ae]||{};ce[te]=se,H[ae]=ce}if(0!==ne.framerate){var ue=V[ae]||{};ue[te]=ne.framerate,V[ae]=ue}}else d.error("No participant ID returned by "+oe)}else this.peerconnection.isP2P&&d.error("JitsiTrack not found for SSRC "+te+" in "+this.peerconnection);ne.resetBitrate()}}catch(e){$=!0,X=e}finally{try{!Q&&Z.return&&Z.return()}finally{if($)throw X}}this.eventEmitter.emit(c.c,this.peerconnection,n),this.conferenceStats.bitrate={upload:J,download:G},this.conferenceStats.bitrate.audio={upload:K,download:W},this.conferenceStats.bitrate.video={upload:z,download:q},this.conferenceStats.packetLoss={total:r(B.download+B.upload,U.download+U.upload),download:r(B.download,U.download),upload:r(B.upload,U.upload)},this.eventEmitter.emit(c.d,this.peerconnection,{bandwidth:this.conferenceStats.bandwidth,bitrate:this.conferenceStats.bitrate,packetLoss:this.conferenceStats.packetLoss,resolution:H,framerate:V,transport:this.conferenceStats.transport}),this.conferenceStats.transport=[]}},a.prototype.processAudioLevelReport=function(){if(this.baselineAudioLevelsReport){var e=this._getStatValue;for(var t in this.currentAudioLevelsReport)if(this.currentAudioLevelsReport.hasOwnProperty(t)){var n=this.currentAudioLevelsReport[t];if("ssrc"===n.type||"track"===n.type){var r=this.baselineAudioLevelsReport[t],i=this.getNonNegativeStat(n,"ssrc");if(!i&&Array.isArray(n.ssrcIds)&&(i=Number(n.ssrcIds[0])),r)if(i){var o=void 0;try{o=e(n,"audioInputLevel")||e(n,"audioOutputLevel")}catch(e){return d.warn("Audio Levels are not available in the statistics."),void clearInterval(this.audioLevelsIntervalId)}if(o){var a=void 0;a="ssrc"===n.type?!e(n,"packetsReceived"):!n.remoteSource,s.a.isEdge()?o=o<0?Math.pow(10,o/20):0:o/=32767,this.eventEmitter.emit(c.a,this.peerconnection,i,o,a)}}else Date.now()-n.timestamp<3e3&&d.warn("No ssrc: ");else d.warn(i+" not enough data")}}}}}).call(t,"modules/statistics/RTPStatsCollector.js")},function(e,t,n){var r,i,o;"function"==typeof Symbol&&Symbol.iterator,function(n,a){i=[],r=a,void 0!==(o="function"==typeof r?r.apply(t,i):r)&&(e.exports=o)}(this||window,function(){function e(e,t){var n,r=null;if(t=t||u,"string"==typeof e&&e)for(n=t.length;n--;)if(t[n].src===e){r=t[n];break}return r}function t(e){var t,n,r=null;for(e=e||u,t=0,n=e.length;t<n;t++)if(!e[t].hasAttribute("src")){if(r){r=null;break}r=e[t]}return r}function n(e,t){var r,i,o=null,a="number"==typeof t;return t=a?Math.round(t):0,"string"==typeof e&&e&&(a?r=e.match(/(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/):(r=e.match(/^(?:|[^:@]*@|.+\)@(?=data:text\/javascript|blob|http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/))&&r[1]||(r=e.match(/\)@(data:text\/javascript(?:;[^,]+)?,.+?|(?:|blob:)(?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/)),r&&r[1]&&(t>0?(i=e.slice(e.indexOf(r[0])+r[0].length),o=n(i,t-1)):o=r[1])),o}function r(){return null}function i(){return null}function o(){if(0===u.length)return null;var r,i,s,v,m,g=[],y=o.skipStackDepth||1;for(r=0;r<u.length;r++)d&&l?a.test(u[r].readyState)&&g.push(u[r]):g.push(u[r]);if(i=new Error,f&&(s=i.stack),!s&&h)try{throw i}catch(e){s=e.stack}if(s&&(v=n(s,y),!(m=e(v,g))&&c&&v===c&&(m=t(g))),m||1===g.length&&(m=g[0]),m||p&&(m=document.currentScript),!m&&d&&l)for(r=g.length;r--;)if("interactive"===g[r].readyState){m=g[r];break}return m||(m=g[g.length-1]||null),m}var a=/^(interactive|loaded|complete)$/,s=window.location?window.location.href:null,c=s?s.replace(/#.*$/,"").replace(/\?.*$/,"")||null:null,u=document.getElementsByTagName("script"),l="readyState"in(u[0]||document.createElement("script")),d=!window.opera||"[object Opera]"!==window.opera.toString(),p="currentScript"in document;"stackTraceLimit"in Error&&Error.stackTraceLimit!==1/0&&(Error.stackTraceLimit,Error.stackTraceLimit=1/0);var f=!1,h=!1;!function(){try{var e=new Error;throw f="string"==typeof e.stack&&!!e.stack,e}catch(e){h="string"==typeof e.stack&&!!e.stack}}(),o.skipStackDepth=1;var v=o;return v.near=o,v.far=r,v.origin=i,v})},function(e,t){var n={LOCAL_JID:"local"};e.exports=n},function(e,t,n){"use strict";(function(e){function r(e){this.versions={},this.conference=e,this.conference.addCommandListener("versions",this.processPresence.bind(this))}t.a=r;var i=n(5),o=n(0).getLogger(e);r.FOCUS_COMPONENT="focus",r.VIDEOBRIDGE_COMPONENT="videobridge",r.XMPP_SERVER_COMPONENT="xmpp",r.prototype.processPresence=function(e,t,n){var a=this;if("http://jitsi.org/jitmeet"!==e.attributes.xmlns)return void o.warn("Ignored presence versions node - invalid xmlns",e);if(!this.conference._isFocus(n))return void o.warn("Received versions not from the focus user: "+e,n);var s=[];e.children.forEach(function(e){var t=e.attributes.name;if(t!==r.FOCUS_COMPONENT&&t!==r.XMPP_SERVER_COMPONENT&&t!==r.VIDEOBRIDGE_COMPONENT)return void o.warn("Received version for not supported component name: "+t);var n=e.value;a.versions[t]!==n&&(a.versions[t]=n,o.info("Got "+t+" version: "+n),s.push({id:"component_version",component:t,version:n}))}),s.length>0&&i.a.sendLog(JSON.stringify(s))},r.prototype.getComponentVersion=function(e){return this.versions[e]}}).call(t,"modules/version/ComponentsVersions.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){if(n<5e3)return 1;var r=0,i=Math.min(t.height,t.width);if(e){var a=v.find(function(e){return e.height<=i});if(a)for(i=a.height;i>=180&&"break"!==function(){var e=i;if(!(a=v.find(function(t){return t.height===e})))return"break";r+=a.target}();i/=2);}else{var s=t.width*t.height;r=s<=76800?600:s<=307200?1700:s<=518400?2e3:2500}return Math.min(r,o(Math.max(0,n-1e3)))}function o(e){return e>6e4?Number.MAX_SAFE_INTEGER:m*Math.pow(1.08,e/1e3)}var a=n(27),s=n(4),c=n(0),u=(n.n(c),function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()),l=n(6),d=n(14),p=n(31),f=Object(c.getLogger)(e),h="stats",v=[{width:1920,height:1080,layers:3,max:5e3,target:4e3,min:800},{width:1280,height:720,layers:3,max:2500,target:2500,min:600},{width:960,height:540,layers:3,max:900,target:900,min:450},{width:640,height:360,layers:2,max:700,target:500,min:150},{width:480,height:270,layers:2,max:450,target:350,min:150},{width:320,height:180,layers:1,max:200,target:150,min:30}],m=800,g=function(){function e(t,n,i){var o=this;r(this,e),this.eventEmitter=n,this._conference=t,this._localStats={connectionQuality:100,jvbRTT:void 0},this._lastConnectionQualityUpdate=-1,this._remoteStats={},this._timeIceConnected=-1,this._timeVideoUnmuted=-1,i.startBitrate&&i.startBitrate>0&&(m=i.startBitrate),t.on(s.CONNECTION_INTERRUPTED,function(){o._updateLocalConnectionQuality(0),o.eventEmitter.emit(a.LOCAL_STATS_UPDATED,o._localStats),o._broadcastLocalStats()}),t.room.addListener(l.ICE_CONNECTION_STATE_CHANGED,function(e,t){e.isP2P||"connected"!==t||(o._timeIceConnected=window.performance.now())}),t.on(s.ENDPOINT_MESSAGE_RECEIVED,function(e,t){t.type===h&&o._updateRemoteStats(e.getId(),t.values)}),t.statistics.addConnectionStatsListener(this._updateLocalStats.bind(this)),t.on(s.TRACK_MUTE_CHANGED,function(e){e.isVideoTrack()&&(e.isMuted()?o._timeVideoUnmuted=-1:o._maybeUpdateUnmuteTime())}),t.on(s.TRACK_ADDED,function(e){e.isVideoTrack()&&!e.isMuted()&&o._maybeUpdateUnmuteTime()})}return u(e,[{key:"_maybeUpdateUnmuteTime",value:function(){this._timeVideoUnmuted<0&&(this._timeVideoUnmuted=window.performance.now())}},{key:"_calculateConnectionQuality",value:function(e,t,n){var r=p[n],o=100,a=void 0;if(this._localStats.packetLoss&&(a=this._localStats.packetLoss.upload,t&&(a*=.5)),t||!r||e===d.DESKTOP||this._timeIceConnected<0||this._timeVideoUnmuted<0)void 0===a?(f.error("Cannot calculate connection quality, unknown packet loss."),o=100):o=a<=2?100:a<=4?70:a<=6?50:a<=8?30:a<=12?10:0;else{var s=window.performance.now()-Math.max(this._timeVideoUnmuted,this._timeIceConnected),c=this._conference.getActivePeerConnection(),u=Boolean(c&&c.isSimulcastOn()),l=i(u,r,s);l*=.9,o=100*this._localStats.bitrate.upload/l,a&&a>=10&&(o=Math.min(o,30))}if(this._lastConnectionQualityUpdate>0){var h=this._localStats.connectionQuality,v=(window.performance.now()-this._lastConnectionQualityUpdate)/1e3;o=Math.min(o,h+2*v)}return Math.min(100,o)}},{key:"_updateLocalConnectionQuality",value:function(e){this._localStats.connectionQuality=e,this._lastConnectionQualityUpdate=window.performance.now()}},{key:"_broadcastLocalStats",value:function(){var e={bitrate:this._localStats.bitrate,packetLoss:this._localStats.packetLoss,connectionQuality:this._localStats.connectionQuality,jvbRTT:this._localStats.jvbRTT},t=this._conference.getLocalVideoTrack();t&&t.resolution&&(e.resolution=t.resolution);try{this._conference.broadcastEndpointMessage({type:h,values:e})}catch(e){}}},{key:"_updateLocalStats",value:function(e,t){if(!e.isP2P){var n=t.transport&&t.transport.length&&t.transport[0].rtt;this._localStats.jvbRTT=n||void 0}if(e===this._conference.getActivePeerConnection()){var r=void 0,i=!this._conference.isConnectionInterrupted(),o=this._conference.getLocalVideoTrack(),s=o?o.videoType:void 0,c=!o||o.isMuted(),u=o?o.resolution:null;c||this._maybeUpdateUnmuteTime();for(r in t)t.hasOwnProperty(r)&&(this._localStats[r]=t[r]);i&&this._updateLocalConnectionQuality(this._calculateConnectionQuality(s,c,u)),this.eventEmitter.emit(a.LOCAL_STATS_UPDATED,this._localStats),this._broadcastLocalStats()}}},{key:"_updateRemoteStats",value:function(e,t){this._remoteStats[e]={bitrate:t.bitrate,packetLoss:t.packetLoss,connectionQuality:t.connectionQuality,jvbRTT:t.jvbRTT},this.eventEmitter.emit(a.REMOTE_STATS_UPDATED,e,this._remoteStats[e])}},{key:"getStats",value:function(){return this._localStats}}]),e}();t.a=g}).call(t,"modules/connectivity/ConnectionQuality.js")},function(e,t,n){"use strict";function r(e){var t=this,n=e.id,r=e.password,a=e.onLoginSuccessful,s=e.roomPassword,c=!1,u=void 0,l=new o.a(this.connection.options),d=new Promise(function(e,o){u=o,l.addListener(i.CONNECTION_DISCONNECTED,function(){l=void 0}),l.addListener(i.CONNECTION_ESTABLISHED,function(){c||(a&&a(),l.createRoom(t.options.name,t.options.config).moderator.authenticate().then(function(){l&&l.disconnect(),c||(t.join(s),e())}).catch(function(e){var t=e.error,n=e.message;l.disconnect(),o({authenticationError:t,message:n})}))}),l.addListener(i.CONNECTION_FAILED,function(e,t,n){o({connectionError:e,credentials:n,message:t}),l=void 0}),c||l.connect(n,r)});return d.cancel=function(){c=!0,u({}),l&&l.disconnect()},d}t.a=r;var i=n(23),o=n(42)},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(93)),c=n(18),u=n(6),l=n.n(u),d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},f=Object(a.getLogger)(e),h=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.xmpp=e,n.rooms={},n}return o(t,e),d(t,[{key:"init",value:function(e){p(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.connection.addHandler(this.onPresence.bind(this),null,"presence",null,null,null,null),this.connection.addHandler(this.onPresenceUnavailable.bind(this),null,"presence","unavailable",null),this.connection.addHandler(this.onPresenceError.bind(this),null,"presence","error",null),this.connection.addHandler(this.onMessage.bind(this),null,"message",null,null),this.connection.addHandler(this.onMute.bind(this),"http://jitsi.org/jitmeet/audio","iq","set",null,null)}},{key:"createRoom",value:function(e,t,n){var r=Strophe.getBareJidFromJid(e);if(this.rooms[r]){var i="You are already in the room!";throw f.error(i),new Error(i)}return this.rooms[r]=new s.a(this.connection,e,t,this.xmpp,n),this.eventEmitter.emit(l.a.EMUC_ROOM_ADDED,this.rooms[r]),this.rooms[r]}},{key:"doLeave",value:function(e){this.eventEmitter.emit(l.a.EMUC_ROOM_REMOVED,this.rooms[e]),delete this.rooms[e]}},{key:"onPresence",value:function(e){var t=e.getAttribute("from");if(e.getAttribute("type"))return!0;var n=this.rooms[Strophe.getBareJidFromJid(t)];return n?($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="201"]').length&&n.createNonAnonymousRoom(),n.onPresence(e),!0):void 0}},{key:"onPresenceUnavailable",value:function(e){var t=e.getAttribute("from"),n=this.rooms[Strophe.getBareJidFromJid(t)];if(n)return n.onPresenceUnavailable(e,t),!0}},{key:"onPresenceError",value:function(e){var t=e.getAttribute("from"),n=this.rooms[Strophe.getBareJidFromJid(t)];if(n)return n.onPresenceError(e,t),!0}},{key:"onMessage",value:function(e){var t=e.getAttribute("from"),n=this.rooms[Strophe.getBareJidFromJid(t)];if(n)return n.onMessage(e,t),!0}},{key:"onMute",value:function(e){var t=e.getAttribute("from"),n=this.rooms[Strophe.getBareJidFromJid(t)];if(n)return n.onMute(e),!0}}]),t}(c.a);t.a=function(e){Strophe.addConnectionPlugin("emuc",new h(e))}}).call(t,"modules/xmpp/strophe.emuc.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){for(var n=[],r=0;r<e.length;r++)e[r].tagName===t&&n.push(e[r]);return n}function s(e){try{var t=JSON.parse(e);if(t&&"object"===(void 0===t?"undefined":b(t))){var n=t[T[0]],r=t[T[1]];if(("string"==typeof n||n instanceof String)&&r)return t;S.debug("parsing valid json but does not have correct structure","topic: ",n,"payload: ",r)}}catch(e){return!1}return!1}var c=n(0),u=(n.n(c),n(2)),l=n.n(u),d=n(44),p=n(8),f=n(3),h=n(94),v=n(46),m=n(6),g=n.n(m),y=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=Object(c.getLogger)(e),_={packet2JSON:function(e,t){var n=this;$(e).children().each(function(){var e=$(this).prop("tagName"),r={tagName:e};r.attributes={},$($(this)[0].attributes).each(function(e,t){r.attributes[t.name]=t.value});var i=Strophe.getText($(this)[0]);i&&(r.value=i),r.children=[],t.push(r),n.packet2JSON($(this),r.children)})},json2packet:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];r&&(t.c(r.tagName,r.attributes),r.value&&t.t(r.value),r.children&&this.json2packet(r.children,t),t.up())}}},T=["jitsi-meet-muc-msg-topic","payload"],E=function(e){function t(e,n,o,a,s){r(this,t);var c=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return c.xmpp=a,c.connection=e,c.roomjid=Strophe.getBareJidFromJid(n),c.myroomjid=n,c.password=o,S.info("Joined MUC as "+c.myroomjid),c.members={},c.presMap={},c.presHandlers={},c.joined=!1,c.role=null,c.focusMucJid=null,c.noBridgeAvailable=!1,c.options=s||{},c.moderator=new h.a(c.roomjid,c.xmpp,c.eventEmitter,{connection:c.xmpp.options,conference:c.options}),c.initPresenceMap(s),c.lastPresences={},c.phoneNumber=null,c.phonePin=null,c.connectionTimes={},c.participantPropertyListener=null,c.locked=!1,c.transcriptionStatus=d.OFF,c}return o(t,e),y(t,[{key:"initPresenceMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.presMap.to=this.myroomjid,this.presMap.xns="http://jabber.org/protocol/muc",this.presMap.nodes=[],this.presMap.nodes.push({tagName:"user-agent",value:navigator.userAgent,attributes:{xmlns:"http://jitsi.org/jitmeet/user-agent"}}),this.addVideoInfoToPresence(!1),e.deploymentInfo&&e.deploymentInfo.userRegion&&this.presMap.nodes.push({tagName:"region",attributes:{id:e.deploymentInfo.userRegion,xmlns:"http://jitsi.org/jitsi-meet"}})}},{key:"updateDeviceAvailability",value:function(e){this.presMap.nodes.push({tagName:"devices",children:[{tagName:"audio",value:e.audio},{tagName:"video",value:e.video}]})}},{key:"join",value:function(e){var t=this;this.password=e,this.moderator.allocateConferenceFocus(function(){return t.sendPresence(!0)})}},{key:"sendPresence",value:function(e){var t=this.presMap.to;if(t&&(this.joined||e)){var n=$pres({to:t});e&&(n.c("x",{xmlns:this.presMap.xns}),this.password&&n.c("password").t(this.password).up(),n.up()),_.json2packet(this.presMap.nodes,n),this.connection.send(n),e&&this.connection.flush()}}},{key:"doLeave",value:function(){S.log("do leave",this.myroomjid);var e=$pres({to:this.myroomjid,type:"unavailable"});this.presMap.length=0,this.connection.flush(),this.connection.send(e),this.connection.flush()}},{key:"discoRoomInfo",value:function(){var e=this,t=$iq({type:"get",to:this.roomjid}).c("query",{xmlns:Strophe.NS.DISCO_INFO});this.connection.sendIQ(t,function(t){var n=1===$(t).find('>query>feature[var="muc_passwordprotected"]').length;n!==e.locked&&(e.eventEmitter.emit(g.a.MUC_LOCK_CHANGED,n),e.locked=n)},function(e){l.a.callErrorHandler(e),S.error("Error getting room info: ",e)})}},{key:"createNonAnonymousRoom",value:function(){var e=$iq({type:"get",to:this.roomjid}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{xmlns:"jabber:x:data",type:"submit"}),t=this;this.connection.sendIQ(e,function(e){if(!$(e).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_whois"]').length){var n="non-anonymous rooms not supported";return l.a.callErrorHandler(new Error(n)),void S.error(n)}var r=$iq({to:t.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});r.c("x",{xmlns:"jabber:x:data",type:"submit"}),r.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),r.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),t.connection.sendIQ(r)},function(e){l.a.callErrorHandler(e),S.error("Error getting room configuration form: ",e)})}},{key:"onPresence",value:function(e){var t=e.getAttribute("from"),n={};n.show=$(e).find(">show").text();var r=$(e).find(">status");r.length&&(n.status=r.text());var i=!1,o=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>item');n.affiliation=o.attr("affiliation"),n.role=o.attr("role");var a=o.attr("jid");n.jid=a,n.isFocus=a&&0===a.indexOf(this.moderator.getFocusUserJid()+"/"),n.isHiddenDomain=a&&a.indexOf("@")>0&&this.options.hiddenDomain===a.substring(a.indexOf("@")+1,a.indexOf("/")),$(e).find(">x").remove();var s=[];_.packet2JSON(e,s),this.lastPresences[t]=s;for(var c=null,u=0;u<s.length;u++){var l=s[u];switch(l.tagName){case"nick":n.nick=l.value;break;case"userId":n.id=l.value}}if(t===this.myroomjid){var d="owner"===n.affiliation?n.role:"none";if(this.role!==d&&(this.role=d,this.eventEmitter.emit(g.a.LOCAL_ROLE_CHANGED,this.role)),!this.joined){this.joined=!0;var p=this.connectionTimes["muc.joined"]=window.performance.now();S.log("(TIME) MUC joined:\t",p),this.password&&(this.locked=!0),this.eventEmitter.emit(g.a.MUC_JOINED)}}else if(void 0===this.members[t])this.members[t]=n,S.log("entered",t,n),n.isFocus?this._initFocus(t,a):this.eventEmitter.emit(g.a.MUC_MEMBER_JOINED,t,n.nick,n.role,n.isHiddenDomain),i=void 0!==n.status;else{var f=this.members[t];f.role!==n.role&&(f.role=n.role,this.eventEmitter.emit(g.a.MUC_ROLE_CHANGED,t,n.role)),n.isFocus&&(f.isFocus=!0,this._initFocus(t,a)),n.displayName&&(f.displayName=n.displayName),f.status!==n.status&&(i=!0,f.status=n.status)}for(var h=0;h<s.length;h++){var v=s[h];switch(v.tagName){case"nick":if(!n.isFocus){var m=this.xmpp.options.displayJids?Strophe.getResourceFromJid(t):n.nick;m&&m.length>0&&this.eventEmitter.emit(g.a.DISPLAY_NAME_CHANGED,t,m)}break;case"bridgeNotAvailable":n.isFocus&&!this.noBridgeAvailable&&(this.noBridgeAvailable=!0,this.eventEmitter.emit(g.a.BRIDGE_DOWN));break;case"jibri-recording-status":c=v;break;case"transcription-status":var y=v.attributes;if(!y)break;var b=y.status;b&&b!==this.transcriptionStatus&&(this.transcriptionStatus=b,this.eventEmitter.emit(g.a.TRANSCRIPTION_STATUS_CHANGED,b));break;case"call-control":var T=v.attributes;if(!T)break;this.phoneNumber=T.phone||null,this.phonePin=T.pin||null,this.eventEmitter.emit(g.a.PHONE_NUMBER_CHANGED);break;default:this.processNode(v,t)}}i&&this.eventEmitter.emit(g.a.PRESENCE_STATUS,t,n.status),c&&(this.lastJibri=c,this.recording&&this.recording.handleJibriPresence(c))}},{key:"_initFocus",value:function(e,t){this.focusMucJid=e,this.recording||(this.recording=new v.a(this.options.recordingType,this.eventEmitter,this.connection,this.focusMucJid,this.options.jirecon,this.roomjid),this.lastJibri&&this.recording.handleJibriPresence(this.lastJibri)),S.info("Ignore focus: "+e+", real JID: "+t)}},{key:"setParticipantPropertyListener",value:function(e){this.participantPropertyListener=e}},{key:"processNode",value:function(e,t){try{var n=this.presHandlers[e.tagName];e.tagName.startsWith("jitsi_participant_")&&(n=[this.participantPropertyListener]),n&&n.forEach(function(n){n(e,Strophe.getResourceFromJid(t),t)})}catch(t){l.a.callErrorHandler(t),S.error("Error processing:"+e.tagName+" node.",t)}}},{key:"sendMessage",value:function(e,t){var n=$msg({to:this.roomjid,type:"groupchat"});n.c("body",e).up(),t&&n.c("nick",{xmlns:"http://jabber.org/protocol/nick"}).t(t).up().up(),this.connection.send(n),this.eventEmitter.emit(g.a.SENDING_CHAT_MESSAGE,e)}},{key:"setSubject",value:function(e){var t=$msg({to:this.roomjid,type:"groupchat"});t.c("subject",e),this.connection.send(t)}},{key:"onParticipantLeft",value:function(e,t){delete this.lastPresences[e],t||(this.eventEmitter.emit(g.a.MUC_MEMBER_LEFT,e),this.moderator.onMucMemberLeft(e))}},{key:"onPresenceUnavailable",value:function(e,t){var n=this;if($(e).find('>ignore[xmlns="http://jitsi.org/jitmeet/"]').length)return!0;if($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy').length){var r=void 0,i=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy>reason');return i.length&&(r=i.text()),this.eventEmitter.emit(g.a.MUC_DESTROYED,r),this.connection.emuc.doLeave(this.roomjid),!0}var o=0!==$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="110"]').length,a=0!==$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="307"]').length,s=Object.keys(this.members);o?s.length>0&&(s.forEach(function(e){var t=n.members[e];delete n.members[e],n.onParticipantLeft(e,t.isFocus)}),this.connection.emuc.doLeave(this.roomjid),a||this.eventEmitter.emit(g.a.MUC_LEFT)):(delete this.members[t],this.onParticipantLeft(t,!1)),a&&this.myroomjid===t&&this.eventEmitter.emit(g.a.KICKED)}},{key:"onMessage",value:function(e,t){var n=$(e).find('>nick[xmlns="http://jabber.org/protocol/nick"]').text()||Strophe.getResourceFromJid(t),r=$(e).find(">body").text();if("error"===e.getAttribute("type"))return this.eventEmitter.emit(g.a.CHAT_ERROR_RECEIVED,$(e).find(">text").text(),r),!0;var i=$(e).find(">subject");if(i.length){var o=i.text();(o||""===o)&&(this.eventEmitter.emit(g.a.SUBJECT_CHANGED,o),S.log("Subject is changed to "+o))}var a=$(e).find(">delay").attr("stamp");if(!a&&(a=$(e).find('>[xmlns="jabber:x:delay"]').attr("stamp"))){var c=a.match(/(\d{4})(\d{2})(\d{2}T\d{2}:\d{2}:\d{2})/);a=c[1]+"-"+c[2]+"-"+c[3]+"Z"}t===this.roomjid&&$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="104"]').length&&this.discoRoomInfo();var u=s(r);if(u)return void this.eventEmitter.emit(g.a.JSON_MESSAGE_RECEIVED,t,u);r&&(S.log("chat",n,r),this.eventEmitter.emit(g.a.MESSAGE_RECEIVED,t,n,r,this.myroomjid,a))}},{key:"onPresenceError",value:function(e,t){if($(e).find('>error[type="auth"]>not-authorized[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length)S.log("on password required",t),this.eventEmitter.emit(g.a.PASSWORD_REQUIRED);else if($(e).find('>error[type="cancel"]>not-allowed[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length){var n=Strophe.getDomainFromJid(e.getAttribute("to"));n===this.xmpp.options.hosts.anonymousdomain?this.eventEmitter.emit(g.a.ROOM_JOIN_ERROR):(S.warn("onPresError ",e),this.eventEmitter.emit(g.a.ROOM_CONNECT_NOT_ALLOWED_ERROR))}else $(e).find(">error>service-unavailable").length?(S.warn("Maximum users limit for the room has been reached",e),this.eventEmitter.emit(g.a.ROOM_MAX_USERS_ERROR)):(S.warn("onPresError ",e),this.eventEmitter.emit(g.a.ROOM_CONNECT_ERROR))}},{key:"kick",value:function(e){var t=$iq({to:this.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{nick:Strophe.getResourceFromJid(e),role:"none"}).c("reason").t("You have been kicked.").up().up().up();this.connection.sendIQ(t,function(t){return S.log("Kick participant with jid: ",e,t)},function(e){return S.log("Kick participant error: ",e)})}},{key:"lockRoom",value:function(e,t,n,r){var i=this;this.connection.sendIQ($iq({to:this.roomjid,type:"get"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}),function(o){if($(o).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_roomsecret"]').length){var a=$iq({to:i.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});a.c("x",{xmlns:"jabber:x:data",type:"submit"}),a.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),a.c("field",{var:"muc#roomconfig_roomsecret"}).c("value").t(e).up().up(),a.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),i.connection.sendIQ(a,t,n)}else r()},n)}},{key:"addToPresence",value:function(e,t){t.tagName=e,this.removeFromPresence(e),this.presMap.nodes.push(t)}},{key:"removeFromPresence",value:function(e){var t=this.presMap.nodes.filter(function(t){return e!==t.tagName});this.presMap.nodes=t}},{key:"addPresenceListener",value:function(e,t){if("function"!=typeof t)throw new Error('"handler" is not a function');var n=this.presHandlers[e];n||(this.presHandlers[e]=n=[]),-1===n.indexOf(t)?n.push(t):S.warn("Trying to add the same handler more than once for: "+e)}},{key:"removePresenceListener",value:function(e,t){var n=this.presHandlers[e],r=n?n.indexOf(t):-1;-1!==r?n.splice(r,1):S.warn("Handler for: "+e+" was not registered")}},{key:"isFocus",value:function(e){var t=this.members[e];return t?t.isFocus:null}},{key:"isModerator",value:function(){return"moderator"===this.role}},{key:"getMemberRole",value:function(e){return this.members[e]?this.members[e].role:null}},{key:"setVideoMute",value:function(e,t){this.sendVideoInfoPresence(e),t&&t(e)}},{key:"setAudioMute",value:function(e,t){return this.sendAudioInfoPresence(e,t)}},{key:"addAudioInfoToPresence",value:function(e){this.removeFromPresence("audiomuted"),this.addToPresence("audiomuted",{attributes:{xmlns:"http://jitsi.org/jitmeet/audio"},value:e.toString()})}},{key:"sendAudioInfoPresence",value:function(e,t){this.addAudioInfoToPresence(e),this.connection&&this.sendPresence(),t&&t()}},{key:"addVideoInfoToPresence",value:function(e){this.removeFromPresence("videomuted"),this.addToPresence("videomuted",{attributes:{xmlns:"http://jitsi.org/jitmeet/video"},value:e.toString()})}},{key:"sendVideoInfoPresence",value:function(e){this.addVideoInfoToPresence(e),this.connection&&this.sendPresence()}},{key:"getMediaPresenceInfo",value:function(e,t){var n=this.lastPresences[this.roomjid+"/"+e];if(!n)return null;var r={muted:!1,videoType:void 0},i=null;if(t===f.a)i=a(n,"audiomuted");else{if(t!==f.b)return S.error("Unsupported media type: "+t),null;i=a(n,"videomuted");var o=a(n,"videoType");o.length>0&&(r.videoType=o[0].value)}return r.muted=i.length>0&&"true"===i[0].value,r}},{key:"isRecordingSupported",value:function(){return!!this.recording&&this.recording.isSupported()}},{key:"getRecordingState",value:function(){return this.recording?this.recording.getState():void 0}},{key:"getRecordingURL",value:function(){return this.recording?this.recording.getURL():null}},{key:"toggleRecording",value:function(e,t){return this.recording?this.recording.toggleRecording(e,t):t("error",new Error("The conference is not created yet!"))}},{key:"isSIPCallingSupported",value:function(){return!!this.moderator&&this.moderator.isSipGatewayEnabled()}},{key:"dial",value:function(e){return this.connection.rayo.dial(e,"fromnumber",Strophe.getBareJidFromJid(this.myroomjid),this.password,this.focusMucJid)}},{key:"hangup",value:function(){return this.connection.rayo.hangup()}},{key:"getPhoneNumber",value:function(){return this.phoneNumber}},{key:"getPhonePin",value:function(){return this.phonePin}},{key:"muteParticipant",value:function(e,t){S.info("set mute",t);var n=$iq({to:this.focusMucJid,type:"set"}).c("mute",{xmlns:"http://jitsi.org/jitmeet/audio",jid:e}).t(t.toString()).up();this.connection.sendIQ(n,function(e){return S.log("set mute",e)},function(e){return S.log("set mute error",e)})}},{key:"onMute",value:function(e){if(e.getAttribute("from")!==this.focusMucJid)return S.warn("Ignored mute from non focus peer"),!1;var t=$(e).find("mute");if(t.length){var n="true"===t.text();this.eventEmitter.emit(g.a.AUDIO_MUTED_BY_FOCUS,n)}return!0}},{key:"leave",value:function(){var e=this;return new Promise(function(t,n){function r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o.removeListener(g.a.MUC_LEFT,r),clearTimeout(i),e?n(new Error("The timeout for the confirmation about leaving the room expired.")):t()}var i=setTimeout(function(){return r(!0)},5e3),o=e.eventEmitter;o.on(g.a.MUC_LEFT,r),e.doLeave()})}}]),t}(p.a);t.a=E}).call(t,"modules/xmpp/ChatRoom.js")},function(e,t,n){"use strict";(function(e){function r(e){var t=1;return function(n){if(n)return void(t=1);var r=Math.pow(2,t-1);return t+=1,r*e}}function i(e,t,n,i){function o(e){if(e.data&&e.data.sessionId){if(e.origin!==window.location.origin)return void s.warn("Ignoring sessionId from different origin: "+e.origin);a.a.sessionId=e.data.sessionId}}this.roomName=e,this.xmppService=t,this.getNextTimeout=r(1e3),this.getNextErrorTimeout=r(1e3),this.externalAuthEnabled=!1,this.options=i,this.sipGatewayEnabled=this.options.connection.hosts&&void 0!==this.options.connection.hosts.call_control,this.eventEmitter=n,this.connection=this.xmppService.connection,window.addEventListener?window.addEventListener("message",o,!1):window.attachEvent("onmessage",o)}t.a=i;var o=n(1),a=n(19),s=n(0).getLogger(e),c=n(6),u=n(45),l=n(2);i.prototype.isExternalAuthEnabled=function(){return this.externalAuthEnabled},i.prototype.isSipGatewayEnabled=function(){return this.sipGatewayEnabled},i.prototype.onMucMemberLeft=function(e){s.info("Someone left is it focus ? "+e),"focus"===Strophe.getResourceFromJid(e)&&(s.info("Focus has left the room - leaving conference"),this.eventEmitter.emit(c.FOCUS_LEFT))},i.prototype.setFocusUserJid=function(e){this.focusUserJid||(this.focusUserJid=e,s.info("Focus jid set to:  "+this.focusUserJid))},i.prototype.getFocusUserJid=function(){return this.focusUserJid},i.prototype.getFocusComponent=function(){var e=this.options.connection.hosts.focus;return e||(e="focus."+this.options.connection.hosts.domain),e},i.prototype.createConferenceIq=function(){var e=$iq({to:this.getFocusComponent(),type:"set"}),t=a.a.sessionId,n=a.a.machineId;s.info("Session ID: "+t+" machine UID: "+n),e.c("conference",{xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":n}),t&&e.attrs({"session-id":t}),void 0!==this.options.connection.enforcedBridge&&e.c("property",{name:"enforcedBridge",value:this.options.connection.enforcedBridge}).up(),void 0!==this.options.connection.hosts&&void 0!==this.options.connection.hosts.call_control&&e.c("property",{name:"call_control",value:this.options.connection.hosts.call_control}).up(),void 0!==this.options.conference.channelLastN&&e.c("property",{name:"channelLastN",value:this.options.conference.channelLastN}).up(),e.c("property",{name:"disableRtx",value:Boolean(this.options.conference.disableRtx)}).up(),e.c("property",{name:"enableLipSync",value:!1!==this.options.connection.enableLipSync}).up(),void 0!==this.options.conference.audioPacketDelay&&e.c("property",{name:"audioPacketDelay",value:this.options.conference.audioPacketDelay}).up(),this.options.conference.startBitrate&&e.c("property",{name:"startBitrate",value:this.options.conference.startBitrate}).up(),this.options.conference.minBitrate&&e.c("property",{name:"minBitrate",value:this.options.conference.minBitrate}).up();var r=void 0;switch(this.options.conference.openBridgeChannel){case"datachannel":case!0:case void 0:r=!0;break;case"websocket":r=!1}return r&&!o.a.supportsDataChannels()&&(r=!1),e.c("property",{name:"openSctp",value:r}).up(),void 0!==this.options.conference.startAudioMuted&&e.c("property",{name:"startAudioMuted",value:this.options.conference.startAudioMuted}).up(),void 0!==this.options.conference.startVideoMuted&&e.c("property",{name:"startVideoMuted",value:this.options.conference.startVideoMuted}).up(),void 0!==this.options.conference.stereo&&e.c("property",{name:"stereo",value:this.options.conference.stereo}).up(),void 0!==this.options.conference.useRoomAsSharedDocumentName&&e.c("property",{name:"useRoomAsSharedDocumentName",value:this.options.conference.useRoomAsSharedDocumentName}).up(),e.up(),e},i.prototype.parseSessionId=function(e){var t=$(e).find("conference").attr("session-id");t&&(s.info("Received sessionId:  "+t),a.a.sessionId=t)},i.prototype.parseConfigOptions=function(e){this.setFocusUserJid($(e).find("conference").attr("focusjid"));var t=$(e).find(">conference>property[name='authentication'][value='true']").length>0;s.info("Authentication enabled: "+t),this.externalAuthEnabled=$(e).find(">conference>property[name='externalAuth'][value='true']").length>0,s.info("External authentication enabled: "+this.externalAuthEnabled),this.externalAuthEnabled||this.parseSessionId(e);var n=$(e).find(">conference").attr("identity");this.eventEmitter.emit(u.IDENTITY_UPDATED,t,n),$(e).find(">conference>property[name='sipGatewayEnabled'][value='true']").length&&(this.sipGatewayEnabled=!0),s.info("Sip gateway enabled:  "+this.sipGatewayEnabled)},i.prototype.allocateConferenceFocus=function(e){var t=this;this.setFocusUserJid(this.options.connection.focusUserJid),this.connection.sendIQ(this.createConferenceIq(),function(n){return t._allocateConferenceFocusSuccess(n,e)},function(n){return t._allocateConferenceFocusError(n,e)}),this.connection.flush()},i.prototype._allocateConferenceFocusError=function(e,t){var n=this,r=$(e).find(">error>session-invalid").length||$(e).find(">error>not-acceptable").length;if(r&&(s.info("Session expired! - removing"),a.a.sessionId=void 0),$(e).find(">error>graceful-shutdown").length)return void this.eventEmitter.emit(c.GRACEFUL_SHUTDOWN);var i=$(e).find(">error>reservation-error");if(i.length){var o=i.attr("error-code"),u=$(e).find(">error>text"),d=void 0;return u&&(d=u.text()),void this.eventEmitter.emit(c.RESERVATION_ERROR,o,d)}if($(e).find(">error>not-authorized").length)return s.warn("Unauthorized to start the conference",e),Strophe.getDomainFromJid(e.getAttribute("to"))!==this.options.connection.hosts.anonymousdomain&&(this.externalAuthEnabled=!0),void this.eventEmitter.emit(c.AUTHENTICATION_REQUIRED);var p=this.getNextErrorTimeout(),f="Focus error, retry after "+p;l.callErrorHandler(new Error(f)),s.error(f,e);var h=this.getFocusComponent(),v=p/1e3;r||this.eventEmitter.emit(c.FOCUS_DISCONNECTED,h,v),this.getNextTimeout(!0),window.setTimeout(function(){return n.allocateConferenceFocus(t)},p)},i.prototype._allocateConferenceFocusSuccess=function(e,t){var n=this;if(this.parseConfigOptions(e),this.getNextErrorTimeout(!0),"true"===$(e).find("conference").attr("ready"))this.getNextTimeout(!0),t();else{var r=this.getNextTimeout();s.info("Waiting for the focus... "+r),window.setTimeout(function(){return n.allocateConferenceFocus(t)},r)}},i.prototype.authenticate=function(){var e=this;return new Promise(function(t,n){e.connection.sendIQ(e.createConferenceIq(),function(n){e.parseSessionId(n),t()},function(e){return n({error:$(e).find("iq>error :first").prop("tagName"),message:$(e).find("iq>error>text").text()})})})},i.prototype.getLoginUrl=function(e,t){this._getLoginUrl(!1,e,t)},i.prototype._getLoginUrl=function(e,t,n){function r(e,t){l.callErrorHandler(new Error(e)),s.error(e,t),n(t)}var i=$iq({to:this.getFocusComponent(),type:"get"}),o={xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":a.a.machineId},c="auth url";e&&(o.popup=!0,c="POPUP "+c),i.c("login-url",o),this.connection.sendIQ(i,function(e){var n=$(e).find("login-url").attr("url");n=decodeURIComponent(n),n?(s.info("Got "+c+": "+n),t(n)):r("Failed to get "+c+" from the focus",e)},r.bind(void 0,"Get "+c+" error"))},i.prototype.getPopupLoginUrl=function(e,t){this._getLoginUrl(!0,e,t)},i.prototype.logout=function(e){var t=$iq({to:this.getFocusComponent(),type:"set"}),n=a.a.sessionId;if(!n)return void e();t.c("logout",{xmlns:"http://jitsi.org/protocol/focus","session-id":n}),this.connection.sendIQ(t,function(t){var n=$(t).find("logout").attr("logout-url");n&&(n=decodeURIComponent(n)),s.info("Log out OK, url: "+n,t),a.a.sessionId=void 0,e(n)},function(e){l.callErrorHandler(new Error("Logout error")),s.error("Logout error",e)})}}).call(t,"modules/xmpp/moderator.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t,n){Strophe.addConnectionPlugin("jingle",new S(e,t,n))}t.a=a;var s=n(0),c=(n.n(s),n(96)),u=n(6),l=n.n(u),d=n(2),p=n.n(d),f=n(16),h=n.n(f),v=n(5),m=n(18),g=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},b=Object(s.getLogger)(e),S=function(e){function t(e,n,o){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.xmpp=e,a.eventEmitter=n,a.sessions={},a.jvbIceConfig={iceServers:[]},a.p2pIceConfig={iceServers:[]},Array.isArray(o)&&(b.info("Configured STUN servers: ",o),a.p2pIceConfig.iceServers=o),a.mediaConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},a}return o(t,e),g(t,[{key:"init",value:function(e){y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null)}},{key:"onJingle",value:function(e){var t=$(e).find("jingle").attr("sid"),n=$(e).find("jingle").attr("action"),r=e.getAttribute("from"),i=$iq({type:"result",to:r,id:e.getAttribute("id")});b.log("on jingle "+n+" from "+r,e);var o=this.sessions[t];if("session-initiate"!==n){if(!o)return i.attrs({type:"error"}),i.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),b.warn("invalid session id",e),this.connection.send(i),!0;if(r!==o.peerjid)return b.warn("jid mismatch for session id",t,o.peerjid,e),i.attrs({type:"error"}),i.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(i),!0}else if(void 0!==o)return i.attrs({type:"error"}),i.c("error",{type:"cancel"}).c("service-unavailable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up(),b.warn("duplicate session id",t,e),this.connection.send(i),!0;var a=window.performance.now();switch(n){case"session-initiate":b.log("(TIME) received session-initiate:\t",a);var s=$(e).find("jingle>startmuted");if(s&&s.length>0){var u=s.attr("audio"),d=s.attr("video");this.eventEmitter.emit(l.a.START_MUTED_FROM_FOCUS,"true"===u,"true"===d)}var f="focus"!==Strophe.getResourceFromJid(r);b.info("Marking session from "+r+" as "+(f?"":"*not*")+" P2P"),o=new c.a($(e).find("jingle").attr("sid"),$(e).attr("to"),r,this.connection,this.mediaConstraints,f?this.p2pIceConfig:this.jvbIceConfig,f,!1,this.xmpp.options),this.sessions[o.sid]=o,this.eventEmitter.emit(l.a.CALL_INCOMING,o,$(e).find(">jingle"),a),v.a.analytics.sendEvent("xmpp.session-initiate",{value:a});break;case"session-accept":this.eventEmitter.emit(l.a.CALL_ACCEPTED,o,$(e).find(">jingle"));break;case"content-modify":o.modifyContents($(e).find(">jingle"));break;case"transport-info":this.eventEmitter.emit(l.a.TRANSPORT_INFO,o,$(e).find(">jingle"));break;case"session-terminate":b.log("terminating...",o.sid);var h=null,m=null;$(e).find(">jingle>reason").length&&(h=$(e).find(">jingle>reason>:first")[0].tagName,m=$(e).find(">jingle>reason>text").text()),this.terminate(o.sid,h,m),this.eventEmitter.emit(l.a.CALL_ENDED,o,h,m);break;case"transport-replace":b.info("(TIME) Start transport replace",a),v.a.analytics.sendEvent("xmpp.transport-replace.start",{value:a}),o.replaceTransport($(e).find(">jingle"),function(){var e=window.performance.now();b.info("(TIME) Transport replace success!",e),v.a.analytics.sendEvent("xmpp.transport-replace.success",{value:e})},function(e){p.a.callErrorHandler(e),b.error("Transport replace failed",e),o.sendTransportReject()});break;case"addsource":case"source-add":o.addRemoteStream($(e).find(">jingle>content"));break;case"removesource":case"source-remove":o.removeRemoteStream($(e).find(">jingle>content"));break;default:b.warn("jingle action not implemented",n),i.attrs({type:"error"}),i.c("error",{type:"cancel"}).c("bad-request",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up()}return this.connection.send(i),!0}},{key:"newP2PJingleSession",value:function(e,t){var n=new c.a(h.a.randomHexString(12),e,t,this.connection,this.mediaConstraints,this.p2pIceConfig,!0,!0,this.xmpp.options);return this.sessions[n.sid]=n,n}},{key:"terminate",value:function(e,t,n){this.sessions.hasOwnProperty(e)&&("ended"!==this.sessions[e].state&&this.sessions[e].onTerminated(t,n),delete this.sessions[e])}},{key:"getStunAndTurnCredentials",value:function(){var e=this;this.connection.sendIQ($iq({type:"get",to:this.connection.domain}).c("services",{xmlns:"urn:xmpp:extdisco:1"}).c("service",{host:"turn."+this.connection.domain}),function(t){var n=[];$(t).find(">services>service").each(function(e,t){t=$(t);var r={},i=t.attr("type");switch(i){case"stun":r.url="stun:"+t.attr("host"),t.attr("port")&&(r.url+=":"+t.attr("port")),n.push(r);break;case"turn":case"turns":r.url=i+":";var o=t.attr("username");o&&(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10)<28?r.url+=o+"@":r.username=o),r.url+=t.attr("host");var a=t.attr("port");a&&"3478"!==a&&(r.url+=":"+t.attr("port"));var s=t.attr("transport");s&&"udp"!==s&&(r.url+="?transport="+s),r.credential=t.attr("password")||r.credential,n.push(r)}});var r=e.xmpp.options;r.useStunTurn&&(e.jvbIceConfig.iceServers=n),r.p2p&&r.p2p.useStunTurn&&(e.p2pIceConfig.iceServers=n)},function(e){b.warn("getting turn credentials failed",e),b.warn("is mod_turncredentials or similar installed?")})}},{key:"getLog",value:function(){var e=this,t={};return Object.keys(this.sessions).forEach(function(n){var r=e.sessions[n],i=r.peerconnection;i&&i.updateLog&&(t["jingle_"+n]={updateLog:i.updateLog,stats:i.stats,url:window.location.href})}),t}}]),t}(m.b)}).call(t,"modules/xmpp/strophe.jingle.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(97),s=n.n(a),c=n(0),u=(n.n(c),n(2)),l=n.n(u),d=n(98),p=n(49),f=n(99),h=n(10),v=n(100),m=n(5),g=n(6),y=n.n(g),b=n(48),S=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_=Object(c.getLogger)(e),T=function(e){function t(e,n,o,a,c,u,l,d,p){r(this,t);var f=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,a,c,u));return f._iceCheckingStartedTimestamp=null,f._gatheringStartedTimestamp=null,f._localVideoActive=!0,f._remoteVideoActive=!0,f._gatheringReported=!1,f.lasticecandidate=!1,f.closed=!1,f.isInitiator=d,f.isP2P=l,f.signalingLayer=new v.a,f.webrtcIceUdpDisable=Boolean(p.webrtcIceUdpDisable),f.webrtcIceTcpDisable=Boolean(p.webrtcIceTcpDisable),f.failICE=Boolean(p.failICE),f.modificationQueue=s.a.queue(f._processQueueTasks.bind(f),1),f.wasConnected=!1,f.establishmentDuration=void 0,f}return o(t,e),S(t,null,[{key:"parseVideoSenders",value:function(e){var t=e.find('>content[name="video"]');if(t.length){var n=t[0].getAttribute("senders");if("both"===n||"initiator"===n||"responder"===n||"none"===n)return n}return null}}]),S(t,[{key:"_assertNotEnded",value:function(e){return this.state!==b.b||(_.log("The session has ended - cancelling action: "+e),!1)}},{key:"doInitialize",value:function(){var e=this;this.lasticecandidate=!1,this.isreconnect=!1,this.wasstable=!1,this.isP2P?this.peerconnection=this.rtc.createPeerConnection(this.signalingLayer,this.iceConfig,this.isP2P,{disableSimulcast:!0,disableRtx:this.room.options.disableRtx,preferH264:this.room.options.p2p&&this.room.options.p2p.preferH264}):this.peerconnection=this.rtc.createPeerConnection(this.signalingLayer,this.iceConfig,this.isP2P,{disableSimulcast:this.room.options.disableSimulcast||this.room.options.preferH264,disableRtx:this.room.options.disableRtx,preferH264:this.room.options.preferH264,enableFirefoxSimulcast:this.room.options.testing&&this.room.options.testing.enableFirefoxSimulcast}),this.peerconnection.onicecandidate=function(t){if(t){var n=t.candidate,r=window.performance.now();if(n){null===e._gatheringStartedTimestamp&&(e._gatheringStartedTimestamp=r);var i=n.protocol;if("string"==typeof i)if("tcp"===(i=i.toLowerCase())||"ssltcp"===i){if(e.webrtcIceTcpDisable)return}else if("udp"===i&&e.webrtcIceUdpDisable)return}else if(!e._gatheringReported){var o=e.isP2P?"p2p.ice.":"ice.";o+=e.isInitiator?"initiator":"responder",o+=".gatheringDuration",m.a.analytics.sendEvent(o,{value:r-e._gatheringStartedTimestamp}),e._gatheringReported=!0}e.sendIceCandidate(n)}},this.peerconnection.onsignalingstatechange=function(){e.peerconnection&&("stable"===e.peerconnection.signalingState?e.wasstable=!0:"closed"!==e.peerconnection.signalingState&&"closed"!==e.peerconnection.connectionState||e.closed||e.room.eventEmitter.emit(y.a.SUSPEND_DETECTED,e))},this.peerconnection.oniceconnectionstatechange=function(){if(e.peerconnection&&e._assertNotEnded("oniceconnectionstatechange")){var t=window.performance.now();switch(e.isP2P||(e.room.connectionTimes["ice.state."+e.peerconnection.iceConnectionState]=t),_.log("(TIME) ICE "+e.peerconnection.iceConnectionState+" P2P? "+e.isP2P+":\t",t),m.a.analytics.sendEvent((e.isP2P?"p2p.ice.":"ice.")+e.peerconnection.iceConnectionState,{value:t}),e.room.eventEmitter.emit(y.a.ICE_CONNECTION_STATE_CHANGED,e,e.peerconnection.iceConnectionState),e.peerconnection.iceConnectionState){case"checking":e._iceCheckingStartedTimestamp=t;break;case"connected":if("stable"===e.peerconnection.signalingState&&e.isreconnect&&e.room.eventEmitter.emit(y.a.CONNECTION_RESTORED,e),!e.wasConnected&&e.wasstable){var n=e.isP2P?"p2p.ice.":"ice.";n+=e.isInitiator?"initiator.":"responder.",m.a.analytics.sendEvent(n+"checksDuration",{value:t-e._iceCheckingStartedTimestamp});var r=Math.min(e._iceCheckingStartedTimestamp,e._gatheringStartedTimestamp);e.establishmentDuration=t-r,m.a.analytics.sendEvent(n+"establishmentDuration",{value:e.establishmentDuration}),e.wasConnected=!0,e.room.eventEmitter.emit(y.a.CONNECTION_ESTABLISHED,e)}e.isreconnect=!1;break;case"disconnected":if(e.closed)break;e.isreconnect=!0,e.wasstable&&e.room.eventEmitter.emit(y.a.CONNECTION_INTERRUPTED,e);break;case"failed":e.room.eventEmitter.emit(y.a.CONNECTION_ICE_FAILED,e),e.room.eventEmitter.emit(y.a.CONFERENCE_SETUP_FAILED,e,new Error("ICE fail"))}}},this.peerconnection.onnegotiationneeded=function(){e.room.eventEmitter.emit(y.a.PEERCONNECTION_READY,e)},this.signalingLayer.setChatRoom(this.room)}},{key:"sendIceCandidate",value:function(e){var t=this,n=new p.a(this.peerconnection.localDescription.sdp);if(e&&!this.lasticecandidate){var r=h.a.iceparams(n.media[e.sdpMLineIndex],n.session),i=h.a.candidateToJingle(e.candidate);if(!r||!i)return l.a.callErrorHandler(new Error("failed to get ice && jcand")),void _.error("failed to get ice && jcand");r.xmlns="urn:xmpp:jingle:transports:ice-udp:1",this.usedrip?(0===this.dripContainer.length&&setTimeout(function(){0!==t.dripContainer.length&&(t.sendIceCandidates(t.dripContainer),t.dripContainer=[])},20),this.dripContainer.push(e)):this.sendIceCandidates([e])}else _.log("sendIceCandidate: last candidate."),this.lasticecandidate=!0}},{key:"sendIceCandidates",value:function(e){var t=this;if(this._assertNotEnded("sendIceCandidates")){_.log("sendIceCandidates",e);for(var n=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-info",initiator:this.initiator,sid:this.sid}),r=new p.a(this.peerconnection.localDescription.sdp),i=0;i<r.media.length;i++)!function(i){var o=e.filter(function(e){return e.sdpMLineIndex===i}),a=h.a.parseMLine(r.media[i].split("\r\n")[0]);if(o.length>0){var s=h.a.iceparams(r.media[i],r.session);s.xmlns="urn:xmpp:jingle:transports:ice-udp:1",n.c("content",{creator:t.initiator===t.localJid?"initiator":"responder",name:o[0].sdpMid?o[0].sdpMid:a.media}).c("transport",s);for(var c=0;c<o.length;c++){var u=h.a.candidateToJingle(o[c].candidate);t.failICE&&(u.ip="1.1.1.1"),n.c("candidate",u).up()}var l=h.a.findLine(r.media[i],"a=fingerprint:",r.session);if(l){var d=h.a.parseFingerprint(l);d.required=!0,n.c("fingerprint",{xmlns:"urn:xmpp:jingle:apps:dtls:0"}).t(d.fingerprint),delete d.fingerprint,n.attrs(d),n.up()}n.up(),n.up()}}(i);this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),1e4)}}},{key:"addIceCandidates",value:function(e){var t=this;if("closed"===this.peerconnection.signalingState)return void _.warn("Ignored add ICE candidate when in closed state");var n=[];if(e.find(">content>transport>candidate").each(function(e,t){var r=h.a.candidateFromJingle(t);r=r.replace("\r\n","").replace("a=","");var i=new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"",candidate:r});n.push(i)}),!n.length)return void _.error("No ICE candidates to add ?",e[0]&&e[0].outerHTML);var r=function(e){var r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;t.peerconnection.addIceCandidate(c,function(){_.debug("addIceCandidate ok!")},function(e){_.error("addIceCandidate failed!",e)})}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}e()};_.debug("Queued add ("+n.length+") ICE candidates task..."),this.modificationQueue.push(r)}},{key:"readSsrcInfo",value:function(e){var t=this;$(e).find('>description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(e,n){var r=Number(n.getAttribute("ssrc"));t.isP2P?t.signalingLayer.setSSRCOwner(r,Strophe.getResourceFromJid(t.peerjid)):$(n).find('>ssrc-info[xmlns="http://jitsi.org/jitmeet"]').each(function(e,n){var i=n.getAttribute("owner");i&&i.length&&(isNaN(r)||r<0?_.warn("Invalid SSRC "+r+" value received for "+i):t.signalingLayer.setSSRCOwner(r,Strophe.getResourceFromJid(i)))})})}},{key:"generateRecvonlySsrc",value:function(){this.peerconnection?this.peerconnection.generateRecvonlySsrc():_.error("Unable to generate recvonly SSRC - no peerconnection")}},{key:"acceptOffer",value:function(e,t,n,r){var i=this;this.setOfferAnswerCycle(e,function(){i.sendSessionAccept(t,n)},n,r)}},{key:"invite",value:function(e){var t=this;if(!this.isInitiator)throw new Error("Trying to invite from the responder session");var n=function(n){var r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;t.peerconnection.addTrack(c)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}t.peerconnection.createOffer(function(e){t.peerconnection.setLocalDescription(e,function(){t.sendSessionInitiate(t.peerconnection.localDescription.sdp),n()},function(t){_.error("Failed to set local SDP",t,e),n(t)})},function(e){_.error("Failed to create an offer",e,t.mediaConstraints),n(e)},t.mediaConstraints)};this.modificationQueue.push(n,function(e){e?_.error("invite error",e):_.debug("invite executed - OK")})}},{key:"sendSessionInitiate",value:function(e){var t=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-initiate",initiator:this.initiator,sid:this.sid});new p.a(e).toJingle(t,this.initiator===this.me?"initiator":"responder"),t=t.tree(),_.info("Session-initiate: ",t),this.connection.sendIQ(t,function(){_.info('Got RESULT for "session-initiate"')},function(e){_.error('"session-initiate" error',e)},1e4)}},{key:"setAnswer",value:function(e){if(!this.isInitiator)throw new Error("Trying to set an answer on the responder session");this.setOfferAnswerCycle(e,function(){_.info("setAnswer - succeeded")},function(e){_.error("setAnswer failed: ",e)})}},{key:"setOfferAnswerCycle",value:function(e,n,r,i){var o=this,a=function(n){if(i){var r=!0,a=!1,s=void 0;try{for(var c,u=i[Symbol.iterator]();!(r=(c=u.next()).done);r=!0){var l=c.value;o.peerconnection.addTrack(l)}}catch(e){a=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(a)throw s}}}var d=o._processNewJingleOfferIq(e),f=o.peerconnection.localDescription.sdp;o._renegotiate(d.raw).then(function(){if(o.state===b.c&&(o.state=b.a,o.isP2P&&!o._localVideoActive&&o.sendContentModify(o._localVideoActive)),f){var e=new p.a(o.peerconnection.localDescription.sdp);o.notifyMySSRCUpdate(new p.a(f),e)}n()},function(e){_.error("Error renegotiating after setting new remote "+(o.isInitiator?"answer: ":"offer: ")+e,d),t.onJingleFatalError(o,e),n(e)})};this.modificationQueue.push(a,function(e){e?r(e):n()})}},{key:"replaceTransport",value:function(e,t,n){var r=this;this.room.eventEmitter.emit(y.a.ICE_RESTARTING,this);var i=e.clone();e.find(">content[name='data']").remove(),this.setOfferAnswerCycle(e,function(){r.setOfferAnswerCycle(i,function(){var e=new p.a(r.peerconnection.localDescription.sdp);r.sendTransportAccept(e,t,n)},n)},n)}},{key:"sendSessionAccept",value:function(e,t){var n=this,r=new p.a(this.peerconnection.localDescription.sdp),i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-accept",initiator:this.initiator,responder:this.responder,sid:this.sid});this.webrtcIceTcpDisable&&(r.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(r.removeUdpCandidates=!0),this.failICE&&(r.failICE=!0),r.toJingle(i,this.initiator===this.localJid?"initiator":"responder",null),i=i.tree(),_.info("Sending session-accept",i),this.connection.sendIQ(i,e,this.newJingleErrorHandler(i,function(e){t(e),n.room.eventEmitter.emit(y.a.SESSION_ACCEPT_TIMEOUT,n)}),1e4)}},{key:"sendContentModify",value:function(e){var t=e?"both":"none",n=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-modify",initiator:this.initiator,sid:this.sid}).c("content",{name:"video",senders:t});_.info("Sending content-modify, video senders: "+t),this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),1e4)}},{key:"sendTransportAccept",value:function(e,t,n){var r=this,i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-accept",initiator:this.initiator,sid:this.sid});e.media.forEach(function(t,n){var o=h.a.parseMLine(t.split("\r\n")[0]);i.c("content",{creator:r.initiator===r.localJid?"initiator":"responder",name:o.media}),e.transportToJingle(n,i),i.up()}),i=i.tree(),_.info("Sending transport-accept: ",i),this.connection.sendIQ(i,t,this.newJingleErrorHandler(i,n),1e4)}},{key:"sendTransportReject",value:function(e,t){var n=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-reject",initiator:this.initiator,sid:this.sid});n=n.tree(),_.info("Sending 'transport-reject",n),this.connection.sendIQ(n,e,this.newJingleErrorHandler(n,t),1e4)}},{key:"terminate",value:function(e,t,n){if(this.state!==b.b){if(!n||Boolean(n.sendSessionTerminate)){var r=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-terminate",initiator:this.initiator,sid:this.sid}).c("reason").c(n&&n.reason||"success");n&&n.reasonDescription&&r.up().c("text").t(n.reasonDescription),r=r.tree(),_.info("Sending session-terminate",r),this.connection.sendIQ(r,e,this.newJingleErrorHandler(r,t),1e4)}else _.info("Skipped sending session-terminate for "+this);this.connection.jingle.terminate(this.sid)}}},{key:"onTerminated",value:function(e,t){this.state=b.b,this.establishmentDuration=void 0,_.info("Session terminated "+this,e,t),this.close()}},{key:"_parseSsrcInfoFromSourceAdd",value:function(e,t){var n=[];return $(e).each(function(e,r){var i=$(r).attr("name"),o="";$(r).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map(function(){return this.getAttribute("ssrc")}).get();t.length&&(o+="a=ssrc-group:"+e+" "+t.join(" ")+"\r\n")}),$(r).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=$(this).attr("ssrc");if(t.containsSSRC(e))return void _.warn("Source-add request for existing SSRC: "+e);$(this).find(">parameter").each(function(){o+="a=ssrc:"+e+" "+$(this).attr("name"),$(this).attr("value")&&$(this).attr("value").length&&(o+=":"+$(this).attr("value")),o+="\r\n"})}),t.media.forEach(function(e,t){h.a.findLine(e,"a=mid:"+i)&&(n[t]||(n[t]=""),n[t]+=o)})}),n}},{key:"addRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!0,e)}},{key:"removeRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!1,e)}},{key:"_addOrRemoveRemoteStream",value:function(e,t){var n=this,r=e?"addRemoteStream":"removeRemoteStream";e&&this.readSsrcInfo(t);var i=function(i){if(!n.peerconnection.localDescription||!n.peerconnection.localDescription.sdp){var o=r+" - localDescription not ready yet";return _.error(o),void i(o)}_.log("Processing "+r),_.log("ICE connection state: ",n.peerconnection.iceConnectionState);var a=new p.a(n.peerconnection.localDescription.sdp),s=new p.a(n.peerconnection.remoteDescription.sdp),c=e?n._parseSsrcInfoFromSourceAdd(t,s):n._parseSsrcInfoFromSourceRemove(t,s),u=e?n._processRemoteAddSource(c):n._processRemoteRemoveSource(c);n._renegotiate(u.raw).then(function(){var e=new p.a(n.peerconnection.localDescription.sdp);_.log(r+" - OK, SDPs: ",a,e),n.notifyMySSRCUpdate(a,e),i()},function(e){_.error(r+" failed:",e),i(e)})};this.modificationQueue.push(i)}},{key:"_processQueueTasks",value:function(e,t){e(t)}},{key:"_processNewJingleOfferIq",value:function(e){var t=new p.a("");return this.webrtcIceTcpDisable&&(t.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(t.removeUdpCandidates=!0),this.failICE&&(t.failICE=!0),t.fromJingle(e),this.readSsrcInfo($(e).find(">content")),t}},{key:"_processRemoteRemoveSource",value:function(e){var t=new p.a(this.peerconnection.remoteDescription.sdp);return e.forEach(function(e,n){e=e.split("\r\n"),e.pop(),e.forEach(function(e){t.media[n]=t.media[n].replace(e+"\r\n","")})}),t.raw=t.session+t.media.join(""),t}},{key:"_processRemoteAddSource",value:function(e){var t=new p.a(this.peerconnection.remoteDescription.sdp);return e.forEach(function(e,n){t.media[n]+=e}),t.raw=t.session+t.media.join(""),t}},{key:"_renegotiate",value:function(e){var t=this,n=e||this.peerconnection.remoteDescription.sdp;if(!n)return Promise.reject("Can not renegotiate without remote description,- current state: "+this.state);var r=new RTCSessionDescription({type:this.isInitiator?"answer":"offer",sdp:n});return new Promise(function(e,n){if("closed"===t.peerconnection.signalingState)return void n("Attempted to renegotiate in state closed");t.isInitiator?t._initiatorRenegotiate(r,e,n):t._responderRenegotiate(r,e,n)})}},{key:"_responderRenegotiate",value:function(e,t,n){var r=this;_.debug("Renegotiate: setting remote description"),this.peerconnection.setRemoteDescription(e,function(){_.debug("Renegotiate: creating answer"),r.peerconnection.createAnswer(function(e){_.debug("Renegotiate: setting local description"),r.peerconnection.setLocalDescription(e,function(){t()},function(e){n("setLocalDescription failed: "+e)})},function(e){return n("createAnswer failed: "+e)},r.mediaConstraints)},function(e){return n("setRemoteDescription failed: "+e)})}},{key:"_initiatorRenegotiate",value:function(e,t,n){var r=this;"have-local-offer"===this.peerconnection.signalingState?(_.debug("Renegotiate: setting remote description"),this.peerconnection.setRemoteDescription(e,function(){r._initiatorRenegotiate(e,t,n)},function(e){return n("setRemoteDescription failed: "+e)})):(_.debug("Renegotiate: creating offer"),this.peerconnection.createOffer(function(i){_.debug("Renegotiate: setting local description"),r.peerconnection.setLocalDescription(i,function(){_.debug("Renegotiate: setting remote description"),r.peerconnection.setRemoteDescription(e,function(){t()},function(e){return n("setRemoteDescription failed: "+e)})},function(e){n("setLocalDescription failed: ",e)})},function(e){return n("createOffer failed: "+e)},this.mediaConstraints))}},{key:"replaceTrack",value:function(e,t){var n=this,r=function(r){if("closed"===n.peerconnection.signalingState||"closed"===n.peerconnection.connectionState||n.closed)return void r();var i=n.peerconnection.localDescription.sdp;!e&&t&&t.isVideoTrack()?n.peerconnection.clearRecvonlySsrc():e&&e.isVideoTrack()&&!t&&(n.peerconnection.clearRecvonlySsrc(),n.peerconnection.generateRecvonlySsrc()),e&&n.peerconnection.removeTrack(e),t&&n.peerconnection.addTrack(t),(e||t)&&n.state===b.a?n._renegotiate().then(function(){var e=new p.a(n.peerconnection.localDescription.sdp);n.notifyMySSRCUpdate(new p.a(i),e),r()},r):r()};this.modificationQueue.push(r,function(e){e?_.error("Replace track error:",e):_.info("Replace track done!")})}},{key:"_parseSsrcInfoFromSourceRemove",value:function(e,t){var n=[];return $(e).each(function(e,r){var i=$(r).attr("name"),o="";$(r).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map(function(){return this.getAttribute("ssrc")}).get();t.length&&(o+="a=ssrc-group:"+e+" "+t.join(" ")+"\r\n")});var a=[];$(r).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each(function(){var e=$(this).attr("ssrc");a.push(e)}),t.media.forEach(function(e,t){h.a.findLine(e,"a=mid:"+i)&&(n[t]||(n[t]=""),a.forEach(function(r){var i=h.a.findLines(e,"a=ssrc:"+r);i.length&&(n[t]+=i.join("\r\n")+"\r\n")}),n[t]+=o)})}),n}},{key:"_verifyNoSSRCChanged",value:function(e,t){var n=new p.a(this.peerconnection.localDescription.sdp),r=new f.a(t,n),i=r.getNewMedia();if(Object.keys(i).length)return _.error(this+" - some SSRC were added on "+e,i),!1;r=new f.a(n,t);var o=r.getNewMedia();return!Object.keys(o).length||(_.error(this+" - some SSRCs were removed on "+e,o),!1)}},{key:"addTrackAsUnmute",value:function(e){return this._addRemoveTrackAsMuteUnmute(!1,e)}},{key:"removeTrackAsMute",value:function(e){return this._addRemoveTrackAsMuteUnmute(!0,e)}},{key:"_addRemoveTrackAsMuteUnmute",value:function(e,t){var n=this;if(!t)return Promise.reject('invalid "track" argument value');var r=e?"removeTrackMute":"addTrackUnmute",i=function(i){var o=n.peerconnection;if(!o)return void i("Error:  tried "+r+" track with no active peerconnection");var a=o.localDescription.sdp;(e?o.removeTrackMute.bind(o,t):o.addTrackUnmute.bind(o,t))()?a&&o.remoteDescription.sdp?n._renegotiate().then(function(){n._verifyNoSSRCChanged(r,new p.a(a)),i()},i):i():i(r+" failed!")};return new Promise(function(e,t){n.modificationQueue.push(i,function(n){n?t(n):e()})})}},{key:"setMediaTransferActive",value:function(e,t){var n=this;if(!this.peerconnection)return Promise.reject('Can not modify transfer active state, before "initialize" is called');var r=e?"audio active":"audio inactive",i=t?"video active":"video inactive";_.info("Queued make "+i+", "+r+" task...");var o=function(r){var i=n.state===b.a,o=n.peerconnection.setAudioTransferActive(e);n._localVideoActive!==t&&(n._localVideoActive=t,n.isP2P&&i&&n.sendContentModify(t));var a=n.peerconnection.setVideoTransferActive(n._localVideoActive&&n._remoteVideoActive);i&&(o||a)?n._renegotiate().then(r,r):r()};return new Promise(function(e,t){n.modificationQueue.push(o,function(n){n?t(n):e()})})}},{key:"modifyContents",value:function(e){var n=this,r=t.parseVideoSenders(e);if(null===r)return void _.error(this+' - failed to parse video "senders" attribute in"content-modify" action');var i=function(e){n._assertNotEnded("content-modify")&&n._modifyRemoteVideoActive(r)?n._renegotiate().then(e,e):e()};_.debug(this+' queued "content-modify" task(video senders="'+r+'")'),this.modificationQueue.push(i,function(e){e&&_.error('"content-modify" failed',e)})}},{key:"_modifyRemoteVideoActive",value:function(e){var t="both"===e||"initiator"===e&&this.isInitiator||"responder"===e&&!this.isInitiator;return t!==this._remoteVideoActive&&(_.debug(this+" new remote video active: "+t),this._remoteVideoActive=t),this.peerconnection.setVideoTransferActive(this._localVideoActive&&this._remoteVideoActive)}},{key:"notifyMySSRCUpdate",value:function(e,t){if(this.state!==b.a)return void _.warn("Skipping SSRC update in '"+this.state+" ' state.");var n=new f.a(t,e),r=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-remove",initiator:this.initiator,sid:this.sid});n.toJingle(r)?(_.info("Sending source-remove",r.tree()),this.connection.sendIQ(r,null,this.newJingleErrorHandler(r,function(e){l.a.callErrorHandler(new Error("Jingle error: "+JSON.stringify(e)))}),1e4)):_.log("removal not necessary"),n=new f.a(e,t);var i=$iq({to:this.peerjid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-add",initiator:this.initiator,sid:this.sid});n.toJingle(i)?(_.info("Sending source-add",i.tree()),this.connection.sendIQ(i,null,this.newJingleErrorHandler(i,function(e){l.a.callErrorHandler(new Error("Jingle error: "+JSON.stringify(e)))}),1e4)):_.log("addition not necessary")}},{key:"newJingleErrorHandler",value:function(e,t){var n=this;return function(r){var i={},o=$(r).find("error");if(o.length){i.code=o.attr("code");var a=$(r).find("error :first");a.length&&(i.reason=a[0].tagName)}r||(i.reason="timeout"),i.source=e,e&&"function"==typeof e.tree&&(i.source=e.tree()),i.source&&i.source.outerHTML&&(i.source=i.source.outerHTML),i.session=n.toString(),t?t(i):n.state===b.b&&"item-not-found"===i.reason?_.debug("Jingle error",i):l.a.callErrorHandler(new Error("Jingle error: "+JSON.stringify(i)))}}},{key:"getIceConnectionState",value:function(){return this.peerconnection.iceConnectionState}},{key:"close",value:function(){this.closed=!0,this.signalingLayer.setChatRoom(null),this.peerconnection&&(this.peerconnection.signalingState&&"closed"!==this.peerconnection.signalingState||this.peerconnection.connectionState&&"closed"!==this.peerconnection.connectionState)&&this.peerconnection.close()}},{key:"toString",value:function(){return"JingleSessionPC[p2p="+this.isP2P+",initiator="+this.isInitiator+",sid="+this.sid+"]"}}],[{key:"onJingleFatalError",value:function(e,t){this.room&&(this.room.eventEmitter.emit(y.a.CONFERENCE_SETUP_FAILED,e,t),this.room.eventEmitter.emit(y.a.JINGLE_FATAL_ERROR,e,t))}}]),t}(d.a);t.a=T}).call(t,"modules/xmpp/JingleSessionPC.js")},function(e,t,n){(function(n,r){var i,o;!function(){function a(e){var t=!1;return function(){if(t)throw new Error("Callback was already called.");t=!0,e.apply(s,arguments)}}var s,c,u={};s=this,null!=s&&(c=s.async),u.noConflict=function(){return s.async=c,u};var l=Object.prototype.toString,d=Array.isArray||function(e){return"[object Array]"===l.call(e)},p=function(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n+=1)t(e[n],n,e)},f=function(e,t){if(e.map)return e.map(t);var n=[];return p(e,function(e,r,i){n.push(t(e,r,i))}),n},h=function(e,t,n){return e.reduce?e.reduce(t,n):(p(e,function(e,r,i){n=t(n,e,r,i)}),n)},v=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t};void 0!==n&&n.nextTick?(u.nextTick=n.nextTick,u.setImmediate=void 0!==r?function(e){r(e)}:u.nextTick):"function"==typeof r?(u.nextTick=function(e){r(e)},u.setImmediate=u.nextTick):(u.nextTick=function(e){setTimeout(e,0)},u.setImmediate=u.nextTick),u.each=function(e,t,n){function r(t){t?(n(t),n=function(){}):(i+=1)>=e.length&&n()}if(n=n||function(){},!e.length)return n();var i=0;p(e,function(e){t(e,a(r))})},u.forEach=u.each,u.eachSeries=function(e,t,n){if(n=n||function(){},!e.length)return n();var r=0;!function i(){t(e[r],function(t){t?(n(t),n=function(){}):(r+=1,r>=e.length?n():i())})}()},u.forEachSeries=u.eachSeries,u.eachLimit=function(e,t,n,r){m(t).apply(null,[e,n,r])},u.forEachLimit=u.eachLimit;var m=function(e){return function(t,n,r){if(r=r||function(){},!t.length||e<=0)return r();var i=0,o=0,a=0;!function s(){if(i>=t.length)return r();for(;a<e&&o<t.length;)o+=1,a+=1,n(t[o-1],function(e){e?(r(e),r=function(){}):(i+=1,a-=1,i>=t.length?r():s())})}()}},g=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[u.each].concat(t))}},y=function(e,t){return function(){var n=Array.prototype.slice.call(arguments);return t.apply(null,[m(e)].concat(n))}},b=function(e){return function(){var t=Array.prototype.slice.call(arguments);return e.apply(null,[u.eachSeries].concat(t))}},S=function(e,t,n,r){if(t=f(t,function(e,t){return{index:t,value:e}}),r){var i=[];e(t,function(e,t){n(e.value,function(n,r){i[e.index]=r,t(n)})},function(e){r(e,i)})}else e(t,function(e,t){n(e.value,function(e){t(e)})})};u.map=g(S),u.mapSeries=b(S),u.mapLimit=function(e,t,n,r){return _(t)(e,n,r)};var _=function(e){return y(e,S)};u.reduce=function(e,t,n,r){u.eachSeries(e,function(e,r){n(t,e,function(e,n){t=n,r(e)})},function(e){r(e,t)})},u.inject=u.reduce,u.foldl=u.reduce,u.reduceRight=function(e,t,n,r){var i=f(e,function(e){return e}).reverse();u.reduce(i,t,n,r)},u.foldr=u.reduceRight;var T=function(e,t,n,r){var i=[];t=f(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n&&i.push(e),t()})},function(e){r(f(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};u.filter=g(T),u.filterSeries=b(T),u.select=u.filter,u.selectSeries=u.filterSeries;var E=function(e,t,n,r){var i=[];t=f(t,function(e,t){return{index:t,value:e}}),e(t,function(e,t){n(e.value,function(n){n||i.push(e),t()})},function(e){r(f(i.sort(function(e,t){return e.index-t.index}),function(e){return e.value}))})};u.reject=g(E),u.rejectSeries=b(E);var C=function(e,t,n,r){e(t,function(e,t){n(e,function(n){n?(r(e),r=function(){}):t()})},function(e){r()})};u.detect=g(C),u.detectSeries=b(C),u.some=function(e,t,n){u.each(e,function(e,r){t(e,function(e){e&&(n(!0),n=function(){}),r()})},function(e){n(!1)})},u.any=u.some,u.every=function(e,t,n){u.each(e,function(e,r){t(e,function(e){e||(n(!1),n=function(){}),r()})},function(e){n(!0)})},u.all=u.every,u.sortBy=function(e,t,n){u.map(e,function(e,n){t(e,function(t,r){t?n(t):n(null,{value:e,criteria:r})})},function(e,t){if(e)return n(e);var r=function(e,t){var n=e.criteria,r=t.criteria;return n<r?-1:n>r?1:0};n(null,f(t.sort(r),function(e){return e.value}))})},u.auto=function(e,t){t=t||function(){};var n=v(e),r=n.length;if(!r)return t();var i={},o=[],a=function(e){o.unshift(e)},s=function(e){for(var t=0;t<o.length;t+=1)if(o[t]===e)return void o.splice(t,1)},c=function(){r--,p(o.slice(0),function(e){e()})};a(function(){if(!r){var e=t;t=function(){},e(null,i)}}),p(n,function(n){var r=d(e[n])?e[n]:[e[n]],o=function(e){var r=Array.prototype.slice.call(arguments,1);if(r.length<=1&&(r=r[0]),e){var o={};p(v(i),function(e){o[e]=i[e]}),o[n]=r,t(e,o),t=function(){}}else i[n]=r,u.setImmediate(c)},l=r.slice(0,Math.abs(r.length-1))||[],f=function(){return h(l,function(e,t){return e&&i.hasOwnProperty(t)},!0)&&!i.hasOwnProperty(n)};f()?r[r.length-1](o,i):a(function e(){f()&&(s(e),r[r.length-1](o,i))})})},u.retry=function(e,t,n){var r=[];"function"==typeof e&&(n=t,t=e,e=5),e=parseInt(e,10)||5;var i=function(i,o){for(;e;)r.push(function(e,t){return function(n){e(function(e,r){n(!e||t,{err:e,result:r})},o)}}(t,!(e-=1)));u.series(r,function(e,t){t=t[t.length-1],(i||n)(t.err,t.result)})};return n?i():i},u.waterfall=function(e,t){if(t=t||function(){},!d(e)){var n=new Error("First argument to waterfall must be an array of functions");return t(n)}if(!e.length)return t();!function e(n){return function(r){if(r)t.apply(null,arguments),t=function(){};else{var i=Array.prototype.slice.call(arguments,1),o=n.next();o?i.push(e(o)):i.push(t),u.setImmediate(function(){n.apply(null,i)})}}}(u.iterator(e))()};var w=function(e,t,n){if(n=n||function(){},d(t))e.map(t,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},n);else{var r={};e.each(v(t),function(e,n){t[e](function(t){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),r[e]=i,n(t)})},function(e){n(e,r)})}};u.parallel=function(e,t){w({map:u.map,each:u.each},e,t)},u.parallelLimit=function(e,t,n){w({map:_(t),each:m(t)},e,n)},u.series=function(e,t){if(t=t||function(){},d(e))u.mapSeries(e,function(e,t){e&&e(function(e){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),t.call(null,e,n)})},t);else{var n={};u.eachSeries(v(e),function(t,r){e[t](function(e){var i=Array.prototype.slice.call(arguments,1);i.length<=1&&(i=i[0]),n[t]=i,r(e)})},function(e){t(e,n)})}},u.iterator=function(e){return function t(n){var r=function t(){return e.length&&e[n].apply(null,arguments),t.next()};return r.next=function(){return n<e.length-1?t(n+1):null},r}(0)},u.apply=function(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t.concat(Array.prototype.slice.call(arguments)))}};var R=function(e,t,n,r){var i=[];e(t,function(e,t){n(e,function(e,n){i=i.concat(n||[]),t(e)})},function(e){r(e,i)})};u.concat=g(R),u.concatSeries=b(R),u.whilst=function(e,t,n){e()?t(function(r){if(r)return n(r);u.whilst(e,t,n)}):n()},u.doWhilst=function(e,t,n){e(function(r){if(r)return n(r);var i=Array.prototype.slice.call(arguments,1);t.apply(null,i)?u.doWhilst(e,t,n):n()})},u.until=function(e,t,n){e()?n():t(function(r){if(r)return n(r);u.until(e,t,n)})},u.doUntil=function(e,t,n){e(function(r){if(r)return n(r);var i=Array.prototype.slice.call(arguments,1);t.apply(null,i)?n():u.doUntil(e,t,n)})},u.queue=function(e,t){function n(e,t,n,r){if(e.started||(e.started=!0),d(t)||(t=[t]),0==t.length)return u.setImmediate(function(){e.drain&&e.drain()});p(t,function(t){var i={data:t,callback:"function"==typeof r?r:null};n?e.tasks.unshift(i):e.tasks.push(i),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),u.setImmediate(e.process)})}void 0===t&&(t=1);var r=0,i={tasks:[],concurrency:t,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(e,t){n(i,e,!1,t)},kill:function(){i.drain=null,i.tasks=[]},unshift:function(e,t){n(i,e,!0,t)},process:function(){if(!i.paused&&r<i.concurrency&&i.tasks.length){var t=i.tasks.shift();i.empty&&0===i.tasks.length&&i.empty(),r+=1;var n=function(){r-=1,t.callback&&t.callback.apply(t,arguments),i.drain&&i.tasks.length+r===0&&i.drain(),i.process()},o=a(n);e(t.data,o)}},length:function(){return i.tasks.length},running:function(){return r},idle:function(){return i.tasks.length+r===0},pause:function(){!0!==i.paused&&(i.paused=!0,i.process())},resume:function(){!1!==i.paused&&(i.paused=!1,i.process())}};return i},u.priorityQueue=function(e,t){function n(e,t){return e.priority-t.priority}function r(e,t,n){for(var r=-1,i=e.length-1;r<i;){var o=r+(i-r+1>>>1);n(t,e[o])>=0?r=o:i=o-1}return r}function i(e,t,i,o){if(e.started||(e.started=!0),d(t)||(t=[t]),0==t.length)return u.setImmediate(function(){e.drain&&e.drain()});p(t,function(t){var a={data:t,priority:i,callback:"function"==typeof o?o:null};e.tasks.splice(r(e.tasks,a,n)+1,0,a),e.saturated&&e.tasks.length===e.concurrency&&e.saturated(),u.setImmediate(e.process)})}var o=u.queue(e,t);return o.push=function(e,t,n){i(o,e,t,n)},delete o.unshift,o},u.cargo=function(e,t){var n=!1,r=[],i={tasks:r,payload:t,saturated:null,empty:null,drain:null,drained:!0,push:function(e,n){d(e)||(e=[e]),p(e,function(e){r.push({data:e,callback:"function"==typeof n?n:null}),i.drained=!1,i.saturated&&r.length===t&&i.saturated()}),u.setImmediate(i.process)},process:function o(){if(!n){if(0===r.length)return i.drain&&!i.drained&&i.drain(),void(i.drained=!0);var a="number"==typeof t?r.splice(0,t):r.splice(0,r.length),s=f(a,function(e){return e.data});i.empty&&i.empty(),n=!0,e(s,function(){n=!1;var e=arguments;p(a,function(t){t.callback&&t.callback.apply(null,e)}),o()})}},length:function(){return r.length},running:function(){return n}};return i};var k=function(e){return function(t){var n=Array.prototype.slice.call(arguments,1);t.apply(null,n.concat([function(t){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(t?console.error&&console.error(t):console[e]&&p(n,function(t){console[e](t)}))}]))}};u.log=k("log"),u.dir=k("dir"),u.memoize=function(e,t){var n={},r={};t=t||function(e){return e};var i=function(){var i=Array.prototype.slice.call(arguments),o=i.pop(),a=t.apply(null,i);a in n?u.nextTick(function(){o.apply(null,n[a])}):a in r?r[a].push(o):(r[a]=[o],e.apply(null,i.concat([function(){n[a]=arguments;var e=r[a];delete r[a];for(var t=0,i=e.length;t<i;t++)e[t].apply(null,arguments)}])))};return i.memo=n,i.unmemoized=e,i},u.unmemoize=function(e){return function(){return(e.unmemoized||e).apply(null,arguments)}},u.times=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return u.map(r,t,n)},u.timesSeries=function(e,t,n){for(var r=[],i=0;i<e;i++)r.push(i);return u.mapSeries(r,t,n)},u.seq=function(){var e=arguments;return function(){var t=this,n=Array.prototype.slice.call(arguments),r=n.pop();u.reduce(e,n,function(e,n,r){n.apply(t,e.concat([function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);r(e,t)}]))},function(e,n){r.apply(t,[e].concat(n))})}},u.compose=function(){return u.seq.apply(null,Array.prototype.reverse.call(arguments))};var I=function(e,t){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),i=r.pop();return e(t,function(e,t){e.apply(n,r.concat([t]))},i)};return arguments.length>2?n.apply(this,Array.prototype.slice.call(arguments,2)):n};u.applyEach=g(I),u.applyEachSeries=b(I),u.forever=function(e,t){function n(r){if(r){if(t)return t(r);throw r}e(n)}n()},void 0!==e&&e.exports?e.exports=u:(i=[],void 0!==(o=function(){return u}.apply(t,i))&&(e.exports=o))}()}).call(t,n(30),n(36).setImmediate)},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(48)),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object(i.getLogger)(e),c=function(){function e(t,n,i,o,a,s){r(this,e),this.sid=t,this.localJid=n,this.peerjid=i,this.connection=o,this.mediaConstraints=a,this.iceConfig=s,this.usedrip=!0,this.dripContainer=[],this.room=null,this.state=null,this.rtc=null}return a(e,[{key:"initialize",value:function(e,t,n){if(null!==this.state){var r="attempt to initiate on session "+this.sid+"\n                   in state "+this.state;throw s.error(r),new Error(r)}this.room=t,this.rtc=n,this.state=o.c,this.initiator=e?this.localJid:this.peerjid,this.responder=e?this.peerjid:this.localJid,this.doInitialize()}},{key:"doInitialize",value:function(){}},{key:"addIceCandidates",value:function(e){}},{key:"getState",value:function(){return this.state}},{key:"addSources",value:function(e){}},{key:"removeSources",value:function(e){}},{key:"terminate",value:function(e,t,n){}},{key:"acceptOffer",value:function(e,t,n){}}]),e}();t.a=c}).call(t,"modules/xmpp/JingleSession.js")},function(e,t,n){"use strict";function r(e,t){if(!t)return!1;if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!e[n].equals(t[n]))return!1}else if(e[n]!==t[n])return!1;return!0}function i(e,t){if(this.mySDP=e,this.otherSDP=t,!e)throw new Error('"mySDP" is undefined!');if(!t)throw new Error('"otherSDP" is undefined!')}t.a=i;var o=n(10);i.prototype.getNewMedia=function(){var e=this.mySDP.getMediaSsrcMap(),t=this.otherSDP.getMediaSsrcMap(),n={};return Object.keys(t).forEach(function(i){var o=e[i],a=t[i];if(!o&&a)return void(n[i]=a);Object.keys(a.ssrcs).forEach(function(e){-1===Object.keys(o.ssrcs).indexOf(e)&&(n[i]||(n[i]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcs[e]=a.ssrcs[e])}),a.ssrcGroups.forEach(function(e){for(var t=!1,s=0;s<o.ssrcGroups.length;s++){var c=o.ssrcGroups[s];if(e.semantics===c.semantics&&r(e.ssrcs,c.ssrcs)){t=!0;break}}t||(n[i]||(n[i]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcGroups.push(e))})}),n},i.prototype.toJingle=function(e){var t=this.getNewMedia(),n=!1;return Object.keys(t).forEach(function(r){n=!0;var i=t[r];e.c("content",{name:i.mid}),e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:i.mid}),Object.keys(i.ssrcs).forEach(function(t){var n=i.ssrcs[t];e.c("source",{xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.attrs({ssrc:n.ssrc}),n.lines.forEach(function(t){var n=t.indexOf(" "),r=t.substr(n+1);if(e.c("parameter"),-1===r.indexOf(":"))e.attrs({name:r});else{var i=r.split(":",2),a=i[0],s=o.a.filterSpecialChars(i[1]);e.attrs({name:a}),e.attrs({value:s})}e.up()}),e.up()}),i.ssrcGroups.forEach(function(t){t.ssrcs.length&&(e.c("ssrc-group",{semantics:t.semantics,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),t.ssrcs.forEach(function(t){e.c("source",{ssrc:t}).up()}),e.up())}),e.up(),e.up()}),n}},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(3)),c=n(50),u=n(101),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=Object(a.getLogger)(e),p=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.ssrcOwners=new Map,e.chatRoom=null,e}return o(t,e),l(t,[{key:"setChatRoom",value:function(e){var t=this,n=this.chatRoom;this.chatRoom=e,n&&(n.removePresenceListener("audiomuted",this._audioMuteHandler),n.removePresenceListener("videomuted",this._videoMuteHandler),n.removePresenceListener("videoType",this._videoTypeHandler)),e&&(this._audioMuteHandler=function(e,n){t.eventEmitter.emit(c.a,n,s.a,"true"===e.value)},e.addPresenceListener("audiomuted",this._audioMuteHandler),this._videoMuteHandler=function(e,n){t.eventEmitter.emit(c.a,n,s.b,"true"===e.value)},e.addPresenceListener("videomuted",this._videoMuteHandler),this._videoTypeHandler=function(e,n){t.eventEmitter.emit(c.b,n,e.value)},e.addPresenceListener("videoType",this._videoTypeHandler))}},{key:"getPeerMediaInfo",value:function(e,t){if(this.chatRoom)return this.chatRoom.getMediaPresenceInfo(e,t);d.error("Requested peer media info, before room was set")}},{key:"getSSRCOwner",value:function(e){return this.ssrcOwners.get(e)}},{key:"setSSRCOwner",value:function(e,t){if("number"!=typeof e)throw new TypeError("SSRC("+e+") must be a number");this.ssrcOwners.set(e,t)}}]),t}(u.a);t.a=p}).call(t,"modules/xmpp/SignalingLayerImpl.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(8),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"getSSRCOwner",value:function(e){throw new Error("not implemented")}},{key:"getPeerMediaInfo",value:function(e,t){throw new Error("not implemented")}}]),t}(a.a);t.a=c},function(e,t,n){"use strict";(function(e){var r=n(0),i=(n.n(r),n(2)),o=n.n(i),a=Object(r.getLogger)(e),s=-1,c=/request id \d+.\d+ got 200/,u=/request errored, status: (\d+), number of errors: \d+/;t.a=function(){Strophe.log=function(e,t){switch(a.trace("Strophe",e,t),"string"==typeof t&&-1!==t.indexOf("Request ")&&-1!==t.indexOf("timed out (secondary), restarting")&&(e=Strophe.LogLevel.WARN),e){case Strophe.LogLevel.DEBUG:-1!==s&&c.test(t)&&(a.debug("Reset lastErrorStatus"),s=-1);break;case Strophe.LogLevel.WARN:a.warn("Strophe: "+t);var n=u.exec(t);n&&2===n.length&&(s=parseInt(n[1],10),a.debug("lastErrorStatus set to: "+s));break;case Strophe.LogLevel.ERROR:case Strophe.LogLevel.FATAL:t="Strophe: "+t,o.a.callErrorHandler(new Error(t)),a.error(t)}},Strophe.getLastErrorStatus=function(){return s},Strophe.getStatusString=function(e){switch(e){case Strophe.Status.ERROR:return"ERROR";case Strophe.Status.CONNECTING:return"CONNECTING";case Strophe.Status.CONNFAIL:return"CONNFAIL";case Strophe.Status.AUTHENTICATING:return"AUTHENTICATING";case Strophe.Status.AUTHFAIL:return"AUTHFAIL";case Strophe.Status.CONNECTED:return"CONNECTED";case Strophe.Status.DISCONNECTED:return"DISCONNECTED";case Strophe.Status.DISCONNECTING:return"DISCONNECTING";case Strophe.Status.ATTACHED:return"ATTACHED";default:return"unknown"}}}}).call(t,"modules/xmpp/strophe.util.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(18)),c=n(2),u=n.n(c),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},p=Object(a.getLogger)(e),f=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.failedPings=0,n.xmpp=e,n}return o(t,e),l(t,[{key:"init",value:function(e){d(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),Strophe.addNamespace("PING","urn:xmpp:ping")}},{key:"ping",value:function(e,t,n,r){var i=$iq({type:"get",to:e});i.c("ping",{xmlns:Strophe.NS.PING}),this.connection.sendIQ(i,t,n,r)}},{key:"hasPingSupport",value:function(e,t){this.xmpp.caps.getFeatures(e).then(function(e){return t(e.has("urn:xmpp:ping"))},function(e){var n="Ping feature discovery error";u.a.callErrorHandler(new Error(n+": "+e)),p.error(n,e),t(!1)})}},{key:"startInterval",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;if(this.intervalId){var r="Ping task scheduled already";return u.a.callErrorHandler(new Error(r)),void p.error(r)}this.intervalId=window.setInterval(function(){t.ping(e,function(){t.failedPings=0},function(e){t.failedPings+=1;var n="Ping "+(e?"error":"timeout");t.failedPings>=3?(u.a.callErrorHandler(new Error(n)),p.error(n,e)):p.warn(n,e)},15e3)},n),p.info("XMPP pings will be sent every "+n+" ms")}},{key:"stopInterval",value:function(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.failedPings=0,p.info("Ping interval cleared"))}}]),t}(s.b);t.a=function(e){Strophe.addConnectionPlugin("ping",new f(e))}}).call(t,"modules/xmpp/strophe.ping.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(18)),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},l=Object(a.getLogger)(e),d=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),c(t,[{key:"init",value:function(e){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.connection.addHandler(this.onRayo.bind(this),"urn:xmpp:rayo:1","iq","set",null,null)}},{key:"onRayo",value:function(e){l.info("Rayo IQ",e)}},{key:"dial",value:function(e,t,n,r,i){var o=this;return new Promise(function(a,s){if(!i)return void s(new Error("Internal error!"));var c=$iq({type:"set",to:i});c.c("dial",{xmlns:"urn:xmpp:rayo:1",to:e,from:t}),c.c("header",{name:"JvbRoomName",value:n}).up(),r&&r.length&&c.c("header",{name:"JvbRoomPassword",value:r}).up(),o.connection.sendIQ(c,function(e){l.info("Dial result ",e);var t=$(e).find("ref").attr("uri");o.callResource=t.substr("xmpp:".length),l.info("Received call resource: "+o.callResource),a()},function(e){l.info("Dial error ",e),s(e)})})}},{key:"hangup",value:function(){var e=this;return new Promise(function(t,n){if(!e.callResource)return n(new Error("No call in progress")),void l.warn("No call in progress");var r=$iq({type:"set",to:e.callResource});r.c("hangup",{xmlns:"urn:xmpp:rayo:1"}),e.connection.sendIQ(r,function(n){l.info("Hangup result ",n),e.callResource=null,t()},function(t){l.info("Hangup error ",t),e.callResource=null,n(new Error("Hangup error "))})})}}]),t}(s.b);t.a=function(){Strophe.addConnectionPlugin("rayo",new d)}}).call(t,"modules/xmpp/strophe.rayo.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(18),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},u=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.log=[],e}return o(t,e),s(t,[{key:"init",value:function(e){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this.connection.rawInput=this.logIncoming.bind(this),this.connection.rawOutput=this.logOutgoing.bind(this)}},{key:"logIncoming",value:function(e){this.log.push([(new Date).getTime(),"incoming",e])}},{key:"logOutgoing",value:function(e){this.log.push([(new Date).getTime(),"outgoing",e])}}]),t}(a.b);t.a=function(){Strophe.addConnectionPlugin("logger",new u)}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){var n=0;return p.some(function(r){return 0!==(n=e[r]>t[r]&&1||e[r]<t[r]&&-1)}),n}var s=n(6),c=n.n(s),u=n(8),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=["category","type","lang","name"],p=["category","type","lang"],f=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"http://jitsi.org/jitsimeet";r(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(o.node=n,o.disco=e.disco,!o.disco)throw new Error("Missing strophe-plugins (disco and caps plugins are required)!");o.versionToCapabilities=Object.create(null),o.jidToVersion=Object.create(null),o.version="",o.rooms=new Set;var a=e.emuc;return a.addListener(c.a.EMUC_ROOM_ADDED,function(e){return o._addChatRoom(e)}),a.addListener(c.a.EMUC_ROOM_REMOVED,function(e){return o._removeChatRoom(e)}),Object.keys(a.rooms).forEach(function(e){o._addChatRoom(a.rooms[e])}),Strophe.addNamespace("CAPS","http://jabber.org/protocol/caps"),o.disco.addFeature(Strophe.NS.CAPS),e.addHandler(o._handleCaps.bind(o),Strophe.NS.CAPS),o._onMucMemberLeft=o._removeJidToVersionEntry.bind(o),o}return o(t,e),l(t,[{key:"addFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.disco.addFeature(e),this._generateVersion(),t&&this.submit()}},{key:"removeFeature",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.disco.removeFeature(e),this._generateVersion(),t&&this.submit()}},{key:"submit",value:function(){this.rooms.forEach(function(e){return e.sendPresence()})}},{key:"getFeatures",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,r=e in this.jidToVersion?this.jidToVersion[e]:null;if(!(r&&r.version in this.versionToCapabilities)){var i=r?r.node+"#"+r.version:null;return new Promise(function(o,a){return t.disco.info(e,i,function(e){var n=new Set;$(e).find(">query>feature").each(function(e,t){return n.add(t.getAttribute("var"))}),r&&(t.versionToCapabilities[r.version]=n),o(n)},a,n)})}return Promise.resolve(this.versionToCapabilities[r.version])}},{key:"_addChatRoom",value:function(e){this.rooms.add(e),e.addListener(c.a.MUC_MEMBER_LEFT,this._onMucMemberLeft),this._fixChatRoomPresenceMap(e)}},{key:"_removeChatRoom",value:function(e){this.rooms.delete(e),e.removeListener(c.a.MUC_MEMBER_LEFT,this._onMucMemberLeft)}},{key:"_fixChatRoomPresenceMap",value:function(e){e.addToPresence("c",{attributes:{xmlns:Strophe.NS.CAPS,hash:"sha-1",node:this.node,ver:this.version}})}},{key:"_notifyVersionChanged",value:function(){var e=this;this.rooms.forEach(function(t){return e._fixChatRoomPresenceMap(t)}),this.submit()}},{key:"_generateVersion",value:function(){var e=this.disco._identities.sort(a),t=this.disco._features.sort();this.version=b64_sha1(e.reduce(function(e,t){return d.reduce(function(e,n,r){return e+(0===r?"":"/")+t[n]},"")+"<"},"")+t.reduce(function(e,t){return e+t+"<"},"")),this._notifyVersionChanged()}},{key:"_handleCaps",value:function(e){var t=e.getAttribute("from"),n=e.querySelector("c"),r=n.getAttribute("ver"),i=n.getAttribute("node"),o=this.jidToVersion[t];return this.jidToVersion[t]={version:r,node:i},o&&o.version!==r&&this.eventEmitter.emit(c.a.PARTCIPANT_FEATURES_CHANGED,t),!0}},{key:"_removeJidToVersionEntry",value:function(e){e in this.jidToVersion&&delete this.jidToVersion[e]}}]),t}(u.a);t.a=f},function(e,t,n){"use strict";(function(e){function r(e){this.conference=e,e.on(l.TRACK_MUTE_CHANGED,function(t){if(t.isLocal()&&e.statistics){var n=t.isP2P?e.p2pJingleSession:e.jvbJingleSession,r=n&&n.peerconnection||null;e.statistics.sendMuteEvent(r,t.isMuted(),t.getType())}}),e.on(l.CONNECTION_INTERRUPTED,h.a.sendEventToAll.bind(h.a,"connection.interrupted")),e.on(l.CONNECTION_RESTORED,h.a.sendEventToAll.bind(h.a,"connection.restored"))}t.a=r;var i=n(45),o=n.n(i),a=n(108),s=n.n(a),c=n(0),u=(n.n(c),n(28)),l=n(4),d=n(3),p=n(7),f=n.n(p),h=n(5),v=n(6),m=n.n(v),g=Object(c.getLogger)(e);r.prototype.setupChatRoomListeners=function(){var e=this,t=this.conference,n=t.room;this.chatRoomForwarder=new s.a(n,this.conference.eventEmitter),n.addListener(m.a.ICE_RESTARTING,function(e){e.isP2P||t.rtc.closeBridgeChannel()}),n.addListener(m.a.AUDIO_MUTED_BY_FOCUS,function(e){t.rtc.setAudioMute(e).then(function(){t.isMutedByFocus=!0},function(){return g.warn("Error while audio muting due to focus request")})}),this.chatRoomForwarder.forward(m.a.SUBJECT_CHANGED,l.SUBJECT_CHANGED),this.chatRoomForwarder.forward(m.a.MUC_JOINED,l.CONFERENCE_JOINED),n.addListener(m.a.MUC_JOINED,function(){e.conference.isJvbConnectionInterrupted=!1,Object.keys(n.connectionTimes).forEach(function(e){var t=n.connectionTimes[e];h.a.analytics.sendEvent("conference."+e,{value:t})}),Object.keys(n.xmpp.connectionTimes).forEach(function(e){var t=n.xmpp.connectionTimes[e];h.a.analytics.sendEvent("xmpp."+e,{value:t})})}),this.chatRoomForwarder.forward(m.a.ROOM_JOIN_ERROR,l.CONFERENCE_FAILED,u.CONNECTION_ERROR),this.chatRoomForwarder.forward(m.a.ROOM_CONNECT_ERROR,l.CONFERENCE_FAILED,u.CONNECTION_ERROR),this.chatRoomForwarder.forward(m.a.ROOM_CONNECT_NOT_ALLOWED_ERROR,l.CONFERENCE_FAILED,u.NOT_ALLOWED_ERROR),this.chatRoomForwarder.forward(m.a.ROOM_MAX_USERS_ERROR,l.CONFERENCE_FAILED,u.CONFERENCE_MAX_USERS),this.chatRoomForwarder.forward(m.a.PASSWORD_REQUIRED,l.CONFERENCE_FAILED,u.PASSWORD_REQUIRED),this.chatRoomForwarder.forward(m.a.AUTHENTICATION_REQUIRED,l.CONFERENCE_FAILED,u.AUTHENTICATION_REQUIRED),this.chatRoomForwarder.forward(m.a.BRIDGE_DOWN,l.CONFERENCE_FAILED,u.VIDEOBRIDGE_NOT_AVAILABLE),n.addListener(m.a.BRIDGE_DOWN,function(){return h.a.analytics.sendEvent("conference.bridgeDown")}),this.chatRoomForwarder.forward(m.a.RESERVATION_ERROR,l.CONFERENCE_FAILED,u.RESERVATION_ERROR),this.chatRoomForwarder.forward(m.a.GRACEFUL_SHUTDOWN,l.CONFERENCE_FAILED,u.GRACEFUL_SHUTDOWN),n.addListener(m.a.JINGLE_FATAL_ERROR,function(e,n){e.isP2P||t.eventEmitter.emit(l.CONFERENCE_FAILED,u.JINGLE_FATAL_ERROR,n)}),n.addListener(m.a.CONNECTION_ICE_FAILED,function(e){t._onIceConnectionFailed(e)}),this.chatRoomForwarder.forward(m.a.MUC_DESTROYED,l.CONFERENCE_FAILED,u.CONFERENCE_DESTROYED),this.chatRoomForwarder.forward(m.a.CHAT_ERROR_RECEIVED,l.CONFERENCE_ERROR,u.CHAT_ERROR),this.chatRoomForwarder.forward(m.a.FOCUS_DISCONNECTED,l.CONFERENCE_FAILED,u.FOCUS_DISCONNECTED),n.addListener(m.a.FOCUS_LEFT,function(){h.a.analytics.sendEvent("conference.focusLeft"),t.eventEmitter.emit(l.CONFERENCE_FAILED,u.FOCUS_LEFT)});var r=function(e){return h.a.sendEventToAll("conference.error."+e)};n.addListener(m.a.SESSION_ACCEPT_TIMEOUT,function(e){r(e.isP2P?"p2pSessionAcceptTimeout":"sessionAcceptTimeout")}),this.chatRoomForwarder.forward(m.a.RECORDER_STATE_CHANGED,l.RECORDER_STATE_CHANGED),this.chatRoomForwarder.forward(m.a.TRANSCRIPTION_STATUS_CHANGED,l.TRANSCRIPTION_STATUS_CHANGED),this.chatRoomForwarder.forward(m.a.VIDEO_SIP_GW_AVAILABILITY_CHANGED,l.VIDEO_SIP_GW_AVAILABILITY_CHANGED),this.chatRoomForwarder.forward(m.a.PHONE_NUMBER_CHANGED,l.PHONE_NUMBER_CHANGED),n.addListener(m.a.CONFERENCE_SETUP_FAILED,function(e,n){e.isP2P||t.eventEmitter.emit(l.CONFERENCE_FAILED,u.SETUP_FAILED,n)}),n.setParticipantPropertyListener(function(e,n){var r=t.getParticipantById(n);r&&r.setProperty(e.tagName.substring("jitsi_participant_".length),e.value)}),this.chatRoomForwarder.forward(m.a.KICKED,l.KICKED),n.addListener(m.a.KICKED,function(){t.room=null,t.leave()}),n.addListener(m.a.SUSPEND_DETECTED,t.onSuspendDetected.bind(t)),this.chatRoomForwarder.forward(m.a.MUC_LOCK_CHANGED,l.LOCK_STATE_CHANGED),n.addListener(m.a.MUC_MEMBER_JOINED,t.onMemberJoined.bind(t)),n.addListener(m.a.MUC_MEMBER_LEFT,t.onMemberLeft.bind(t)),this.chatRoomForwarder.forward(m.a.MUC_LEFT,l.CONFERENCE_LEFT),n.addListener(m.a.DISPLAY_NAME_CHANGED,t.onDisplayNameChanged.bind(t)),n.addListener(m.a.LOCAL_ROLE_CHANGED,function(e){t.onLocalRoleChanged(e),t.statistics&&t.isModerator()&&t.on(l.RECORDER_STATE_CHANGED,function(e,t){var n={id:"recorder_status",status:e};t&&(n.error=t),h.a.sendLog(JSON.stringify(n))})}),n.addListener(m.a.MUC_ROLE_CHANGED,t.onUserRoleChanged.bind(t)),n.addListener(o.a.IDENTITY_UPDATED,function(e,n){t.authEnabled=e,t.authIdentity=n,t.eventEmitter.emit(l.AUTH_STATUS_CHANGED,e,n)}),n.addListener(m.a.MESSAGE_RECEIVED,function(e,n,r,i,o){var a=Strophe.getResourceFromJid(e);t.eventEmitter.emit(l.MESSAGE_RECEIVED,a,r,o)}),n.addListener(m.a.PRESENCE_STATUS,function(e,n){var r=Strophe.getResourceFromJid(e),i=t.getParticipantById(r);i&&i._status!==n&&(i._status=n,t.eventEmitter.emit(l.USER_STATUS_CHANGED,r,n))}),n.addListener(m.a.JSON_MESSAGE_RECEIVED,function(e,n){var r=Strophe.getResourceFromJid(e),i=t.getParticipantById(r);i?t.eventEmitter.emit(l.ENDPOINT_MESSAGE_RECEIVED,i,n):g.warn("Ignored XMPPEvents.JSON_MESSAGE_RECEIVED for not existing participant: "+e,n)}),n.addPresenceListener("startmuted",function(e,n){var r=!1;if(t.myUserId()===n&&t.isModerator())r=!0;else{var i=t.getParticipantById(n);i&&i.isModerator()&&(r=!0)}if(r){var o="true"===e.attributes.audio,a="true"===e.attributes.video,s=!1;o!==t.startMutedPolicy.audio&&(t.startMutedPolicy.audio=o,s=!0),a!==t.startMutedPolicy.video&&(t.startMutedPolicy.video=a,s=!0),s&&t.eventEmitter.emit(l.START_MUTED_POLICY_CHANGED,t.startMutedPolicy)}}),n.addPresenceListener("devices",function(e,n){var r=!1,i=!1;e.children.forEach(function(e){"audio"===e.tagName&&(r="true"===e.value),"video"===e.tagName&&(i="true"===e.value)});var o=void 0;if(t.myUserId()===n)o=t.availableDevices;else{var a=t.getParticipantById(n);if(!a)return;o=a._availableDevices}var s=!1;o.audio!==r&&(s=!0,o.audio=r),o.video!==i&&(s=!0,o.video=i),s&&t.eventEmitter.emit(l.AVAILABLE_DEVICES_CHANGED,n,o)}),t.statistics&&(n.addListener(m.a.CONNECTION_ICE_FAILED,function(e){t.statistics.sendIceConnectionFailedEvent(e.peerconnection)}),n.addListener(m.a.ADD_ICE_CANDIDATE_FAILED,function(e,n){t.statistics.sendAddIceCandidateFailed(e,n)}))},r.prototype.setupRTCListeners=function(){var e=this.conference,t=e.rtc;t.addListener(f.a.REMOTE_TRACK_ADDED,e.onRemoteTrackAdded.bind(e)),t.addListener(f.a.REMOTE_TRACK_REMOVED,e.onRemoteTrackRemoved.bind(e)),t.addListener(f.a.DOMINANT_SPEAKER_CHANGED,function(t){e.lastDominantSpeaker!==t&&e.room&&(e.lastDominantSpeaker=t,e.eventEmitter.emit(l.DOMINANT_SPEAKER_CHANGED,t)),e.statistics&&e.myUserId()===t&&e.statistics.sendDominantSpeakerEvent()}),t.addListener(f.a.DATA_CHANNEL_OPEN,function(){var t=window.performance.now();g.log("(TIME) data channel opened ",t),e.room.connectionTimes["data.channel.opened"]=t,h.a.analytics.sendEvent("conference.dataChannel.open",{value:t}),e.eventEmitter.emit(l.DATA_CHANNEL_OPENED)}),t.addListener(f.a.AVAILABLE_DEVICES_CHANGED,function(t){return e.room.updateDeviceAvailability(t)}),t.addListener(f.a.ENDPOINT_MESSAGE_RECEIVED,function(t,n){var r=e.getParticipantById(t);r?e.eventEmitter.emit(l.ENDPOINT_MESSAGE_RECEIVED,r,n):g.warn("Ignored ENDPOINT_MESSAGE_RECEIVED for not existing participant: "+t,n)}),t.addListener(f.a.LOCAL_UFRAG_CHANGED,function(e,t){e.isP2P||h.a.sendLog(JSON.stringify({id:"local_ufrag",value:t}))}),t.addListener(f.a.REMOTE_UFRAG_CHANGED,function(e,t){e.isP2P||h.a.sendLog(JSON.stringify({id:"remote_ufrag",value:t}))}),e.statistics&&(t.addListener(f.a.CREATE_ANSWER_FAILED,function(t,n){e.statistics.sendCreateAnswerFailed(t,n)}),t.addListener(f.a.CREATE_OFFER_FAILED,function(t,n){e.statistics.sendCreateOfferFailed(t,n)}),t.addListener(f.a.SET_LOCAL_DESCRIPTION_FAILED,function(t,n){e.statistics.sendSetLocalDescFailed(t,n)}),t.addListener(f.a.SET_REMOTE_DESCRIPTION_FAILED,function(t,n){e.statistics.sendSetRemoteDescFailed(t,n)}))},r.prototype.setupXMPPListeners=function(){var e=this.conference;e.xmpp.caps.addListener(m.a.PARTCIPANT_FEATURES_CHANGED,function(t){var n=e.getParticipantById(Strophe.getResourceFromJid(t));n&&e.eventEmitter.emit(l.PARTCIPANT_FEATURES_CHANGED,n)}),e.xmpp.addListener(m.a.CALL_INCOMING,e.onIncomingCall.bind(e)),e.xmpp.addListener(m.a.CALL_ACCEPTED,e.onCallAccepted.bind(e)),e.xmpp.addListener(m.a.TRANSPORT_INFO,e.onTransportInfo.bind(e)),e.xmpp.addListener(m.a.CALL_ENDED,e.onCallEnded.bind(e)),e.xmpp.addListener(m.a.START_MUTED_FROM_FOCUS,function(t,n){e.options.config.ignoreStartMuted||(e.startAudioMuted=t,e.startVideoMuted=n,e.getLocalTracks().forEach(function(t){switch(t.getType()){case d.a:e.startAudioMuted&&t.mute();break;case d.b:e.startVideoMuted&&t.mute()}}),e.eventEmitter.emit(l.STARTED_MUTED))})},r.prototype.setupStatisticsListeners=function(){var e=this.conference;e.statistics&&(e.statistics.addAudioLevelListener(function(t,n,r,i){e.rtc.setAudioLevel(t,n,r,i)}),e.statistics.addBeforeDisposedListener(function(){e.eventEmitter.emit(l.BEFORE_STATISTICS_DISPOSED)}),e.statistics.addByteSentStatsListener(function(t,n){e.getLocalTracks(d.a).forEach(function(e){var r=t.getLocalSSRC(e);r&&n.hasOwnProperty(r)&&e._setByteSent(t,n[r])})}))}}).call(t,"JitsiConferenceEventManager.js")},function(e,t){function n(e,t){if(!e||!t||"function"!=typeof e.addListener||"function"!=typeof t.emit)throw new Error("Invalid arguments passed to EventEmitterForwarder");this.src=e,this.dest=t}n.prototype.forward=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0];t[0]=this.dest,this.src.addListener(r,Function.prototype.bind.apply(this.dest.emit,t))},e.exports=n},function(e,t,n){(function(e){function t(e,t){var n=e.getTrack();if(!n)throw new Error("Failed to initialize DTMFSender: no audio track.");this.dtmfSender=t.peerconnection.createDTMFSender(n),r.debug("Initialized DTMFSender")}var r=n(0).getLogger(e);t.prototype.sendTones=function(e,t,n){this.dtmfSender.insertDTMF(e,t||200,n||200)}}).call(t,"modules/DTMF/JitsiDTMFManager.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(4),o=n(32),a=n(3),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(){function e(t,n,i,a){r(this,e),this._jid=t,this._id=Strophe.getResourceFromJid(t),this._conference=n,this._displayName=i,this._supportsDTMF=!1,this._tracks=[],this._role="none",this._status=null,this._availableDevices={audio:void 0,video:void 0},this._hidden=a,this._connectionStatus=o.a.ACTIVE,this._properties={}}return s(e,[{key:"getConference",value:function(){return this._conference}},{key:"getProperty",value:function(e){return this._properties[e]}},{key:"hasAnyVideoTrackWebRTCMuted",value:function(){return this.getTracks().some(function(e){return e.getType()===a.b&&e.isWebRTCTrackMuted()})}},{key:"_setConnectionStatus",value:function(e){this._connectionStatus=e}},{key:"getConnectionStatus",value:function(){return this._connectionStatus}},{key:"setProperty",value:function(e,t){var n=this._properties[e];t!==n&&(this._properties[e]=t,this._conference.eventEmitter.emit(i.PARTICIPANT_PROPERTY_CHANGED,this,e,n,t))}},{key:"getTracks",value:function(){return this._tracks.slice()}},{key:"getTracksByMediaType",value:function(e){return this.getTracks().filter(function(t){return t.getType()===e})}},{key:"getId",value:function(){return this._id}},{key:"getJid",value:function(){return this._jid}},{key:"getDisplayName",value:function(){return this._displayName}},{key:"getStatus",value:function(){return this._status}},{key:"isModerator",value:function(){return"moderator"===this._role}},{key:"isHidden",value:function(){return this._hidden}},{key:"isAudioMuted",value:function(){return this._isMediaTypeMuted(a.a)}},{key:"_isMediaTypeMuted",value:function(e){return this.getTracks().reduce(function(t,n){return t&&(n.getType()!==e||n.isMuted())},!0)}},{key:"isVideoMuted",value:function(){return this._isMediaTypeMuted(a.b)}},{key:"getRole",value:function(){return this._role}},{key:"supportsDTMF",value:function(){return this._supportsDTMF}},{key:"getFeatures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;return this._conference.xmpp.caps.getFeatures(this._jid,e)}}]),e}();t.a=c},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(4)),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object(i.getLogger)(e),c=function(){function e(t){var n=this;r(this,e),this._conference=t,this._jvb121=!0,this._conference.addEventListener(o.USER_JOINED,function(){return n.evaluateStatus()}),this._conference.addEventListener(o.USER_LEFT,function(){return n.evaluateStatus()}),this._conference.addEventListener(o.P2P_STATUS,function(){return n.evaluateStatus()})}return a(e,[{key:"evaluateStatus",value:function(){var e=this._jvb121,t=!this._conference.isP2PActive()&&this._conference.getParticipantCount()<=2;e!==t&&(this._jvb121=t,s.debug("JVB121 status "+e+" => "+t),this._conference.eventEmitter.emit(o.JVB121_STATUS,e,t))}}]),e}();t.a=c}).call(t,"modules/event/Jvb121EventGenerator.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(4),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.conference=t,t.addEventListener(i.TRACK_AUDIO_LEVEL_CHANGED,this._audioLevel.bind(this)),this.myUserID=this.conference.myUserId()}return o(e,[{key:"_audioLevel",value:function(e,t){!this.conference.isP2PActive()||t<=.6||e===this.myUserID&&this.conference.getLocalAudioTrack().isMuted()||this.conference.eventEmitter.emit(i.DOMINANT_SPEAKER_CHANGED,e)}}]),e}();t.a=a},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(7)),a=n.n(o),s=n(2),c=n.n(s),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=Object(i.getLogger)(e),d=function(){function e(t,n,i){var o=this;if(r(this,e),!t&&!n)throw new TypeError("At least peerconnection or wsUrl must be given");if(t&&n)throw new TypeError("Just one of peerconnection or wsUrl must be given");if(t?l.debug("constructor() with peerconnection"):l.debug('constructor() with wsUrl:"'+n+'"'),this._channel=null,this._eventEmitter=i,this._mode=null,t)t.ondatachannel=function(e){var t=e.channel;o._handleChannel(t),o._mode="datachannel"};else if(n){var a=new WebSocket(n);this._handleChannel(a),this._mode="websocket"}}return u(e,[{key:"close",value:function(){if(this._channel){try{this._channel.close()}catch(e){}this._channel=null}}},{key:"isOpen",value:function(){return this._channel&&("open"===this._channel.readyState||this._channel.readyState===WebSocket.OPEN)}},{key:"sendMessage",value:function(e,t){this._send({colibriClass:"EndpointMessage",msgPayload:t,to:e})}},{key:"sendSetLastNMessage",value:function(e){var t={colibriClass:"LastNChangedEvent",lastN:e};this._send(t),l.log("Channel lastN set to: "+e)}},{key:"sendPinnedEndpointMessage",value:function(e){l.log("sending pinned changed notification to the bridge for endpoint ",e),this._send({colibriClass:"PinnedEndpointChangedEvent",pinnedEndpoint:e||null})}},{key:"sendSelectedEndpointMessage",value:function(e){l.log("sending selected changed notification to the bridge for endpoint ",e),this._send({colibriClass:"SelectedEndpointChangedEvent",selectedEndpoint:e||null})}},{key:"sendReceiverVideoConstraintMessage",value:function(e){l.log("sending a ReceiverVideoConstraint message with a maxFrameHeight of "+e+" pixels"),this._send({colibriClass:"ReceiverVideoConstraint",maxFrameHeight:e})}},{key:"_handleChannel",value:function(e){var t=this,n=this._eventEmitter;e.onopen=function(){l.info(t._mode+" channel opened"),n.emit(a.a.DATA_CHANNEL_OPEN)},e.onerror=function(e){l.error("Channel error:",e)},e.onmessage=function(e){var t=e.data,r=void 0;try{r=JSON.parse(t)}catch(e){return c.a.callErrorHandler(e),void l.error("Failed to parse channel message as JSON: ",t,e)}var i=r.colibriClass;switch(i){case"DominantSpeakerEndpointChangeEvent":var o=r.dominantSpeakerEndpoint;l.info("Channel new dominant speaker event: ",o),n.emit(a.a.DOMINANT_SPEAKER_CHANGED,o);break;case"EndpointConnectivityStatusChangeEvent":var s=r.endpoint,u="true"===r.active;l.info("Endpoint connection status changed: "+s+" active ? "+u),n.emit(a.a.ENDPOINT_CONN_STATUS_CHANGED,s,u);break;case"EndpointMessage":n.emit(a.a.ENDPOINT_MESSAGE_RECEIVED,r.from,r.msgPayload);break;case"LastNEndpointsChangeEvent":var d=r.lastNEndpoints;l.info("Channel new last-n event: ",d,r),n.emit(a.a.LASTN_ENDPOINT_CHANGED,d,r);break;default:l.debug("Channel JSON-formatted message: ",r),n.emit("rtc.datachannel."+i,r)}},e.onclose=function(){l.info("Channel closed"),t._channel=null},this._channel=e}},{key:"_send",value:function(e){var t=this._channel;if(!this.isOpen())throw new Error("No opened channel");t.send(JSON.stringify(e))}},{key:"mode",get:function(){return this._mode}}]),e}();t.a=d}).call(t,"modules/RTC/BridgeChannel.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(51),s=n.n(a),c=n(0),u=(n.n(c),n(52)),l=n(9),d=n(13),p=n(15),f=n(3),h=n(1),v=n(7),m=n.n(v),g=n(25),y=n(5),b=n(14),S=n.n(b),_=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),T=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;return void 0!==a?a.call(r):void 0},E=Object(c.getLogger)(e),C=function(e){function t(e){var n=e.deviceId,o=e.facingMode,a=e.mediaType,s=e.resolution,c=e.rtcId,u=e.sourceId,l=e.sourceType,d=e.stream,f=e.track,v=e.videoType;r(this,t);var y=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,null,d,f,function(){return y.emit(p.LOCAL_TRACK_STOPPED)},a,v));return y.rtcId=c,y.sourceId=u,y.sourceType=l,y.resolution=h.a.isFirefox()?null:s,y.deviceId=n,y._prevSetMuted=Promise.resolve(),y._facingMode=o,y._trackEnded=!1,y._bytesSent=null,y._testByteSent=!0,y._realDeviceId=""===y.deviceId?void 0:y.deviceId,y._noDataFromSourceTimeout=null,y._onDeviceListChanged=function(e){y._setRealDeviceIdFromDeviceList(e),void 0!==y.getTrack().readyState||void 0===y._realDeviceId||e.find(function(e){return e.deviceId===y._realDeviceId})||(y._trackEnded=!0)},y.isAudioTrack()&&g.a.isDeviceChangeAvailable("output")&&(y._onAudioOutputDeviceChanged=y.setAudioOutput.bind(y),g.a.addListener(m.a.AUDIO_OUTPUT_DEVICE_CHANGED,y._onAudioOutputDeviceChanged)),g.a.addListener(m.a.DEVICE_LIST_CHANGED,y._onDeviceListChanged),y._initNoDataFromSourceHandlers(),y}return o(t,e),_(t,[{key:"isEnded",value:function(){return"ended"===this.getTrack().readyState||this._trackEnded}},{key:"_initNoDataFromSourceHandlers",value:function(){var e=this;if(this.isVideoTrack()&&this.videoType===S.a.CAMERA){var t=this._onNoDataFromSourceError.bind(this);this._setHandler("track_mute",function(){if(e._checkForCameraIssues()){var n=window.performance.now();e._noDataFromSourceTimeout=setTimeout(t,3e3),e._setHandler("track_unmute",function(){e._clearNoDataFromSourceMuteResources(),y.a.sendEventToAll(e.getType()+".track_unmute",{value:window.performance.now()-n})})}}),this._setHandler("track_ended",t)}}},{key:"_clearNoDataFromSourceMuteResources",value:function(){this._noDataFromSourceTimeout&&(clearTimeout(this._noDataFromSourceTimeout),this._noDataFromSourceTimeout=null),this._setHandler("track_unmute",void 0)}},{key:"_onNoDataFromSourceError",value:function(){this._clearNoDataFromSourceMuteResources(),this._checkForCameraIssues()&&this._fireNoDataFromSourceEvent()}},{key:"_fireNoDataFromSourceEvent",value:function(){this.emit(p.NO_DATA_FROM_SOURCE);var e=this.getType()+".no_data_from_source";y.a.analytics.sendEvent(e);var t={name:e};this.isAudioTrack()&&(t.isReceivingData=this._isReceivingData()),y.a.sendLog(JSON.stringify(t))}},{key:"_setRealDeviceIdFromDeviceList",value:function(e){var t=this.getTrack(),n=e.find(function(e){return e.kind===t.kind+"input"&&e.label===t.label});n&&(this._realDeviceId=n.deviceId)}},{key:"_setStream",value:function(e){T(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_setStream",this).call(this,e),e?(this.storedMSID=this.getMSID(),E.debug("Setting new MSID: "+this.storedMSID+" on "+this)):E.debug("Setting 'null' stream on "+this)}},{key:"mute",value:function(){return this._queueSetMuted(!0)}},{key:"unmute",value:function(){return this._queueSetMuted(!1)}},{key:"_queueSetMuted",value:function(e){var t=this._setMuted.bind(this,e);return this._prevSetMuted=this._prevSetMuted.then(t,t),this._prevSetMuted}},{key:"_setMuted",value:function(e){var t=this;if(this.isMuted()===e)return Promise.resolve();var n=Promise.resolve(),r=function(){return E.info("Mute "+t+": "+e)};if(this.isAudioTrack()||this.videoType===S.a.DESKTOP||!h.a.doesVideoMuteByStreamRemove())r(),this.track&&(this.track.enabled=!e);else if(e)n=new Promise(function(e,n){r(),t._removeStreamFromConferenceAsMute(function(){t._unregisterHandlers(),t._stopStream(),t._setStream(null),e()},n)});else{r();var i={cameraDeviceId:this.getDeviceId(),devices:[f.b],facingMode:this.getCameraFacingMode()};this.resolution&&(i.resolution=this.resolution),n=g.a.obtainAudioAndVideoPermissions(i).then(function(e){var n=t.getType(),r=e.find(function(e){return e.mediaType===n});if(!r)throw new l.a(d.TRACK_NO_STREAM_FOUND);return t._setStream(r.stream),t.track=r.track,t.videoType!==r.videoType&&(E.warn(t+": video type has changed after unmute!",t.videoType,r.videoType),t.videoType=r.videoType),t.containers=t.containers.map(function(e){return g.a.attachMediaStream(e,t.stream)}),t._addStreamToConferenceAsUnmute()})}return n.then(function(){return t._sendMuteStatus(e)}).then(function(){return t.emit(p.TRACK_MUTE_CHANGED,t)})}},{key:"_addStreamToConferenceAsUnmute",value:function(){var e=this;return this.conference?new Promise(function(t,n){e.conference._addLocalTrackAsUnmute(e).then(t,function(e){return n(new Error(e))})}):Promise.resolve()}},{key:"_removeStreamFromConferenceAsMute",value:function(e,t){if(!this.conference)return void e();this.conference._removeLocalTrackAsMute(this).then(e,function(e){return t(new Error(e))})}},{key:"_sendMuteStatus",value:function(e){var t=this;return this.conference&&this.conference.room?new Promise(function(n){t.conference.room[t.isAudioTrack()?"setAudioMute":"setVideoMute"](e,n)}):Promise.resolve()}},{key:"dispose",value:function(){var e=this,n=Promise.resolve();return this.conference&&(n=this.conference.removeTrack(this)),this.stream&&(this._stopStream(),this.detach()),g.a.removeListener(m.a.DEVICE_LIST_CHANGED,this._onDeviceListChanged),this._onAudioOutputDeviceChanged&&g.a.removeListener(m.a.AUDIO_OUTPUT_DEVICE_CHANGED,this._onAudioOutputDeviceChanged),n.then(function(){return T(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispose",e).call(e)})}},{key:"isMuted",value:function(){return!(this.stream&&(!this.isVideoTrack()||this.isActive())&&this.track&&this.track.enabled)}},{key:"_setConference",value:function(e){this.conference=e;for(var t=0;t<this.containers.length;t++)this._maybeFireTrackAttached(this.containers[t])}},{key:"isLocal",value:function(){return!0}},{key:"getDeviceId",value:function(){return this._realDeviceId||this.deviceId}},{key:"getParticipantId",value:function(){return this.conference&&this.conference.myUserId()}},{key:"_setByteSent",value:function(e,t){var n=this;this._bytesSent=t;var r=e.getConnectionState();this._testByteSent&&"connected"===r&&(setTimeout(function(){n._bytesSent<=0&&(E.warn(n+" 'bytes sent' <= 0:                         "+n._bytesSent),n._fireNoDataFromSourceEvent())},3e3),this._testByteSent=!1)}},{key:"getCameraFacingMode",value:function(){if(this.isVideoTrack()&&this.videoType===S.a.CAMERA){var e=void 0;try{e=this.track.getSettings()}catch(e){}return e&&"facingMode"in e?e.facingMode:void 0!==this._facingMode?this._facingMode:s.a.USER}}},{key:"_stopStream",value:function(){this._stopStreamInProgress=!0;try{g.a.stopMediaStream(this.stream)}finally{this._stopStreamInProgress=!1}}},{key:"_switchCamera",value:function(){this.isVideoTrack()&&this.videoType===S.a.CAMERA&&"function"==typeof this.track._switchCamera&&(this.track._switchCamera(),this._facingMode=this._facingMode===s.a.ENVIRONMENT?s.a.USER:s.a.ENVIRONMENT)}},{key:"_checkForCameraIssues",value:function(){return!(!this.isVideoTrack()||this._stopStreamInProgress||this.videoType===S.a.DESKTOP||this._isReceivingData())}},{key:"_isReceivingData",value:function(){return!!this.stream&&this.stream.getTracks().some(function(e){return!("readyState"in e&&"live"!==e.readyState||"muted"in e&&!0===e.muted)})}},{key:"toString",value:function(){return"LocalTrack["+this.rtcId+","+this.getType()+"]"}}]),t}(u.a);t.a=C}).call(t,"modules/RTC/JitsiLocalTrack.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(116)),c=n.n(s),u=n(119),l=n(122),d=n(123),p=n(16),f=n.n(p),h=n(10),v=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=Object(a.getLogger)(e),y={stable:"stable",haveLocalOffer:"have-local-offer",haveRemoteOffer:"have-remote-offer",closed:"closed"},b={new:"new",gathering:"gathering",complete:"complete"},S="jitsi-ortc-cname-"+f.a.randomInt(1e4,99999),_=function(e){function t(e){r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return g.debug("constructor() pcConfig:",e),n._bufferedIceCandidates=[],n._closed=!1,n._dtlsTransport=null,n._iceGatherer=null,n._iceGatheringState=b.new,n._iceTransport=null,n._localCapabilities=null,n._localDescription=null,n._localTrackInfos=new Map,n._mids=new Map,n._remoteDescription=null,n._remoteStreams=new Map,n._remoteTrackInfos=new Map,n._sdpGlobalFields={id:h.a.generateSsrc(),version:0},n._signalingState=y.stable,n._setIceGatherer(e),n._setIceTransport(n._iceGatherer),n._setDtlsTransport(n._iceTransport),n}return o(t,e),m(t,[{key:"addIceCandidate",value:function(e){var t=void 0,n=void 0,r=void 0;if(!e)throw new TypeError("candidate missing");if(0==(arguments.length<=1?0:arguments.length-1))t=!0;else{if(t=!1,n=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("addIceCandidate() candidate:",e),t)return this._addIceCandidate(e);this._addIceCandidate(e).then(function(){return n()}).catch(function(e){return r(e)})}},{key:"addStream",value:function(e){g.debug("addStream()"),this._addStream(e)}},{key:"close",value:function(){if(!this._closed){this._closed=!0,g.debug("close()"),this._updateAndEmitSignalingStateChange(y.closed);try{this._iceGatherer.close()}catch(e){g.warn("iceGatherer.close() failed:"+e)}try{this._iceTransport.stop()}catch(e){g.warn("iceTransport.stop() failed:"+e)}try{this._dtlsTransport.stop()}catch(e){g.warn("dtlsTransport.stop() failed:"+e)}var e=!0,t=!1,n=void 0;try{for(var r,i=this._localTrackInfos.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=o.rtpSender;try{a.stop()}catch(e){g.warn("rtpSender.stop() failed:"+e)}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this._localTrackInfos.clear();var s=!0,c=!1,u=void 0;try{for(var l,d=this._remoteTrackInfos.values()[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var p=l.value,f=p.rtpReceiver;try{f.stop()}catch(e){g.warn("rtpReceiver.stop() failed:"+e)}}}catch(e){c=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw u}}this._remoteTrackInfos.clear(),this._remoteStreams.clear()}}},{key:"createAnswer",value:function(){var e=void 0,t=void 0,n=void 0,r=void 0;if(arguments.length<=1)e=!0,t=arguments.length<=0?void 0:arguments[0];else{if(e=!1,n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],t=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("createAnswer() options:",t),e)return this._createAnswer(t);this._createAnswer(t).then(function(e){return n(e)}).catch(function(e){return r(e)})}},{key:"createDataChannel",value:function(){throw g.debug("createDataChannel()"),new Error("createDataChannel() not supported in Edge")}},{key:"createOffer",value:function(){var e=void 0,t=void 0,n=void 0,r=void 0;if(arguments.length<=1)e=!0,t=arguments.length<=0?void 0:arguments[0];else{if(e=!1,n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1],t=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("createOffer() options:",t),e)return this._createOffer(t);this._createOffer(t).then(function(e){return n(e)}).catch(function(e){return r(e)})}},{key:"getLocalStreams",value:function(){return Array.from(this._localTrackInfos.values()).map(function(e){return e.stream}).filter(function(e,t,n){return n.indexOf(e)===t})}},{key:"getRemoteStreams",value:function(){return Array.from(this._remoteStreams.values())}},{key:"getStats",value:function(){var e=void 0,t=void 0,n=void 0,r=void 0;if("function"==typeof(arguments.length<=0?void 0:arguments[0])?(e=!1,n=arguments.length<=0?void 0:arguments[0],r=arguments.length<=1?void 0:arguments[1]):"function"==typeof(arguments.length<=1?void 0:arguments[1])?(e=!1,t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2]):(e=!0,t=arguments.length<=0?void 0:arguments[0]),e||r||(r=function(e){g.error("getStats() failed: "+e),g.error(e.stack)}),e)return this._getStats(t);this._getStats(t).then(function(e){return n(e)}).catch(function(e){return r(e)})}},{key:"removeStream",value:function(e){g.debug("removeStream()"),this._removeStream(e)}},{key:"setLocalDescription",value:function(e){var t=void 0,n=void 0,r=void 0;if(!e)throw new TypeError("description missing");if(0==(arguments.length<=1?0:arguments.length-1))t=!0;else{if(t=!1,n=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("setLocalDescription() desc:",e),t)return this._setLocalDescription(e);this._setLocalDescription(e).then(function(){return n()}).catch(function(e){return r(e)})}},{key:"setRemoteDescription",value:function(e){var t=void 0,n=void 0,r=void 0;if(!e)throw new TypeError("description missing");if(0==(arguments.length<=1?0:arguments.length-1))t=!0;else{if(t=!1,n=arguments.length<=1?void 0:arguments[1],r=arguments.length<=2?void 0:arguments[2],"function"!=typeof n)throw new TypeError("callback missing");if("function"!=typeof r)throw new TypeError("errback missing")}if(g.debug("setRemoteDescription() desc:",e),t)return this._setRemoteDescription(e);this._setRemoteDescription(e).then(function(){return n()}).catch(function(e){return r(e)})}},{key:"_addIceCandidate",value:function(e){return this._closed?Promise.reject(new d.a("RTCPeerConnection closed")):Promise.reject(new Error("addIceCandidate() not supported"))}},{key:"_addStream",value:function(e){if(this._closed)throw new d.a("RTCPeerConnection closed");var t=!0,n=!1,r=void 0;try{for(var i,o=e.getTracks()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if("ended"!==a.readyState)if(this._localTrackInfos.has(a.id))g.warn("ignoring already handled MediaStreamTrack");else{var s=new RTCRtpSender(a,this._dtlsTransport);this._localTrackInfos.set(a.id,{rtpSender:s,stream:e})}else g.warn("ignoring ended MediaStreamTrack")}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var c=!0,u=!1,l=void 0;try{for(var p,f=this._localTrackInfos[Symbol.iterator]();!(c=(p=f.next()).done);c=!0){var h=v(p.value,2),m=h[0],y=h[1],b=y.rtpSender.track;if("ended"===b.readyState){g.warn("_addStream() an already handled track was stopped, track.id:"+b.id);try{y.rtpSender.stop()}catch(e){g.warn("rtpSender.stop() failed:"+e)}this._localTrackInfos.delete(b.id)}else if(y.stream===e&&!e.getTrackById(m)){g.warn("_addStream() a track in this stream was removed, track.id:"+m);try{y.rtpSender.stop()}catch(e){g.warn("rtpSender.stop() failed:"+e)}this._localTrackInfos.delete(b.id)}}}catch(e){u=!0,l=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw l}}this._emitNegotiationNeeded()}},{key:"_createAnswer",value:function(e){if(this._closed)return Promise.reject(new d.a("RTCPeerConnection closed"));if(this.signalingState!==y.haveRemoteOffer)return Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"'));var t=this._createLocalDescription("answer");return Promise.resolve(t)}},{key:"_createLocalDescription",value:function(e){function t(t,o){var u={};switch(u.type=o,o){case"audio":case"video":u.protocol="RTP/SAVPF",u.port=9,u.direction="sendrecv";break;case"application":u.protocol="DTLS/SCTP",u.port=0,u.payloads="0",u.direction="inactive"}u.connection={ip:"127.0.0.1",version:4},u.mid=t,u.iceUfrag=r.usernameFragment,u.icePwd=r.password,u.candidates=[];var d=!0,p=!1,f=void 0;try{for(var v,m=i[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var g=v.value,y={};y.component=1,y.foundation=g.foundation,y.ip=g.ip,y.port=g.port,y.priority=g.priority,y.transport=g.protocol.toLowerCase(),y.type=g.type,"tcp"===y.transport&&(y.tcptype=g.tcpType),u.candidates.push(y)}}catch(e){p=!0,f=e}finally{try{!d&&m.return&&m.return()}finally{if(p)throw f}}if(u.endOfCandidates="end-of-candidates",u.setup="offer"===e?"actpass":"server"===a.role?"active":"passive","audio"===o||"video"===o){u.rtp=[],u.rtcpFb=[],u.fmtp=[];var b=[],_=!0,T=!1,E=void 0;try{for(var C,w=s.codecs[Symbol.iterator]();!(_=(C=w.next()).done);_=!0){var R=C.value;if(!R.kind||R.kind===o){b.push(R.preferredPayloadType);var k={codec:R.name,payload:R.preferredPayloadType,rate:R.clockRate};if(R.numChannels>1&&(k.encoding=R.numChannels),u.rtp.push(k),R.parameters){var I={config:"",payload:R.preferredPayloadType},P=!0,A=!1,D=void 0;try{for(var O,L=Object.keys(R.parameters)[Symbol.iterator]();!(P=(O=L.next()).done);P=!0){var N=O.value;I.config&&(I.config+=";"),I.config+=N+"="+R.parameters[N]}}catch(e){A=!0,D=e}finally{try{!P&&L.return&&L.return()}finally{if(A)throw D}}I.config&&u.fmtp.push(I)}var M=!0,x=!1,F=void 0;try{for(var j,U=(R.rtcpFeedback||[])[Symbol.iterator]();!(M=(j=U.next()).done);M=!0){var B=j.value;u.rtcpFb.push({payload:R.preferredPayloadType,subtype:B.parameter||void 0,type:B.type})}}catch(e){x=!0,F=e}finally{try{!M&&U.return&&U.return()}finally{if(x)throw F}}}}}catch(e){T=!0,E=e}finally{try{!_&&w.return&&w.return()}finally{if(T)throw E}}0===b.length?(u.payloads="9",u.port=0,u.direction="inactive"):u.payloads=b.join(" "),u.ssrcs=[],u.ssrcGroups=[];var G=!0,J=!1,H=void 0;try{for(var V,W=c.values()[Symbol.iterator]();!(G=(V=W.next()).done);G=!0){var K=V.value,q=K.rtpSender,z=K.stream.id,Q=q.track;if("ended"!==Q.readyState&&Q.kind===o){K.ssrc||(K.ssrc=h.a.generateSsrc());var $=l&&"video"===Q.kind;$&&!K.rtxSsrc&&(K.rtxSsrc=K.ssrc+1),u.ssrcs.push({attribute:"cname",id:K.ssrc,value:S}),u.ssrcs.push({attribute:"msid",id:K.ssrc,value:z+" "+Q.id}),u.ssrcs.push({attribute:"mslabel",id:K.ssrc,value:z}),u.ssrcs.push({attribute:"label",id:K.ssrc,value:Q.id}),$&&(u.ssrcs.push({attribute:"cname",id:K.rtxSsrc,value:S}),u.ssrcs.push({attribute:"msid",id:K.rtxSsrc,value:z+" "+Q.id}),u.ssrcs.push({attribute:"mslabel",id:K.rtxSsrc,value:z}),u.ssrcs.push({attribute:"label",id:K.rtxSsrc,value:Q.id}),u.ssrcGroups.push({semantics:"FID",ssrcs:K.ssrc+" "+K.rtxSsrc}))}}}catch(e){J=!0,H=e}finally{try{!G&&W.return&&W.return()}finally{if(J)throw H}}u.ext=[];var X=!0,Y=!1,Z=void 0;try{for(var ee,te=s.headerExtensions[Symbol.iterator]();!(X=(ee=te.next()).done);X=!0){var ne=ee.value;ne.kind&&ne.kind!==o||u.ext.push({value:ne.preferredId,uri:ne.uri})}}catch(e){Y=!0,Z=e}finally{try{!X&&te.return&&te.return()}finally{if(Y)throw Z}}u.rtcpMux="rtcp-mux",u.rtcpRsize="rtcp-rsize"}n.media.push(u)}var n={},r=this._iceGatherer.getLocalParameters(),i=this._iceGatherer.getLocalCandidates(),o=this._dtlsTransport.getLocalParameters(),a=this._dtlsTransport.getRemoteParameters(),s=this._localCapabilities,c=this._localTrackInfos;"offer"===e&&this._sdpGlobalFields.version++,n.version=0,n.origin={address:"127.0.0.1",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"jitsi-ortc-webrtc-shim"},n.name="-",n.timing={start:0,stop:0},n.msidSemantic={semantic:"WMS",token:"*"},n.groups=[{mids:Array.from(this._mids.keys()).join(" "),type:"BUNDLE"}],n.media=[],n.fingerprint={hash:o.fingerprints[0].value,type:o.fingerprints[0].algorithm};var l=!1,d=!0,p=!1,f=void 0;try{for(var m,y=s.codecs[Symbol.iterator]();!(d=(m=y.next()).done);d=!0){var b=m.value;if("video"===b.kind&&"rtx"===b.name){l=!0;break}}}catch(e){p=!0,f=e}finally{try{!d&&y.return&&y.return()}finally{if(p)throw f}}var _=!0,T=!1,E=void 0;try{for(var C,w=this._mids[Symbol.iterator]();!(_=(C=w.next()).done);_=!0){var R=v(C.value,2),k=R[0],I=R[1];t.call(this,k,I)}}catch(e){T=!0,E=e}finally{try{!_&&w.return&&w.return()}finally{if(T)throw E}}var P=new u.a({type:e,_sdpObject:n});return g.debug("_createLocalDescription():",P),P}},{key:"_createOffer",value:function(e){return this._closed?Promise.reject(new d.a("RTCPeerConnection closed")):this.signalingState!==y.stable?Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"')):Promise.reject(new Error("createoOffer() not yet supported"))}},{key:"_emitAddStream",value:function(e){if(!this._closed){g.debug('emitting "addstream"');var t=new c.a.Event("addstream");t.stream=e,this.dispatchEvent(t)}}},{key:"_emitBufferedIceCandidates",value:function(){if(!this._closed){var e=!0,t=!1,n=void 0;try{for(var r,i=this._bufferedIceCandidates[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(o){o.sdpMIndex=this._mids.keys().next().value,g.debug('emitting buffered "icecandidate", candidate:',o);var a=new c.a.Event("icecandidate");a.candidate=o,this.dispatchEvent(a)}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this._bufferedIceCandidates=[]}}},{key:"_emitConnectionStateChange",value:function(){if(!this._closed||"closed"===this.connectionState){g.debug('emitting "connectionstatechange", connectionState:',this.connectionState);var e=new c.a.Event("connectionstatechange");this.dispatchEvent(e)}}},{key:"_emitIceCandidate",value:function(e){if(!this._closed){var t=null;if(e){var n=this._mids.keys().next().value,r="candidate:"+e.foundation+" 1 "+e.protocol+" "+e.priority+" "+e.ip+" "+e.port+" typ "+e.type;e.relatedAddress&&(r+=" raddr "+e.relatedAddress),e.relatedPort&&(r+=" rport "+e.relatedPort),"tcp"===e.protocol&&(r+=" tcptype "+e.tcpType),t={candidate:r,component:1,foundation:e.foundation,ip:e.ip,port:e.port,priority:e.priority,protocol:e.protocol,type:e.type,sdpMIndex:n,sdpMLineIndex:0},"tcp"===e.protocol&&(t.tcptype=e.tcpType),e.relatedAddress&&(t.relatedAddress=e.relatedAddress),e.relatedPort&&(t.relatedPort=e.relatedPort)}if(this._localDescription){g.debug('emitting "icecandidate", candidate:',t);var i=new c.a.Event("icecandidate");i.candidate=t,this.dispatchEvent(i)}else g.debug("buffering gathered ICE candidate:",t),this._bufferedIceCandidates.push(t)}}},{key:"_emitIceConnectionStateChange",value:function(){if(!this._closed||"closed"===this.iceConnectionState){g.debug('emitting "iceconnectionstatechange", iceConnectionState:',this.iceConnectionState);var e=new c.a.Event("iceconnectionstatechange");this.dispatchEvent(e)}}},{key:"_emitNegotiationNeeded",value:function(){if(this.signalingState===y.stable){g.debug('emitting "negotiationneeded"');var e=new c.a.Event("negotiationneeded");this.dispatchEvent(e)}}},{key:"_emitRemoveStream",value:function(e){if(!this._closed){g.debug('emitting "removestream"');var t=new c.a.Event("removestream");t.stream=e,this.dispatchEvent(t)}}},{key:"_getParametersForRtpReceiver",value:function(e,t){var n=t.ssrc,r=t.rtxSsrc,i=t.cname,o=this._localCapabilities,a={codecs:[],degradationPreference:"balanced",encodings:[],headerExtensions:[],muxId:"",rtcp:{cname:i,compound:!0,mux:!0,reducedSize:!0}},s=[],c=void 0,u=!0,l=!1,d=void 0;try{for(var p,f=o.codecs[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value;if(h.kind===e&&"rtx"!==h.name){c=h.preferredPayloadType,s.push({clockRate:h.clockRate,maxptime:h.maxptime,mimeType:h.mimeType,name:h.name,numChannels:h.numChannels,parameters:h.parameters,payloadType:h.preferredPayloadType,ptime:h.ptime,rtcpFeedback:h.rtcpFeedback});break}}}catch(e){l=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(l)throw d}}if(r){var v=!0,m=!1,g=void 0;try{for(var y,b=o.codecs[Symbol.iterator]();!(v=(y=b.next()).done);v=!0){var S=y.value;if(S.kind===e&&"rtx"===S.name){s.push({clockRate:S.clockRate,mimeType:S.mimeType,name:"rtx",parameters:S.parameters,payloadType:S.preferredPayloadType,rtcpFeedback:S.rtcpFeedback});break}}}catch(e){m=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(m)throw g}}}a.codecs=s;var _={active:!0,codecPayloadType:c,ssrc:n};r&&(_.rtx={ssrc:r}),a.encodings.push(_);var T=!0,E=!1,C=void 0;try{for(var w,R=o.headerExtensions[Symbol.iterator]();!(T=(w=R.next()).done);T=!0){var k=w.value;k.kind===e&&a.headerExtensions.push({encrypt:k.preferredEncrypt,id:k.preferredId,uri:k.uri})}}catch(e){E=!0,C=e}finally{try{!T&&R.return&&R.return()}finally{if(E)throw C}}return a}},{key:"_getParametersForRtpSender",value:function(e,t){var n=t.ssrc,r=t.rtxSsrc,i=S,o=this._localCapabilities,a={codecs:[],degradationPreference:"balanced",encodings:[],headerExtensions:[],muxId:"",rtcp:{cname:i,compound:!0,mux:!0,reducedSize:!0}},s=[],c=void 0,u=!0,l=!1,d=void 0;try{for(var p,f=o.codecs[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value;if(h.kind===e&&"rtx"!==h.name){c=h.preferredPayloadType,s.push({clockRate:h.clockRate,maxptime:h.maxptime,mimeType:h.mimeType,name:h.name,numChannels:h.numChannels,parameters:h.parameters,payloadType:h.preferredPayloadType,ptime:h.ptime,rtcpFeedback:h.rtcpFeedback});break}}}catch(e){l=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(l)throw d}}if(r){var v=!0,m=!1,g=void 0;try{for(var y,b=o.codecs[Symbol.iterator]();!(v=(y=b.next()).done);v=!0){var _=y.value;if(_.kind===e&&"rtx"===_.name){s.push({clockRate:_.clockRate,mimeType:_.mimeType,name:"rtx",parameters:_.parameters,payloadType:_.preferredPayloadType,rtcpFeedback:_.rtcpFeedback});break}}}catch(e){m=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(m)throw g}}}a.codecs=s;var T={active:!0,codecPayloadType:c,ssrc:n};r&&(T.rtx={ssrc:r}),a.encodings.push(T);var E=!0,C=!1,w=void 0;try{for(var R,k=o.headerExtensions[Symbol.iterator]();!(E=(R=k.next()).done);E=!0){var I=R.value;I.kind===e&&a.headerExtensions.push({encrypt:I.preferredEncrypt,id:I.preferredId,uri:I.uri})}}catch(e){C=!0,w=e}finally{try{!E&&k.return&&k.return()}finally{if(C)throw w}}return a}},{key:"_getStats",value:function(e){if(this._closed)return Promise.reject(new d.a("RTCPeerConnection closed"));var t=this._iceGatherer,n=this._iceTransport,r=[],i=[],o=[],a=!0,s=!1,c=void 0;try{for(var u,l=this._localTrackInfos.values()[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var p=u.value,f=p.rtpSender;p.sending&&r.push(f)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}var h=!0,v=!1,m=void 0;try{for(var g,y=this._remoteTrackInfos.values()[Symbol.iterator]();!(h=(g=y.next()).done);h=!0){var b=g.value,S=b.rtpReceiver;i.push(S)}}catch(e){v=!0,m=e}finally{try{!h&&y.return&&y.return()}finally{if(v)throw m}}t&&o.push(t.getStats().catch(function(){return null})),n&&(o.push(n.getStats().catch(function(){return null})),"function"==typeof n.msGetStats&&o.push(n.msGetStats().catch(function(){return null})));var _=!0,T=!1,E=void 0;try{for(var C,w=r[Symbol.iterator]();!(_=(C=w.next()).done);_=!0)!function(){var e=C.value,t="audio"===e.track.kind;o.push(e.getStats().then(function(e){if(!t){var n=!0,r=!1,i=void 0;try{for(var o,a=Object.keys(e)[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=e[s];"track"===c.type&&delete c.audioLevel}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}return e}).catch(function(){return null}))}()}catch(e){T=!0,E=e}finally{try{!_&&w.return&&w.return()}finally{if(T)throw E}}var R=!0,k=!1,I=void 0;try{for(var P,A=i[Symbol.iterator]();!(R=(P=A.next()).done);R=!0)!function(){var e=P.value,t="audio"===e.track.kind;o.push(e.getStats().then(function(e){if(!t){var n=!0,r=!1,i=void 0;try{for(var o,a=Object.keys(e)[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=e[s];"track"===c.type&&delete c.audioLevel}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}}return e}).catch(function(){return null}))}()}catch(e){k=!0,I=e}finally{try{!R&&A.return&&A.return()}finally{if(k)throw I}}return Promise.all(o).then(function(e){var t={},n=!0,r=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;if(s){var c=!0,u=!1,l=void 0;try{for(var d,p=Object.keys(s)[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value;t[f]=s[f]}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}}}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t})}},{key:"_handleLocalInitialAnswer",value:function(e){g.debug("_handleLocalInitialAnswer(), desc:",e);var t=e.sdpObject;this._localCapabilities=l.a(t),g.debug("local capabilities:",this._localCapabilities)}},{key:"_handleLocalReAnswer",value:function(e){g.debug("_handleLocalReAnswer(), desc:",e);var t=e.sdpObject;this._localCapabilities=l.a(t),g.debug("local capabilities:",this._localCapabilities)}},{key:"_handleRemoteInitialOffer",value:function(e){g.debug("_handleRemoteInitialOffer(), desc:",e);var t=e.sdpObject;this._mids=l.e(t);var n=l.a(t);g.debug("remote capabilities:",n),this._localCapabilities=l.g(n),this._startIceAndDtls(e)}},{key:"_handleRemoteReOffer",value:function(e){g.debug("_handleRemoteReOffer(), desc:",e);var t=e.sdpObject;this._mids=l.e(t);var n=l.a(t);g.debug("remote capabilities:",n),this._localCapabilities=l.g(n)}},{key:"_receiveMedia",value:function(){g.debug("_receiveMedia()");var e=new Set(this._remoteTrackInfos.keys()),t=l.f(this._remoteDescription.sdpObject),n=new Map,r=new Map,i=new Map;g.debug("_receiveMedia() remote track infos:",t);var o=!0,a=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var d=v(c.value,2),p=d[0],f=d[1];if(!e.has(p)){g.debug("_receiveMedia() new remote track, ssrc:"+p),this._remoteTrackInfos.set(p,f);var h=f.kind,m=f.rtxSsrc,y=f.streamId,b=f.trackId,S=f.cname,_=!this._remoteStreams.has(y),T=void 0;_?(g.debug("_receiveMedia() new remote stream, id:"+y),T=new MediaStream,T.jitsiRemoteId=y,n.set(y,T),this._remoteStreams.set(y,T)):T=this._remoteStreams.get(y);var E=new RTCRtpReceiver(this._dtlsTransport,h),C=this._getParametersForRtpReceiver(h,{ssrc:p,rtxSsrc:m,cname:S});f.track=E.track,E.onerror=function(e){g.error('rtpReceiver "error" event, event:'),g.error(e)},f.stream=T,f.rtpReceiver=E,g.debug("calling rtpReceiver.receive(), parameters:",C);try{E.receive(C);var w=f.track;w.jitsiRemoteId=b,T.addTrack(w),n.has(y)||r.set(w,T)}catch(e){g.error("rtpReceiver.receive() failed:"+e.message),g.error(e)}}}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}var R=!0,k=!1,I=void 0;try{for(var P,A=e[Symbol.iterator]();!(R=(P=A.next()).done);R=!0){var p=P.value;if(!t.has(p)){g.debug("_receiveMedia() remote track removed, ssrc:"+p);var f=this._remoteTrackInfos.get(p),D=f.stream,O=f.track,L=f.rtpReceiver;try{L.stop()}catch(e){g.warn("rtpReceiver.stop() failed:"+e)}i.set(O,D),D.removeTrack(O),this._remoteTrackInfos.delete(p)}}}catch(e){k=!0,I=e}finally{try{!R&&A.return&&A.return()}finally{if(k)throw I}}var N=!0,M=!1,x=void 0;try{for(var F,j=r[Symbol.iterator]();!(N=(F=j.next()).done);N=!0){var U=v(F.value,2),B=U[0],G=U[1],J=new Event("addtrack");J.track=B,G.dispatchEvent(J)}}catch(e){M=!0,x=e}finally{try{!N&&j.return&&j.return()}finally{if(M)throw x}}var H=!0,V=!1,W=void 0;try{for(var K,q=i[Symbol.iterator]();!(H=(K=q.next()).done);H=!0){var z=v(K.value,2),Q=z[0],$=z[1],X=new Event("removetrack");X.track=Q,$.dispatchEvent(X)}}catch(e){V=!0,W=e}finally{try{!H&&q.return&&q.return()}finally{if(V)throw W}}var Y=!0,Z=!1,ee=void 0;try{for(var te,ne=n.values()[Symbol.iterator]();!(Y=(te=ne.next()).done);Y=!0){var re=te.value;0===re.getTracks().length?(g.warn("ignoring new stream for which no track could be added"),n.delete(re.jitsiRemoteId),this._remoteStreams.delete(re.jitsiRemoteId)):this._emitAddStream(re)}}catch(e){Z=!0,ee=e}finally{try{!Y&&ne.return&&ne.return()}finally{if(Z)throw ee}}var ie=!0,oe=!1,ae=void 0;try{for(var se,ce=this._remoteStreams[Symbol.iterator]();!(ie=(se=ce.next()).done);ie=!0){var ue=v(se.value,2),le=ue[0],de=ue[1];de.getTracks().length>0||(this._remoteStreams.delete(le),this._emitRemoveStream(de))}}catch(e){oe=!0,ae=e}finally{try{!ie&&ce.return&&ce.return()}finally{if(oe)throw ae}}}},{key:"_removeStream",value:function(e){if(this._closed)throw new d.a("RTCPeerConnection closed");var t=!0,n=!1,r=void 0;try{for(var i,o=e.getTracks()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(this._localTrackInfos.has(a.id)){var s=this._localTrackInfos.get(a.id).rtpSender;try{s.stop()}catch(e){g.warn("rtpSender.stop() failed:"+e)}this._localTrackInfos.delete(a.id)}}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this._emitNegotiationNeeded()}},{key:"_sendMedia",value:function(){g.debug("_sendMedia()");var e=!0,t=!1,n=void 0;try{for(var r,i=this._localTrackInfos.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(!o.sending){var a=o.rtpSender,s=o.ssrc,c=o.rtxSsrc,u=a.track,l=u.kind,d=this._getParametersForRtpSender(l,{ssrc:s,rtxSsrc:c});g.debug("calling rtpSender.send(), parameters:",d);try{a.send(d),o.sending=!0}catch(e){g.error("rtpSender.send() failed:"+e.message),g.error(e)}}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"_setDtlsTransport",value:function(e){var t=this,n=new RTCDtlsTransport(e);n.onstatechange=function(){g.debug('dtlsTransport "statechange" event, state:'+n.state),t._emitConnectionStateChange()},n.ondtlsstatechange=function(){g.debug('dtlsTransport "dtlsstatechange" event, state:'+n.state),t._emitConnectionStateChange()},n.onerror=function(e){var n=void 0;e.message?n=e.message:e.error&&(n=e.error.message),g.error('dtlsTransport "error" event, message:'+n),t._emitConnectionStateChange()},this._dtlsTransport=n}},{key:"_setIceGatherer",value:function(e){var t=this,n={gatherPolicy:e.iceTransportPolicy||"all",iceServers:e.iceServers||[]},r=new RTCIceGatherer(n);r.onstatechange=function(){g.debug('iceGatherer "statechange" event, state:'+r.state),t._updateAndEmitIceGatheringStateChange(r.state)},r.onlocalcandidate=function(e){var n=e.candidate,r=e.complete;g.debug('iceGatherer "localcandidate" event, candidate:',n),r||!n||0===Object.keys(n).length?(n=null,t._updateAndEmitIceGatheringStateChange(b.complete),t._emitIceCandidate(null)):t._emitIceCandidate(n)},r.onerror=function(e){var t=e.errorCode,n=e.errorText;g.error('iceGatherer "error" event, errorCode:'+t+", errorText:"+n)};try{r.gather()}catch(e){g.warn("iceGatherer.gather() failed:"+e)}this._iceGatherer=r}},{key:"_setIceTransport",value:function(e){var t=this,n=new RTCIceTransport(e);n.onstatechange=function(){g.debug('iceTransport "statechange" event, state:'+n.state),t._emitIceConnectionStateChange()},n.onicestatechange=function(){g.debug('iceTransport "icestatechange" event, state:'+n.state),"completed"===n.state&&g.debug("nominated candidate pair:",n.getNominatedCandidatePair()),t._emitIceConnectionStateChange()},n.oncandidatepairchange=function(e){g.debug('iceTransport "candidatepairchange" event, pair:'+e.pair)},this._iceTransport=n}},{key:"_setLocalDescription",value:function(e){var t=this;if(this._closed)return Promise.reject(new d.a("RTCPeerConnection closed"));var n=void 0;try{n=new u.a(e)}catch(e){return Promise.reject(new TypeError("invalid RTCSessionDescriptionInit: "+e))}switch(e.type){case"offer":return this.signalingState!==y.stable?Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"')):Promise.reject(new TypeError('setLocalDescription() with type "offer" not supported'));case"answer":if(this.signalingState!==y.haveRemoteOffer)return Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"'));var r=Boolean(!this._localDescription);return Promise.resolve().then(function(){return r?t._handleLocalInitialAnswer(n):t._handleLocalReAnswer(n)}).then(function(){g.debug("setLocalDescription() succeed"),t._localDescription=n,t._updateAndEmitSignalingStateChange(y.stable),r&&t._emitBufferedIceCandidates(),t._sendMedia(),t._receiveMedia()}).catch(function(e){throw g.error("setLocalDescription() failed: "+e.message),g.error(e),e});default:return Promise.reject(new TypeError('unsupported description.type "'+e.type+'"'))}}},{key:"_setRemoteDescription",value:function(e){var t=this;if(this._closed)return Promise.reject(new d.a("RTCPeerConnection closed"));var n=void 0;try{n=new u.a(e)}catch(e){return Promise.reject(new TypeError("invalid RTCSessionDescriptionInit: "+e))}switch(e.type){case"offer":if(this.signalingState!==y.stable)return Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"'));var r=Boolean(!this._remoteDescription);return Promise.resolve().then(function(){return r?t._handleRemoteInitialOffer(n):t._handleRemoteReOffer(n)}).then(function(){g.debug("setRemoteDescription() succeed"),t._remoteDescription=n,t._updateAndEmitSignalingStateChange(y.haveRemoteOffer)}).catch(function(e){throw g.error("setRemoteDescription() failed: "+e),e});case"answer":return this.signalingState!==y.haveLocalOffer?Promise.reject(new d.a('invalid signalingState "'+this.signalingState+'"')):Promise.reject(new TypeError('setRemoteDescription() with type "answer" not supported'));default:return Promise.reject(new TypeError('unsupported description.type "'+e.type+'"'))}}},{key:"_startIceAndDtls",value:function(e){var t=e.sdpObject,n=l.d(t),r=l.c(t),i=l.b(t);switch(e.type){case"offer":this._iceTransport.start(this._iceGatherer,n,"controlled");break;case"answer":this._iceTransport.start(this._iceGatherer,n,"controlling")}var o=!0,a=!1,s=void 0;try{for(var c,u=r[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var d=c.value;0!==d.port&&9!==d.port&&this._iceTransport.addRemoteCandidate(d)}}catch(e){a=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw s}}switch(this._iceTransport.addRemoteCandidate({}),e.type){case"offer":i.role="server";break;case"answer":i.role="client"}this._dtlsTransport.start(i)}},{key:"_updateAndEmitIceGatheringStateChange",value:function(e){if(!this._closed&&e!==this.iceGatheringState){this._iceGatheringState=e,g.debug('emitting "icegatheringstatechange", iceGatheringState:',this.iceGatheringState);var t=new c.a.Event("icegatheringstatechange");this.dispatchEvent(t)}}},{key:"_updateAndEmitSignalingStateChange",value:function(e){if(e!==this.signalingState){this._signalingState=e,g.debug('emitting "signalingstatechange", signalingState:',this.signalingState);var t=new c.a.Event("signalingstatechange");this.dispatchEvent(t)}}},{key:"connectionState",get:function(){return this._dtlsTransport.state}},{key:"iceConnectionState",get:function(){return this._iceTransport.state}},{key:"iceGatheringState",get:function(){return this._iceGatheringState}},{key:"localDescription",get:function(){return this._localDescription}},{key:"remoteDescription",get:function(){return this._remoteDescription}},{key:"signalingState",get:function(){return this._signalingState}}]),t}(c.a.EventTarget);t.a=_}).call(t,"modules/RTC/ortc/RTCPeerConnection.js")},function(e,t,n){e.exports={EventTarget:n(117),Event:n(118)}},function(e,t){function n(){this._listeners={}}Object.defineProperties(n.prototype,{listeners:{get:function(){return this._listeners}}}),n.prototype.addEventListener=function(e,t){var n,r,i;if(e&&t){for(n=this._listeners[e],void 0===n&&(this._listeners[e]=n=[]),r=0;i=n[r];r++)if(i===t)return;n.push(t)}},n.prototype.removeEventListener=function(e,t){var n,r,i;if(e&&t&&void 0!==(n=this._listeners[e])){for(r=0;i=n[r];r++)if(i===t){n.splice(r,1);break}0===n.length&&delete this._listeners[e]}},n.prototype.dispatchEvent=function(e){var t,n,r,i,o,a=!1;if(!e||"string"!=typeof e.type)throw new Error("`event` must have a valid `type` property");e._yaeti&&(e.target=this,e.cancelable=!0);try{e.stopImmediatePropagation=function(){a=!0}}catch(e){}if(t=e.type,n=this._listeners[t]||[],"function"==typeof(r=this["on"+t]))try{r.call(this,e)}catch(e){console.error(e)}for(i=0;(o=n[i])&&!a;i++)try{o.call(this,e)}catch(e){console.error(e)}return!e.defaultPrevented},e.exports=n},function(e,t,n){(function(t){e.exports=t.Event}).call(t,n(20))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(11),o=n.n(i),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(){function e(t){switch(r(this,e),this._sdp=null,this._sdpObject=null,this._type=null,t.type){case"offer":case"answer":break;default:throw new TypeError('invalid type "'+t.type+'"')}if(this._type=t.type,"string"==typeof t.sdp){this._sdp=t.sdp;try{this._sdpObject=o.a.parse(t.sdp)}catch(e){throw new Error("invalid sdp: "+e)}}else{if("object"!==a(t._sdpObject))throw new TypeError("invalid sdp or _sdpObject");this._sdpObject=t._sdpObject;try{this._sdp=o.a.write(t._sdpObject)}catch(e){throw new Error("invalid sdp object: "+e)}}}return s(e,[{key:"toJSON",value:function(){return{sdp:this._sdp,type:this._type}}},{key:"sdp",get:function(){return this._sdp},set:function(e){try{this._sdpObject=o.a.parse(e)}catch(e){throw new Error("invalid sdp: "+e)}this._sdp=e}},{key:"sdpObject",get:function(){return this._sdpObject}},{key:"type",get:function(){return this._type}}]),e}();t.a=c},function(e,t,n){var r=function(e){return String(Number(e))===e?Number(e):e},i=function(e,t,n,i){if(i&&!n)t[i]=r(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(t[n[o]]=r(e[o+1]))},o=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var o=e.push?{}:r?t[e.name]:t;i(n.match(e.reg),o,e.names,e.name),e.push&&t[e.push].push(o)},a=n(53),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},n=[],r=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],i=e.slice(2);"m"===t&&(n.push({rtp:[],fmtp:[]}),r=n[n.length-1]);for(var s=0;s<(a[t]||[]).length;s+=1){var c=a[t][s];if(c.reg.test(i))return o(c,r,i)}}),t.media=n,t};var c=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length&&(e[n[0]]=r(n[1])),e};t.parseParams=function(e){return e.split(/\;\s?/).reduce(c,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(r),i=0;i<n.length;i+=3)t.push({component:n[i],ip:n[i+1],port:n[i+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=r(e):(t=r(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},function(e,t,n){var r=n(53),i=/%[sdv%]/g,o=function(e){var t=1,n=arguments,r=n.length;return e.replace(i,function(e){if(t>=r)return e;var i=n[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}})},a=function(e,t,n){var r=t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format,i=[e+"="+r];if(t.names)for(var a=0;a<t.names.length;a+=1){var s=t.names[a];t.name?i.push(n[t.name][s]):i.push(n[t.names[a]])}else i.push(n[t.name]);return o.apply(null,i)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||s,i=t.innerOrder||c,o=[];return n.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})}),e.media.forEach(function(e){o.push(a("m",r.m[0],e)),i.forEach(function(t){r[t].forEach(function(n){n.name in e&&null!=e[n.name]?o.push(a(t,n,e)):n.push in e&&null!=e[n.push]&&e[n.push].forEach(function(e){o.push(a(t,n,e))})})})}),o.join("\r\n")+"\r\n"}},function(e,t,n){"use strict";function r(e){var t=new Map,n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e.media[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value,u=c.type;if("audio"===u||"video"===u){var l=!0,d=!1,f=void 0;try{for(var h,v=c.rtp[Symbol.iterator]();!(l=(h=v.next()).done);l=!0){var m=h.value,g={clockRate:m.rate,kind:u,mimeType:u+"/"+m.codec,name:m.codec,numChannels:m.encoding||1,parameters:{},preferredPayloadType:m.payload,rtcpFeedback:[]};t.set(g.preferredPayloadType,g)}}catch(e){d=!0,f=e}finally{try{!l&&v.return&&v.return()}finally{if(d)throw f}}var y=!0,b=!1,S=void 0;try{for(var _,T=(c.fmtp||[])[Symbol.iterator]();!(y=(_=T.next()).done);y=!0){var E=_.value,C=p.a.parseFmtpConfig(E.config),w=t.get(E.payload);w&&(w.parameters=C)}}catch(e){b=!0,S=e}finally{try{!y&&T.return&&T.return()}finally{if(b)throw S}}var R=!0,k=!1,I=void 0;try{for(var P,A=(c.rtcpFb||[])[Symbol.iterator]();!(R=(P=A.next()).done);R=!0){var D=P.value,O=t.get(D.payload);O&&O.rtcpFeedback.push({parameter:D.subtype||"",type:D.type})}}catch(e){k=!0,I=e}finally{try{!R&&A.return&&A.return()}finally{if(k)throw I}}var L=!0,N=!1,M=void 0;try{for(var x,F=(c.ext||[])[Symbol.iterator]();!(L=(x=F.next()).done);L=!0)!function(){var e=x.value,t=e.value,r=e.uri,i={kind:u,uri:r,preferredId:t};n.find(function(e){return i.kind===e.kind&&i.uri===e.uri})||n.push(i)}()}catch(e){N=!0,M=e}finally{try{!L&&F.return&&F.return()}finally{if(N)throw M}}}}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return{codecs:Array.from(t.values()),fecMechanisms:[],headerExtensions:n}}function i(e){var t=l(e),n=t.fingerprint||e.fingerprint,r=void 0;switch(t.setup){case"active":r="client";break;case"passive":r="server";break;case"actpass":r="auto"}return{role:r,fingerprints:[{algorithm:n.type,value:n.hash}]}}function o(e){var t=l(e),n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t.candidates[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;if(1===c.component){var u={foundation:c.foundation,ip:c.ip,port:c.port,priority:c.priority,protocol:c.transport.toLowerCase(),type:c.type};n.push(u)}}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}function a(e){var t=l(e),n=t.iceUfrag,r=t.icePwd;return{icelite:"ice-lite"===e.icelite,password:r,usernameFragment:n}}function s(e){var t=new Map,n=!0,r=!1,i=void 0;try{for(var o,a=e.media[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;t.set(s.mid,s.type)}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}return t}function c(e){var t=new Map,n=new Map,r=new Set,i=!0,o=!1,a=void 0;try{for(var s,c=e.media[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=u.type;if("audio"===l||"video"===l){var d=!0,p=!1,f=void 0;try{for(var h,v=(u.ssrcGroups||[])[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var m=h.value;if("FID"===m.semantics){var g=m.ssrcs.split(" ").map(function(e){return Number(e)}),y=g[0],b=g[1];n.set(y,b),r.add(b)}}}catch(e){p=!0,f=e}finally{try{!d&&v.return&&v.return()}finally{if(p)throw f}}var S=!0,_=!1,T=void 0;try{for(var E,C=(u.ssrcs||[])[Symbol.iterator]();!(S=(E=C.next()).done);S=!0){var w=E.value,R=w.id;if(!r.has(R)){var k=t.get(R);switch(k||(k={kind:l,rtxSsrc:n.get(R),ssrc:R},t.set(R,k)),w.attribute){case"cname":k.cname=w.value;break;case"msid":var I=w.value.split(" "),P=I[0],A=I[1];k.streamId=P,k.trackId=A;break;case"mslabel":var D=w.value;k.streamId=D;break;case"label":var O=w.value;k.trackId=O}}}}catch(e){_=!0,T=e}finally{try{!S&&C.return&&C.return()}finally{if(_)throw T}}}}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return t}function u(e){var t=RTCRtpReceiver.getCapabilities(),n={codecs:[],fecMechanisms:[],headerExtensions:[]},r=new Map,i=!0,o=!1,a=void 0;try{for(var s,c=e.codecs[Symbol.iterator]();!(i=(s=c.next()).done);i=!0)!function(){var e=s.value,i=e.name.toLowerCase();if("rtx"===i)return r.set(e.parameters.apt,e.preferredPayloadType),"continue";var o=t.codecs.find(function(t){return t.name.toLowerCase()===i&&t.kind===e.kind&&t.clockRate===e.clockRate});if(!o)return"continue";var a={clockRate:o.clockRate,kind:o.kind,mimeType:o.kind+"/"+o.name,name:o.name,numChannels:o.numChannels||1,parameters:{},preferredPayloadType:e.preferredPayloadType,rtcpFeedback:[]},c=!0,u=!1,l=void 0;try{for(var d,p=Object.keys(e.parameters)[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value,h=e.parameters[f],v=!0,m=!1,g=void 0;try{for(var y,b=Object.keys(o.parameters)[Symbol.iterator]();!(v=(y=b.next()).done);v=!0){var S=y.value,_=o.parameters[S];if(S===f&&_===h){a.parameters[S]=_;break}}}catch(e){m=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(m)throw g}}}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}var T=!0,E=!1,C=void 0;try{for(var w,R=e.rtcpFeedback[Symbol.iterator]();!(T=(w=R.next()).done);T=!0)!function(){var e=w.value,t=o.rtcpFeedback.find(function(t){return t.type===e.type&&t.parameter===e.parameter});t&&a.rtcpFeedback.push(t)}()}catch(e){E=!0,C=e}finally{try{!T&&R.return&&R.return()}finally{if(E)throw C}}n.codecs.push(a)}()}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}var u=!0,l=!1,d=void 0;try{for(var p,f=n.codecs[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value,v=h.preferredPayloadType;if(r.has(v)){var m={clockRate:h.clockRate,kind:h.kind,mimeType:h.kind+"/rtx",name:"rtx",parameters:{apt:v},preferredPayloadType:r.get(v),rtcpFeedback:[]};n.codecs.push(m)}}}catch(e){l=!0,d=e}finally{try{!u&&f.return&&f.return()}finally{if(l)throw d}}var g=!0,y=!1,b=void 0;try{for(var S,_=e.headerExtensions[Symbol.iterator]();!(g=(S=_.next()).done);g=!0)!function(){var e=S.value,r=t.headerExtensions.find(function(t){return t.kind===e.kind&&t.uri===e.uri});if(r){var i={kind:r.kind,preferredEncrypt:Boolean(e.preferredEncrypt),preferredId:e.preferredId,uri:r.uri};n.headerExtensions.push(i)}}()}catch(e){y=!0,b=e}finally{try{!g&&_.return&&_.return()}finally{if(y)throw b}}var T=!0,E=!1,C=void 0;try{for(var w,R=e.fecMechanisms[Symbol.iterator]();!(T=(w=R.next()).done);T=!0)!function(){var e=w.value,r=t.fecMechanisms.find(function(t){return t===e});r&&n.fecMechanisms.push(r)}()}catch(e){E=!0,C=e}finally{try{!T&&R.return&&R.return()}finally{if(E)throw C}}return n}function l(e){return e.media.find(function(e){return e.iceUfrag&&0!==e.port})}t.a=r,t.b=i,t.c=o,t.d=a,t.e=s,t.f=c,t.g=u;var d=n(11),p=n.n(d)},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return a});var a=function(e){return function(t){function n(t){r(this,n);var o=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return Object.defineProperty(o,"name",{value:e}),o}return o(n,t),n}(Error)}("InvalidStateError")},function(e,t,n){"use strict";(function(e){function r(e,t,n){T(["screen"],function(e){return t({stream:e})},n)}function i(e){return"https://chrome.google.com/webstore/detail/"+e.desktopSharingChromeExtId}function o(e,t){try{for(var n=e.split("."),r=t.split("."),i=Math.max(n.length,r.length),o=0;o<i;o++){var a=0,s=0;if(o<n.length&&(a=parseInt(n[o],10)),o<r.length&&(s=parseInt(r[o],10)),isNaN(a)||isNaN(s))return!0;if(a!==s)return a>s}return!1}catch(e){return g.callErrorHandler(e),m.error("Failed to parse extension version",e),!0}}function a(e,t){if("undefined"==typeof chrome||!chrome||!chrome.runtime)return void e(!1,!1);chrome.runtime.sendMessage(t.desktopSharingChromeExtId,{getVersion:!0},function(n){if(!n||!n.version)return m.warn("Extension not installed?: ",chrome.runtime.lastError),void e(!1,!1);var r=n.version;m.log("Extension version is: "+r);var i=o(t.desktopSharingChromeMinExtVersion,r);e(!i,i)})}function s(e,t,n){chrome.runtime.sendMessage(e.desktopSharingChromeExtId,{getStream:!0,sources:e.desktopSharingChromeSources},function(e){if(!e){var r=chrome.runtime.lastError;return void n(r instanceof Error?r:new f.a(h.CHROME_EXTENSION_GENERIC_ERROR,r))}m.log("Response from extension: ",e),d(e,t,n)})}function c(e){0===$("link[rel=chrome-webstore-item]").length&&$("head").append('<link rel="chrome-webstore-item">'),$("link[rel=chrome-webstore-item]").attr("href",i(e))}function u(e){return c(e),new Promise(function(t){a(function(e,n){y=e,b=n,m.info("Chrome extension installed: "+y+" updateRequired: "+b),t()},e)})}function l(e,t,n){return 0===n?Promise.reject():new Promise(function(r,i){var o=n,s=window.setInterval(function(){a(function(e){e?(window.clearInterval(s),r()):0==--o&&(i(),window.clearInterval(s))},e)},t)})}function d(e,t,n){var r=e.streamId,i=e.streamType,o=e.error;if(r)T(["desktop"],function(e){return t({stream:e,sourceId:r,sourceType:i})},n,{desktopStream:r});else{if(""===r)return void n(new f.a(h.CHROME_EXTENSION_USER_CANCELED));n(new f.a(h.CHROME_EXTENSION_GENERIC_ERROR,o))}}function p(e){if(!e.desktopSharingFirefoxDisabled&&!1!==S&&!0!==S){if(!e.desktopSharingFirefoxExtId)return void(S=!1);var t=document.createElement("img");t.onload=function(){m.log("Detected firefox screen sharing extension."),S=!0},t.onerror=function(){m.log("Detected lack of firefox screen sharing extension."),S=!1};var n="chrome://"+e.desktopSharingFirefoxExtId.replace("@",".")+"/content/"+document.location.hostname+".png";t.setAttribute("src",n)}}var f=n(9),h=n(13),v=n(1),m=n(0).getLogger(e),g=n(2),y=!1,b=!1,S=null,_=!1,T=null,E={intChromeExtPromise:null,obtainStream:null,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{disableDesktopSharing:!1,desktopSharingChromeDisabled:!1,desktopSharingChromeExtId:null,desktopSharingFirefoxDisabled:!1,desktopSharingFirefoxExtId:null},t=arguments[1];this.options=e=e||{},T=t,this.obtainStream=this.options.disableDesktopSharing?null:this._createObtainStreamMethod(e),this.obtainStream||m.info("Desktop sharing disabled")},_createObtainStreamMethod:function(e){var t=this;if(v.a.isNWJS())return function(e,t,n){window.JitsiMeetNW.obtainDesktopStream(t,function(e,t){var r=void 0;r=e&&"InvalidStateError"===e.name?new f.a(h.CHROME_EXTENSION_USER_CANCELED):new f.a(e,t,["desktop"]),"function"==typeof n&&n(r)})};if(v.a.isElectron())return this.obtainScreenOnElectron;if(v.a.isTemasysPluginUsed()){var i=n(33).WebRTCPlugin.plugin;return i.HasScreensharingFeature?i.isScreensharingAvailable?(m.info("Using Temasys plugin for desktop sharing"),r):(m.warn("Screensharing not available with Temasys plugin on this site"),null):(m.warn("Screensharing not supported by this plugin version"),null)}return v.a.isChrome()?v.a.getChromeVersion()<34?(m.info("Chrome extension not supported until ver 34"),null):e.desktopSharingChromeDisabled||!1===e.desktopSharingChromeMethod||!e.desktopSharingChromeExtId?null:(m.info("Using Chrome extension for desktop sharing"),this.intChromeExtPromise=u(e).then(function(){t.intChromeExtPromise=null}),this.obtainScreenFromExtension):v.a.isFirefox()?e.desktopSharingFirefoxDisabled?null:"http:"===window.location.protocol?(m.log("Screen sharing is not supported over HTTP. Use of HTTPS is required."),null):(p(e),this.obtainScreenOnFirefox):(m.log("Screen sharing not supported by the current browser: ",v.a.getBrowserType(),v.a.getBrowserName()),null)},isSupported:function(){return null!==this.obtainStream},obtainScreenOnFirefox:function(e,t,n){var i=this,o=!1,a=this.options.desktopSharingFirefoxMaxVersionExtRequired;return(-1===a||a>=0&&v.a.getFirefoxVersion()<=a)&&(o=!0,m.log("Jidesha extension required on firefox version "+v.a.getFirefoxVersion())),o&&!0!==S?(_&&(_=!1,p(this.options)),null===S?(window.setTimeout(function(){null===S&&(S=!1),i.obtainScreenOnFirefox(t,n)},300),void m.log("Waiting for detection of jidesha on firefox to finish.")):(S=null,_=!0,void n(new f.a(h.FIREFOX_EXTENSION_NEEDED)))):void r(e,t,n)},obtainScreenOnElectron:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=arguments[2];window.JitsiMeetScreenObtainer&&window.JitsiMeetScreenObtainer.openDesktopPicker?window.JitsiMeetScreenObtainer.openDesktopPicker({desktopSharingSources:e.desktopSharingSources||this.options.desktopSharingChromeSources},function(e,r){return d({streamId:e,streamType:r},t,n)},function(e){return n(new f.a(h.ELECTRON_DESKTOP_PICKER_ERROR,e))}):n(new f.a(h.ELECTRON_DESKTOP_PICKER_NOT_FOUND))},obtainScreenFromExtension:function(e,t,n){var r=this;if(null!==this.intChromeExtPromise)return void this.intChromeExtPromise.then(function(){r.obtainScreenFromExtension(e,t,n)});var o=this.options,a=o.desktopSharingChromeExtId,c=o.desktopSharingChromeSources,u={desktopSharingChromeExtId:a,desktopSharingChromeSources:e.desktopSharingSources||c};if(y)s(u,t,n);else{b&&alert("Jitsi Desktop Streamer requires update. Changes will take effect after next Chrome restart.");try{chrome.webstore.install(i(this.options),function(i){m.log("Extension installed successfully",i),y=!0,l(r.options,200,10).then(function(){s(u,t,n)}).catch(function(){r.handleExtensionInstallationError(e,t,n)})},this.handleExtensionInstallationError.bind(this,e,t,n))}catch(r){this.handleExtensionInstallationError(e,t,n,r)}}},handleExtensionInstallationError:function(e,t,n,r){var o=i(this.options);if(("Inline installs can not be initiated from pop-up windows."===r||"Chrome Web Store installations can only be started by the top frame."===r||"Installs can only be initiated by one of the Chrome Web Store item's verified sites."===r||"Inline installation is not supported for this item. The user will be redirected to the Chrome Web Store."===r)&&e.interval>0&&"function"==typeof e.checkAgain&&"function"==typeof e.listener)return e.listener("waitingForExtension",o),void this.checkForChromeExtensionOnInterval(e,t,n,r);var a="Failed to install the extension from "+o;m.log(a,r);var s="Chrome Web Store installations can only be initated by a user gesture."===r?h.CHROME_EXTENSION_USER_GESTURE_REQUIRED:h.CHROME_EXTENSION_INSTALLATION_ERROR;n(new f.a(s,a))},checkForChromeExtensionOnInterval:function(e,t,n){var r=this;if(!1===e.checkAgain())return void n(new f.a(h.CHROME_EXTENSION_INSTALLATION_ERROR));l(this.options,e.interval,1).then(function(){y=!0,e.listener("extensionFound"),r.obtainScreenFromExtension(e,t,n)}).catch(function(){r.checkForChromeExtensionOnInterval(e,t,n)})}};t.a=E}).call(t,"modules/RTC/ScreenObtainer.js")},function(e,t,n){"use strict";(function(e){function r(e,t,r,i,o,a,s){var c=this;this.audioTransferActive=!0,this.videoTransferActive=!0,this.rtc=e,this.id=t,this.isP2P=a,this.remoteTracks=new Map,this.localTracks=new Map,this._addedStreams=new Set,this.localSSRCs=new Map,this.localUfrag=null,this.remoteUfrag=null,this.signalingLayer=r,this._peerVideoTypeChanged=this._peerVideoTypeChanged.bind(this),this.signalingLayer.on(E.b,this._peerVideoTypeChanged),this._peerMutedChanged=this._peerMutedChanged.bind(this),this.signalingLayer.on(E.a,this._peerMutedChanged),this.options=s,this.peerconnection=new h.a.RTCPeerConnectionType(i,o),this.updateLog=[],this.stats={},this.statsinterval=null,this.maxstats=0;var u=n(130).Interop;this.interop=new u;var l=n(134);this.simulcast=new l({numOfLayers:R,explodeRemoteSimulcast:!1}),this.sdpConsistency=new S.a(this.toString()),this.localSdpMunger=new p.a(this),this.eventEmitter=e.eventEmitter,this.rtxModifier=new y.a,this.trace=function(e,t){c.updateLog.push({time:new Date,type:e,value:t||""})},this.onicecandidate=null,this.peerconnection.onicecandidate=function(e){v.a.isTemasysPluginUsed()||c.trace("onicecandidate",JSON.stringify(e.candidate,null," ")),null!==c.onicecandidate&&c.onicecandidate(e)},this.peerconnection.onaddstream=function(e){return c._remoteStreamAdded(e.stream)},this.peerconnection.onremovestream=function(e){return c._remoteStreamRemoved(e.stream)},this.onsignalingstatechange=null,this.peerconnection.onsignalingstatechange=function(e){c.trace("onsignalingstatechange",c.signalingState),null!==c.onsignalingstatechange&&c.onsignalingstatechange(e)},this.oniceconnectionstatechange=null,this.peerconnection.oniceconnectionstatechange=function(e){c.trace("oniceconnectionstatechange",c.iceConnectionState),null!==c.oniceconnectionstatechange&&c.oniceconnectionstatechange(e)},this.onnegotiationneeded=null,this.peerconnection.onnegotiationneeded=function(e){c.trace("onnegotiationneeded"),null!==c.onnegotiationneeded&&c.onnegotiationneeded(e)},this.ondatachannel=null,this.peerconnection.ondatachannel=function(e){c.trace("ondatachannel",e),null!==c.ondatachannel&&c.ondatachannel(e)},!v.a.isFirefox()&&this.maxstats&&(this.statsinterval=window.setInterval(function(){c.peerconnection.getStats(function(e){for(var t=e.result(),n=new Date,r=0;r<t.length;++r)!function(e){t[e].names().forEach(function(r){var i=t[e].id+"-"+r,o=c.stats[i];o||(c.stats[i]=o={startTime:n,endTime:n,values:[],times:[]}),o.values.push(t[e].stat(r)),o.times.push(n.getTime()),o.values.length>c.maxstats&&(o.values.shift(),o.times.shift()),o.endTime=n})}(r)})},1e3)),w.info("Create new "+this)}function i(e){var t=new Map,n=new Map;if("object"!==(void 0===e?"undefined":C(e))||null===e||"string"!=typeof e.sdp)return w.warn("An empty description was passed as an argument."),t;var r=c.a.parse(e.sdp);if(!Array.isArray(r.media))return t;var i=!0,o=!1,a=void 0;try{for(var s,u=r.media[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(Array.isArray(l.ssrcs)){if(Array.isArray(l.ssrcGroups)){var d=!0,p=!1,f=void 0;try{for(var h,v=l.ssrcGroups[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var m=h.value;if(void 0!==m.semantics&&void 0!==m.ssrcs){var g=m.ssrcs.split(" ").map(function(e){return parseInt(e,10)}),y=g[0];m.ssrcs=g,n.has(y)||n.set(y,[]),n.get(y).push(m)}}}catch(e){p=!0,f=e}finally{try{!d&&v.return&&v.return()}finally{if(p)throw f}}}var b=!0,S=!1,_=void 0;try{for(var T,E=l.ssrcs[Symbol.iterator]();!(b=(T=E.next()).done);b=!0){var R=T.value;if("msid"===R.attribute){var k=R.value,I=t.get(k);I||(I={ssrcs:[],groups:[],msid:k},t.set(k,I));var P=R.id;if(I.ssrcs.push(P),n.has(P)){var A=n.get(P),D=!0,O=!1,L=void 0;try{for(var N,M=A[Symbol.iterator]();!(D=(N=M.next()).done);D=!0){var x=N.value;I.groups.push(x)}}catch(e){O=!0,L=e}finally{try{!D&&M.return&&M.return()}finally{if(O)throw L}}}}}}catch(e){S=!0,_=e}finally{try{!b&&E.return&&E.return()}finally{if(S)throw _}}}}}catch(e){o=!0,a=e}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return t}function o(e){return e&&e.groups&&e.groups.length?e.groups[0].ssrcs[0]:e&&e.ssrcs&&e.ssrcs.length?e.ssrcs[0]:null}t.a=r;var a=n(0),s=(n.n(a),n(11)),c=n.n(s),u=n(2),l=(n.n(u),n(126)),d=n(3),p=n(127),f=n(24),h=n(25),v=n(1),m=n(7),g=n.n(m),y=n(128),b=n(49),S=n(129),_=n(26),T=n(10),E=n(50),C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w=Object(a.getLogger)(e),R=3,k=["1","2","3"],I=function(e){return void 0===e||null===e?"":"type: "+e.type+"\r\n"+e.sdp};r.prototype.getConnectionState=function(){var e=this.peerconnection.iceConnectionState;return"completed"===e?"connected":e},r.prototype._getDesiredMediaDirection=function(e){var t=!0;return e===d.a?t=this.audioTransferActive:e===d.b&&(t=this.videoTransferActive),t?this.hasAnyTracksOfType(e)?"sendrecv":"recvonly":"inactive"},r.prototype.isSimulcastOn=function(){return!this.options.disableSimulcast&&v.a.supportsSimulcast()&&(!v.a.isFirefox()||this.options.enableFirefoxSimulcast)},r.prototype._peerVideoTypeChanged=function(e,t){if(!e)return void w.error("No endpointID on peerVideoTypeChanged "+this);var n=this.getRemoteTracks(e,d.b);n.length&&n[0]._setVideoType(t)},r.prototype._peerMutedChanged=function(e,t,n){if(!e)return void w.error("On peerMuteChanged - no endpoint ID");var r=this.getRemoteTracks(e,t);r.length&&r[0].setMute(n)},r.prototype.getLocalTracks=function(e){var t=Array.from(this.localTracks.values());return void 0!==e&&(t=t.filter(function(t){return t.getType()===e})),t},r.prototype.hasAnyTracksOfType=function(e){if(!e)throw new Error('"mediaType" is required');return this.getLocalTracks(e).length>0},r.prototype.getRemoteTracks=function(e,t){var n=[],r=e?[e]:this.remoteTracks.keys(),i=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=this.remoteTracks.get(u);if(l){var d=!0,p=!1,f=void 0;try{for(var h,v=l.keys()[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var m=h.value;if(!t||t===m){var g=l.get(m);g&&n.push(g)}}}catch(e){p=!0,f=e}finally{try{!d&&v.return&&v.return()}finally{if(p)throw f}}}}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}return n},r.prototype.getTrackBySSRC=function(e){if("number"!=typeof e)throw new Error("SSRC "+e+" is not a number");var t=!0,n=!1,r=void 0;try{for(var i,o=this.localTracks.values()[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var a=i.value;if(this.getLocalSSRC(a)===e)return a}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var s=!0,c=!1,u=void 0;try{for(var l,d=this.getRemoteTracks()[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var p=l.value;if(p.getSSRC()===e)return p}}catch(e){c=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw u}}return null},r.prototype._remoteStreamAdded=function(e){var t=this,n=f.a.getStreamID(e);if(!f.a.isUserStreamById(n))return void w.info(this+" ignored remote 'stream added' event for non-user streamid: "+n);(v.a.isChrome()||v.a.isNWJS()||v.a.isElectron()||v.a.isEdge())&&(e.onaddtrack=function(n){t._remoteTrackAdded(e,n.track)},e.onremovetrack=function(n){t._remoteTrackRemoved(e,n.track)});var r=e.getAudioTracks(),i=!0,o=!1,a=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;this._remoteTrackAdded(e,u)}}catch(e){o=!0,a=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw a}}var l=e.getVideoTracks(),d=!0,p=!1,h=void 0;try{for(var m,g=l[Symbol.iterator]();!(d=(m=g.next()).done);d=!0){var y=m.value;this._remoteTrackAdded(e,y)}}catch(e){p=!0,h=e}finally{try{!d&&g.return&&g.return()}finally{if(p)throw h}}},r.prototype._remoteTrackAdded=function(e,t){var n=f.a.getStreamID(e),r=t.kind;if(w.info(this+" remote track added:",n,r),!r)return void u.callErrorHandler(new Error("MediaType undefined for remote track, stream id: "+n));var i=new b.a(this.remoteDescription.sdp),o=i.media.filter(function(e){return e.startsWith("m="+r)});if(!o.length)return void u.callErrorHandler(new Error("No media lines for type "+r+" found in remote SDP for remote track: "+n));var a=T.a.findLines(o[0],"a=ssrc:");if(a=a.filter(function(e){var t=v.a.isTemasysPluginUsed()?"mslabel":"msid";return-1!==e.indexOf(t+":"+n)}),!a.length)return void u.callErrorHandler(new Error("No SSRC lines for streamId "+n+" for remote track, media type: "+r));var s=a[0].substring(7).split(" ")[0],c=Number(s),l=this.signalingLayer.getSSRCOwner(c);if(isNaN(c)||c<0)return void u.callErrorHandler(new Error("Invalid SSRC: "+s+" for remote track, msid: "+n+" media type: "+r));if(!l)return void u.callErrorHandler(new Error("No SSRC owner known for: "+c+" for remote track, msid: "+n+" media type: "+r));w.log(this+" associated ssrc",l,c);var d=this.signalingLayer.getPeerMediaInfo(l,r);if(!d)return void u.callErrorHandler(new Error(this+": no peer media info available for "+l));var p=d.muted,h=d.videoType;this._createRemoteTrack(l,e,t,r,h,c,p)},r.prototype._createRemoteTrack=function(e,t,n,r,i,o,a){var s=new l.a(this.rtc,this.rtc.conference,e,t,n,r,i,o,a,this.isP2P),c=this.remoteTracks.get(e);c||(c=new Map,this.remoteTracks.set(e,c)),c.has(r)&&w.error(this+" overwriting remote track! "+s,e,r),c.set(r,s),this.eventEmitter.emit(g.a.REMOTE_TRACK_ADDED,s)},r.prototype._remoteStreamRemoved=function(e){if(!f.a.isUserStream(e)){var t=f.a.getStreamID(e);return void w.info("Ignored remote 'stream removed' event for non-user stream "+t)}var n=e.getVideoTracks(),r=!0,i=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var c=a.value;this._remoteTrackRemoved(e,c)}}catch(e){i=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}var u=e.getAudioTracks(),l=!0,d=!1,p=void 0;try{for(var h,v=u[Symbol.iterator]();!(l=(h=v.next()).done);l=!0){var m=h.value;this._remoteTrackRemoved(e,m)}}catch(e){d=!0,p=e}finally{try{!l&&v.return&&v.return()}finally{if(d)throw p}}},r.prototype._remoteTrackRemoved=function(e,t){var n=f.a.getStreamID(e),r=t&&f.a.getTrackID(t);return w.info(this+" - remote track removed: "+n+", "+r),n?r?void(this._removeRemoteTrackById(n,r)||w.warn(this+" Removed track not found for msid: "+n+",\n             track id: "+r)):void u.callErrorHandler(new Error(this+" remote track removal failed - no track ID")):void u.callErrorHandler(new Error(this+" remote track removal failed - no stream ID"))},r.prototype._getRemoteTrackById=function(e,t){var n=!0,r=!1,i=void 0;try{for(var o,a=this.remoteTracks.values()[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,c=!0,u=!1,l=void 0;try{for(var d,p=s.values()[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var f=d.value;if(f.getStreamId()==e&&f.getTrackId()==t)return f}}catch(e){u=!0,l=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw l}}}}catch(e){r=!0,i=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw i}}},r.prototype.removeRemoteTracks=function(e){var t=[],n=this.remoteTracks.get(e);if(n){var r=n.get(d.a),i=n.get(d.b);r&&t.push(r),i&&t.push(i),this.remoteTracks.delete(e)}return w.debug(this+" removed remote tracks for "+e+" count: "+t.length),t},r.prototype._removeRemoteTrack=function(e){e.dispose();var t=e.getParticipantId(),n=this.remoteTracks.get(t);n?n.delete(e.getType())||w.error("Failed to remove "+e+" - type mapping messed up ?"):w.error("removeRemoteTrack: no remote tracks map for "+t),this.eventEmitter.emit(g.a.REMOTE_TRACK_REMOVED,e)},r.prototype._removeRemoteTrackById=function(e,t){var n=this._getRemoteTrackById(e,t);return n&&this._removeRemoteTrack(n),n};var P=function(e){if("object"!==(void 0===e?"undefined":C(e))||null===e||"string"!=typeof e.sdp)return w.warn("An empty description was passed as an argument."),e;var t=n(11),r=t.parse(e.sdp);void 0!==r&&void 0!==r.media&&Array.isArray(r.media)&&r.media.forEach(function(e){var t=[],n=[];if(void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach(function(e){void 0!==e.semantics&&"FID"===e.semantics&&void 0!==e.ssrcs&&t.push(Number(e.ssrcs.split(" ")[0]))}),Array.isArray(e.ssrcs)){var r=void 0;for(r=0;r<e.ssrcs.length;r++)"object"===C(e.ssrcs[r])&&void 0!==e.ssrcs[r].id&&t.indexOf(e.ssrcs[r].id)>=0&&(n.push(e.ssrcs[r]),delete e.ssrcs[r]);for(r=0;r<e.ssrcs.length;r++)void 0!==e.ssrcs[r]&&n.push(e.ssrcs[r]);e.ssrcs=n}});var i=t.write(r);return new RTCSessionDescription({type:e.type,sdp:i})},A=function(e){if(e&&e.sdp){var t=new _.a(e.sdp),n=t.selectMedia("audio"),r=!1;n&&"sendrecv"!==n.direction&&(n.direction="sendrecv",r=!0);var i=t.selectMedia("video");i&&"sendrecv"!==i.direction&&(i.direction="sendrecv",r=!0),r&&(e.sdp=t.toRawSDP())}};r.prototype.getLocalSSRC=function(e){var t=this._getSSRC(e.rtcId);return t&&t.ssrcs[0]},r.prototype._injectSsrcGroupForUnifiedSimulcast=function(e){var t=c.a.parse(e.sdp),n=t.media.find(function(e){return"video"===e.type});if(n.simulcast_03){var r=[];if(n.ssrcs.forEach(function(e){"msid"===e.attribute&&r.push(e.id)}),n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.find(function(e){return"SIM"===e.semantics}))return e;n.ssrcGroups.push({semantics:"SIM",ssrcs:r.join(" ")})}return e.sdp=c.a.write(t),e};var D={signalingState:function(){return this.peerconnection.signalingState},iceConnectionState:function(){return this.peerconnection.iceConnectionState},localDescription:function(){var e=this.peerconnection.localDescription;return this.trace("getLocalDescription::preTransform",I(e)),e&&v.a.usesUnifiedPlan()&&(e=this.interop.toPlanB(e),this.trace("getLocalDescription::postTransform (Plan B)",I(e)),e=this._injectSsrcGroupForUnifiedSimulcast(e),this.trace("getLocalDescription::postTransform (inject ssrc group)",I(e))),v.a.doesVideoMuteByStreamRemove()&&(this.localSdpMunger.maybeMungeLocalSdp(e),w.debug("getLocalDescription::postTransform (munge local SDP)",e)),A(e),e||{}},remoteDescription:function(){var e=this.peerconnection.remoteDescription;return this.trace("getRemoteDescription::preTransform",I(e)),v.a.usesUnifiedPlan()&&(e=this.interop.toPlanB(e),this.trace("getRemoteDescription::postTransform (Plan B)",I(e))),e||{}}};Object.keys(D).forEach(function(e){Object.defineProperty(r.prototype,e,{get:D[e]})}),r.prototype._getSSRC=function(e){return this.localSSRCs.get(e)},r.prototype.addTrack=function(e){var t=e.rtcId;if(w.info("add "+e+" to: "+this),this.localTracks.has(t))return void w.error(e+" is already in "+this);this.localTracks.set(t,e);var n=e.getOriginalStream();if(n?this._addStream(n):(!v.a.doesVideoMuteByStreamRemove()||e.isAudioTrack()||e.isVideoTrack()&&!e.isMuted())&&w.error(this+" no WebRTC stream for: "+e),v.a.doesVideoMuteByStreamRemove()&&e.isVideoTrack()&&e.isMuted()){var r=this.generateNewStreamSSRCInfo(e);this.sdpConsistency.setPrimarySsrc(r.ssrcs[0]);var i=r.groups.find(function(e){return"SIM"===e.semantics});i&&this.simulcast.setSsrcCache(i.ssrcs);var o=r.groups.filter(function(e){return"FID"===e.semantics});if(o){var a=new Map;o.forEach(function(e){var t=e.ssrcs[0],n=e.ssrcs[1];a.set(t,n)}),this.rtxModifier.setSsrcCache(a)}}},r.prototype.addTrackUnmute=function(e){if(!this._assertTrackBelongs("addTrackUnmute",e))return!1;w.info("Adding "+e+" as unmute to "+this);var t=e.getOriginalStream();return t?(this._addStream(t),!0):(w.error("Unable to add "+e+" as unmute to "+this+" - no WebRTC stream"),!1)},r.prototype._addStream=function(e){this.peerconnection.addStream(e),this._addedStreams.add(e)},r.prototype._removeStream=function(e){v.a.isFirefox()?this._handleFirefoxRemoveStream(e):this.peerconnection.removeStream(e),this._addedStreams.delete(e)},r.prototype._assertTrackBelongs=function(e,t){var n=this.localTracks.has(t.rtcId);return n||w.error(e+": "+t+" does not belong to "+this),n},r.prototype.isMediaStreamInPc=function(e){return this._addedStreams.has(e)},r.prototype.removeTrack=function(e){var t=e.getOriginalStream();this.trace("removeStream",e.rtcId,t?t.id:void 0),this._assertTrackBelongs("removeStream",e)&&(this.localTracks.delete(e.rtcId),this.localSSRCs.delete(e.rtcId),t&&(v.a.isFirefox()?this._handleFirefoxRemoveStream(t):this.peerconnection.removeStream(t)))},r.prototype.removeTrackMute=function(e){var t=e.getOriginalStream();return this.trace("removeStreamMute",e.rtcId,t?t.id:null),!!this._assertTrackBelongs("removeStreamMute",e)&&(t?(w.info("Removing "+e+" as mute from "+this),this._removeStream(t),!0):(w.error("removeStreamMute - no WebRTC stream for "+e),!1))},r.prototype._handleFirefoxRemoveStream=function(e){if(e){var t=null,n=null;if(e.getAudioTracks()&&e.getAudioTracks().length?n=e.getAudioTracks()[0]:e.getVideoTracks()&&e.getVideoTracks().length&&(n=e.getVideoTracks()[0]),!n)return void w.error("Cannot remove tracks: no tracks.");this.peerconnection.getSenders().some(function(e){return e.track===n&&(t=e,!0)}),t?this.peerconnection.removeTrack(t):w.log("Cannot remove tracks: no RTPSender.")}},r.prototype.createDataChannel=function(e,t){return this.trace("createDataChannel",e,t),this.peerconnection.createDataChannel(e,t)},r.prototype._ensureSimulcastGroupIsLast=function(e){var t=e.sdp,n=t.indexOf("m=video"),r=t.indexOf("a=ssrc-group:SIM",n),i=t.lastIndexOf("a=ssrc-group");if(-1!==r&&-1!==i&&i!==r){var o=t.indexOf("\r\n",r),a=t.substring(r,o+2);t=t.replace(a,""),i=t.lastIndexOf("a=ssrc-group");var s=t.indexOf("\r\n",i);t=t.slice(0,s)+"\r\n"+a.trim()+t.slice(s),e.sdp=t}},r.prototype._adjustLocalMediaDirection=function(e){var t=new _.a(e.sdp),n=!1,r=t.selectMedia("audio");if(r){var i=this._getDesiredMediaDirection(d.a);r.direction!==i&&(r.direction=i,w.info("Adjusted local audio direction to "+i),n=!0)}else w.warn('No "audio" media found int the local description');var o=t.selectMedia("video");if(o){var a=this._getDesiredMediaDirection(d.b);o.direction!==a&&(o.direction=a,w.info("Adjusted local video direction to "+a),n=!0)}else w.warn('No "video" media found in the local description');n&&(e.sdp=t.toRawSDP())},r.prototype.setLocalDescription=function(e,t,n){var r=this,i=e;if(this.trace("setLocalDescription::preTransform",I(i)),this.options.preferH264){var o=c.a.parse(i.sdp),a=o.media.find(function(e){return"video"===e.type});T.a.preferVideoCodec(a,"h264"),i.sdp=c.a.write(o),this.trace("setLocalDescription::postTransform (preferH264)",I(i))}this._adjustLocalMediaDirection(i),this._ensureSimulcastGroupIsLast(i),v.a.usesUnifiedPlan()&&(i=this.interop.toUnifiedPlan(i),this.trace("setLocalDescription::postTransform (Unified Plan)",I(i))),this.peerconnection.setLocalDescription(i,function(){r.trace("setLocalDescriptionOnSuccess");var e=T.a.getUfrag(i.sdp);e!==r.localUfrag&&(r.localUfrag=e,r.eventEmitter.emit(g.a.LOCAL_UFRAG_CHANGED,r,e)),t()},function(e){r.trace("setLocalDescriptionOnFailure",e),r.eventEmitter.emit(g.a.SET_LOCAL_DESCRIPTION_FAILED,e,r),n(e)})},r.prototype.setAudioTransferActive=function(e){w.debug(this+" audio transfer active: "+e);var t=this.audioTransferActive!==e;return this.audioTransferActive=e,t},r.prototype._insertUnifiedPlanSimulcastReceive=function(e){var t=c.a.parse(e.sdp),n=t.media.find(function(e){return"video"===e.type});return n.rids=[{id:"1",direction:"recv"},{id:"2",direction:"recv"},{id:"3",direction:"recv"}],n.simulcast_03={value:"recv rid="+k.join(";")},e.sdp=c.a.write(t),e},r.prototype.setRemoteDescription=function(e,t,n){var r=this;if(this.trace("setRemoteDescription::preTransform",I(e)),e=this.simulcast.mungeRemoteDescription(e),this.trace("setRemoteDescription::postTransform (simulcast)",I(e)),this.options.preferH264){var i=c.a.parse(e.sdp),o=i.media.find(function(e){return"video"===e.type});T.a.preferVideoCodec(o,"h264"),e.sdp=c.a.write(i)}v.a.usesUnifiedPlan()?(e.sdp=this.rtxModifier.stripRtx(e.sdp),this.trace("setRemoteDescription::postTransform (stripRtx)",I(e)),e=this.interop.toUnifiedPlan(e),this.trace("setRemoteDescription::postTransform (Plan A)",I(e)),this.isSimulcastOn()&&(e=this._insertUnifiedPlanSimulcastReceive(e),this.trace("setRemoteDescription::postTransform (sim receive)",I(e)))):e=P(e),this.peerconnection.setRemoteDescription(e,function(){r.trace("setRemoteDescriptionOnSuccess");var n=T.a.getUfrag(e.sdp);n!==r.remoteUfrag&&(r.remoteUfrag=n,r.eventEmitter.emit(g.a.REMOTE_UFRAG_CHANGED,r,n)),t()},function(e){r.trace("setRemoteDescriptionOnFailure",e),r.eventEmitter.emit(g.a.SET_REMOTE_DESCRIPTION_FAILED,e,r),n(e)})},r.prototype.setVideoTransferActive=function(e){w.debug(this+" video transfer active: "+e);var t=this.videoTransferActive!==e;return this.videoTransferActive=e,t},r.prototype.generateRecvonlySsrc=function(){var e=T.a.generateSsrc();w.info(this+" generated new recvonly SSRC: "+e),this.sdpConsistency.setPrimarySsrc(e)},r.prototype.clearRecvonlySsrc=function(){w.info("Clearing primary video SSRC!"),this.sdpConsistency.clearVideoSsrcCache()},r.prototype.close=function(){this.trace("stop"),this.signalingLayer.off(E.a,this._peerMutedChanged),this.signalingLayer.off(E.b,this._peerVideoTypeChanged);var e=!0,t=!1,n=void 0;try{for(var r,i=this.remoteTracks.values()[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value,a=!0,s=!1,c=void 0;try{for(var u,l=o.values()[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;this._removeRemoteTrack(d)}}catch(e){s=!0,c=e}finally{try{!a&&l.return&&l.return()}finally{if(s)throw c}}}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}this.remoteTracks.clear(),this._addedStreams.clear(),this.rtc._removePeerConnection(this)||w.error("RTC._removePeerConnection returned false"),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),w.info("Closing "+this+"..."),this.peerconnection.close()};var O=function(e,t){v.a.isChrome()&&e&&t&&e.media&&t.media&&e.media.length===t.media.length&&(t.media.forEach(function(n,r){T.a.findLine(e.media[r],"a=setup:actpass",e.session)&&(t.media[r]=n.replace(/a=setup:active/g,"a=setup:passive"))}),t.raw=t.session+t.media.join(""))};r.prototype.createAnswer=function(e,t,n){if(v.a.supportsRtpSender()&&this.isSimulcastOn()){var r=this.peerconnection.getSenders().find(function(e){return"video"===e.track.kind}),i={encodings:[{rid:"1",scaleResolutionDownBy:4},{rid:"2",scaleResolutionDownBy:2},{rid:"3"}]};r.setParameters(i)}this._createOfferOrAnswer(!1,e,t,n)},r.prototype.createOffer=function(e,t,n){this._createOfferOrAnswer(!0,e,t,n)},r.prototype._createOfferOrAnswer=function(e,t,n,r){var o=this,a=e?"Offer":"Answer";this.trace("create"+a,JSON.stringify(r,null," "));var s=function(r){try{if(o.trace("create"+a+"OnSuccess::preTransform",I(r)),v.a.usesUnifiedPlan()&&(r=o.interop.toPlanB(r),o.trace("create"+a+"OnSuccess::postTransform (Plan B)",I(r)),o.isSimulcastOn()&&(r=o._injectSsrcGroupForUnifiedSimulcast(r),o.trace("create"+a+"OnSuccess::postTransform(inject ssrc group)",I(r)))),v.a.isFirefox()||(o.hasAnyTracksOfType(d.b)||o.sdpConsistency.hasPrimarySsrcCached()||o.generateRecvonlySsrc(),r.sdp=o.sdpConsistency.makeVideoPrimarySsrcsConsistent(r.sdp),o.trace("create"+a+"OnSuccess::postTransform (make primary audio/video ssrcs consistent)",I(r))),o.isSimulcastOn()&&(r=o.simulcast.mungeLocalDescription(r),o.trace("create"+a+"OnSuccess::postTransform (simulcast)",I(r))),!o.options.disableRtx&&v.a.supportsRtx()&&(r.sdp=o.rtxModifier.modifyRtxSsrcs(r.sdp),o.trace("create"+a+"OnSuccess::postTransform (rtx modifier)",I(r))),!e){var s=new b.a(o.remoteDescription.sdp),c=new b.a(r.sdp);O(s,c),r.sdp=c.raw}var u=i(r);w.debug("Got local SSRCs MAP: ",u),o._processLocalSSRCsMap(u),t(r)}catch(e){o.trace("create"+a+"OnError",e),o.trace("create"+a+"OnError",I(r)),w.error("create"+a+"OnError",e,I(r)),n(e)}},c=function(t){o.trace("create"+a+"OnFailure",t);var r=e?g.a.CREATE_OFFER_FAILED:g.a.CREATE_ANSWER_FAILED;o.eventEmitter.emit(r,t,o),n(t)};e?this.peerconnection.createOffer(s,c,r):this.peerconnection.createAnswer(s,c,r)},r.prototype._processLocalSSRCsMap=function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=this.localTracks.values()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,c=s.getMSID();if(e.has(c)){var u=e.get(c);if(!u)return void w.error("No SSRC found for: "+c+" in "+this);var l=this.localSSRCs.get(s.rtcId),d=o(u),p=o(l);d!==p?(null===p?w.info("Storing new local SSRC for "+s+" in "+this,u):w.error("Overwriting SSRC for "+s+" "+c+" in "+this+" with: ",u),this.localSSRCs.set(s.rtcId,u)):w.debug("The local SSRC("+d+") for "+s+" "+c+"is still up to date in "+this)}else w.warn("No local track matched with: "+c+" in "+this)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}},r.prototype.addIceCandidate=function(e,t,n){this.trace("addIceCandidate",JSON.stringify(e,null," ")),this.peerconnection.addIceCandidate(e,t,n)},r.prototype.getStats=function(e,t){v.a.isFirefox()||v.a.isTemasysPluginUsed()||v.a.isReactNative()?this.peerconnection.getStats(null,e,t||function(){}):this.peerconnection.getStats(e)},r.prototype.generateNewStreamSSRCInfo=function(e){var t=e.rtcId,n=this._getSSRC(t);if(n&&w.error("Will overwrite local SSRCs for track ID: "+t),this.isSimulcastOn()){n={ssrcs:[],groups:[]};for(var r=0;r<R;r++)n.ssrcs.push(T.a.generateSsrc());n.groups.push({ssrcs:n.ssrcs.slice(),semantics:"SIM"})}else n={ssrcs:[T.a.generateSsrc()],groups:[]};if(!this.options.disableRtx&&v.a.supportsRtx())for(var i=n.ssrcs.length,o=0;o<i;++o){var a=n.ssrcs[o],s=T.a.generateSsrc();n.ssrcs.push(s),n.groups.push({ssrcs:[a,s],semantics:"FID"})}return n.msid=e.storedMSID,this.localSSRCs.set(t,n),n},r.prototype.toString=function(){return"TPC["+this.id+",p2p:"+this.isP2P+"]"}}).call(t,"modules/RTC/TraceablePeerConnection.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(52),s=n(15),c=n(1),u=n(5),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),d=n(0).getLogger(e),p=n(7),f=!1,h=!1,v=function(e){function t(e,n,o,a,s,c,u,l,d,p){r(this,t);var f=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,a,s,function(){},c,u));if(f.rtc=e,"number"!=typeof l)throw new TypeError("SSRC "+l+" is not a number");return f.ssrc=l,f.ownerEndpointId=o,f.muted=d,f.isP2P=p,f.hasBeenMuted=d,f.rtc&&f.track&&f._bindMuteHandlers(),f}return o(t,e),l(t,[{key:"_bindMuteHandlers",value:function(){var e=this;this.track.addEventListener?(this.track.addEventListener("mute",function(){return e._onTrackMute()}),this.track.addEventListener("unmute",function(){return e._onTrackUnmute()})):this.track.attachEvent&&(this.track.attachEvent("onmute",function(){return e._onTrackMute()}),this.track.attachEvent("onunmute",function(){return e._onTrackUnmute()}))}},{key:"_onTrackMute",value:function(){d.debug('"onmute" event('+Date.now()+"): ",this.getParticipantId(),this.getType(),this.getSSRC()),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_MUTE,this)}},{key:"_onTrackUnmute",value:function(){d.debug('"onunmute" event('+Date.now()+"): ",this.getParticipantId(),this.getType(),this.getSSRC()),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_UNMUTE,this)}},{key:"setMute",value:function(e){this.muted!==e&&(e&&(this.hasBeenMuted=!0),this.stream&&(this.stream.muted=e),this.muted=e,this.emit(s.TRACK_MUTE_CHANGED,this))}},{key:"isMuted",value:function(){return this.muted}},{key:"getParticipantId",value:function(){return this.ownerEndpointId}},{key:"isLocal",value:function(){return!1}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"_setVideoType",value:function(e){this.videoType!==e&&(this.videoType=e,this.emit(s.TRACK_VIDEOTYPE_CHANGED,e))}},{key:"_playCallback",value:function(){var e=this.isVideoTrack()?"video":"audio",t=window.performance.now();console.log("(TIME) Render "+e+":\t",t),this.conference.getConnectionTimes()[e+".render"]=t;var n=window.connectionTimes["obtainPermissions.start"],r=window.connectionTimes["obtainPermissions.end"],i=isNaN(r)||isNaN(n)?0:r-n,o=t-(this.conference.getConnectionTimes()["session.initiate"]-this.conference.getConnectionTimes()["muc.joined"])-i;this.conference.getConnectionTimes()[e+".ttfm"]=o,console.log("(TIME) TTFM "+e+":\t",o);var a=e+".ttfm";this.hasBeenMuted&&(a+=".muted"),u.a.analytics.sendEvent(a,{value:o})}},{key:"_attachTTFMTracker",value:function(e){if(!(f&&this.isAudioTrack()||h&&this.isVideoTrack()))if(this.isAudioTrack()&&(f=!0),this.isVideoTrack()&&(h=!0),c.a.isTemasysPluginUsed()){var t=n(33);t.addEvent(e,"play",this._playCallback.bind(this))}else e.addEventListener("canplay",this._playCallback.bind(this))}},{key:"toString",value:function(){return"RemoteTrack["+this.ownerEndpointId+", "+this.getType()+", p2p: "+this.isP2P+"]"}}]),t}(a.a);t.a=v}).call(t,"modules/RTC/JitsiRemoteTrack.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(3)),a=n(26),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=Object(i.getLogger)(e),u=function(){function e(t){r(this,e),this.tpc=t}return s(e,[{key:"_addMutedLocalVideoTracksToSDP",value:function(e){var t=this.tpc.getLocalTracks(o.b);if(!t.length)return!1;1!==t.length&&c.error(this.tpc+" there is more than 1 video track ! Strange things may happen !",t);var n=e.selectMedia("video");if(!n)return c.error(this.tpc+' unable to hack local video track SDP- no "video" media'),!1;var r=!1,i=!0,a=!1,s=void 0;try{for(var u,l=t[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var d=u.value,p=d.isMuted(),f=d.getOriginalStream(),h=f&&this.tpc.isMediaStreamInPc(f),v=p||!h;if(c.debug(this.tpc+" "+d+" muted: "+p+", is in PeerConnection: "+h+" => should fake sdp ? : "+v),v){var m=this.tpc.isSimulcastOn()?this.tpc.simulcast.ssrcCache:[this.tpc.sdpConsistency.cachedPrimarySsrc];if(m.length){r=!0,n.direction="sendrecv";var g=m[0],y="injected-"+g,b=!0,S=!1,_=void 0;try{for(var T,E=m[Symbol.iterator]();!(b=(T=E.next()).done);b=!0){var C=T.value;n.removeSSRC(C),c.debug(this.tpc+" injecting video SSRC: "+C+" for "+d),n.addSSRCAttribute({id:C,attribute:"cname",value:y}),n.addSSRCAttribute({id:C,attribute:"msid",value:d.storedMSID})}}catch(e){S=!0,_=e}finally{try{!b&&E.return&&E.return()}finally{if(S)throw _}}if(m.length>1){var w={ssrcs:m.join(" "),semantics:"SIM"};n.findGroup(w.semantics,w.ssrcs)||(c.debug(this.tpc+" injecting SIM group for "+d,w),n.addSSRCGroup(w))}this.tpc.options.disableRtx||this.tpc.rtxModifier.modifyRtxSsrcs2(n)}else c.error("No SSRCs stored for: "+d+" in "+this.tpc)}}}catch(e){a=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw s}}return r}},{key:"maybeMungeLocalSdp",value:function(e){if(e&&e.sdp){var t=new a.a(e.sdp);this._addMutedLocalVideoTracksToSDP(t)&&(e.sdp=t.toRawSDP())}}}]),e}();t.a=u}).call(t,"modules/RTC/LocalSdpMunger.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){u.debug("Updating mline to associate "+n+"rtx ssrc with primary stream, "+t.id);var r=t.id,i=t.msid,o=t.cname,a=e.getRtxSSRC(r);if(a===n)return void u.debug(n+" was already associated with "+r);a&&(u.debug(r+" was previously associated with rtx"+a+", removing all references to it"),e.removeSSRC(a),u.debug("groups before filtering for "+a),u.debug(e.dumpSSRCGroups()),e.removeGroupsWithSSRC(a)),e.addSSRCAttribute({id:n,attribute:"cname",value:o}),e.addSSRCAttribute({id:n,attribute:"msid",value:i}),e.addSSRCGroup({semantics:"FID",ssrcs:r+" "+n})}var o=n(0),a=(n.n(o),n(26)),s=n(10),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=Object(o.getLogger)(e),l=function(){function e(){r(this,e),this.correspondingRtxSsrcs=new Map}return c(e,[{key:"clearSsrcCache",value:function(){this.correspondingRtxSsrcs.clear()}},{key:"setSsrcCache",value:function(e){u.debug("Setting ssrc cache to ",e),this.correspondingRtxSsrcs=e}},{key:"modifyRtxSsrcs",value:function(e){var t=new a.a(e),n=t.selectMedia("video");return n?this.modifyRtxSsrcs2(n)?t.toRawSDP():e:(u.error("No 'video' media found in the sdp: "+e),e)}},{key:"modifyRtxSsrcs2",value:function(e){if("recvonly"===e.direction)return u.debug("RtxModifier doing nothing, video m line is recvonly"),!1;if(e.getSSRCCount()<1)return u.debug("RtxModifier doing nothing, no video ssrcs present"),!1;u.debug("Current ssrc mapping: ",this.correspondingRtxSsrcs);var t=e.getPrimaryVideoSSRCs();u.debug("Parsed primary video ssrcs ",t," making sure all have rtx streams");var n=!0,r=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var l=a.value,d=e.getSSRCAttrValue(l,"msid"),p=e.getSSRCAttrValue(l,"cname"),f=this.correspondingRtxSsrcs.get(l);if(f)u.debug("Already have an associated rtx ssrc forvideo ssrc "+l+": "+f);else{u.debug("No previously associated rtx ssrc for video ssrc "+l);var h=e.getRtxSSRC(l);h?(u.debug("Rtx stream "+h+" already existed in the sdp as an rtx stream for "+l),f=h):(f=s.a.generateSsrc(),u.debug("Generated rtx ssrc "+f+" for ssrc "+l)),u.debug("Caching rtx ssrc "+f+" for video ssrc "+l),this.correspondingRtxSsrcs.set(l,f)}i(e,{id:l,cname:p,msid:d},f)}}catch(e){r=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(r)throw o}}return!0}},{key:"stripRtx",value:function(e){var t=new a.a(e),n=t.selectMedia("video");if(!n)return u.error("No 'video' media found in the sdp: "+e),e;if("recvonly"===n.direction)return u.debug("RtxModifier doing nothing, video m line is recvonly"),e;if(n.getSSRCCount()<1)return u.debug("RtxModifier doing nothing, no video ssrcs present"),e;if(!n.containsAnySSRCGroups())return u.debug("RtxModifier doing nothing, no video ssrcGroups present"),e;var r=n.findGroups("FID");n.removeGroupsBySemantics("FID");var i=!0,o=!1,s=void 0;try{for(var c,l=r[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var d=c.value,p=Object(a.c)(d);n.removeSSRC(p)}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}return t.toRawSDP()}}]),e}();t.a=l}).call(t,"modules/xmpp/RtxModifier.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(26)),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object(i.getLogger)(e),c=function(){function e(t){r(this,e),this.clearVideoSsrcCache(),this.logPrefix=t}return a(e,[{key:"clearVideoSsrcCache",value:function(){this.cachedPrimarySsrc=null,this.injectRecvOnly=!1}},{key:"setPrimarySsrc",value:function(e){if("number"!=typeof e)throw new Error("Primary SSRC must be a number!");this.cachedPrimarySsrc=e}},{key:"hasPrimarySsrcCached",value:function(){return Boolean(this.cachedPrimarySsrc)}},{key:"makeVideoPrimarySsrcsConsistent",value:function(e){var t=new o.a(e),n=t.selectMedia("video");if(!n)return s.error(this.logPrefix+" no 'video' media found in the sdp: "+e),e;if("recvonly"===n.direction)this.cachedPrimarySsrc&&this.injectRecvOnly?n.addSSRCAttribute({id:this.cachedPrimarySsrc,attribute:"cname",value:"recvonly-"+this.cachedPrimarySsrc}):s.info(this.logPrefix+" no SSRC found for the recvonly videostream!");else{var r=n.getPrimaryVideoSsrc();if(!r)return s.info(this.logPrefix+" sdp-consistency couldn't parse new primary ssrc"),e;if(this.cachedPrimarySsrc){s.info(this.logPrefix+" sdp-consistency replacing new ssrc"+r+" with cached "+this.cachedPrimarySsrc),n.replaceSSRC(r,this.cachedPrimarySsrc);var i=!0,a=!1,c=void 0;try{for(var u,l=n.ssrcGroups[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var d=u.value;if("FID"===d.semantics){var p=Object(o.b)(d),f=Object(o.c)(d);p===r&&(d.ssrcs=this.cachedPrimarySsrc+" "+f)}}}catch(e){a=!0,c=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw c}}}else this.cachedPrimarySsrc=r,s.info(this.logPrefix+" sdp-consistency caching primary ssrc"+this.cachedPrimarySsrc);this.injectRecvOnly=!0}return t.toRawSDP()}}]),e}();t.a=c}).call(t,"modules/xmpp/SdpConsistency.js")},function(e,t,n){t.Interop=n(131)},function(e,t,n){"use strict";function r(){this.cache={mlB2UMap:{},mlU2BMap:{}}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(132),a=n(133);e.exports=r,r.prototype.candidateToUnifiedPlan=function(e){var t=new RTCIceCandidate(e);return t.sdpMLineIndex=this.cache.mlB2UMap[t.sdpMLineIndex],t},r.prototype.candidateToPlanB=function(e){var t=new RTCIceCandidate(e);if(0===t.sdpMid.indexOf("audio"))t.sdpMid="audio";else{if(0!==t.sdpMid.indexOf("video"))throw new Error("candidate with "+t.sdpMid+" not allowed");t.sdpMid="video"}return t.sdpMLineIndex=this.cache.mlU2BMap[t.sdpMLineIndex],t},r.prototype.getFirstSendingIndexFromAnswer=function(e){if(!this.cache.answer)return null;var t=o.parse(this.cache.answer);if(t&&t.media&&Array.isArray(t.media))for(var n=0;n<t.media.length;n++)if(t.media[n].type==e&&(!t.media[n].direction||"sendrecv"===t.media[n].direction||"sendonly"===t.media[n].direction))return n;return null},r.prototype.toPlanB=function(e){var t=this;if("object"!==(void 0===e?"undefined":i(e))||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=o.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length<=3&&n.media.every(function(e){return-1!==["video","audio","data"].indexOf(e.mid)}))return console.warn("This description does not look like Unified Plan."),e;for(var r=e.sdp,a=!1,s=0;s<n.media.length;s++)n.media[s].rtp.forEach(function(e){if("NULL"===e.codec){a=!0;var n=o.parse(t.cache.offer);e.codec=n.media[s].rtp[0].codec}});a&&(r=o.write(n)),this.cache[e.type]=r;var c=n.media;n.media=[];var u={},l=[];c.forEach(function(e){if(("string"!=typeof e.rtcpMux||"rtcp-mux"!==e.rtcpMux)&&"inactive"!==e.direction)throw new Error("Cannot convert to Plan B because m-lines without the rtcp-mux attribute were found.");void 0!==u[e.type]&&"inactive"!==u[e.type].direction||(u[e.type]=e)}),c.forEach(function(e){if("application"===e.type)return n.media.push(e),void l.push(e.mid);"object"===i(e.sources)&&Object.keys(e.sources).forEach(function(t){"object"!==i(u[e.type].sources)&&(u[e.type].sources={}),u[e.type].sources[t]=e.sources[t],void 0!==e.msid&&(u[e.type].sources[t].msid=e.msid)}),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&(void 0!==u[e.type].ssrcGroups&&Array.isArray(u[e.type].ssrcGroups)||(u[e.type].ssrcGroups=[]),u[e.type].ssrcGroups=u[e.type].ssrcGroups.concat(e.ssrcGroups)),u[e.type]===e&&(e.mid=e.type,delete e.bundleOnly,delete e.msid,"inactive"!==e.direction&&l.push(e.type),n.media.push(e))}),n.groups.some(function(e){if("BUNDLE"===e.type)return e.mids=l.join(" "),!0}),n.msidSemantic={semantic:"WMS",token:"*"};var d=o.write(n);return new RTCSessionDescription({type:e.type,sdp:d})},r.prototype.toUnifiedPlan=function(e){var t=this;if("object"!==(void 0===e?"undefined":i(e))||null===e||"string"!=typeof e.sdp)return console.warn("An empty description was passed as an argument."),e;var n=o.parse(e.sdp);if(void 0===n.media||!Array.isArray(n.media)||0===n.media.length)return console.warn("The description has no media."),e;if(n.media.length>3||!n.media.every(function(e){return-1!==["video","audio","data"].indexOf(e.mid)}))return console.warn("This description does not look like Plan B."),e;var r=[];n.media.forEach(function(e){r.push(e.mid)});var s=!1;if(void 0!==n.groups&&Array.isArray(n.groups)&&(s=n.groups.every(function(e){return"BUNDLE"!==e.type||a.apply(e.mids.sort(),[r.sort()])})),!s)throw new Error("Cannot convert to Unified Plan because m-lines that are not bundled were found.");var c;void 0!==this.cache[e.type]&&(c=o.parse(this.cache[e.type]));var u={audio:{},video:{}},l={},d=0,p=0;if(n.media.forEach(function(n){if(("string"!=typeof n.rtcpMux||"rtcp-mux"!==n.rtcpMux)&&"inactive"!==n.direction)throw new Error("Cannot convert to Unified Plan because m-lines without the rtcp-mux attribute were found.");if("application"===n.type)return void(l[n.mid]=n);var r=n.sources,o=n.ssrcGroups,a=n.candidates,s=n.iceUfrag,f=n.icePwd,h=n.fingerprint,v=n.port;delete n.sources,delete n.ssrcGroups,delete n.candidates,delete n.iceUfrag,delete n.icePwd,delete n.fingerprint,delete n.port,delete n.mid;var m={};void 0!==o&&Array.isArray(o)&&o.forEach(function(e){"SIM"!==e.semantics&&void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach(function(t){void 0===m[t]&&(m[t]=[]),m[t].push(e)})});var g={};"object"===(void 0===r?"undefined":i(r))&&Object.keys(r).forEach(function(o){var y;if("offer"===e.type&&!r[o].msid)return void(u[n.type][o]=r[o]);if(void 0!==m[o]&&Array.isArray(m[o])&&m[o].some(function(e){return e.ssrcs.some(function(e){if("object"===i(g[e]))return y=g[e],!0})}),"object"===(void 0===y?"undefined":i(y)))y.sources[o]=r[o],delete r[o].msid;else{if(y=Object.create(n),g[o]=y,void 0!==r[o].msid&&(y.msid=r[o].msid,delete r[o].msid),y.sources={},y.sources[o]=r[o],y.ssrcGroups=m[o],void 0!==c&&void 0!==c.media&&Array.isArray(c.media)&&c.media.forEach(function(e){"object"===i(e.sources)&&Object.keys(e.sources).forEach(function(t){t===o&&(y.mid=e.mid)})}),void 0===y.mid){if("answer"===e.type)throw new Error("An unmapped SSRC was found.");y.mid=[n.type,"-",o].join("")}y.candidates=a,y.iceUfrag=s,y.icePwd=f,y.fingerprint=h,y.port=v,l[y.mid]=y,t.cache.mlU2BMap[p]=d,void 0===t.cache.mlB2UMap[d]&&(t.cache.mlB2UMap[d]=p),p++}}),d++}),n.media=[],r=[],"answer"===e.type)for(var f=0;f<c.media.length;f++){var h=c.media[f];void 0===l[h.mid]&&(delete h.msid,delete h.sources,delete h.ssrcGroups,h.direction&&"sendrecv"!==h.direction?"sendonly"===h.direction&&(h.direction="inactive"):h.direction="recvonly"),n.media.push(h),"string"==typeof h.mid&&r.push(h.mid)}else void 0!==c&&void 0!==c.media&&Array.isArray(c.media)&&c.media.forEach(function(e){r.push(e.mid),void 0!==l[e.mid]?n.media.push(l[e.mid]):(delete e.msid,delete e.sources,delete e.ssrcGroups,e.direction&&"sendrecv"!==e.direction||(e.direction="recvonly"),e.direction&&"sendonly"!==e.direction||(e.direction="inactive"),n.media.push(e))}),Object.keys(l).forEach(function(e){-1===r.indexOf(e)&&(r.push(e),"recvonly"===l[e].direction?n.media.some(function(t){if(("sendrecv"===t.direction||"sendonly"===t.direction)&&t.type===l[e].type)return Object.keys(l[e].sources).forEach(function(n){t.sources[n]=l[e].sources[n]}),!0}):n.media.push(l[e]))});["audio","video"].forEach(function(e){if(n&&n.media&&Array.isArray(n.media)){var r=null;if(Object.keys(u[e]).length>0&&null===(r=t.getFirstSendingIndexFromAnswer(e)))for(var i=0;i<n.media.length;i++)if(n.media[i].type===e){r=i;break}if(r&&n.media.length>r){var o=n.media[r];Object.keys(u[e]).forEach(function(t){o.sources&&o.sources[t]&&console.warn("Replacing an existing SSRC."),o.sources||(o.sources={}),o.sources[t]=u[e][t]})}}}),n.groups.some(function(e){if("BUNDLE"===e.type)return e.mids=r.join(" "),!0}),n.msidSemantic={semantic:"WMS",token:"*"};var v=o.write(n);return this.cache[e.type]=v,new RTCSessionDescription({type:e.type,sdp:v})}},function(e,t,n){var r=n(11);t.write=function(e,t){return void 0!==e&&void 0!==e.media&&Array.isArray(e.media)&&e.media.forEach(function(e){void 0!==e.sources&&0!==Object.keys(e.sources).length&&(e.ssrcs=[],Object.keys(e.sources).forEach(function(t){var n=e.sources[t];Object.keys(n).forEach(function(r){e.ssrcs.push({id:t,attribute:r,value:n[r]})})}),delete e.sources),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach(function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.ssrcs=e.ssrcs.join(" "))})}),void 0!==e&&void 0!==e.groups&&Array.isArray(e.groups)&&e.groups.forEach(function(e){void 0!==e.mids&&Array.isArray(e.mids)&&(e.mids=e.mids.join(" "))}),r.write(e,t)},t.parse=function(e){var t=r.parse(e);return void 0!==t&&void 0!==t.media&&Array.isArray(t.media)&&t.media.forEach(function(e){void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&(e.sources={},e.ssrcs.forEach(function(t){e.sources[t.id]||(e.sources[t.id]={}),e.sources[t.id][t.attribute]=t.value}),delete e.ssrcs),void 0!==e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach(function(e){"string"==typeof e.ssrcs&&(e.ssrcs=e.ssrcs.split(" "))})}),void 0!==t&&void 0!==t.groups&&Array.isArray(t.groups)&&t.groups.forEach(function(e){"string"==typeof e.mids&&(e.mids=e.mids.split(" "))}),t}},function(e,t){e.exports=function e(t){if(!t)return!1;if(this.length!=t.length)return!1;for(var n=0,r=this.length;n<r;n++)if(this[n]instanceof Array&&t[n]instanceof Array){if(!e.apply(this[n],[t[n]]))return!1}else if(this[n]!=t[n])return!1;return!0}},function(e,t,n){function r(e,t,n){return e.ssrcs.filter(function(e){return e.id===t}).filter(function(e){return e.attribute===n}).map(function(e){return e.value})[0]}function i(e){this.options=e||{},this.options.numOfLayers||(this.options.numOfLayers=m),console.log("SdpSimulcast: using "+this.options.numOfLayers+" layers"),this.ssrcCache=[]}function o(){return Math.floor(4294967295*Math.random())+0}function a(e,t){null!=e&&Array.isArray(e.media)&&e.media.forEach(function(e){"video"===e.type&&t(e)})}function s(e){return e&&null!=e&&e.type&&""!=e.type&&e.sdp&&""!=e.sdp}function c(e){if(e&&Array.isArray(e.ssrcGroups))for(var t=h(e),n=[],r=e.ssrcGroups.length;r--;)if("SIM"===e.ssrcGroups[r].semantics){for(var i=e.ssrcGroups[r].ssrcs.split(" "),o=0;o<i.length;o++){var a=i[o];n.push(a);var s=t[a].msid.split(" ");t[a].msid=[s[0],"/",o," ",s[1],"/",o].join(""),t[a].cname=[t[a].cname,"/",o].join(""),e.ssrcGroups.forEach(function(e){if("SIM"!==e.semantics){var r=e.ssrcs.split(" ");-1!==r.indexOf(a)&&r.forEach(function(e){t[e].msid=t[a].msid,t[e].cname=t[a].cname,e!==a&&n.push(e)})}})}e.ssrcs=v(t,n),e.ssrcGroups.splice(r,1)}}function u(e){if(!e||!Array.isArray(e.ssrcGroups))return void console.info("Halt: There are no SSRC groups in the remote description.");var t=h(e);e.ssrcGroups.forEach(function(n){if("SIM"===n.semantics){console.info("Imploding SIM group: "+n.ssrcs),n.nuke=!0;for(var r=n.ssrcs.split(" "),i=1;i<r.length;i++){var o=r[i];delete t[o],e.ssrcGroups.forEach(function(e){if("SIM"!==e.semantics){var n=e.ssrcs.split(" ");-1!==n.indexOf(o)&&(n.forEach(function(e){delete t[e]}),e.nuke=!0)}})}}}),e.ssrcs=v(t);for(var n=e.ssrcGroups.length;n--;)e.ssrcGroups[n].nuke&&e.ssrcGroups.splice(n,1)}function l(e){if(e&&Array.isArray(e.invalid))for(var t=e.invalid.length;t--;)"x-google-flag:conference"==e.invalid[t].value&&e.invalid.splice(t,1)}function d(e){e&&(Array.isArray(e.invalid)||(e.invalid=[]),e.invalid.some(function(e){return"x-google-flag:conference"===e.value})||e.invalid.push({value:"x-google-flag:conference"}))}var p=n(11),f=n(135),h=f.parseSsrcs,v=f.writeSsrcs,m=3;i.prototype.clearSsrcCache=function(){this.ssrcCache=[]},i.prototype.setSsrcCache=function(e){this.ssrcCache=e},i.prototype._parseSimLayers=function(e){var t=e.ssrcGroups&&e.ssrcGroups.find(function(e){return"SIM"===e.semantics});return t?t.ssrcs.split(" ").map(function(e){return parseInt(e)}):[e.ssrcs[0].id]},i.prototype._buildNewToOldSsrcMap=function(e,t){for(var n={},r=0;r<e.length;++r){var i=e[r],o=t[r]||null;n[i]=o}return n},i.prototype._fillInSourceDataFromCache=function(e){console.log("SdpSimulcast restoring from cache: ",this.ssrcCache);var t=this._parseSimLayers(e);console.log("SdpSimulcast Parsed new sim ssrcs: ",t);var n=r(e,t[0],"msid"),i=r(e,t[0],"cname"),o=this._buildNewToOldSsrcMap(t,this.ssrcCache);console.log("SdpSimulcast built replacement map: ",o);var a=this.ssrcCache.filter(function(e){return-1===Object.values(o).indexOf(e)});return console.log("SdpSimulcast built ssrcs to add: ",a),e.ssrcs.forEach(function(e){o[e.id]&&(e.id=o[e.id])}),a.forEach(function(t){e.ssrcs.push({id:t,attribute:"msid",value:n}),e.ssrcs.push({id:t,attribute:"cname",value:i})}),e.ssrcGroups=e.ssrcGroups||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:this.ssrcCache.join(" ")}),e},i.prototype._generateSourceData=function(e,t){for(var n=r(e,t,"msid"),i=r(e,t,"cname"),a=[],s=0;s<this.options.numOfLayers-1;++s){var c=o();!function(e,t){e.ssrcs.push({id:t,attribute:"cname",value:i}),e.ssrcs.push({id:t,attribute:"msid",value:n})}(e,c),a.push(c)}return e.ssrcGroups=e.ssrcGroups||[],e.ssrcGroups.push({semantics:"SIM",ssrcs:t+" "+a.join(" ")}),e},i.prototype._restoreSimulcast=function(e){var t,n=e.ssrcs&&e.ssrcs.map(function(e){return e.id}).filter(function(e,t,n){return n.indexOf(e)===t}).length||0,r=e.ssrcGroups&&e.ssrcGroups.length||0;if(0===n||n>2)return e;if(2==n&&0===r)return e;if(1===n)t=e.ssrcs[0].id;else{var i=e.ssrcGroups.filter(function(e){return"FID"===e.semantics})[0];if(!i)return e;t=parseInt(i.ssrcs.split(" ")[0])}return console.log("SdpSimulcast: current ssrc cache: ",this.ssrcCache),console.log("SdpSimulcast: parsed primary ssrc "+t),-1!==this.ssrcCache.indexOf(t)?(console.log("SdpSimulcast: Have seen primary ssrc before, filling in data from cache"),e=this._fillInSourceDataFromCache(e)):(console.log("SdpSimulcast: Have not seen primary ssrc before, generating source data"),e=this._generateSourceData(e,t)),this.ssrcCache=this._parseSimLayers(e),e},i.prototype.mungeRemoteDescription=function(e){if(!s(e))return e;var t=p.parse(e.sdp),n=this;return a(t,function(e){n.options.explodeRemoteSimulcast?c(e):u(e),n.ssrcCache.length<1?l(e):d(e)}),new RTCSessionDescription({type:e.type,sdp:p.write(t)})},i.prototype.mungeLocalDescription=function(e){if(!s(e))return e;var t=p.parse(e.sdp),n=this;return a(t,function(e){"recvonly"!=e.direction&&"inactive"!=e.direction&&n._restoreSimulcast(e)}),new RTCSessionDescription({type:e.type,sdp:p.write(t)})},e.exports=i},function(e,t){t.writeSsrcs=function(e,t){var n=[];if(void 0!==e&&0!==Object.keys(e).length){Array.isArray(t)||(t=[]);for(var r=0;r<t.length;r++){var i=t[r],o=e[i];Object.keys(o).forEach(function(e){n.push({id:i,attribute:e,value:o[e]})})}Object.keys(e).forEach(function(r){if(r=parseInt(r),!(t.indexOf(r)>=0)){var i=e[r];Object.keys(i).forEach(function(e){n.push({id:r,attribute:e,value:i[e]})})}})}return n},t.parseSsrcs=function(e){var t={};return void 0!==e.ssrcs&&Array.isArray(e.ssrcs)&&e.ssrcs.forEach(function(e){t[e.id]||(t[e.id]={}),t[e.id][e.attribute]=e.value}),t}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(4),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t,n){r(this,e),this._callback=n,this._eventFired=!1,t.statistics.addAudioLevelListener(this._audioLevel.bind(this)),t.on(i.TRACK_MUTE_CHANGED,this._trackMuteChanged.bind(this)),t.on(i.TRACK_ADDED,this._trackAdded.bind(this))}return o(e,[{key:"_audioLevel",value:function(e,t,n,r){r&&this.audioTrack&&!this._eventFired&&this.audioTrack.isMuted()&&n>.6&&(this._eventFired=!0,this._callback())}},{key:"_isLocalAudioTrack",value:function(e){return e.isAudioTrack()&&e.isLocal()}},{key:"_trackAdded",value:function(e){this._isLocalAudioTrack(e)&&(this.audioTrack=e)}},{key:"_trackMuteChanged",value:function(e){this._isLocalAudioTrack(e)&&e.isMuted()&&(this._eventFired=!1)}}]),e}();t.a=a},function(e,t,n){function r(){this.audioRecorder=new s,this.transcriptionService=new c,this.counter=null,this.startTime=null,this.transcription=null,this.callback=null,this.results=[],this.state=u,this.lineLength=0}function i(e,t){if(console.log("retrieved an answer from the transcription service. The answer has an array of length: "+t.wordArray.length),t.wordArray.length>0){var n=t.startTime.getUTCMilliseconds()-e.startTime.getUTCMilliseconds();n<0&&(n=0);var r="[";t.wordArray.forEach(function(e){e.begin+=n,e.end+=n,r+=e.word+","}),r+="]",console.log(r),t.wordArray.name=t.name}e.results.push(t.wordArray),e.counter--,console.log("current counter: "+e.counter),e.maybeMerge()}function o(e){for(var t=0;t<e.length;t++)0===e[t].length&&e.splice(t,1);return e.length>0}function a(e,t){if(0===e.length)e.push(t);else{if(e[e.length-1].begin<=t.begin)return void e.push(t);for(var n=0;n<e.length;n++)if(t.begin<e[n].begin)return void e.splice(n,0,t);e.push(t)}}var s=n(54),c=n(139),u="before";r.prototype.start=function(){if(this.state!==u)throw new Error("The transcription can only start when it's in the \""+u+'" state. It\'s currently in the "'+this.state+'" state');this.state="recording",this.audioRecorder.start(),this.startTime=new Date},r.prototype.stop=function(e){var t=this;if("recording"!==this.state)throw new Error('The transcription can only stop when it\'s in the "recording" state. It\'s currently in the "'+this.state+'" state');console.log("stopping recording and sending audio files"),this.audioRecorder.stop();var n=i.bind(null,this);this.audioRecorder.getRecordingResults().forEach(function(e){t.transcriptionService.send(e,n),t.counter++}),this.state="transcribing",this.callback=e},r.prototype.maybeMerge=function(){"transcribing"===this.state&&0===this.counter&&this.merge()},r.prototype.merge=function(){var e=this;console.log("starting merge process!\n The length of the array: "+this.results.length),this.transcription="";var t=this.results,n=[];for(o(t),t.forEach(function(e){return a(n,e)});o(t);)!function(){var n=t[0];t.forEach(function(e){e[0].begin<n[0].begin&&(n=e)});var r=n.shift();for(e.updateTranscription(r,n.name);n.length>0&&"break"!==function(){var i=!1,o=n[0].begin;if(t.forEach(function(e){e[0].begin<o&&(i=!0)}),i)return"break";r=n.shift(),e.updateTranscription(r,null)}(););}();this.state="finished",this.callback&&this.callback(this.transcription)},r.prototype.updateTranscription=function(e,t){void 0!==t&&null!==t&&(this.transcription+="\n"+t+":",this.lineLength=t.length+1),this.lineLength+e.word.length>80&&(this.transcription+="\n    ",this.lineLength=4),this.transcription+=" "+e.word,this.lineLength+=e.word.length+1},r.prototype.addTrack=function(e){this.audioRecorder.addTrack(e)},r.prototype.removeTrack=function(e){this.audioRecorder.removeTrack(e)},r.prototype.getTranscription=function(){if("finished"!==this.state)throw new Error('The transcription can only be retrieved when it\'s in the "finished" state. It\'s currently in the "'+this.state+'" state');return this.transcription},r.prototype.getState=function(){return this.state},r.prototype.reset=function(){this.state=u,this.counter=null,this.transcription=null,this.startTime=null,this.callback=null,this.results=[],this.lineLength=0},e.exports=r},function(e,t){var n=function(e,t,n,r){this.blob=e,this.name=t,this.startTime=n,this.wordArray=r};e.exports=n},function(e,t,n){function r(){var e="config does not contain an url to a Sphinx4 https server";if(void 0===config.sphinxURL)console.log(e);else{var t=config.sphinxURL;if(void 0!==t.includes&&t.includes("https://"))return t;console.log(e)}}var i=n(140),o=n(141),a=n(54),s=function(){this.url=r()};s.prototype=Object.create(i.prototype),s.constructor=s,s.prototype.sendRequest=function(e,t){console.log("sending an audio file  to "+this.url),console.log("the audio file being sent: "+e);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE&&200===n.status)t(n.responseText);else if(n.readyState===XMLHttpRequest.DONE)throw new Error("unable to accept response from sphinx server. status: "+n.status)},n.open("POST",this.url),n.setRequestHeader("Content-Type",a.determineCorrectFileType()),n.send(e),console.log("send "+e)},s.prototype.formatResponse=function(e){var t=JSON.parse(e).objects;t.shift();var n=[];return t.forEach(function(e){return e.filler||n.push(new o(e.word,e.start,e.end))}),n},s.prototype.verify=function(e){if(console.log("response from server:"+e.toString()),"string"!=typeof e)return!1;var t=void 0;try{t=JSON.parse(e)}catch(e){return console.log(e),!1}if(void 0===t.objects)return!1;var n=t.objects;return!(!n[0]||!n[0]["session-id"])},e.exports=s},function(e,t){var n=function(){throw new Error("TranscriptionService is abstract and cannot becreated")};n.prototype.send=function(e,t){var n=this;this.sendRequest(e.blob,function(r){n.verify(r)?e.wordArray=n.formatResponse(r):(console.log("the retrieved response from the server is not valid!"),e.wordArray=[]),t(e)})},n.prototype.sendRequest=function(e,t){throw new Error("TranscriptionService.sendRequest is abstract")},n.prototype.formatResponse=function(e){throw new Error("TranscriptionService.format is abstract")},n.prototype.verify=function(e){throw new Error("TranscriptionService.verify is abstract")},e.exports=n},function(e,t){var n=function(e,t,n){this.word=e,this.begin=t,this.end=n};n.prototype.getWord=function(){return this.word},n.prototype.getBeginTime=function(){return this.begin},n.prototype.getEndTime=function(){return this.end},e.exports=n},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(0),o=(n.n(i),n(143)),a=n(34),s=n(6),c=n.n(s),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=Object(i.getLogger)(e),d=function(){function e(t){r(this,e),this.chatRoom=t,this.eventEmitter=t.eventEmitter,l.info("creating VideoSIPGW"),this.sessions={},this.sessionStateChangeListener=this.sessionStateChanged.bind(this),t.addPresenceListener("jibri-sip-status",this.handleJibriSIPStatus.bind(this)),t.addPresenceListener("jibri-sip-call-state",this.handleJibriSIPState.bind(this))}return u(e,[{key:"handleJibriSIPStatus",value:function(e){var t=e.attributes;if(t){l.log("Handle video sip gw status : ",t);var n=t.status;n===this.status||n!==a.STATUS_UNDEFINED&&n!==a.STATUS_AVAILABLE&&n!==a.STATUS_BUSY||(this.status=n,this.eventEmitter.emit(c.a.VIDEO_SIP_GW_AVAILABILITY_CHANGED,this.status))}}},{key:"handleJibriSIPState",value:function(e){var t=e.attributes;if(t){l.log("Handle video sip gw state : ",t);var n=t.state;if(n!==this.state)switch(n){case a.STATE_ON:case a.STATE_OFF:case a.STATE_PENDING:case a.STATE_RETRYING:case a.STATE_FAILED:var r=t.sipaddress;if(!r)return;var i=this.sessions[r];i?i.setState(n):l.warn("Video SIP GW session not found:",r)}}}},{key:"createVideoSIPGWSession",value:function(e,t){var n=new o.a(e,t,this.chatRoom);return n.addStateListener(this.sessionStateChangeListener),this.sessions[e]&&l.warn("There was already a Video SIP GW session for address",e),this.sessions[e]=n,n}},{key:"isVideoSIPGWAvailable",value:function(){return this.status===a.STATUS_AVAILABLE}},{key:"sessionStateChanged",value:function(e,t){if(t.newState===a.STATE_OFF||t.newState===a.STATE_FAILED){var n=this.sessions[e];if(!n)return void l.error("Missing Video SIP GW session with address:",e);n.removeStateListener(this.sessionStateChangeListener),delete this.sessions[e]}}}]),e}();t.a=d}).call(t,"modules/videosipgw/VideoSIPGW.js")},function(e,t,n){"use strict";(function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=n(0),s=(n.n(a),n(8)),c=n(34),u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=Object(a.getLogger)(e),d=function(e){function t(e,n,o){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return a.sipAddress=e,a.displayName=n,a.chatRoom=o,a.state=void 0,a}return o(t,e),u(t,[{key:"stop",value:function(){if(this.state===c.STATE_OFF||this.state===c.STATE_FAILED)return void l.warn("Video SIP GW session already stopped or failed!");this._sendJibriIQ("stop")}},{key:"start",value:function(){if(this.state===c.STATE_ON||this.state===c.STATE_OFF||this.state===c.STATE_PENDING||this.state===c.STATE_RETRYING)return void l.warn("Video SIP GW session already started!");this._sendJibriIQ("start")}},{key:"setState",value:function(e){if(e!==this.state){var t=this.state;this.state=e,this.eventEmitter.emit(this.sipAddress,{name:"STATE_CHANGED",oldState:t,newState:this.state})}}},{key:"addStateListener",value:function(e){this.addListener("STATE_CHANGED",e)}},{key:"removeStateListener",value:function(e){this.removeListener("STATE_CHANGED",e)}},{key:"_sendJibriIQ",value:function(e){var t=this,n={xmlns:"http://jitsi.org/protocol/jibri",action:e,sipaddress:this.sipAddress};n.displayname=this.displayName;var r=$iq({to:this.chatRoom.focusMucJid,type:"set"}).c("jibri",n).up();l.log("Stop video SIP GW session",r.nodeTree),this.chatRoom.connection.sendIQ(r,function(e){l.log("Result",e);var n=$(e).find("jibri").attr("state");t.setState(n)},function(e){l.log("Failed to start video SIP GW session, error: ",e),t.setState(c.STATE_FAILED)})}}]),t}(s.a);t.a=d}).call(t,"modules/videosipgw/JitsiVideoSIPGWSession.js")},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=n(4),o=n(145),a=n.n(o),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function(){function e(t){r(this,e),this.stats={users:{},dominantSpeakerId:null};var n=t.myUserId();this.stats.users[n]=new a.a(n,null,!0),t.addEventListener(i.DOMINANT_SPEAKER_CHANGED,this._onDominantSpeaker.bind(this)),t.addEventListener(i.USER_JOINED,this._onUserJoin.bind(this)),t.addEventListener(i.USER_LEFT,this._onUserLeave.bind(this)),t.addEventListener(i.DISPLAY_NAME_CHANGED,this._onDisplayNameChange.bind(this))}return s(e,[{key:"_onDominantSpeaker",value:function(e){var t=this.stats.users[this.stats.dominantSpeakerId],n=this.stats.users[e];t&&t.setIsDominantSpeaker(!1),n&&n.setIsDominantSpeaker(!0),this.stats.dominantSpeakerId=e}},{key:"_onUserJoin",value:function(e,t){var n=this.stats.users[e];n||(n=this.stats.users[e]=new a.a(e,t.getDisplayName()))}},{key:"_onUserLeave",value:function(e){var t=this.stats.users[e];t&&t.markAsHasLeft()}},{key:"_onDisplayNameChange",value:function(e,t){var n=this.stats.users[e];n&&n.setDisplayName(t)}},{key:"getStats",value:function(){return this.stats.users}}]),e}();t.a=c},function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r,i){n(this,e),this._userId=t,this.setDisplayName(r),this._isLocalStats=i||!1,this.setIsDominantSpeaker(!1),this.totalDominantSpeakerTime=0,this._dominantSpeakerStart=null,this._hasLeft=!1}return r(e,[{key:"getUserId",value:function(){return this._userId}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"setDisplayName",value:function(e){this.displayName=e}},{key:"isLocalStats",value:function(){return this._isLocalStats}},{key:"isDominantSpeaker",value:function(){return this._isDominantSpeaker}},{key:"setIsDominantSpeaker",value:function(e){if(!this._isDominantSpeaker&&e)this._dominantSpeakerStart=Date.now();else if(this._isDominantSpeaker&&!e){var t=Date.now(),n=t-(this._dominantSpeakerStart||0);this.totalDominantSpeakerTime+=n,this._dominantSpeakerStart=null}this._isDominantSpeaker=e}},{key:"getTotalDominantSpeakerTime",value:function(){var e=this.totalDominantSpeakerTime;return this._isDominantSpeaker&&(e+=Date.now()-this._dominantSpeakerStart),e}},{key:"hasLeft",value:function(){return this._hasLeft}},{key:"markAsHasLeft",value:function(){this._hasLeft=!0,this.setIsDominantSpeaker(!1)}}]),e}();e.exports=i},function(e,t,n){"use strict";function r(e,t){var n=t.find(function(t){return"audiooutput"===t.kind&&t.deviceId===e});n&&p.a.sendActiveDeviceListEvent(c.a.getEventDataForActiveDevice(n))}var i=n(12),o=n.n(i),a=n(55),s=n(3),c=n(24),u=n(1),l=n(7),d=n.n(l),p=n(5),f=new o.a,h={enumerateDevices:function(e){c.a.enumerateDevices(e)},isDeviceListAvailable:function(){return c.a.isDeviceListAvailable()},isDeviceChangeAvailable:function(e){return c.a.isDeviceChangeAvailable(e)},isDevicePermissionGranted:function(e){var t=c.a.getDeviceAvailability();switch(e){case s.b:return!0===t.video;case s.a:return!0===t.audio;default:return!0===t.video&&!0===t.audio}},isMultipleAudioInputSupported:function(){return!u.a.isFirefox()},getAudioOutputDevice:function(){return c.a.getAudioOutputDevice()},setAudioOutputDevice:function(e){var t=c.a.getCurrentlyAvailableMediaDevices();return t&&t.length>0&&r(e,c.a.getCurrentlyAvailableMediaDevices()),c.a.setAudioOutputDevice(e)},addEventListener:function(e,t){f.addListener(e,t)},removeEventListener:function(e,t){f.removeListener(e,t)},emitEvent:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];f.emit.apply(f,[e].concat(n))}};c.a.addListener(d.a.DEVICE_LIST_CHANGED,function(e){return f.emit(a.DEVICE_LIST_CHANGED,e)}),c.a.addListener(d.a.DEVICE_LIST_AVAILABLE,function(e){return r(h.getAudioOutputDevice(),e)}),t.a=h},function(e,t,n){"use strict";(function(e){var r=n(1),i=n(0).getLogger(e),o={getVideoElementName:function(){return r.a.isTemasysPluginUsed()?"object":"video"},findVideoElement:function(e){var t=o.getVideoElementName();if(!r.a.isTemasysPluginUsed())return $(e).find(t)[0];var n=$(e).find(" "+t+'>param[value="video"]');return n.length?(n.length>1&&i.warn("Container with more than one video elements: ",e),n.parent()[0]):void 0},isResizeEventSupported:function(){return!r.a.isTemasysPluginUsed()},setVolume:function(e,t){r.a.isIExplorer()||(e.volume=t)},setAutoPlay:function(e,t){r.a.isIExplorer()||(e.autoplay=t)}};t.a=o}).call(t,"modules/RTC/RTCUIHelper.js")}])});

    //-------------------------------------------------------
    //
    //  etherlynk xmpp
    //
    //-------------------------------------------------------

    function cleanupMedia(name)
    {
        if (lynk.localAudioTracks[name])
        {
            //console.info("cleanupConnection: remove localtrack");

            lynk.localAudioTracks[name].track.stop();
            lynk.localAudioTracks[name].dispose();

            delete lynk.localAudioTracks[name];
        }

        if (lynk.remoteAudioTracks[name])
        {
            var tracks = Object.getOwnPropertyNames(lynk.remoteAudioTracks[name]);

            for(var y = 0; y<tracks.length; y++)
            {
                var id = name + "-" + tracks[y] + 'audio';
                var audio = document.getElementById(id)

                if (audio)
                {
                    console.info("cleanupConnection: remove remotetrack and stop", tracks[y]);

                    lynk.remoteAudioTracks[name][tracks[y]].track.stop();
                    lynk.remoteAudioTracks[name][tracks[y]].detach(audio);
                    audio.parentNode.removeChild(audio);
                }
            }

            delete lynk.remoteAudioTracks[name];
        }

        if (lynk.sip.remoteAudioElements[name])
        {
            var audio = lynk.sip.remoteAudioElements[name];

            if (audio)
            {
                console.info("cleanupConnection: remove remote sip audio", audio);
                audio.parentNode.removeChild(audio);
            }

            delete lynk.sip.remoteAudioElements[name];
        }

    }

    function cleanupConnection(name)
    {
        console.log("cleanupConnection", name);

        cleanupMedia(name);

        if (lynk.conferences[name])
        {
            console.info("cleanupConnection: leave", name);

            lynk.conferences[name].removeTrack(lynk.localAudioTracks[name])
            lynk.conferences[name].leave();

            delete lynk.conferences[name];
        }

        if (lynk.connections[name])
        {
            try {
                lynk.connections[name].disconnect();
            } catch (e) {}

            delete lynk.connections[name];
        }

        if (lynk.sip.sessions && lynk.sip.sessions[name])
        {
            if (lynk.sip.sessions[name].startTime) {
                lynk.sip.sessions[name].bye();

            } else if (lynk.sip.sessions[name].reject) {
                lynk.sip.sessions[name].reject();

            } else if (lynk.sip.sessions[name].cancel) {
                lynk.sip.sessions[name].cancel();
            }

            delete lynk.sip.sessions[name];
        }
    }


    function connectXMPP(name, params, options)
    {
        if (!options) options = setupConfig(pade.server, pade.domain);

        lynk.connections[name] = new JitsiMeetJS.JitsiConnection(null, null, options);
        lynk.connections[name].params = params;

        if (lynk.connections[name])
        {
            lynk.connections[name].addEventListener(JitsiMeetJS.events.connection.CONNECTION_ESTABLISHED, function(id)
            {
                lynk.connections[name].xmpp.connection.connectionmanager.disable();

                JitsiMeetJS.createLocalTracks({devices: ["audio"]}).then(function(tracks)
                {
                    lynk.conferences[name] = setupConference(name, tracks, params);

                }).catch(function (error)
                {
                    console.error("connectXMPP error", error)
                });
            });

            lynk.connections[name].addEventListener(JitsiMeetJS.events.connection.CONNECTION_FAILED, function()
            {
                console.error("Connection Failed!", name)
            });

            lynk.connections[name].addEventListener(JitsiMeetJS.events.connection.CONNECTION_DISCONNECTED, function()
            {
                console.log("Connection Disconnected!", name)
                if (pade.port) pade.port.postMessage({event: "disconnected", id : pade.username, name: name});
            });

            lynk.connections[name].connect();

        } else {
            console.error("JitsiConnection fail", name);
        }
    }


    function setupLocalTracks(name, tracks)
    {
        console.log("setupLocalTracks!", name);

        for(var i = 0; i < tracks.length; i++)
        {
            if(tracks[i].getType() == "audio")
            {
                lynk.localAudioTracks[name] = tracks[i];

                var id = "localAudio-" + name;
                var audio = document.getElementById(id);

                if (!audio)
                {
                    audio = new Audio();
                    audio.id = id;
                    audio.controls = false;
                    audio.autoplay = true;
                    audio.muted = true;
                    audio.volume = 1;
                    document.body.appendChild(audio);
                }

                lynk.localAudioTracks[name].attach(audio);
                break;
            }
        }
    }

    function setupConference(name, tracks, params)
    {
        console.log("setupConference!", name);

        setupLocalTracks(name, tracks)

        var room = lynk.connections[name].initJitsiConference(name, {openSctp: true});

        room.on(JitsiMeetJS.events.conference.TRACK_ADDED, function (track)
        {
            console.log("track addedd!!!", track.getParticipantId());

            if(track.isLocal())
            {
                if (Object.getOwnPropertyNames(lynk.conferences).length == 1)
                {
                    // TODO voice recongnition
                    //console.log("Etherlynk recognition started ok");
                }

                // TODO fix conflict with Jisti
                //if (pade.enableSip) dial(name, {extraHeaders: [ 'X-ofmeet-userid: ' + pade.username, 'X-ofmeet-room: ' + name ]});

                return;
            }

            if (pade.port) pade.port.postMessage({event: "joined", id : track.getParticipantId(), name: name});

            var participant = track.getParticipantId();
            var id = "remoteAudio-" + name;

            if (track.getType() == "audio")
            {
                if (!lynk.remoteAudioTracks[name]) lynk.remoteAudioTracks[name] = {};

                lynk.remoteAudioTracks[name][participant] = track;

                var audio = document.getElementById(id)

                if (!audio)
                {
                    audio = new Audio();
                    audio.id = id;
                    audio.controls = false;
                    audio.autoplay = true;
                    audio.muted = false;
                    audio.volume = 1;
                    document.body.appendChild(audio);
                }
                track.attach(audio);
                track.track.enabled = true;

                if (lynk.localAudioTracks[name]) lynk.localAudioTracks[name].track.enabled = true;

                if (lynk.connections[name] && lynk.connections[name].params && lynk.connections[name].params.mute)
                {
                    lynk.localAudioTracks[name].track.enabled = false;
                }
            }
        });

        room.on(JitsiMeetJS.events.conference.TRACK_REMOVED, function (track)
        {
            console.log("track removed!!!", track, name);

            if (pade.port) pade.port.postMessage({event: "left", id : track.getParticipantId(), name: name});
        });

        room.on(JitsiMeetJS.events.conference.CONFERENCE_JOINED, function ()
        {
            console.log("conference joined!", name, pade.port);
            room.addTrack(lynk.localAudioTracks[name]);

            if (pade.port) pade.port.postMessage({event: "connected", id : pade.username, name: name});

        });
        room.on(JitsiMeetJS.events.conference.CONFERENCE_LEFT, function ()
        {
            console.log("conference left!", name, pade.port);
            room.removeTrack(lynk.localAudioTracks[name]);
        });
        room.on(JitsiMeetJS.events.conference.USER_JOINED, function (id)
        {
            console.log("user join", name, id);
        });
        room.on(JitsiMeetJS.events.conference.USER_LEFT, function (id)
        {
            console.log("user left", name, id);
        });

        room.on(JitsiMeetJS.events.conference.DOMINANT_SPEAKER_CHANGED, function (id)
        {
            console.log("dominant speaker changed", name, id);
        });

        room.join();
        return room
    };


    function handleMessage(json)
    {
        console.log("handleMessage", json);
    }

    function setupConfig(server, domain)
    {
        var sip = server;
        var pos = server.indexOf(":");

        if (pos > -1) sip = server.substring(0, pos);

        return {
                hosts: {
                domain: domain,
                muc: "conference." + domain,
                server: server,
                focus: "focus." + domain,
                sip: sip
            },
            p2p: {
                enabled: true,
                stunServers: [
                    { urls: "stun:stun.l.google.com:19302" },
                    { urls: "stun:stun1.l.google.com:19302" },
                    { urls: "stun:stun2.l.google.com:19302" }
                ],
                preferH264: true
            },
            nickName: pade.username,
            username: pade.username,
            bosh: domain.startsWith("meet.jit.si") ? "https://" + server + "/http-bind" : "wss://" + server + "/ws/",
            clientNode: 'etherlynk'
        };
    }

    //-------------------------------------------------------
    //
    //  etherlynk sip
    //
    //-------------------------------------------------------

    function connectSIP()
    {
        var options = setupConfig(pade.server, pade.domain);
        console.log("connectSIP", options);

        var getTurnServers = function()
        {
            var turnServers = null;

            if (options.iceServers && options.iceServers.iceServers)
            {
                turnServers = [];

                for (var i=0; i<options.iceServers.iceServers.length; i++)
                {
                    if (options.iceServers.iceServers[i].url.indexOf("turn:") > -1 || options.iceServers.iceServers[i].url.indexOf("turns:") > -1)
                    {
                        turnServers.push({urls: options.iceServers.iceServers[i].url, username: options.iceServers.iceServers[i].username, password: options.iceServers.iceServers[i].credential})
                    }
                }
            }

            return turnServers;
        }

        var getStunServers = function()
        {
            var stunServers = null;

            if (options.iceServers && options.iceServers.iceServers)
            {
                stunServers = [];

                for (var i=0; i<options.iceServers.iceServers.length; i++)
                {
                    if (options.iceServers.iceServers[i].url.indexOf("stun:") > -1 || options.iceServers.iceServers[i].url.indexOf("stuns:") > -1)
                    {
                        stunServers.push(options.iceServers.iceServers[i].url)
                    }
                }
            }

            return stunServers;
        }

        var uri = 'sip:default@' + options.hosts.sip;
        var wsServers = "wss://" + options.hosts.server + "/sip/proxy?url=ws://" + options.hosts.sip + ":5066";

        if (pade.sip.authUsername)
        {
            uri = 'sip:' + pade.sip.authUsername + '@' + pade.sip.server;
            wsServers = "wss://" + options.hosts.server + "/sip/proxy?url=ws://" + pade.sip.server + ":5066";
        }

        var sipIdentity = pade.sip.displayPhoneNum ? pade.sip.displayPhoneNum:  options.nickName;

        lynk.sip.sipUI = new SIP.UA(
        {
            password        : pade.sip.password,
            displayName     : sipIdentity,
            uri             : uri,
            wsServers       : wsServers,
            turnServers     : getTurnServers(),
            stunServers     : getStunServers(),
            //rtcpMuxPolicy   : "negotiate",
            registerExpires : 30,
            traceSip        : true,
            log             : {
                level : 1,
            }
        });

        lynk.sip.sipUI.on('connected', function(e) {
            console.log("SIP Connected");
            pade.sip.registered = false;
        });

        lynk.sip.sipUI.on('disconnected', function(e) {
            console.log("SIP Disconnected");
            pade.sip.registered = false;
        });

        lynk.sip.sipUI.on('registered', function(e) {

            if (!pade.sip.registered)
            {
                notifyText("SIP Phone", "Registered",null,null,null,"sip-notify");
                pade.sip.registered = true;

                if (pade.sip.authUsername) setSipStatus("Registered");

                console.log("SIP Registered");
            }
        });

        lynk.sip.sipUI.on('registrationFailed', function(e) {
            console.log("Error: Registration Failed");
            pade.sip.registered = false;
            if (pade.sip.authUsername) setSipStatus("Registered");
        });

        lynk.sip.sipUI.on('unregistered', function(e) {
            console.log("Error: Unregistered");
            pade.sip.registered = false;
            if (pade.sip.authUsername) setSipStatus("Registered");
        });

        lynk.sip.sipUI.on('message', function(message) {
            console.log("SIP Message", message.body);

            var data = {};

            if (message.body.substring(0, 1) == "{")
            {
                try {
                    data = JSON.parse(message.body);

                    console.log("JSON Object", data);

                } catch (e) {
                    console.error(e);
                }
            }
        });

        lynk.sip.sipUI.on('invite', function (incomingSession) {
            console.log("SIP Invite", incomingSession.request);

            var id = incomingSession.remoteIdentity.uri.user;
            lynk.sip.sessions[id] = incomingSession;

            setupCallHandlers(incomingSession);

            JitsiMeetJS.createLocalTracks({devices: ["audio"]}).then(function(tracks)
            {
                setupLocalTracks(id, tracks);
                accept(id);

            }).catch(function (error)
            {
                console.error("sip invite error", error)
            });
        });
    }

    function setupCallHandlers(newSess)
    {
        var displayName = newSess.remoteIdentity.displayName
        var uri = newSess.remoteIdentity.uri.toString();
        var id = newSess.remoteIdentity.uri.user;

        newSess.on('progress', function(e) {
            console.log("progress", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "progress", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('connecting', function(e) {
            console.log("connecting", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "connecting", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('accepted', function(e) {
            console.log("accepted", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "connected", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('hold', function(e) {
            console.log("hold", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "hold", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('unhold', function(e) {
            console.log("unhold", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "unhold", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('muted', function(e) {
            console.log("muted", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "muted", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('unmuted', function(e) {
            console.log("unmuted", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "unmuted", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('cancel', function(e) {
            console.log("cancel", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "cancel", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('bye', function(e) {
            console.log("bye", displayName, uri);
            cleanupMedia(id);
            if (pade.port) pade.port.postMessage({event: "disconnected", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('failed', function(e) {
            console.log("failed", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "failed", name: id, uri: uri, displayName: displayName});
        });

        newSess.on('rejected', function(e) {
            console.log("rejected", displayName, uri);
            if (pade.port) pade.port.postMessage({event: "rejected", name: id, uri: uri, displayName: displayName});
        });
    }

    function acceptSipCall(id)
    {
        console.log("acceptSipCall", id);

        lynk.sip.sessions[id].accept({
            media : {
            stream      : lynk.localAudioTracks[id].stream,
            constraints : { audio : true, video : false },
            render      : { remote : new Audio()},
            }
        });

        notifyText("SIP Phone", "Connected",null,null,null,"sip-notify");
    }

    function accept(id)
    {
        console.log("accept", id);

        if (lynk.sip.sessions[id].request.headers["Call-Info"] &&
            lynk.sip.sessions[id].request.headers["Call-Info"][0] &&
            lynk.sip.sessions[id].request.headers["Call-Info"][0].raw.indexOf("answer-after=0") > -1)
        {
            acceptSipCall(id);
        }
        else

        if (pade.port)
        {
            var displayName = lynk.sip.sessions[id].remoteIdentity.displayName;
            var uri = lynk.sip.sessions[id].remoteIdentity.uri.toString();

            pade.port.postMessage({event: "invited", name: id, uri: uri, displayName: displayName});

        } else {

            if (pade.sip.window == null)
            {
                openPhoneWindow(false);
                pade.sip.incomingSession = lynk.sip.sessions[id];
                pade.sip.incomingCall = true;
            }
        }
    }

    function hangup(name)
    {
        if (lynk.sip.sessions[name])
        {
            if (lynk.sip.sessions[name].startTime) {
                lynk.sip.sessions[name].bye();

            } else if (lynk.sip.sessions[name].reject) {
                lynk.sip.sessions[name].reject();

            } else if (lynk.sip.sessions[name].cancel) {
                lynk.sip.sessions[name].cancel();
            }

            delete lynk.sip.sessions[name];
        }
    }

    function dial(name, options)
    {
        console.log("dial", name, options);

        if (!options) options = {};

        var setupRemoteAudio = function(name)
        {
            console.log("setupRemoteAudio!", name);

            var id = "remoteAudio-sip-" + name;
            var audio = document.getElementById(id);

            if (!audio)
            {
                audio = new Audio();
                audio.id = id;
                audio.controls = false;
                audio.autoplay = true;
                audio.muted = false;
                audio.volume = 1;
                document.body.appendChild(audio);
            }

            lynk.sip.remoteAudioElements[name] = audio;
            return audio;
        }

        try {

            JitsiMeetJS.createLocalTracks({devices: ["audio"]}).then(function(tracks)
            {
                setupLocalTracks(name, tracks);

                lynk.sip.sessions[name] = lynk.sip.sipUI.invite(name,
                {
                    media : {
                        stream      : lynk.localAudioTracks[name].stream,
                        constraints : { audio : true, video : false },
                        render      : { remote : setupRemoteAudio(name)},
                    },
                    extraHeaders: options.extraHeaders
                });

                lynk.sip.sessions[name].direction = 'outgoing';
                lynk.sip.sessions[name].sessionId  = Math.random().toString(36).substr(2, 9);

                setupCallHandlers(lynk.sip.sessions[name]);

            }).catch(function (error)
            {
                console.error("sip invite error", error)
            });

        } catch(e) {
            console.error("dial failed", e);
        }
    }

    function startJitsiAudio(name, params, state)
    {
        var url = name.split("/");

        if (url.length == 4)
        {
            var jid = url[2].split(":");
            var domain = jid[0];
            var host = url[2];

            if (jid[0].indexOf("@") > -1)
            {
                domain = jid[0].split("@")[1];
                host = url[2].split("@")[1];

                // conversation, alert far party
                inviteToConference(jid[0], url[3]);
            }

            connectXMPP(url[3], params, setupConfig(host, domain));

        } else {
            var msg = "Bad jitsi-meet conference room: " + name + ", expecting https://domain:port/room";
            console.error(msg, url);
            notifyText("Communicator", msg);
        }
    }

    function uploadFile(file, room)
    {
        var putUrl = "https://" + pade.server + "/dashboard/upload?name=" + file.name + "&username=" + pade.username;

        var req = new XMLHttpRequest();

        req.onreadystatechange = function()
        {
          if (this.readyState == 4 && this.status >= 200 && this.status < 400)
          {
            console.log("uploadFile", this.statusText);
          }
          else

          if (this.readyState == 4 && this.status >= 400)
          {
            console.error("uploadFile", this.statusText);
          }

        };
        req.open("PUT", putUrl, true);
        req.setRequestHeader("Authorization", 'Basic ' + btoa(pade.username+':'+pade.password));
        req.send(file);
    }

    function dataUrlToFile(dataUrl, name)
    {
        //console.log("dataUrlToFile", dataUrl, name);

        var binary = atob(dataUrl.split(',')[1]),
        data = [];

        for (var i = 0; i < binary.length; i++)
        {
            data.push(binary.charCodeAt(i));
        }

        return new File([new Uint8Array(data)], name, {type: 'video/webm'});
    }

    //-------------------------------------------------------
    //
    //  etherlynk media public
    //
    //-------------------------------------------------------

    lynk.stopRecorder = function()
    {
        console.log("stopRecorder");

        if (lynk.audioRecorder) lynk.audioRecorder.stop();
        if (lynk.videoRecorder) lynk.videoRecorder.stop();
    }

    lynk.startRecorder = function(localAudioStream, localVideoStream, room, nickname)
    {
        console.log("startRecorder", nickname, room, localAudioStream, localVideoStream);

        if (getSetting("recordAudio", false) || getSetting("recordVideo", false))
        {
            lynk.audioRecorder = new MediaRecorder(localAudioStream);
            lynk.audioChunks = [];

            lynk.audioRecorder.ondataavailable = function(e)
            {
                if (e.data.size > 0)
                {
                    console.log("startRecorder push audio ", e.data);
                    lynk.audioChunks.push(e.data);
                }
            }

            lynk.audioRecorder.onstop = function(e)
            {
                var audioReader = new FileReader();

                audioReader.onload = function()
                {
                    var file = dataUrlToFile(audioReader.result, room + "." + nickname + ".audio.webm");
                    console.log("audioReader.onload", file);
                    uploadFile(file, room);
                };

                audioReader.readAsDataURL(new Blob(lynk.audioChunks, {type: 'video/webm'}));
            }

            lynk.audioRecorder.start();
        }

        if (getSetting("recordVideo", false))
        {
            lynk.videoRecorder = new MediaRecorder(localVideoStream);
            lynk.videoChunks = [];

            lynk.videoRecorder.ondataavailable = function(e)
            {
                if (e.data.size > 0)
                {
                    console.log("startRecorder push video ", e.data);
                    lynk.videoChunks.push(e.data);
                }
            }

            lynk.videoRecorder.onstop = function(e)
            {
                var videoReader = new FileReader();

                videoReader.onload = function()
                {
                    var file = dataUrlToFile(videoReader.result, room + "." + nickname + ".video.webm");
                    console.log("videoReader.onload", file);
                    uploadFile(file, room);
                };

                videoReader.readAsDataURL(new Blob(lynk.videoChunks, {type: 'video/webm'}));
            }

            lynk.videoRecorder.start();
        }
    }

    //-------------------------------------------------------
    //
    //  etherlynk xmpp public
    //
    //-------------------------------------------------------

    lynk.connect = function()
    {
        JitsiMeetJS.setLogLevel(JitsiMeetJS.logLevels.ERROR);

        JitsiMeetJS.init({disableAudioLevels: true}).then(function()
        {
            console.log("etherlynk connect");

            // TODO - merge with ofmeet SIP
            // Issue with SIP and JitsiMeet chat

        }).catch(function (error) {
            console.log(error);
        });

        lynk.sip.sessions = {}
        lynk.sip.remoteAudioElements = {};
    }

    lynk.disconnect = function()
    {
        console.log("etherlynk disconnect");

        var items = Object.getOwnPropertyNames(lynk.connections);

        for(var z = 0; z<items.length; z++)
        {
            cleanupConnection(items[z]);
        }

        if (lynk.sip.sipUI)
        {
            lynk.sip.sipUI.unregister();
            lynk.sip.sipUI.stop();
        }

        console.log("Etherlynk logoff ok");
    }

    lynk.join = function(name, params, state)
    {
        console.log("etherlynk join " + name, params, state);

        if (name.startsWith("tel:"))
        {
            if (state == "invited")
            {
                acceptSipCall(name.substring(4));

            } else {
                dial(name.substring(4), {});
            }

        } else {

            // name can be [https://name@domain:port/room] or just [room]

            if (name.startsWith("https://") || name.startsWith("http://"))
            {
                if (name.indexOf(pade.server) > -1)         // own videobridge
                {
                    startJitsiAudio(name, params, state);

                } else {
                    openVideoWindowUrl(name);
                }
            }
            else connectXMPP(name, params);
        }
    }

    lynk.mute = function(name)
    {
        if (name.startsWith("https://") || name.startsWith("http://")) name = name.split("/")[3];

        if (lynk.localAudioTracks[name])
        {
            lynk.localAudioTracks[name].track.enabled = !lynk.localAudioTracks[name].track.enabled;
            return !lynk.localAudioTracks[name].track.enabled;
        }
        return false;
    }

    lynk.muteLocal = function(name, flag)
    {
        if (name.startsWith("https://") || name.startsWith("http://")) name = name.split("/")[3];

        if (lynk.localAudioTracks[name])
        {
            lynk.localAudioTracks[name].track.enabled = !flag;
            return !lynk.localAudioTracks[name].track.enabled;
        }
        return false;
    }

    lynk.leave = function(name)
    {
        if (name.startsWith("tel:"))
        {
            hangup(name.substring(4));

        } else {

            if (name.startsWith("https://") || name.startsWith("http://")) name = name.split("/")[3];

            if (lynk.connections[name])
            {
                lynk.connections[name].xmpp.connection.ping.stopInterval();
                cleanupConnection(name);

                console.log("Etherlynk leave " + name);
            }

            try {
                if (Object.getOwnPropertyNames(lynk.conferences).length == 0)
                {
                    // TODO voice recognition
                    //console.log("Etherlynk recognition stopped");
                }

            } catch (e) {
                console.error(e);
            }
        }
    }

    //-------------------------------------------------------
    //
    //  etherlynk sip public
    //
    //-------------------------------------------------------

    lynk.connectSIP = function()
    {
        connectSIP();
    }

    lynk.dial = function(destination, options)
    {
        dial(destination, options);
    }

    lynk.accept = function(name)
    {
        acceptSipCall(name);
    }

    lynk.hangup = function(name)
    {
        hangup(name);
    }

    lynk.getSipWebRtc = function()
    {
        return SIP.WebRTC;
    }

    lynk.getSipUI = function()
    {
        return lynk.sip.sipUI;
    }

    lynk.sipReady = function()
    {
        console.debug("sipReady", pade.sip);

        if (pade.sip.incomingCall && pade.sip.incomingSession)
        {
            pade.sip.incomingCall = false;

            try {
                lynk.sip.sipUI.emit("uiinvite", pade.sip.incomingSession);
            } catch (e) {}
        }
    }

    lynk.remoteAudioTracks = {};
    lynk.localAudioTracks = {};

    lynk.connections = {};
    lynk.conferences = {};
    lynk.sip = {};

    return lynk;

}(etherlynk || {}));